# Float Chat

### Float Chat 계기

- 계기
  - 미니 커뮤니티 플랫폼 프로젝트를 마무리하고 React와 TypeScript 그리고 WebSocket을 활용해 새로운 포트폴리오 프로젝트를 제작하고 싶어서 찾아본 결과, 실시간 통신 애플리케이션 내용이 단계별로 여러 내용을 연습할 수 있을 것 같기에 선택하게 됨

<br />

### Float Chat 제작 툴

- 제작 툴 선택 과정
  - React와 Next.js 중에 고민했으나, React를 더 깊이 익히는 것이 중요하다고 판단하여 이번 프로젝트에서도 React를 선택했으며, 상태 관리는 기존의 Context API 대신 Zustand를 사용해 더 단순하고 효율적인 관리 방식을 도입할 계획이고, 코드 안정성을 높이기 위해 TypeScript를 활용하기로 결정했고, 그리고 백엔드는 Express JS가 가장 익숙하고 자신 있기 때문에 선택하게 되었고, DB는 MySQL이 현재 프로젝트에서 사용하기에 적합하다고 생각이 되지만, 가장 많이 다뤄본 MongoDB가 배포 과정에서 더 편리하다고 생각되어 최종적으로 MongoDB를 선택하게 되었다.
- 최종 선택
  - FE : React + TypeScript (vite)
    - 상태 관리 : Zustand
  - BE : Express JS
  - DB : MongoDB

<br />

### Float Chat UI 설계

- UI 설계
  - 페이지 설계
    - 메인 페이지
      - 비로그인 상태
        - 기본적으로 로그인이 필요하다는 텍스트 메시지 출력
        - 회원가입 또는 로그인 버튼
          - 모달을 통해 보여지도록 구성 예정
        - 임의의 버튼 클릭 시 회원가입 또는 로그인 하러가기 모달 표시
          - 회원가입 또는 로그인 모달이 보여지고, 둘 중 하나 클릭 시 해당 모달로 전환
      - 로그인 상태
        - 다이렉트 메시지로 이동하는 버튼
          - 친구 버튼
            - 모두
            - 온라인
            - 친구 대기 목록
            - 친구 추가
          - 다이렉트 메시지
            - 1:1 대화를 나눈 상대 표시
        - 참여한 방을 이동하는 버튼
        - 새롭게 방을 추가할 수 있는 버튼
    - 방 페이지
      - 사용자를 초대할 수 있는 코드 또는 링크를 복사하는 버튼
      - 텍스트를 입력할 수 있는 입력창
      - 참여한 사용자 목록 창
        - 온라인과 오프라인을 나눠서 구분
  - 컴포넌트 설계
    - 메인 폴더
      - 메인 페이지 컴포넌트
    - 친구 폴더
      - 친구 목록 컴포넌트
      - 친구 컴포넌트
      - 온라인 친구 컴포넌트
      - 친구 추가 컴포넌트
    - 채팅 폴더
      - 1:1 채팅 컴포넌트
        - 채팅을 모아서 보여주는 컴포넌트
        - 채팅 컴포넌트
      - 그룹 채팅 컴포넌트
        - 그룹 채팅을 모아서 보여주는 컴포넌트
        - 그룹 채팅 컴포넌트
    - 방 폴더
      - 개인 채팅방 컴포넌트
        - 채팅방을 모아서 보여주는 컴포넌트
        - 채팅방 컴포넌트
      - 그룹 채팅방 컴포넌트
        - 그룹 채팅방을 모아서 보여주는 컴포넌트
        - 그룹 채팅방 컴포넌트
        - 그룹 채팅방 추가 컴포넌트
    - 사용자 폴더
      - 회원가입 컴포넌트
      - 로그인 컴포넌트
      - 프로필 컴포넌트
      - 프로필 수정 컴포넌트
    - 재사용 컴포넌트
      - 모달 컴포넌트
      - 옵션 컴포넌트
      - 채팅 입력 컴포넌트
      - 오류 관련 컴포넌트

<br />

### Float Chat UI 구조 추가 내용

- 전체 UI 구조
  - 사이드 바
    - 다이렉트 메시지
    - 그룹 채팅방 목록
      - 그룹 채팅방
      - 그룹 채팅방 추가 버튼
  - 사이드 바와 컨텐츠 영역 중간 내용
    - 다이렉트 메시지
      - 친구 목록
      - 다이렉트 메시지 목록
        - 다이렉트 메시지
    - 그룹 채팅방
      - 그룹 채팅방 이름
      - 그룹 채팅방 초대 링크 생성 버튼
      - 그룹 채팅방 참여자 목록
  - 컨텐츠 영역
    - 친구 목록
      - 온라인
        - 친구 검색란
        - 온라인 친구 목록
      - 모두
        - 친구 검색란
        - 전체 친구 목록
      - 대기 중
        - 친구 신청한 목록
      - 친구 추가하기
        - 모달로 렌더링할 지, 컴포넌트로 렌더링할 지 아직 고려중
    - 다이렉트 메시지, 그룹 채팅방
      - 친구와 나눈 채팅 목록
        - 내용 왼쪽에 아이콘
          - 아이콘에 이미지를 추가할 지, 배경이 랜덤으로 색이 지정되도록 할 지 생각 중
          - 기본적인 아이콘을 제공하고 배경이 랜덤색으로 지정되도록 해 주고, 이미지를 추가할 수 있게 하는 것도 고려 중
        - 닉네임, 메시지 보낸 날짜
          - 메시지 보낸 날짜는 년.월.일.오전 0:00
        - 채팅 내용
      - 메시지 중간에 날짜가 변경되면, 변경된 날짜를 한 줄로 표시
      - 이 두 내용은 동일한 컴포넌트를 재사용해도 될 것 같다는 생각
  - 헤더 영역
    - 친구 목록
      - 친구 아이콘 및 텍스트
      - 온라인 (접속한 친구 목록)
      - 모두 (전체 친구 목록)
      - 대기중 (친구 신청 목록)
      - 친구 추가하기 버튼
    - 다이렉트 메시지
      - 대화하는 친구 닉네임
    - 그룹 채팅방
      - 디스코드 앱에서는 "#일반" 이라는 내용이 보여지는데, 나는 없애는 것도 고려 중이고, 아니면 추후 웹 확장을 위해 비슷하게 내용이 보여지는 것을 생각 중
  - 모달
    - 그룹 채팅방 생성 모달
      - 모달 설명
      - 서버 이름 입력란
      - 취소, 만들기 버튼
    - 그룹 채팅방 초대 링크 모달
      - 모달 설명
      - 친구 검색란
      - 친구 목록
      - 초대 링크, 복사 버튼
    - 로그인 모달
      - 모달 설명
      - 이메일
      - 비밀번호
    - 회원가입 모달
      - 모달 설명
      - 이메일
      - 닉네임
      - 비밀번호
      - 비밀번호 확인
      - 취소, 만들기 버튼
    - 회원가입 인증 모달
      - 모달 설명
      - 이메일에서 확인한 초대 링크
    - 친구 추가하기 모달
      - 모달 설명
      - 닉네임 + #0000 또는 이메일 검색, 요청 보내기 버튼
      - 이 내용은 모달이 아닌, 친구 추가하기 버튼 클릭 시 다른 컴포넌트 내용이 렌더링되는 것도 고려 중

<br />

### Float Chat 라우터 및 페이지, 컴포넌트 구조

- 루트 레이아웃
  - 사이드 바 컴포넌트
    - 다이렉트 메시지 컴포넌트 (친구, 다이렉트 메시지가 보여지는 페이지로 이동)
    - 그룹 채팅방 목록 컴포넌트
      - 그룹 채팅방 컴포넌트
      - 그룹 채팅방 추가 버튼 컴포넌트
- 다이렉트 메시지 페이지
  - 중간 영역
    - 친구 목록 컴포넌트
    - 다이렉트 메시지 목록 컴포넌트
      - 다이렉트 메시지 컴포넌트
  - 콘텐츠 영역
    - 친구 목록 컴포넌트
      - 헤더 컴포넌트
        - 온라인, 모두, 대기 중, 친구 추가하기 버튼
      - 콘텐츠 컴포넌트
        - 조건부로 온라인, 모두, 대기 중 항목을 나눠서 출력
        - 헤더 컴포넌트에서 선택한 버튼에 따라 알맞는 링크 컴포넌트 동작 또는 컴포넌트 내용 렌더링
        - 조건에 일치하는 친구 목록 렌더링 (다이렉트 메시지 컴포넌트)
      - 추가로, 친구 목록에 대한 내용
        - 친구 목록은 온라인, 모두, 대기 중을 구분해 다르게 보여지도록 분할 예정
        - 온라인, 모두, 대기 중 내용은 별도의 컴포넌트를 나누는 것은 생각이 필요
        - 별도의 컴포넌트없이 조건부로 가능할 것으로 예상
        - 또 다른 생각으로 온라인, 모두, 대기 중 클릭에 따라 친구 목록이 다르게 보여져야 하기 때문에 별도의 컴포넌트가 좋을 수도 있다고 생각됨
    - 다이렉트 메시지 컴포넌트
      - 헤더 컴포넌트
        - 대화하는 친구 닉네임
      - 콘텐츠 컴포넌트
        - 메시지 내용
- 그룹 채팅방 페이지
  - 현재는 그룹 채팅방 목록이 보여지지만, 앞으로는 그룹 채팅방 목록이 사이드 바에서 보여질 예정이기 때문에 해당 페이지에서는 그룹 채팅방에 이동하면 내용이 보여지는 쪽으로 구성을 해 줘야 함
    - 아직 생각이고, 확정은 아님
  - 그룹 채팅방 세부 컴포넌트
    - 중간 영역
      - 서버 이름
      - 초대 링크
      - 채팅방 참여자 목록
    - 콘텐츠 영역
      - 헤더 컴포넌트
        - "#일반" 텍스트 내용
      - 콘텐츠 컴포넌트
        - 메시지 내용
- 재사용할 수 있는 컴포넌트 (새롭게 생각한 내용만 추가)
  - 헤더 컴포넌트
    - 다이렉트 메시지는 친구 닉네임이 보여지도록 하고, 그룹 채팅방은 일반 텍스트가 보여지도록 조건부로 구성하면 될 것 같음
  - 콘텐츠 컴포넌트
    - 콘텐츠 컴포넌트 내에 채팅 내용을 출력하는 부분이 있다면 이 내용은 재사용할 수 있을 것으로 예상
    - 다이렉트 메시지 또는 그룹 채팅방 \_id 정보를 받아와서 그 \_id에 해당하는 모든 메시지 내용을 출력
  - 모달
    - UI 설계 내용과 중복될 것 같아서 작성하지 않았고, 조금 많은 부분에서 사용될 예정이라서 확실하게 재사용할 수 있을 지 장담할 수 없음
    - 재사용하기 애매하다면 따로따로 구성할 계획

<br />

### Float Chat BE 설계

- 백엔드 설계
  - 사용자 라우터
    - 회원가입과 관련된 POST 라우터
    - 로그인과 관련된 POST 라우터
    - 액세스 토큰 확인하는 GET 라우터
    - 리프레쉬 토큰 확인하는 GET 라우터
    - 리프레쉬 토큰 만료 시간 확인하는 GET 라우터
    - 로그아웃과 관련된 POST 라우터
    - 프로필 정보를 가져오는 GET 라우터
    - 프로필 내용을 수정하는 PATCH 라우터
  - 메인 페이지 라우터
    - 로그인한 사용자 정보를 불러오는 GET 라우터
    - 사용자 정보 수정을 위한 PATCH 라우터
    - 친구 추가와 관련된 POST 라우터
    - 친구 삭제와 관련된 DELETE 라우터
    - 다이렉트 메시지를 나눈 상대 목록을 불러오는 GET 라우터
    - 다이렉트 메시지 목록을 지우는 DELETE 라우터
    - 그룹 채팅방 목록을 불러오는 GET 라우터
    - 그룹 채팅방을 추가하는 POST 라우터
    - 그룹 채팅방 나가는 DELETE 라우터
      - 사용자 본인이 만든 채팅방이 아닌, 참여한 채팅방
  - 개인 채팅방 라우터
    - 채팅을 나눈 상대방 정보를 불러오는 GET 라우터
  - 그룹 채팅방 라우터
    - 참여한 모든 사용자 정보를 불러오는 GET 라우터
    - 채팅방 제목, 기타 내용 수정하는 PATCH 라우터
    - 채팅방 삭제와 관련된 DELETE 라우터
      - 채팅방을 만든 사용자만 사용 가능
  - 개인 채팅 라우터
    - 메시지를 불러오는 GET 라우터
    - 메시지 저장과 관련된 POST 라우터
  - 그룹 채팅 라우터
    - 메시지를 불러오는 GET 라우터
    - 메시지 저장과 관련된 POST 라우터

<br />

### Float Chat DB 설계

- DB 설계
  - 사용자 (users)
    - 사용자 정보가 저장된 컬렉션
    - 속성 내용
      - \_id
      - 이메일
      - 이름
      - 닉네임
      - 프로필 사진 URL
      - 타입
        - ex) 자리 비움, 온라인, 다른 용무 중
      - 계정 생성일
      - 친구 추가된 사용자 저장
        - 저장된 친구 \_id
        - 이메일
        - 이름
        - 닉네임
        - 타입
          - 온라인 유무 구분을 위해 사용
          - 온라인, 오프라인, 자리 비움, 다른 용무 중 등
      - 친구 추가 대기중인 정보 저장
        - 친구 \_id
        - 친구 이메일
        - 친구 이름
        - 친구 닉네임
        - 타입
          - 보낸 요청 또는 받은 요청 구분을 위해 사용
          - send 또는 receive
  - 개인 채팅방 (privateRooms)
    - 사용자 두 명의 정보가 저장된 컬렉션
    - 속성 내용
      - 방 코드 번호
        - 방 자체 \_id
      - 방 생성일
        - 방 생성일자를 저장해 방 관리 목적으로 사용
        - ex) 오래된 방 삭제
      - 참여한 사용자 두 명의 정보
        - \_id, 이메일, 이름, 닉네임
  - 방 (rooms)
    - 방 정보가 저장된 컬렉션
    - 속성 내용
      - 방 코드 번호
        - 방 자체 \_id
      - 방 이름
        - 그룹 채팅방 구분을 위해 사용자가 방 이름을 지정
      - 방 설명
        - 방 목적이나 주제 설명을 추가할 수 있음
        - 꼭 필요한 항목은 아님
      - 방 생성일
        - 방 생성일자를 저장해 방 관리 목적으로 사용
      - 참여한 모든 사용자 정보
        - \_id, 이메일, 이름, 닉네임, 온라인 여부
  - 개인 채팅 (privateChats)
    - 개인간의 채팅 메시지를 저장하는 컬렉션
    - 속성 내용
      - 개인 채팅방 \_id
      - 보낸 사람 \_id
      - 받은 사람 \_id
        - 이 내용은 필요 없을 수도 있음
      - 보낸 사람 이메일, 이름, 닉네임
      - 채팅 메시지 내용
      - 채팅 입력 날짜
      - 읽음 상태 유무
        - 메시지가 읽혔는지 여부를 확인하기 위한 속성
        - ex) true 또는 false로 확인
  - 그룹 채팅 (groupChats)
    - 방에서 입력된 채팅 메시지를 저장하는 컬렉션
    - 속성 내용
      - 방 \_id
      - 보낸 사람 \_id
      - 보낸 사람 이메일, 이름, 닉네임
      - 채팅 메시지 내용
      - 채팅 입력 날짜
      - 읽음 상태 유무
        - 메시지가 읽혔는지 여부를 확인하기 위한 속성
        - ex) true 또는 false로 확인
        - ex) [] 배열을 추가해 읽은 사용자 \_id를 저장
