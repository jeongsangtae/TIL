# 오늘 한 일

### React + TypeScript 프로젝트 제작 (React, TypeScript, ExpressJS, MongoDB로 만드는 실시간 통신 애플리케이션)

- 그룹 채팅방 호스트 아바타 색 데이터 저장 및 그룹 채팅방 호스트 아바타 색 업데이트 추가 및 그룹 채팅방 수정 관련 날짜 데이터 삭제
  - 그룹 채팅방 생성 시에 호스트 아바타 색도 함께 저장하도록 구성하고 그룹 채팅방 제목 수정 시에 제목 내용만 업데이트되고 날짜 데이터는 변경되지 않도록 삭제해주었으며, 사용자가 아바타 색을 수정하면 자신이 생성한 그룹 채팅방에 저장된 호스트 아바타 색 내용도 함께 수정되도록 내용 추가
  - 백엔드
    - user-routes
      - 사용자 정보 수정하는 PATCH 라우터 수정
        - 그룹 채팅방 데이터에 저장된 호스트 닉네임만이 아닌, 호스트 아바타 색도 업데이트되어 저장되도록 수정
    - group-chat-routes
      - 그룹 채팅방 추가하는 POST 라우터
        - 새롭게 추가하는 그룹 채팅방 정보에 hostAvatarColor 항목을 추가해 그룹 채팅방을 생성한 사용자 아바타 색이 포함되도록 구성
      - 그룹 채팅방 수정하는 PATCH 라우터
        - date 관련 내용을 주석 처리
        - 업데이트되는 내용에 \_id를 제외한 그룹 채팅방 제목만 포함시켜도록 수정
  - 프론트엔드
    - groupChatStore
      - groupChatForm 액션 수정
        - userInfo 내용을 통해 avatarColor도 불러오도록 구성
        - requestBody에 avatarColor 항목도 포함시켜 백엔드로 전달하도록 구성
    - GroupChats
      - 넘어오는 props 관련 타입 정의에 "hostAvatarColor"도 포함시켜 제외하도록 수정
    - types
      - GroupChatData 타입 정의 수정
        - hostAvatarColor 항목을 추가해 string으로 정의
  - 그룹 채팅방 생성할 때 호스트 아바타 색을 함께 저장하고, 업데이트할 때는 그룹 채팅방 제목만 업데이트되며 날짜 데이터는 초기에 생성할 때를 제외하고 변경되지 않도록 구성해주었고, 그룹 채팅방 호스트가 아바타 색을 변경하면 해당 내용이 저장되도록 구성하고 확인한 결과, 그룹 채팅방 수정 시에 날짜 데이터가 새롭게 덮어씌워지는 문제가 더이상 발생하지 않고, 호스트가 닉네임 또는 아바타 색을 수정하면 그룹 채팅방 정보에서도 해당 내용이 업데이트되어 보여지는 것을 확인할 수 있었다.
    - 호스트 아바타 색을 저장할 수 있도록 내용을 구성했기 때문에, 이제 해당 내용이 화면에 출력되어 보여질 수 있도록 구성해봐야 함
    - 호스트 닉네임이나 아바타 색을 수정하면 해당 내용이 패널에서 실시간 반영되어 보여지도록 구성해야 함
    - 그룹 채팅방 패널에 현재 참여 인원 수를 보여주고, 접는 기능을 추가해 펼치면 닉네임 리스트를 보여주고 접으면 보이지 않는 내용, 채팅방 설명이나 소개 문구를 호스트가 간단하게 작성하고 수정하는 내용, 공지사항 또는 고정 메시지를 짧게 보여주는 내용, 참여자 역할을 구분하는 내용(방장, 일반, 초대 대기중 등) 등 여러 내용을 생각중
    - 다른 컴포넌트에서 구성된 배열을 탐색하는 find, filter, map 같은 연산이 있는 내용에 useMemo를 추가해 최적화 해야 함
    - 다이렉트 채팅방 패널에 친구와 함께 참여한 서버, 같이 아는 친구 같은 내용이 들어가면 좋을 것 같아서 이 내용도 추가해봐야 함
    - 정리해야 할 내용은 정리하고 채팅 목록과 관련된 스크롤 관련 기능을 수정해봐야 함
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/10c2397e478e45e8f37790733469783740876308)

<br />

- 그룹 채팅방 패널 내의 호스트 아바타 색 출력 및 그룹 채팅방 생성일 데이터 수정 및 그룹 채팅방 호스트 닉네임, 호스트 아바타 색 실시간 반영 추가 및 여러 내용 추가 수정
  - 그룹 채팅방 패널에서 보여지는 호스트 아바타가 호스트가 설정한 아바타 색이 출력되도록 구성하고, 그룹 채팅방 생성일 데이터를 포맷팅해 년월일 형태로 보여지도록 구성하고, 그룹 채팅방 호스트 닉네임과 호스트 아바타 색이 변경되면 패널 내에서 실시간 반영되어 보여지도록 내용을 추가해주었고 이 외에 새롭게 타입 정의를 추가해 타입 정의 관련 오류가 발생하지 않도록 구성
  - 백엔드
    - user-routes
      - 사용자 정보 수정하는 PATCH 라우터 수정
        - 그룹 채팅방 사용자 목록에서 변경된 사용자 정보를 이벤트 소켓으로 전달하는 내용을 복사해 이벤트 이름을 변경해 구성
        - 이전에 사용하던 이벤트 이름은 "groupChatProfileUpdated"에서 "groupChatUserProfileUpdated"로 변경
        - 새롭게 추가한 호스트 정보를 전달하는 이벤트는 "groupChatHostProfileUpdated"로 구성
  - 프론트엔드
    - groupChatStore
      - getGroupChats 액션 수정
        - groupChatHostProfileUpdated 이벤트 관련 socket.off 추가
        - groupChatHostProfileUpdated 이벤트 관련 socket.on 추가
          - 사용자 \_id, 닉네임, 아바타 색을 받아오도록 구성
          - 그룹 채팅방 목록에 map을 사용해 그룹 채팅방에 저장된 호스트 \_id와 받아온 사용자 \_id가 일치하는지 확인
          - 일치할 경우, 호스트 닉네임과 호스트 아바타 색을 업데이트하고 나머지 내용은 그대로 반환
          - 일치하지 않을 경우, 기존 그룹 채팅방 정보를 그대로 유지하고 반환
    - DirectChatDetails
      - friendSince useMemo 수정
        - dateStr 변수를 friendSinceDateStr로 수정
        - datePart 배열 이름을 friendSinceDate로 수정
        - parseInt 대신에 Number를 사용하도록 수정
    - GroupChatDetails
      - useMemo를 불러와 사용할 수 있도록 구성
      - useGroupChatStore Zustand에서 getGroupChats 액션을 불러와 사용할 수 있도록 구성
      - groupChatSince 변수를 추가하고 useMemo로 구성
        - groupChatDateStr 변수를 추가하고 그룹 채팅방 날짜 데이터를 저장
          - groupChatDateStr 변수 데이터가 존재하는지 확인
        - 공백을 기준으로 잘라내도록 구성
        - 년, 월, 일을 "." 기준으로 잘라내도록 구성
        - 포맷팅한 날짜 데이터를 "XXXX년 XX월 XX일"로 반환하도록 구성
        - 의존성 배열로 그룹 채팅방 날짜를 사용
      - 새로운 useEffect 추가
        - 의존성 배열은 비워놓고, getGroupChats 액션이 실행되도록 구성
      - JSX 코드 내용 수정
        - GroupChatPanel 컴포넌트에 전달하는 groupChatSince, hostNickname props 수정
          - groupChatSince, hostNickname가 null 또는 undefined일 경우, 빈 문자열을 전달하도록 구성
        - hostAvatarColor props 추가 전달
          - hostAvatarColor가 null 또는 undefined일 경우, 빈 문자열을 전달
    - GroupChatPanel
      - hostAvatarColor props를 추가로 전달받고, props 내용들을 GroupChatPanelProps로 타입 정의해 타입 에러 문제 해결
      - JSX 코드 내용 수정
        - 아바타 윗 부분 영역을 "#ccc"가 아닌, hostAvatarColor로 수정
        - 호스트 아바타 색을 "#ccc"가 아닌, hostAvatarColor로 수정
    - types
      - GroupChatPanelProps 타입 정의 추가
        - groupChatSince, hostNickname, hostAvatarColor 모두 string으로 타입 정의
  - 그룹 채팅방 패널 내의 호스트 아바타와 아바타 헤더 부분에서 호스트가 설정한 아바타 색이 보여지도록 구성하고, 그룹 채팅방 생성일이 년월일 형태로 보여지며 호스트가 닉네임 또는 아바타 색을 수정하면 패널에서 보여지는 호스트 정보가 실시간 반영되어 보여지도록 구성하고 확인한 결과, 패널 내의 아바타 헤더 부분과 아바타에서 호스트 아바타 색과 동일한 색이 보여지며, 호스트가 정보를 수정했을 때 해당 내용이 실시간 반영되어 패널 내의 호스트 정보도 실시간 반영되는 것을 확인했고, 그룹 채팅방 생성일이 DB에 저장된 날짜 데이터 그대로 보여지는 것이 아닌 "XXXX년 XX월 XX일" 형태로 보여지는 것을 확인할 수 있었다.
    - 그룹 채팅방 패널에 현재 참여 인원 수를 보여주고, 접는 기능을 추가해 펼치면 닉네임 리스트를 보여주고 접으면 보이지 않는 내용, 채팅방 설명이나 소개 문구를 호스트가 간단하게 작성하고 수정하는 내용, 공지사항 또는 고정 메시지를 짧게 보여주는 내용, 참여자 역할을 구분하는 내용(방장, 일반, 초대 대기중 등) 등 여러 내용을 생각중
    - 다른 컴포넌트에서 구성된 배열을 탐색하는 find, filter, map 같은 연산이 있는 내용에 useMemo를 추가해 최적화 해야 함
    - 다이렉트 채팅방 패널에 친구와 함께 참여한 서버, 같이 아는 친구 같은 내용이 들어가면 좋을 것 같아서 이 내용도 추가해봐야 함
    - 정리해야 할 내용은 정리하고 채팅 목록과 관련된 스크롤 관련 기능을 수정해봐야 함
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/784cca527b6091803583f867dac5526861aac7b0)

# 오늘 느낀 점

- 그룹 채팅방 생성 또는 수정할 때 호스트 아바타 색이 저장 또는 업데이트되도록 구성하고, 그룹 채팅방 수정 시에 날짜 데이터가 업데이트되지 않고 생성한 날짜 그대로 유지되도록 구성해주었으며, 그룹 채팅방 패널 내의 호스트 아바타와 아바타 헤더 부분에서 호스트 아바타 색으로 동적 적용되어 보여지고, 사용자 정보 관련 수정 시에 그룹 채팅방 호스트로 존재한다면 해당 내용이 실시간 반영되어 보여지는 것까지 문제없이 구성을 해주었다. 이제 다이렉트 채팅방 패널 내에 친구와 함께 참여한 서버, 같이 아는 친구 같은 내용이 보여지도록 구성해야 하고, 그룹 채팅방 패널 내에는 전체 참여 인원 수와 접는 기능을 추가한 사용자 닉네임 리스트 그리고 참여자 역할을 구분하는 내용을 추가해줘야 한다. 이 내용들을 구성하기 전에 우선 여러 컴포넌트에 구성된 find, filter, map, some 같은 연산이 필요한 내용을 확인해 계산이 좀 복잡하거나 여러번 실행될 필요가 있는 내용은 useMemo를 추가해 최적화할 생각이고, 테스트를 위해 추가하고 더이상 확인이 필요하지 않은 console.log 내용은 정리해서 좀 더 깔끔하게 보이도록 할 생각이다.

<br />

# 내일 할 일

- 실시간 통신 애플리케이션 (Float Chat) 프로젝트 진행

- Zustand 내용 구성

- 닉네임 수정과 그룹 채팅방 제목 수정 내용에서 사용하지 않거나 필요없는 정보를 삭제해 코드 정리를 해야 함 (중복된 데이터 전송이나 사용하지 않는 데이터 전송 관련 내용 등)

- 그룹 채팅방에서 다른 사용자를 클릭할 수 있고, 클릭 시에 다이렉트 채팅방이 생성되어 채팅을 나눌 수 있도록 구성하는 것을 고려중 (이 방법 대신, 다른 사용자 클릭 시에 프로필이 보여지도록 구성하고 그 내용을 통해 다이렉트 메시지를 보내거나 프로필 내용을 보는 그런 방식으로 구성해야 함)

- 출력되는 채팅 메시지 목록에 스크롤 관련 내용을 추가 수정해야 함

- 채팅 입력창에 적용된 스크롤 기능 추가 수정 필요

- 다이렉트 채팅방 목록이 정렬될 때 부드럽게 위로 올라가고 내려가는 CSS 적용 필요

- 친구 관련된 내용에서 코드 정리 필요 (코드를 깔끔하게 보이도록 수정 필요)

- 여러 Zustand에 구성된 실시간 반영 로직들이 재사용될 수 있도록 커스텀 훅에 옮겨서 구성하는 것을 고려해야 함

<br />

# 앞으로 해야 할 일

- React, TypeScript 공부

- React 상태 관리 도구인 Zustand 공부

- 실시간 통신 애플리케이션 프로젝트 제작
