# 오늘 한 일

### React + TypeScript 프로젝트 제작 (React, TypeScript, ExpressJS, MongoDB로 만드는 실시간 통신 애플리케이션)

- 다이렉트 채팅 관련 내용 타입 정의 추가 및 친구 추가 실시간 반영 추가
  - 다이렉트 채팅 관련 내용에 타입 정의를 추가해 타입 에러가 없어지도록 해 주었고, 친구 요청을 하고 상대방이 수락하면 요청한 사용자 화면의 친구 목록에 수락한 친구가 보여지도록 실시간 반영 내용을 추가
  - 백엔드
    - direct-chat-routes
      - 어떤 역할을 하는지 구분하기 위해 라우터에 주석 추가
      - 다이렉트 채팅방 조회하는 GET 라우터 수정
        - 다이렉트 채팅방 목록을 확인하는 조건부 수정
          - `!directChats.length === 0`로 다시 수정
          - `!directChats.length`로 사용하면, 다이렉트 채팅방 목록이 없을 경우 에러 발생으로 오류 메시지가 계속 출력됨
    - group-chat-routes
      - 그룹 채팅방 조회하는 GET 라우터 수정
        - 그룹 채팅방 목록을 확인하는 조건부 수정
          - `!groupChats.length === 0`로 다시 수정
          - `!groupChats.length`로 사용하면, 그룹 채팅방 목록이 없을 경우 에러 발생으로 오류 메시지가 계속 출력됨
    - friend-routes
      - 친구 수락하는 POST 라우터 수정
        - 친구 수락 시에 insertOne으로 바로 데이터가 저장되는 것이 아닌, 객체에 저장된 내용이 전달되어 저장되도록 수정
          - newFriend 변수를 추가하고, 백엔드에 저장될 데이터 내용을 구성
          - insertOne에 newFriend 변수를 사용해 데이터 저장
        - 소켓 이벤트 내용에 friendAdd 이벤트 추가
          - friendAdd 이벤트 리스너를 통해 newFriend 내용이 전달되도록 구성
  - 프론트엔드
    - friendStore
      - loadFriends 함수 수정
        - socket.off를 추가해 이벤트 리스너 중복 실행을 방지
        - socket.on 내용 추가
          - friendAdd 이벤트를 통해 새로운 친구 정보를 받도록 구성
            - newFriend 정보를 전달받음
          - friends 목록에 concat 또는 스프레드 연산자를 사용해 기존 배열을 유지하면서 새로운 친구를 실시간으로 추가해 보여지도록 구성
          - concat 로직은 주석 처리하고, 스프레드 연산자를 사용해 실시간 반영되도록 구성
    - directChatStore
      - 재사용 타입 정의 파일에서 DirectChatData 타입 정의를 불러오도록 구성
      - useDirectChatStore Zustand 타입 정의를 추가
        - socket
          - Socket | null로 정의
        - directChats
          - 불러온 DirectChatData 타입 정의에 배열을 추가해 정의
        - getDirectChat
          - 비동기 함수로 타입 정의
        - directChatForm
          - 매개변수로 전달받은 id는 string으로 타입 정의
          - 비동기 함수로 타입 정의
    - DirectChat
      - 재사용 타입 정의 파일에서 DirectChatProps 타입 정의를 불러오도록 구성
      - 전달받은 props 내용에 DirectChatProps 타입 정의 추가
    - Friend
      - directChatHandler 함수 수정
        - 비동기 함수 타입 정의
    - types
      - DirectChatData 타입 정의 추가
        - \_id, date는 string으로 타입 정의
        - participants는 사용자 ID 목록을 배열로 가지고 있으므로, string 배열로 타입 정의
      - DirectChatProps 타입 정의 추가
        - \_id는 string으로 타입 정의
        - otherUser는 string 또는 undefined로 타입 정의
  - 추가한 다이렉트 채팅 관련 내용에 타입 정의를 해 주면서 타입 에러가 사라진 것을 확인했고, 친구 요청을 보낸 사용자 화면에서도 즉시 실시간 반영되도록 로직을 추가한 내용 또한 문제없이 적용되는 것을 확인할 수 있었다.
    - 다이렉트 채팅방 관련해서 중복으로 생성되는지 확인한 결과, 상대방이 친구 버튼을 클릭해도 생성되지 않는 것을 확인했고, 상대방 화면에서 다이렉트 채팅방 관련 내용이 문제없이 출력되는 것도 확인
    - 친구 닉네임 클릭 시에 이동되는 로직이 구현되어 있지 않기 때문에 관련 로직을 추가해야 함
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/934a7e48e631964d03e956de95ab2231264e3b64)

# 오늘 느낀 점

- 친구 관련 실시간 반영 로직이 빠진 부분이 있어서 추가해 주었고, 다이렉트 채팅 관련 내용에 타입 정의를 추가해 주면서 타입 에러가 사라져서 이전보다 보기 좀 더 편해졌다고 생각이 된다. 다이렉트 채팅방 목록에서 사용자 닉네임이 보여져야 하지만 \_id가 보여지기 때문에 수정을 해 줘야 하고, 다이렉트 채팅방 클릭 시에 다이렉트 채팅방 세부 페이지로 이동해서 채팅을 나눌 수 있도록 구성을 해 줘야 한다. 최우선은 가독성을 위해 다이렉트 채팅방 목록이 사용자 닉네임으로 보여져야하고 그 뒤에 특정 태그나 내용이 보여져 다이렉트 채팅방임을 알 수 있도록 구성이 필요하며, 그 다음 다이렉트 채팅방 클릭 시에 세부 페이지로 이동되는게 우선이라고 생각이 되며, 이 내용까지 해결이 된다면 그 다음 채팅을 나눌 수 있도록 구성이 필요하다고 생각이 된다. 그리고 다이렉트 채팅방 메시지를 그룹 채팅방 메시지가 저장하는 컬렉션과 함께 공유를 할 것인지 아니면 별도의 컬렉션으로 구성해 저장할 지 고민을 해 봐야 한다.

<br />

# 내일 할 일

- 실시간 통신 애플리케이션 (Float Chat) 프로젝트 진행

- Zustand 내용 구성

- 다이렉트 채팅방 세부 페이지로 이동하는 기능

- 다이렉트 채팅방 메시지 나누는 기능 (실시간 반영 및 상대방 화면에도 적용되는지 확인 필요)

- 다이렉트 채팅방 닫는 기능

- 친구 관련된 내용에서 코드 정리 필요 (코드를 깔끔하게 보이도록 수정 필요)

- 그룹 채팅방 초대하고 알림을 전송하는 기능에서, 로그인한 사용자가 아닌 친구에게 보내는 그런 구조로 작동되도록 수정이 필요 (비로그인 상태여도 상관이 없음 단순하게 친구한테 친구 요청하면 알림 메시지가 전달되어야 함)

- 추가된 친구와 대화를 나눌 수 있는 다이렉트 채팅방

- 여러 Zustand에 구성된 실시간 반영 로직들이 재사용될 수 있도록 커스텀 훅에 옮겨서 구성하는 것을 고려해야 함

<br />

# 앞으로 해야 할 일

- React, TypeScript 공부

- React 상태 관리 도구인 Zustand 공부

- 실시간 통신 애플리케이션 프로젝트 제작
