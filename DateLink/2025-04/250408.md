# 오늘 한 일

### React + TypeScript 프로젝트 제작 (React, TypeScript, ExpressJS, MongoDB로 만드는 실시간 통신 애플리케이션)

- 친구 관련 내용 출력 위치 수정 (친구 관련 내용 오류 해결) 및 다이렉트 채팅방 조회 관련 실시간 반영 추가
  - 웹 사이트에 접속하면 친구 관련 에러 메시지가 출력되기 때문에, 친구 관련 내용이 다이렉트 채팅방 컴포넌트에서 출력되도록 수정해서 오류 해결해 주었고, 다이렉트 채팅방에 저장된 isVisible 내용이 false일 경우 다른 사용자가 메시지를 추가하면 true로 변경되는데 이 때 백엔드에서만 업데이트되고, 출력되는 화면에서는 실시간 반영이 되지 않기 때문에 메시지가 추가되어 isVisible 내용이 true로 변경되면 화면에 해당 다이렉트 채팅방이 실시간 반영되어 바로 보여지도록 구성
  - 백엔드
    - chat-routes
      - 채팅 메시지 추가하는 POST 라우터 수정
        - 채팅방이 유효한지 확인하는 조건부 내용에 실시간 반영 관련 내용 추가
        - 찾은 다이렉트 채팅방에 참여한 다른 사용자 정보를 저장하는 변수 추가
          - find를 사용해 participant 내용에서 로그인한 사용자 외의 다른 사용자 정보를 찾아서 저장
        - socket 관련 내용을 구성
          - io, onlineUsers, socketId 순서로 구성
            - socketId는 앞에서 찾은 사용자 \_id를 활용해 찾도록 구성
          - 메시지가 추가되고, 알림이 전송되는 부분에 구성되어 있지만 해당 조건부 내용에 별도로 필요해서 추가
        - 다이렉트 채팅방 내용이 업데이트되고, 최신화된 다이렉트 채팅방을 조회하는 내용 추가
          - roomId를 활용해 최신화된 다이렉트 채팅방을 조회
        - 다른 사용자 정보에 저장된 isVisible 내용이 false일 경우 실행되는 조건부 내용 추가
          - updatedDirectChat 소켓 이벤트를 통해 최신화된 다이렉트 채팅방 정보를 전달하도록 구성
          - 채팅 메시지가 전달되고 난 후에는 isVisible 내용이 true로 변경되기 때문에 추가로 메시지를 전달해도 중복으로 다이렉트 채팅방 정보가 전송되지 않음
          - 초기에 다이렉트 채팅방이 보이지 않는 경우 또는 다이렉트 채팅방을 닫고 보이지 않는 경우에서만 작동되어 실시간 반영되도록 구성
  - 프론트엔드
    - DirectChatPage
      - Friends 컴포넌트 관련 내용 삭제
    - directChatStore
      - 소켓 관련 내용 주석 해제
      - getDirectChat 액션 수정
        - socket 관련 내용 추가
        - socket.off를 추가해 이벤트 리스너 중복 실행을 방지
        - socket.on 내용 추가
          - updatedDirectChat 이벤트를 통해 updatedDirectChat 내용을 전달받도록 구성
          - directChats 목록에 concat을 사용해 업데이트된 다이렉트 채팅방 내용이 추가되어 보여지도록 구성
    - DirectChats
      - Friends 컴포넌트 관련 내용 보여지도록 주석 해제
  - 친구 목록 컴포넌트를 다이렉트 채팅방 목록 컴포넌트에 옮겨서 친구 관련 에러가 출력되지 않는 것을 확인했고, 다이렉트 채팅방 isVisible 내용이 false일 때 채팅이 추가되면 true로 업데이트되고 소켓 이벤트를 통해 업데이트된 내용이 전달되어 실시간 반영되도록 구성하고 테스트한 결과, 문제없이 작동되어 다이렉트 채팅방 목록이 실시간 반영되는 것을 확인할 수 있었다.
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/dbbef800eadf8d1a49f2254083f0b399d0efca68)

<br />

- 다이렉트 채팅방, 그룹 채팅방, 친구 관련 Zustand 액션 내용에 빠진 예외 처리 내용 추가
  - 다이렉트 채팅방 Zustand에 구성된 모든 액션 내용이 try-catch를 통해 예외 처리가 되지 않은 상태라서 관련 내용을 추가해 주었고, 그룹 채팅방에서는 그룹 채팅방을 추가 및 수정하는 내용에서 예외 처리가 되지 않은 상태라서 try-catch를 추가하고, 콘솔 에러 내용이 빠진 부분이나 alert 내용에서 새로고침 관련 텍스트가 빠져있어서 추가해 주었고, 친구 관련 내용에서는 새로고침 관련 텍스트가 빠진 채로 alert가 구성되어 있어서 내용을 추가
  - 프론트엔드
    - directChatStore
      - getDirectChat, directChatForm, closeDirectChat 액션에 try-catch를 추가해 예외 처리
    - groupChatStore
      - getGroupChatUsers 액션의 예외 처리에 콘솔 에러 내용 추가
      - groupChatForm 액션에 try-catch를 추가해 예외 처리
      - 이 외 액션 alert 내용에 새로고침 관련 텍스트 추가
    - friendStore
      - alert 내용에 새로고침 관련 텍스트 추가
  - 다이렉트 채팅방, 그룹 채팅방, 친구 관련 Zustand 액션 내용에 구성된 예외 처리가 통일성 있게 구성이 된 것을 확인할 수 있었다.
    - 다이렉트 채팅방 세부 페이지에서 다이렉트 채팅방 닫기를 클릭하면, 해당 채팅방이 목록에서 사라지지만 그대로 채팅방에 남아있기 때문에 닫기 버튼을 클릭하면 채팅방을 벗어나서 홈으로 이동되도록 구성해야 함
    - 홈에서 친구 클릭 시에 해당 친구와의 다이렉트 채팅방 세부 페이지로 이동하고 해당 페이지에서 보여지는 친구 목록에서 다른 친구를 클릭하면 해당 친구와의 다이렉트 채팅방 세부 페이지로 이동이 되지만, 해당 친구와의 다이렉트 채팅방이 목록에 출력되지 않기 때문에 실시간 반영을 추가해서 페이지 이동이 되고 목록에 클릭한 친구와 대화를 나눌 수 있는 다이렉트 채팅방이 생성되도록 구성 필요
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/197e7af00141b5b465d0bfd8dbfc4f9633b92e0f)

# 오늘 느낀 점

- 웹 페이지에 접속하면 친구 관련 에러들이 alert를 통해 출력되는 것을 확인하고 친구 목록 컴포넌트를 원래 위치에서 실행되도록 수정해 문제를 해결해 주었고, 다이렉트 채팅방 목록과 관련된 내용이 실시간 반영되어 보여지도록 로직을 추가해 주었다. 그리고 여러 Zustand 액션 내용에 예외 처리 내용이 빠져있어서 추가를 해 주었는데, 예외 처리 내용이 좀 더 통일성 있게 구성이 되었다고 생각이 된다. 다이렉트 채팅방 세부 페이지에서 닫기 버튼을 클릭하면 해당 채팅방이 목록에서 사라지는 것은 실시간 반영이 되지만, 그대로 채팅방에 남아서 내용이 보여지기 때문에 닫기 버튼 클릭 시에는 홈으로 이동되어 보이지 않도록 내용을 수정해 줘야 한다. 추가로 A 친구 다이렉트 채팅방 세부 페이지에서 B 친구 버튼 클릭 시에 B 친구와 관련된 다이렉트 채팅방 세부 페이지로 이동이 되는데, 이 때 다이렉트 채팅방 목록에 B 친구와 관련된 다이렉트 채팅방이 보여지지 않기 때문에 다이렉트 채팅방이 추가되면 목록이 실시간으로 업데이트되어 보여지도록 내용을 구성해 줄 생각이다.

<br />

# 내일 할 일

- 실시간 통신 애플리케이션 (Float Chat) 프로젝트 진행

- Zustand 내용 구성

- 다이렉트 채팅방 닫기 클릭 시에 해당 채팅방을 벗어나서 홈으로 이동되어야 함

- 친구 버튼 클릭 시에 해당 친구와의 다이렉트 채팅방이 생성되는데, 그 내용이 다이렉트 채팅방 세부 페이지에서는 실시간 반영이 되지 않으므로 관련 내용 추가 필요

- 친구 삭제 시에 다이렉트 채팅방 삭제 확인 로직 필요 (친구 삭제 시에 다이렉트 채팅방을 그대로 남겨놓고 삭제 확인창은 따로 추가하지 않을 예정)

- 친구 관련된 내용에서 코드 정리 필요 (코드를 깔끔하게 보이도록 수정 필요)

- 그룹 채팅방 초대하고 알림을 전송하는 기능에서, 로그인한 사용자가 아닌 친구에게 보내는 그런 구조로 작동되도록 수정이 필요 (비로그인 상태여도 상관이 없음 단순하게 친구한테 친구 요청하면 알림 메시지가 전달되어야 함)

- 추가된 친구와 대화를 나눌 수 있는 다이렉트 채팅방 (진행중)

- 여러 Zustand에 구성된 실시간 반영 로직들이 재사용될 수 있도록 커스텀 훅에 옮겨서 구성하는 것을 고려해야 함

<br />

# 앞으로 해야 할 일

- React, TypeScript 공부

- React 상태 관리 도구인 Zustand 공부

- 실시간 통신 애플리케이션 프로젝트 제작
