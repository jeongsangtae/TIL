# 오늘 한 일

### React + TypeScript 프로젝트 제작 (React, TypeScript, ExpressJS, MongoDB로 만드는 실시간 통신 애플리케이션)

- 다이렉트 채팅 메시지 저장, 출력 및 채팅 목록, 채팅 입력창 컴포넌트 재사용
  - 다이렉트 채팅방에 채팅 입력창을 추가해 채팅 메시지를 입력하고 저장될 수 있도록 구성을 해 주었으며, 채팅 목록을 출력할 수 있도록 채팅 목록 컴포넌트를 추가하고, 채팅 메시지 목록을 불러와 출력되도록 구성
  - 백엔드
    - group-chat-routes
      - 채팅 메시지 추가하는 POST 라우터 수정
        - 그룹 채팅방을 찾는 내용 변수 이름 수정
          - groupChat -> chatRoom으로 변경
          - const에서 let으로 변경
        - 찾은 그룹 채팅방이 없을 경우, 다이렉트 채팅방에서 찾도록 조건부 추가
          - 다이렉트 채팅방 컬렉션에서 roomId를 사용해 일치하는 항목을 찾도록 구성
          - 찾은 다이렉트 채팅방이 유효하지 않을 경우, 에러 메시지를 출력
          - 다이렉트 채팅방 데이터를 chatRoom 형식으로 변환
            - 해당 내용은 소켓 이벤트에 전달되어 실시간 반영되기 위한 내용
            - \_id에 다이렉트 채팅방 \_id를 저장
            - title에 로그인한 사용자 닉네임을 저장
            - users는 다이렉트 채팅방 participants 내용에 map을 사용해 \_id 내용만 빼내고 새로운 배열로 만들어서 groupChat의 users와 같은 형식으로 변환
        - 메시지 보낸 사용자를 제외하고, 현재 방에 없는 사용자에게만 알림을 보내는 이벤트 내용 수정
          - groupChat 대신에 chatRoom이 사용되도록 변경
          - messageNotification 이벤트에 전달되는 roomTitle에 groupChat.title 대신에 chatRoom.title이 사용되도록 변경
  - 프론트엔드
    - DirectChatDetails
      - Chats, ChatInput 컴포넌트 추가 및 props로 roomId를 전달
    - types
      - ChatMessage 타입 정의 수정
        - room_id를 roomId로 수정
  - 다이렉트 채팅방에서 채팅을 입력하면 채팅 메시지가 DB에 저장되고, 해당 채팅 목록을 불러와 출력하는 것까지 문제없이 작동되는 것을 확인할 수 있었다.
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/77f649996b7ebc5a774f77b311153c72eed050f8)

<br />

- 채팅 라우터 추가 및 채팅 메시지 추가, 조회 라우터 위치 변경 및 다이렉트 채팅 참여자 항목에 보여지는 내용 추가
  - 채팅과 관련된 라우터만 따로 관리하는 채팅 routes 파일을 추가하고, 그룹 채팅방 routes에 구성된 채팅 관련 라우터 내용을 새롭게 추가한 채팅 routes 파일에 옮겨 주었으며, 다이렉트 채팅방이 보여지는 유무를 판단하기 위해 참여자 항목에 isVisible이라는 속성을 추가
  - 백엔드
    - app
      - 채팅 관련 내용이 문제없이 작동되도록 chatRoutes 내용을 추가
    - group-chat-routes
      - 채팅 조회, 추가와 관련된 라우터 내용 삭제하고 chat-routes로 옮김
    - direct-chat-routes
      - 다이렉트 채팅방 추가하는 POST 라우터 수정
        - 다이렉트 채팅방 생성 시에 participants 항목에 isVisible 속성이 함께 저장되도록 추가
          - isVisible 속성은 다이렉트 채팅방을 생성한 사용자는 true, 친구 사용자는 false로 저장
        - 다이렉트 채팅방 닫기 버튼 클릭 시에 isVisible 속성이 false로 업데이트되도록 구성할 예정이고, 친구 삭제 시에 다이렉트 채팅방을 삭제하는 것이 아닌, isVisible 속성이 false가 되어 보이지 않도록 구성해야 함
          - 친구 삭제 시에 다이렉트 채팅방 삭제 여부를 물어보고, 그에 맞게 isVisible 속성이 변경될 예정
          - 여기서 다이렉트 채팅방 삭제는 닫기 동작과 동일하고, 다이렉트 채팅방 자체 삭제가 되지 않음
          - 삭제한 친구 화면에서는 다이렉트 채팅방이 그대로 남아서 보여져야 함
          - 다이렉트 채팅방을 초기에 생성하고 메시지를 상대방에게 보내면 그 때 상대방 데이터의 isVisible 속성이 true로 변경되어 다이렉트 채팅방이 보여지도록 할 예정
          - 다이렉트 채팅방 목록에서 해당 다이렉트 채팅방이 보이는 유무는 isVisible 속성으로 판단할 예정
    - chat-routes
      - routes 기본 구성에 필요한 내용들을 추가
        - express, mongodb
        - db, accessToken, errorHandler 등
      - 채팅 메시지를 조회하는 GET 라우터 추가
      - 채팅 메시지를 추가하는 POST 라우터 추가
      - 그룹 채팅방 routes에 구성된 채팅 관련 내용을 옮겨와 구성
  - 그룹 채팅방 routes에 구성된 채팅 관련 라우터 내용을 채팅 routes에 옮겨서 테스트한 결과, 이전과 동일하게 작동되는 것을 확인할 수 있었고 다이렉트 채팅 참여자 항목에 새롭게 추가한 isVisible 속성은 아직 제대로 테스트를 해보지 못했기 때문에 관련 내용을 추가해 테스트를 진행해 봐야 한다.
    - isVisible 속성 사용 유무와 관련된 내용은 어떤식으로 활용할 예정인지 따로 정리할 생각이고, 다이렉트 채팅방 닫기 또는 삭제 등 관련된 내용 또한 어떤식으로 처리될 것인지 정리를 해 줄 예정이다.
    - 다이렉트 채팅방 내용과 관련해서 정리를 한 번 해준 후에 다시 관련 로직을 추가할 예정이고, 추가로 다이렉트 채팅방 목록이 홈에서만 보여지는 것이 아닌, 그룹 채팅방과 마찬가지로 전역적으로 보여져 이동될 수 있도록 구성해 줘야 함
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/6cbcf671f6df54cdd52af349f8d5855c0cab7c0d)

# 오늘 느낀 점

- 다이렉트 채팅방에서 추가한 채팅 메시지 저장과 조회하는 내용이 문제없이 작동되기 때문에, 이제 다이렉트 닫기 또는 삭제 등 isVisible 속성을 활용해 보여지는 유무에 관련해서 내용을 구성해 줘야 한다. 추가로 다이렉트 채팅방 목록이 홈 화면에서만 보여지고 전역적으로 보여지지 않기 때문에 그룹 채팅방과 동일하게 전역적으로 보여지도록 수정해 줘야 하며, 다이렉트 채팅방이 처음에 생성되면 생성한 사용자 화면에는 보여지지만, 상대방 화면에서는 보여지지 않고 채팅 메시지를 추가했을 때 실시간 반영되어 다이렉트 채팅방이 보여지도록 구성을 해 줘야 한다. 이 외에 친구 삭제 시에 다이렉트 채팅방을 삭제할 것인지, 아니면 그대로 유지할 것인지 등 다이렉트 채팅방 관련해서 내용 정리가 필요하기 때문에 우선, 다이렉트 채팅방 관련해 내용을 정리하고 그 다음 순서대로 로직 구현을 할 생각이다.

<br />

# 내일 할 일

- 실시간 통신 애플리케이션 (Float Chat) 프로젝트 진행

- Zustand 내용 구성

- 다이렉트 채팅방이 전역적으로 보여지도록 수정 필요 (그룹 채팅방과 동일하게 전역적으로 보여져야 함)

- 다이렉트 채팅방 생성 시에 초기에는 생성한 사용자 화면에서만 보여지고, 이후에 채팅 추가 시에 상대방 화면에도 보여져야 함 (실시간 반영이 되려면, 채팅 메시지가 추가되고 그 때 실시간 반영되어 보여져야 함)

- 다이렉트 채팅방 메시지 나누는 기능 (실시간 반영 및 상대방 화면에도 적용되는지 확인 필요)

- 다이렉트 채팅방 닫는 기능 (isVisible 속성 활용 예정)

- 친구 삭제 시에 다이렉트 채팅방 삭제 확인 로직 필요 (isVisible 속성 활용 예정)

- 다이렉트 채팅방 목록이 전역적으로 보여지도록 수정 필요

- 친구 관련된 내용에서 코드 정리 필요 (코드를 깔끔하게 보이도록 수정 필요)

- 그룹 채팅방 초대하고 알림을 전송하는 기능에서, 로그인한 사용자가 아닌 친구에게 보내는 그런 구조로 작동되도록 수정이 필요 (비로그인 상태여도 상관이 없음 단순하게 친구한테 친구 요청하면 알림 메시지가 전달되어야 함)

- 추가된 친구와 대화를 나눌 수 있는 다이렉트 채팅방

- 여러 Zustand에 구성된 실시간 반영 로직들이 재사용될 수 있도록 커스텀 훅에 옮겨서 구성하는 것을 고려해야 함

<br />

# 앞으로 해야 할 일

- React, TypeScript 공부

- React 상태 관리 도구인 Zustand 공부

- 실시간 통신 애플리케이션 프로젝트 제작
