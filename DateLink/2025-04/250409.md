# 오늘 한 일

### React + TypeScript 프로젝트 제작 (React, TypeScript, ExpressJS, MongoDB로 만드는 실시간 통신 애플리케이션)

- 다이렉트 채팅방 닫기에 navigate 내용 추가 및 다이렉트 채팅방 목록 실시간 반영 추가
  - 다이렉트 채팅방 세부 페이지에서 다이렉트 채팅방 닫기 버튼 클릭 시에 홈으로 이동되어 해당 다이렉트 채팅방을 벗어나도록 구성을 해 주었고, 친구 클릭 시에 생성되는 다이렉트 채팅방이 목록에 실시간 반영되어 보여지도록 구성 추가
  - 백엔드
    - direct-chat-routes
      - 다이렉트 채팅방 추가하는 POST 라우터 수정
        - 친구 버튼 클릭 시에 기존 다이렉트 채팅방이 존재할 경우, 기존 다이렉트 채팅방 isVisible 내용을 업데이트하는 내용 뒤에 내용 추가
        - 업데이트된 다이렉트 채팅방 정보를 불러오고, 해당 다이렉트 채팅방 정보를 프론트엔드로 전달하도록 구성
          - roomId도 여전히 전달
          - 업데이트된 다이렉트 채팅방 정보를 추가로 전달
        - 다이렉트 채팅방을 새롭게 생성하고 해당 다이렉트 채팅방 정보를 프론트엔드로 전달하도록 구성
          - roomId는 여전히 전달
          - 새롭게 추가된 다이렉트 채팅방 정보를 추가로 전달하는 구조
  - 프론트엔드
    - directChatStore
      - directChatForm 액션 수정
        - 백엔드에서 전달한 다이렉트 채팅방 정보를 전달받고, 이전 다이렉트 채팅방 목록에 전달받은 다이렉트 채팅방을 추가해 실시간 반영이 되도록 구성
        - 스프레드 연산자를 사용해 추가되도록 구성
    - DirectChat
      - useNavigate 불러오고, navigate로 사용할 수 있도록 구성
      - closeDirectChatHandler 함수 수정
        - closeDirectChat 액션, getDirectChat 액션이 실행되고 그 다음 navigate가 실행되어 홈으로 이동되도록 구성
  - 다이렉트 채팅방 닫기 버튼 클릭 시에 홈으로 이동되도록 구성한 내용이 작동되는 것을 확인해 주었고, 친구 버튼 클릭 시에 다이렉트 채팅방이 실시간 반영되어 목록에 추가되고 보여지는 것을 확인할 수 있었다.
    - 다이렉트 채팅방 닫기 클릭 시에 홈으로 이동하긴 하지만, 현재 참여한 다이렉트 채팅방이 아닌 다른 다이렉트 채팅방을 닫을 때도 홈으로 이동하기 때문에 조건부를 추가해 현재 참여한 다이렉트 채팅방을 닫을 때만 navigate가 실행되도록 수정 필요
    - 다이렉트 채팅방 목록에 추가된 다이렉트 채팅방이 실시간 반영되어 보여지긴 하지만, 친구 버튼을 클릭하면 중복으로 다이렉트 채팅방이 추가되어 보여지기 때문에, 이와 관련해서 중복으로 추가되지 않도록 내용을 수정해야 함
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/d83760ee1aaf786877852a170ea0e70089241423)

<br />

- 다이렉트 채팅방 닫기에 구성된 navigate 내용에 조건부 추가 및 현재 방 번호 상태, 현재 방 번호를 업데이트하는 액션 내용 추가
  - 다이렉트 채팅방 세부 페이지에서 다이렉트 채팅방 닫기 클릭 시에 홈으로 이동하긴 하지만, 현재 참여한 다이렉트 채팅방이 아닌 다른 다이렉트 채팅방을 닫을 때도 홈으로 이동해 불편한 UX를 제공하기 때문에, 해당 오류를 수정하기 위해 navigate 내용에 조건부를 추가해 현재 참여한 방 번호와 닫기 버튼을 클릭한 채팅방 번호가 일치할 때만 navigate가 작동되어 홈으로 이동되도록 구성
  - 프론트엔드
    - directChatStore
      - currentRoomId 타입 정의 추가
        - string 또는 null이 적용되도록 타입 정의
      - setCurrentRoomId 타입 정의 추가
        - 매개변수로 넘어오는 roomId는 string 또는 null이 적용되도록 타입 정의
        - 기본 함수로 타입 정의
      - currentRoomId 상태 추가
        - null 값도 받을 수 있도록 null로 구성
        - 현재 참여한 방 번호를 저장
      - setCurrentRoomId 액션 추가
        - roomId를 매개변수로 전달받고, set을 통해 currentRoomId 상태를 roomId로 업데이트
    - DirectChat
      - useDirectChatStore Zustand에서 currentRoomId 상태를 불러오도록 구성
      - closeDirectChatHandler 함수 수정
        - if문 조건부 추가
          - currentRoomId 상태와 \_id 내용이 일치할 때 navigate가 실행되도록 구성
          - 현재 참여한 방 번호와 해당 다이렉트 채팅방 버튼에 저장된 \_id를 비교해 일치할 때만 navigate가 작동되어 홈으로 이동
    - DirectChatDetails
      - useDirectChatStore Zustand에서 setCurrentRoomId 액션을 불러오도록 구성
      - useEffect 추가
        - roomId를 의존성 배열로 구성
          - 다이렉트 채팅방을 옮겨 다닐 때, roomId가 변경되어 해당 useEffect가 실행되고 currentRoomId 상태를 업데이트할 수 있게됨
          - roomId가 있어야 동기화 문제가 발생하지 않음
        - roomId가 변경되면 useEffect가 실행되고 그 안에 구성된 setCurrentRoomId 액션이 실행되어 roomId 또는 null이 전달되도록 구성
  - 현재 참여한 다이렉트 채팅방 세부 페이지 번호와 닫기 버튼을 클릭한 다이렉트 채팅방 번호가 일치할 때만 navigate가 작동되도록 로직을 구성하고 테스트한 결과, 문제없이 작동되어 A 다이렉트 채팅방에서 B, C 다이렉트 채팅방을 닫아도 홈으로 이동되지 않고 A 다이렉트 채팅방을 닫을 때만 홈으로 이동되는 것을 확인할 수 있었다.
    - 다이렉트 채팅방 닫기 버튼 클릭 시에 홈으로 이동되는 오류를 해결했기 때문에, 친구 버튼을 여러번 클릭 시에 다이렉트 채팅방이 중복으로 화면에 출력되는 오류를 수정해야 함
    - 추가로, currentRoomId 상태를 사용하지 않고, 로컬 스토리지에 저장된 현재 방 번호 내용으로 테스트가 가능한지 한 번 확인해 봐야 함
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/851335e5ea5965352bfe197a00b5bda873989ed1)

<br />

- 친구 버튼 클릭 시 다이렉트 채팅방 실시간 반영이 중복으로 발생하는 오류 수정
  - 친구 버튼을 클릭하면 다이렉트 채팅방이 실시간 반영되어 목록에 추가되고 화면에 출력되는데, 이 때 같은 친구를 여러번 클릭하면 같은 다이렉트 채팅방이 중복되어 화면에 보여지는 문제가 발생해서 관련 오류를 수정
  - 프론트엔드
    - directChatStore
      - directChatForm 액션 수정
        - 백엔드에서 전달받은 다이렉트 채팅방 정보가 기존 다이렉트 채팅방에 추가되어 실시간 반영하는 로직에 some을 추가해 중복을 방지하도록 구성
        - exists라는 변수 추가
          - 기존 다이렉트 채팅방 목록에 some을 사용해, 기존 다이렉트 채팅방 \_id와 새롭게 전달받은 다이렉트 채팅방 \_id를 비교해 중복되는지 확인
        - exists 내용이 true일 경우, 기존 다이렉트 채팅방 목록을 그대로 출력
        - exists 내용이 false일 경우, 기존 다이렉트 채팅방 목록에 새롭게 전달받은 다이렉트 채팅방을 추가해 목록을 업데이트하고 출력
  - 친구 버튼을 여러번 클릭하면 다이렉트 채팅방이 중복으로 여러번 생성되는 문제가 발생해서, 관련 오류를 해결하기 위해 some을 추가하고 로직을 구성해 테스트한 결과, 현재는 친구 버튼을 여러번 클릭해도 해당 다이렉트 채팅방이 중복으로 생성되지 않는 것을 확인할 수 있었다.
    - 다이렉트 채팅방 목록이 새로고침하면 순서가 정렬되는 문제가 있는 것 같아서, 해당 내용을 수정해 다이렉트 채팅방에 저장된 메시지를 기준으로 정렬이 되거나, 아니면 새롭게 메시지가 추가되면 그 채팅방이 위로 올라오고 다른 채팅방은 아래로 내려가는 그런 구조를 만들어보려고 생각중
    - 우선, 저장된 메시지를 기준으로 다이렉트 채팅방 목록이 정렬되는 것을 목표로 하고 그 다음 새롭게 메시지가 추가되면 해당 메시지가 저장된 날짜를 기준으로 새롭게 다이렉트 채팅방 목록 순서가 실시간으로 바뀌는 그런 구조를 구성해 봐야 함
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/1b7a783afc454f68e0f95fe7b6139bba93dea852)

# 오늘 느낀 점

- 다이렉트 채팅방 닫기 시에 홈으로 이동되도록 구성을 추가하고, 친구 버튼 클릭 시에 다이렉트 채팅방이 실시간 반영되어 목록에 출력되도록 구성을 하고 초기에 테스트할 때는 문제가 없는 줄 알았지만, 추가로 여러번 테스트해 본 결과 문제가 발생해서 닫기 시에 홈으로 이동되는 내용에는 조건부를 추가해 오류를 수정해 주었고, 다이렉트 채팅방은 중복으로 화면에 출력되어 보이지 않도록 처리를 해 주었다. 최종적으로 현재는 모두 문제없이 생각한 구조대로 작동되기 때문에 오류 관련해서는 더이상 신경쓰지 않아도 될 것 같고, 추가로 닫기 시에 홈으로 이동되는 조건부 내용에 새롭게 추가한 currentRoomId와 setCurrentRoomId를 사용하는데, 이 내용 대신에 로컬 스토리지에 저장하고 있는 현재 방 번호 정보를 사용하면 좀 더 간단한 로직으로 해결할 수 있을 거 같다는 생각이 들어서 한 번 테스트를 해 볼 생각이고, 다이렉트 채팅방 목록이 새로고침하면 이상하게 정렬되는 것을 확인했기 때문에 다이렉트 채팅방 목록 정렬을 저장된 메시지 날짜를 기준으로 정렬이 되도록 구성해 줄 생각이고, 여기에 추가로 새롭게 메시지가 추가되면 해당 메시지가 저장된 날짜를 기준으로 새롭게 다이렉트 채팅방 목록 순서가 실시간으로 바뀌는 구조를 구성해 볼 생각이다.

<br />

# 내일 할 일

- 실시간 통신 애플리케이션 (Float Chat) 프로젝트 진행

- Zustand 내용 구성

- 다이렉트 채팅방 목록이 마지막 메시지 날짜 기준으로 정렬되어 순서가 변경되고 보여지도록 구성 예정

- 친구 삭제 시에 다이렉트 채팅방 삭제 확인 로직 필요 (친구 삭제 시에 다이렉트 채팅방을 그대로 남겨놓고 삭제 확인창은 따로 추가하지 않을 예정)

- 친구 관련된 내용에서 코드 정리 필요 (코드를 깔끔하게 보이도록 수정 필요)

- 그룹 채팅방 초대하고 알림을 전송하는 기능에서, 로그인한 사용자가 아닌 친구에게 보내는 그런 구조로 작동되도록 수정이 필요 (비로그인 상태여도 상관이 없음 단순하게 친구한테 친구 요청하면 알림 메시지가 전달되어야 함)

- 추가된 친구와 대화를 나눌 수 있는 다이렉트 채팅방 (진행중)

- 여러 Zustand에 구성된 실시간 반영 로직들이 재사용될 수 있도록 커스텀 훅에 옮겨서 구성하는 것을 고려해야 함

<br />

# 앞으로 해야 할 일

- React, TypeScript 공부

- React 상태 관리 도구인 Zustand 공부

- 실시간 통신 애플리케이션 프로젝트 제작
