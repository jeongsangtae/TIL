# 오늘 한 일

### React + TypeScript 프로젝트 제작 (React, TypeScript, ExpressJS, MongoDB로 만드는 실시간 통신 애플리케이션)

- 프론트엔드 router, 백엔드 app 내용 수정 및 다이렉트 채팅방 관련 라우터 파일 추가 및 다이렉트 채팅방 추가하는 라우터 추가 및 다이렉트 채팅방 추가 액션 로직 추가 및 여러 내용 추가
  - 다이렉트 채팅방 기능 구현을 위해 프론트엔드 router 파일, 백엔드 app 내용을 수정하고, 다이렉트 채팅방 관련 라우터 파일을 추가해 다이렉트 채팅방 추가 라우터를 구성해 주었으며, 프론트엔드에서 다이렉트 채팅방 추가 액션 내용을 구성해 백엔드와 연결해 실행될 수 있도록 해 주었으며, 나중에 다이렉트 채팅방에 추가될 메시지가 보여지도록 다이렉트 채팅방 세부 페이지 관련 구조 내용을 추가
  - 백엔드
    - app
      - 다이렉트 채팅방 라우터 파일 내용 추가
    - direct-chat-routes
      - express, mongodb 같은 기본 구성 내용을 추가
      - db, accessToken, errorHandler 내용을 불러와 구성
      - 이 외에 기본 구성에 필요한 내용들 추가
      - 다이렉트 채팅방 추가하는 POST 라우터 추가
        - 로그인한 사용자 정보를 가져오는 내용 추가
          - 조건부 포함
        - 프론트엔드에서 전달한 친구 id 내용을 사용할 수 있도록 구성
          - req.body로 받음
        - 기존 채팅방이 있는지 확인하기 위한 내용 추가
          - directChats 컬렉션에 findOne을 사용하고, participants 내용에 $all을 사용해 배열 안에 로그인한 사용자 \_id와 프론트엔드에서 전달한 친구 id가 모두 포함되어 있는 문서를 찾도록 구성
          - 찾은 내용에 조건부를 사용해 기존 채팅방이 존재한다면 해당 채팅방 \_id를 전달하고 메시지를 전달
        - 기존 채팅방이 없을 경우, directChats 컬렉션에 새로운 다이렉트 채팅방을 추가하는 내용 추가
          - participants
            - 로그인한 사용자 \_id와 친구 \_id를 저장
            - 이 항목 이름과 저장되는 내용 변경에 대해 좀 고민해 봐야 함
          - date
            - 한국 시간 날짜로 저장되도록 구성
        - insertOne을 통해 directChats 컬렉션에 새로운 다이렉트 채팅방을 생성하고, 관련 정보를 프론트엔드로 전달
        - 오류 발생 시에 에러 헬퍼 함수를 통해 오류 메시지 출력
  - 프론트엔드
    - router
      - 다이렉트 채팅방 세부 페이지 관련 경로를 추가
        - 경로는 "me/:roomId"로 구성
        - element는 DirectChatDetailsPage 컴포넌트를 추가해 구성
    - directChatStore
      - directChatForm 액션 함수 구성
        - 비동기 함수로 구성하고 id 내용을 매개변수로 전달받도록 구성
        - fetch 함수를 통해 백엔드에 구성된 다이렉트 채팅방 생성 라우터와 연결
          - method는 POST로 구성
          - body에 id 내용을 객체로 전달
          - header, credentials 내용 구성
        - 올바른 응답이 넘어오지 않으면 오류 메시지를 출력하도록 구성
        - 응답 데이터를 확인하기 위한 콘솔 로그 구성
    - DirectChatDetailsPage
      - 다이렉트 채팅방 세부 페이지 컴포넌트 파일만 추가
      - 다이렉트 채팅방 관련 내용을 모두 구성하고, 채팅 메시지 관련 내용을 추가할 때 사용할 예정
    - DirectChatDetails
      - 다이렉트 채팅방 세부 컴포넌트 파일만 추가
      - 다이렉트 채팅방 관련 내용을 모두 구성하고, 채팅 메시지 관련 내용을 추가할 때 사용할 예정
    - Friend
      - directChatHandler 함수 수정
        - userId 대신에 id 내용을 확인하도록 수정
        - directChatForm 액션에 userId 대신에 id 내용을 전달
  - 프론트엔드에서 다이렉트 채팅방 세부 페이지 관련 경로 및 컴포넌트만 추가한 상태라서 테스트할 내용이 없었고, 대신 다이렉트 채팅방 생성과 관련된 액션을 구성하고 백엔드에서 다이렉트 채팅방 생성 라우터를 추가해 연결하고 테스트한 결과, 문제없이 연결되어 친구 닉네임 클릭 시에 다이렉트 채팅방이 생성되는 것을 확인할 수 있었다.
    - 중복으로 다이렉트 채팅방이 생성되지 않도록 백엔드에서 로직을 추가한 내용 또한 문제없이 작동되어, 친구 닉네임을 다시 클릭하면 다이렉트 채팅방이 생성되지 않는 것을 확인
    - 현재는 친구 닉네임 클릭 시에 이동되는 로직이 구현되어 있지 않기 때문에 관련 로직을 추가해야 함
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/893444f9f7a8873c147acb54d41baeec8ab0c773)

<br />

- 다이렉트 채팅방 목록 조회하는 라우터, 액션 추가 및 다이렉트 채팅방 목록 출력
  - 저장된 다이렉트 채팅방 목록을 조회할 수 있도록 백엔드에 라우터 구성을 하고, 프론트엔드에서는 다이렉트 채팅방 조회와 관련된 액션을 구성해 백엔드와 연결하고 데이터를 불러와 화면에 출력되도록 구성
  - 백엔드
    - direct-chat-routes
      - 다이렉트 채팅방 조회하는 GET 라우터 추가
        - 로그인한 사용자 정보를 가져오도록 구성
          - 확인하는 조건부 포함
        - 로그인한 사용자가 참여하고 있는 모든 다이렉트 채팅방을 불러오도록 구성
          - directChats 컬렉션에 find를 사용하고, participants 항목에서 $in을 사용해 로그인한 사용자 \_id 정보가 포함된 모든 항목을 불러오도록 구성
          - 찾은 항목들이 유효한지 확인하는 조건부 포함
        - 찾은 다이렉트 채팅방 목록을 프론트엔드로 전달
        - 오류 발생 시에 에러 헬퍼 함수 실행
    - group-chat-routes
      - 그룹 채팅방 조회하는 GET 라우터 수정
        - 그룹 채팅방 목록을 확인하는 조건부 수정
          - `!groupChats.length === 0`에서 `!groupChats.length`로 수정
          - 이전 내용은 논리적으로 잘못되었기 때문에, 확실한 처리를 위해 수정
  - 프론트엔드
    - directChatStore
      - directChats 상태 추가
        - 불러온 다이렉트 채팅방 목록을 저장하는 상태
      - getDirectChat 액션 구성
        - 비동기 함수로 구성
        - fetch 함수를 통해 백엔드에 구성된 다이렉트 채팅방 목록 조회 라우터와 연결
        - 올바른 응답이 넘어오지 않으면 오류 메시지를 출력하도록 구성
        - set을 사용해 directChats 상태가 넘어온 데이터로 업데이트되도록 구성
    - DirectChats
      - useAuthStore Zustand에서 userInfo 내용을 불러오도록 구성
      - useDirectChatStore Zustand에서 directChats 상태, getDirectChat 액션을 불러오도록 구성
      - useEffect에 getDirectChat 액션을 추가해 getGroupChatInvites 액션 다음에 실행될 수 있도록 구성
      - filteredDirectChats 변수 추가
        - 다이렉트 채팅방 목록에 map을 사용해 새로운 배열로 만들고, 기존의 다이렉트 채팅방 객체를 복사한 후에 새 필드인 otherUser를 추가해, 현재 로그인한 사용자를 제외한 참가자를 찾도록 구성
        - 다이렉트 채팅방에 참여한 로그인한 사용자와 친구 내용 중에서 로그인한 사용자는 제외하고, 친구 내용만 남겨서 전달할 수 있도록 구성
      - JSX 내용 수정
        - filteredDirectChats 내용에 map 함수를 사용하고, 새로운 배열로 만들어서 \_id, otherUser props에 각 내용을 전달
          - \_id prop에는 \_id, otherUser prop에는 otherUser 내용 전달
    - DirectChat
      - props롤 전달받은 \_id, otherUser 내용을 출력하도록 구성
  - 다이렉트 채팅방 목록을 조회하고 해당 내용이 출력될 수 있도록 구성한 후에 테스트한 결과, 문제없이 다이렉트 채팅방 목록을 불러오며 내용이 출력되는 것을 확인할 수 있었다.
    - 현재는 \_id 내용만 출력되도록 구성이 되어있긴 하지만, 문제없이 출력이 되고 있으며 내용을 수정해 상대방 닉네임이 출력되도록 해야 함
    - 다이렉트 채팅방에서 메시지를 주고 받는 내용을 추가하기 전에 우선은 상대방 닉네임이 보여지도록 구성하고, 상대방 화면에서도 친구 버튼 클릭 시에 다이렉트 채팅방이 중복으로 생성되지 않는지 확인이 필요하며, 현재 구성이 뭔가 뒤죽박죽된 것 같기 때문에 이 내용부터 수정하고 그 다음 기능 구성을 추가해야 함
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/6a4455ebaf58dab8394e2d27345a30c4ed5cf7c1)

# 오늘 느낀 점

- 다이렉트 채팅방이 생성되고 조회되는 것까지는 문제없이 작동이 되고 있지만, 현재 상대방 닉네임이 보여지지 않고 \_id 내용이 보여지기 때문에 이 부분 수정이 필요하고, 다이렉트 채팅방 클릭 시에 다이렉트 채팅방 세부 페이지로 이동되지도 않고, 해당 채팅방에 들어가서 채팅 메시지를 추가할 수도 없기 때문에 관련 내용을 추가해 줘야 한다. 앞에서 말한 내용들 구성도 중요하지만 우선은 상대방 화면에서도 다이렉트 채팅방이 문제없이 출력되고 있는지 확인이 필요하고, 친구 버튼 클릭 시에 채팅방이 중복으로 생성되지 않는지 확인이 필요하다. 그리고 현재 구성한 로직이 조금 뒤죽박죽 정신이 없는 것 같아서 정리가 필요하고 타입 정의같은 내용도 추가해 타입 에러를 없애는 쪽이 보기 더 편할 것으로 생각된다.

<br />

# 내일 할 일

- 실시간 통신 애플리케이션 (Float Chat) 프로젝트 진행

- Zustand 내용 구성

- 친구 추가가 된 후, 친구 목록이 보여지는 모두 내용에서 실시간 반영이 되지 않고 있음

- 다이렉트 채팅방 세부 페이지로 이동하는 기능

- 다이렉트 채팅방 메시지 나누는 기능 (실시간 반영 및 상대방 화면에도 적용되는지 확인 필요)

- 다이렉트 채팅방 닫는 기능

- 친구 관련된 내용에서 코드 정리 필요 (코드를 깔끔하게 보이도록 수정 필요)

- 그룹 채팅방 초대하고 알림을 전송하는 기능에서, 로그인한 사용자가 아닌 친구에게 보내는 그런 구조로 작동되도록 수정이 필요 (비로그인 상태여도 상관이 없음 단순하게 친구한테 친구 요청하면 알림 메시지가 전달되어야 함)

- 추가된 친구와 대화를 나눌 수 있는 다이렉트 채팅방

- 여러 Zustand에 구성된 실시간 반영 로직들이 재사용될 수 있도록 커스텀 훅에 옮겨서 구성하는 것을 고려해야 함

<br />

# 앞으로 해야 할 일

- React, TypeScript 공부

- React 상태 관리 도구인 Zustand 공부

- 실시간 통신 애플리케이션 프로젝트 제작
