# 오늘 한 일

### React + TypeScript 프로젝트 제작 (React, TypeScript, ExpressJS, MongoDB로 만드는 실시간 통신 애플리케이션)

- 다이렉트 채팅방 currentRoomId 관련 내용 삭제 및 소켓 스토어 currentRoom 내용 사용
  - 다이렉트 채팅방에서 사용되는 currentRoomId 관련 내용이 소켓 Zustand에서 구성한 currentRoom와 중복되는 내용이기 때문에, currentRoomId 관련 내용을 삭제하고 소켓 Zustand에서 구성된 currentRoom 내용이 사용되도록 수정
  - 프론트엔드
    - directChatStore
      - currentRoomId 타입 정의 및 상태 삭제
      - setCurrentRoomId 타입 정의 및 액션 삭제
    - DirectChat
      - useSocketStore Zustand 추가 및 currentRoom 상태를 사용할 수 있도록 구성
      - closeDirectChatHandler 함수 수정
        - currentRoomId 내용을 삭제하고 대신 currentRoom을 사용
    - DirectChatDetails
      - useDirectChatStore Zustand 관련 내용 삭제
      - useEffect 내용 삭제
        - 의존성 배열, 안에 구성된 내용까지 모두 삭제
  - currentRoomId에서 currentRoom로 변경해 테스트한 결과, 문제없이 이전과 동일하게 작동되어 다이렉트 채팅방 세부 페이지에 접속해 해당 다이렉트 채팅방 닫기 버튼을 클릭했을 때만 홈으로 이동되는 것을 확인할 수 있었다.
    - 다이렉트 채팅방 목록이 이상하게 정렬되어 보여지기 때문에, 다이렉트 채팅방이 생성된 날짜나, 해당 채팅방에서 추가된 마지막 메시지 날짜 (최근 메시지)를 저장해 비교하고 정렬되도록 구성해야 함
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/8dc2dd0c32f6f4412cf9a3092ff9e0da0a3f1f92)

<br />

- 다이렉트 채팅방에 마지막 메시지 날짜 내용 추가 및 다이렉트 채팅방 출력 관련 정렬 내용 수정 및 date로 구성된 내용 kstDate로 수정
  - 다이렉트 채팅방 생성 시에 lastMessageDate 내용이 포함되어 함께 생성되고, 다이렉트 채팅방 목록 조회 시에 lastMessageDate 내용을 확인해 정렬이 되도록 구성해 주었고, 채팅 메시지 추가 시에 lastMessageDate 내용이 채팅 메시지 날짜로 업데이트되도록 구성
  - 백엔드
    - chat-routes
      - 채팅 메시지 추가하는 POST 라우터 수정
        - 다이렉트 채팅방에 참여한 사용자 isVisible 내용을 업데이트하는 부분에 lastMessageDate 내용을 추가해 함께 업데이트되도록 구성
        - lastMessageDate 내용은 새로운 채팅 메시지가 추가된 날짜가 저장되어 업데이트되도록 구성
    - friend-routes
      - date로 구성된 내용 kstDate로 수정
    - direct-chat-routes
      - 다이렉트 채팅방 조회하는 GET 라우터 수정
        - 다이렉트 채팅방을 조회하는 로직에 sort를 추가하고, lastMessageDate 내용이 기준이 되어 정렬되도록 구성
          - -1로 구성해 제일 마지막, 즉 최근에 생성된 다이렉트 채팅방이 최상단에 보여지도록 구성
      - 다이렉트 채팅방 추가하는 POST 라우터 수정
        - formatKSTDate 변수를 추가해, 날짜 관련 변환 내용을 재사용
        - date 내용에 formatKSTDate를 사용
        - lastMessageDate 내용을 추가하고 formatKSTDate가 사용되도록 구성
        - 다이렉트 채팅방 추가 시에 lastMessageDate 내용도 함께 포함되어 생성
          - 초기 lastMessageDate 값은 다이렉트 채팅방이 생성되는 날짜와 동일하게 구성
    - group-chat-routes
      - date로 구성된 내용 kstDate로 수정
  - 다이렉트 채팅방 추가 시에 lastMessageDate 내용이 포함되어 추가되는 것을 확인할 수 있었고, 다이렉트 채팅방 목록 조회 시에 lastMessageDate 내용을 기준으로 정렬되어 출력되는 것도 확인할 수 있었으며, 채팅 메시지를 추가하면 lastMessageDate 내용이 채팅 메시지 날짜로 업데이트되는 내용까지 문제없이 적용되는 것을 확인할 수 있었다.
    - lastMessageDate 내용을 기준으로 다이렉트 채팅방 목록을 조회하는 내용이 정상적으로 작동은 하고 있는데, 문제는 백엔드에서 내용을 불러올 때는 정상적으로 정렬되어 보여지지만, 프론트엔드에서 정렬 관련 내용이 구성되지 않아서 새롭게 추가되거나 이미 존재하는 다이렉트 채팅방을 다시 조회할 때는 정렬이 되지 않는 문제가 발생하기 때문에 프론트엔드에서 정렬 관련 내용을 추가해 줘야 함
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/b6fbff2516bbb192748f8c9399df4fa25c3c21f0)

<br />

- 다이렉트 채팅방 생성, 이미 존재하는 다이렉트 채팅방 조회할 때 정렬되는 내용 수정 (프론트엔드에 sort 사용해 정렬)
  - 다이렉트 채팅방이 새롭게 추가되거나 이미 존재하는 다이렉트 채팅방을 조회할 때 프론트엔드에서 정렬되지 않는 문제가 발생하기 때문에, 프론트엔드 내용에 정렬 관련 로직을 추가해 생성되거나 닫힌 다이렉트 채팅방을 다시 출력할 때 실시간으로 다이렉트 채팅방 목록이 정렬되어 보여지도록 구성
  - 프론트엔드
    - directChatStore
      - getDirectChats 액션 수정
        - concat을 사용해 기존 다이렉트 채팅방 목록에 업데이트된 다이렉트 채팅방을 추가하는 내용을 수정
        - 스프레드 연산자를 사용해 기존 다이렉트 채팅방 목록에 업데이트된 다이렉트 채팅방이 추가되도록 구성하고, sort를 사용해 요소를 비교하고 정렬되도록 구성
          - a, b 요소를 가져오고 각 요소에 `new Date(...).getTime()`을 사용해 시간 데이터를 밀리초 숫자로 변환
          - b-a로 내용을 구성해 b가 더 크면 양수이므로 b가 최신 데이터가 되며 상단에 보여지고, a가 더 크다면 음수이므로 a가 최신 데이터가 되어 a가 상단에 보여지도록 구성
          - 최신 데이터가 더 상단에 보여지며 내림차순 정렬되도록 구성
      - directChatForm 액션 수정
        - 다이렉트 채팅방 추가 시에 실시간 반영되어 업데이트되는 내용에 sort를 사용해 요소를 비교하고 정렬되도록 구성
          - 다이렉트 채팅방 목록 조회와 동일한 구조로 구성
          - a, b 요소를 가져오고 각 요소에 `new Date(...).getTime()`을 사용해 시간 데이터를 밀리초 숫자로 변환
          - b-a로 내용을 구성해 b가 더 크면 양수이므로 b가 최신 데이터가 되며 상단에 보여지고, a가 더 크다면 음수이므로 a가 최신 데이터가 되어 a가 상단에 보여지도록 구성
          - 최신 데이터가 더 상단에 보여지며 내림차순 정렬되도록 구성
  - 다이렉트 채팅방 생성 또는 닫힌 다이렉트 채팅방을 출력할 때 다이렉트 채팅방 목록에서 정렬되어 보여지도록 구성하고 테스트한 결과, 새롭게 다이렉트 채팅방을 추가하면 최상단에 위치해 보여지는 것을 확인했고, 닫힌 다이렉트 채팅방이 다시 보여질 때는 닫힌 위치 즉, 마지막 메시지 날짜 기준으로 다시 위치해 정렬되는 것을 확인할 수 있었다.
    - 다이렉트 채팅방 목록이 마지막 메시지 날짜를 기준으로 정렬이 되긴 하지만, 실시간 반영이 되지 않는 문제가 있어서 이와 관련해 처리를 해 줘야 함
    - 메시지를 받는 사용자 화면은 실시간 반영이 되지만, 메시지를 보낸 사용자 화면에서 정렬이 되지 않아서 수정이 필요함
    - 당장 구성할 내용은 아니지만, 다이렉트 채팅방 목록에서 채팅방들이 정렬될 때 현재는 CSS가 없어서 뻣뻣하게 정렬되고 있는데 여기에 내용을 추가해 위로 올라가는 내용이 부드럽게 올라가서 위치가 변경되는 그런 CSS 추가하는 것을 생각함
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/d369e7cb2ba48e9ab646768559953e0504d4e918)

# 오늘 느낀 점

- 다이렉트 채팅방에서 사용되는 currentRoomId 대신에 currentRoom가 사용되도록 변경해서 코드를 조금 더 줄일 수 있었고, 다이렉트 채팅방 목록이 정렬될 수 있도록 마지막 메시지 날짜 정보를 추가하고 해당 데이터를 사용해 다이렉트 채팅방 목록이 생각한 구조대로 정렬되는 것까지 문제없이 구현되었다고 생각이 된다. 다이렉트 채팅방 목록에 다이렉트 채팅방이 추가되어 정렬되는 내용이 메시지를 보낸 사용자 화면에서는 실시간 반영이 되지 않고, 메시지를 받는 사용자 화면에서만 실시간 반영이 되고 있기 때문에, 메시지를 보낸 사용자 화면에서도 실시간 반영되어 정렬되도록 내용을 추가해 줘야 한다. 예를 들어, A라는 다이렉트 채팅방을 참여하고 메시지를 추가하면 A 다이렉트 채팅방이 최상단에 이동되어야 하지만, 현재는 실시간 반영이 되지 않고 새로고침을 해야 정렬이 되고 있기 때문에 수정이 필요하다. 이 내용까지 수정을 하면, 다이렉트 채팅방 관련 내용이 얼추 마무리가 된다고 생각하기 때문에, 빠진 기능이 없는지 테스트를 해보고 만약 다 구성이 되었다면 앞으로 어떤 내용을 더 추가해야 하는지 확인을 위한 내용 정리를 한 번 해야 할 것 같다.

<br />

# 내일 할 일

- 실시간 통신 애플리케이션 (Float Chat) 프로젝트 진행

- Zustand 내용 구성

- 다이렉트 채팅방 목록이 마지막 메시지를 기준으로 정렬이 되긴하는데, 실시간 반영이 되지 않아서 실시간 반영이 되도록 구성 필요 (메시지를 보낸 사용자 화면에서 정렬이 되지 않음, 받은 사용자는 정렬되어 보여짐)

- A라는 다이렉트 채팅방을 참여하고 메시지를 추가하면 실시간 반영되어 A 다이렉트 채팅방이 최상단에 이동되어야 하지만, 현재는 새로고침해야 정렬되고 있음

- 다이렉트 채팅방 목록이 정렬될 때 부드럽게 위로 올라가고 내려가는 CSS 적용 필요

- 친구 삭제 시에 다이렉트 채팅방 삭제 확인 로직 필요 (친구 삭제 시에 다이렉트 채팅방을 그대로 남겨놓고 삭제 확인창은 따로 추가하지 않을 예정)

- 친구 관련된 내용에서 코드 정리 필요 (코드를 깔끔하게 보이도록 수정 필요)

- 그룹 채팅방 초대하고 알림을 전송하는 기능에서, 로그인한 사용자가 아닌 친구에게 보내는 그런 구조로 작동되도록 수정이 필요 (비로그인 상태여도 상관이 없음 단순하게 친구한테 친구 요청하면 알림 메시지가 전달되어야 함)

- 추가된 친구와 대화를 나눌 수 있는 다이렉트 채팅방 (진행중)

- 여러 Zustand에 구성된 실시간 반영 로직들이 재사용될 수 있도록 커스텀 훅에 옮겨서 구성하는 것을 고려해야 함

<br />

# 앞으로 해야 할 일

- React, TypeScript 공부

- React 상태 관리 도구인 Zustand 공부

- 실시간 통신 애플리케이션 프로젝트 제작
