# 오늘 한 일

### React + TypeScript 프로젝트 제작 (React, TypeScript, ExpressJS, MongoDB로 만드는 실시간 통신 애플리케이션)

- 온라인 친구 실시간 반영 로직 수정 (오류 해결)
  - 친구가 로그인하면 온라인 상태에 실시간 반영되어 보여지도록 로직 수정
  - 백엔드
    - app
      - registerUser 이벤트 수정
        - onlineFriends 변수 내용 삭제
        - onlineFriends 변수 내용 확인하는 콘솔 로그 삭제
        - 친구 정보를 확인하는 콘솔 로그 삭제
        - onlineFriend 이벤트에 onlineFriends 대신에 friend 정보를 전달
          - forEach를 통해 찾는 친구 관계 정보를 전달
  - onlineFriend 이벤트에 전달되는 내용을 수정해 테스트한 결과, 친구가 로그인하면 온라인 상태에 실시간 반영되어 친구 정보가 뜨는 것을 확인할 수 있었다.
    - 친구가 로그인하면 온라인 상태에 친구 정보가 뜨긴 하지만, 새로고침하면 중복 관련 오류가 발생해 같은 친구 정보가 계속 추가되기 때문에 중복 오류를 수정해야 함
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/9d44ab09fe25e8b45e8614d9309c996b6a7e1bb1)

<br />

- 온라인 친구 실시간 반영 중복 오류 수정
  - 친구가 로그인하면 온라인 상태에 실시간 반영되어 보여지긴 하지만, 새로고침할 경우 중복된 친구 정보가 계속 추가되기 때문에 중복 관련 오류를 수정
  - 프론트엔드
    - friendStore
      - loadOnlineFriends 액션 수정
        - socket.on 내용 수정
          - some을 추가해 기존 온라인 친구 목록 \_id 내용과 이벤트를 통해 넘어온 데이터 \_id를 비교
            - 일치할 경우, 기존 온라인 친구 목록을 그대로 출력
            - 일치하지 않을 경우, 이벤트를 통해 넘어온 데이터를 추가해 출력
  - 새로고침하면 온라인 상태에 친구 정보가 중복으로 추가되지 않도록 some 관련 내용을 추가하고 테스트한 결과, 현재는 문제없이 작동되어 새로고침해도 중복으로 친구 정보가 추가되지 않는 것을 확인할 수 있었다.
    - 친구가 로그인했을 때, 온라인 상태에 친구 정보가 실시간 반영되어 추가되도록 내용을 구성해 주었기 때문에, 반대로 로그아웃을 하면 온라인 상태에 있던 친구 정보가 실시간 반영되어 사라지도록 로직을 추가해야 함
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/555841614c697ef034acc6e05ae4f5b2da77d676)

<br />

- 오프라인 친구 실시간 반영 로직 추가
  - 친구가 로그아웃하면 온라인 상태에 실시간 반영되어 해당 친구 정보가 보이지 않도록 로직 추가
  - 백엔드
    - app
      - disconnect 이벤트 수정
        - 비동기 함수로 변경
        - for문에 오프라인 관련 내용 추가
          - 친구 목록을 조회하는 내용 추가
          - 조회한 친구 목록 데이터에 forEach를 사용해 친구 ID를 뽑아내고, 친구 ID를 활용해 친구 소켓 ID 정보를 얻도록 구성
          - 친구 소켓 ID를 통해 찾은 친구에게 offlineFriend 이벤트로 친구 관계 정보를 전달
  - 프론트엔드
    - friendStore
      - loadOnlineFriends 액션 수정
        - socket.off를 추가해 이벤트 리스너 중복 실행을 방지
        - socket.on 내용 추가
          - offlineFriend 이벤트를 통해 오프라인 친구 데이터를 전달받도록 구성
          - 기존 온라인 친구 목록에 filter를 사용해 친구 \_id와 백엔드에서 넘어온 오프라인 친구 데이터 \_id를 비교하고 일치하지 않는 데이터만 남기도록 구성
  - 로그아웃 시에 로그아웃 하는 사용자 정보를 친구들에게 넘겨서 해당 친구를 제외하고 온라인 상태에서 출력하도록 구성하고 테스트한 결과, 친구가 로그아웃하면 온라인 상태 내용이 실시간 반영되어 해당 친구를 제외하고 보여지는 것을 확인할 수 있었다.
    - 로그인, 로그아웃 시에 온라인 상태가 실시간으로 변경되도록 내용을 모두 구성했기 때문에, 다이렉트 채팅방 목록에서 사용자 로그인 상태를 확인할 수 있도록 구성을 해 봐야 함
    - 다이렉트 채팅방 목록에서 로그인 상태를 보여주는 내용 또한, 로그인시에 바로 적용되도록 registerUser 이벤트 내에서 구성을 해야 하는지 좀 생각을 해 봐야 하고, 다른 좋은 방법이 있을지 찾아봐야 함
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/be97ee309b8a0221106c34b195d9cbd2456520b4)

# 오늘 느낀 점

- 로그인, 로그아웃 시에 온라인 상태가 실시간으로 변경되는 내용을 모두 처리해 주었기 때문에, 이제 비슷한 구조로 다이렉트 채팅방 목록에서 친구의 로그인 상태를 확인할 수 있도록 보여줘야 한다. 온라인 상태 실시간 반영을 위해 registerUser, disconnect 이벤트 내에 구성한 소켓 이벤트 내용에 추가로, 다이렉트 채팅방 목록 로그인 유무와 관련된 소켓 이벤트를 추가하거나, 기존 데이터를 전달하는 방식으로 실시간 반영이 되도록 구성을 해 보려고 생각중인데, 아직 머릿속으로 생각만 해보고 테스트를 진행해보지 못했지 때문에 하나씩 테스트를 해봐야 할 것 같다. 만약 쉽게 해결이 된다면 인증 관련 내용을 다듬어서, URL로 존재하지 않는 채팅방을 입장하려고 하거나 로그아웃 상태에서 URL을 통해 채팅방에 입장하는 경우 리다이렉트되어 오류 페이지로 이동하도록 구성을 해볼 생각이다.

<br />

# 내일 할 일

- 실시간 통신 애플리케이션 (Float Chat) 프로젝트 진행

- Zustand 내용 구성

- 채팅 메시지 입력창과 관련된 내용을 수정해 크기 조절과 줄바꿈 내용이 적용되도록 구성 필요

- 출력되는 채팅 메시지 목록에 스크롤을 추가해 보기 편하도록 변경해야 하고, 메시지가 언제 추가되었는지 구분할 수 있도록 저장된 날짜 데이터를 불러와 표기해야 함

- 다이렉트 채팅방 목록이 정렬될 때 부드럽게 위로 올라가고 내려가는 CSS 적용 필요

- 친구 삭제 시에 다이렉트 채팅방 삭제 확인 로직 필요 (친구 삭제 시에 다이렉트 채팅방을 그대로 남겨놓고 삭제 확인창은 따로 추가하지 않을 예정)

- 친구 관련된 내용에서 코드 정리 필요 (코드를 깔끔하게 보이도록 수정 필요)

- 그룹 채팅방 초대하고 알림을 전송하는 기능에서, 로그인한 사용자가 아닌 친구에게 보내는 그런 구조로 작동되도록 수정이 필요 (비로그인 상태여도 상관이 없음 단순하게 친구한테 친구 요청하면 알림 메시지가 전달되어야 함)

- 추가된 친구와 대화를 나눌 수 있는 다이렉트 채팅방 (진행중)

- 여러 Zustand에 구성된 실시간 반영 로직들이 재사용될 수 있도록 커스텀 훅에 옮겨서 구성하는 것을 고려해야 함

<br />

# 앞으로 해야 할 일

- React, TypeScript 공부

- React 상태 관리 도구인 Zustand 공부

- 실시간 통신 애플리케이션 프로젝트 제작
