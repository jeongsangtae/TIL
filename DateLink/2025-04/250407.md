# 오늘 한 일

### React + TypeScript 프로젝트 제작 (React, TypeScript, ExpressJS, MongoDB로 만드는 실시간 통신 애플리케이션)

- 다이렉트 채팅방 닫기에 타입 정의 내용 추가 및 다이렉트 채팅 라우터 구조 수정 및 비어있는 페이지 관련 컴포넌트 추가 및 친구 토글 함수 추가 및 여러 내용 수정
  - 다이렉트 채팅방 닫기와 관련된 내용에서 타입 정의가 추가되지 않아서 타입 에러가 발생하기 때문에 해당 문제를 해결하기 위해 타입 정의를 추가해 주었고, 다이렉트 채팅과 관련된 라우터 구조를 변경해 다이렉트 채팅방 목록이 다이렉트 채팅방 세부 페이지에서 보여지며 이동될 수 있도록 구성해 주었고, 친구 토글 함수를 추가해 친구 관련 버튼이 항상 보여지는 것이 아닌 토글 버튼 클릭 시에 보여지고 숨겨지도록 구성
  - 프론트엔드
    - router
      - EmptyChatPage 컴포넌트 불러오도록 구성
      - 루트 레이아웃 하위에 다이렉트 채팅 페이지 컴포넌트가 들어가도록 구성
        - index로 들어가던 내용을 me 경로 내용에 옮겨서 구성
      - index로 지정되고, 기본 me 경로에 들어가는 내용은 EmptyChatPage로 수정
        - 비어있는 페이지 컴포넌트로 중첩 라우트 오류를 방지하고 공통 레이아웃 + Route 기반 콘텐츠를 구성할 때 사용하는 방법
        - me 경로에서는 별도로 보여줄 내용이 없으니, 깔끔하게 Empty 컴포넌트를 사용해서 관리
        - ex) 대시보드, 관리페이지, 메신저, 이메일 앱처럼 좌측 사이드바 + 오른쪽 내용이 바뀌는 레이아웃일 때 이런 패턴을 사용
      - path 경로로 "me/:roomId"를 사용하는 다이렉트 채팅방 세부 페이지 내용 수정
        - ":roomId"로 수정하고, 보여지는 내용은 그대로 다이렉트 채팅방 세부 페이지를 보여줌
        - me 경로 하위에 들어가기 때문에, roomId 앞에 사용되는 me 내용 삭제
      - 이외에 주석 처리하고 사용하지 않는 경로 내용들 삭제
    - DirectChatPage
      - Fiends 컴포넌트를 추가해 친구 관련 내용이 보여지도록 구성
      - Outlet을 추가해 하위 컴포넌트에서 다이렉트 채팅방 목록이 보여지도록 구성
    - EmptyChatPage
      - 비어있는 페이지 컴포넌트로 중첩 라우트 오류를 방지하기 위해 사용되는 내용
      - 여기에 내용을 추가해 채팅방을 선택해달라는 메시지가 보이도록 할 수 있지만, 현재는 주석 처리하고 아무런 내용도 보이지 않는 상태로 구성
      - 만약 추가로 내용이 보여지더라도 별도의 컴포넌트를 구성해 거기서 출력될 내용을 구성해야 함
    - directChatStore
      - closeDirectChat 타입 정의 추가
        - 비동기 함수로 타입 정의
        - 매개변수로 전달받는 \_id 내용은 string으로 타입 정의
      - closeDirectChat 액션 수정
        - 주석 처리한 실시간 반영 로직 삭제
    - DirectChats
      - Friends 컴포넌트 주석 처리
        - DirectChatPage 페이지 컴포넌트에 추가해 친구 관련 내용이 보여지도록 구성
    - DirectChat
      - 출력되는 텍스트 수정
    - Friends
      - toggleFriend useState 추가
        - boolean으로 타입 정의
        - 초기값은 false
      - friendToggleHandler 함수 추가
        - 일반 함수로 타입 정의
        - 친구 버튼 클릭 시에 작동되는 함수로, setToggleFriend를 통해 toggleFriend 내용을 반대로 전환
        - 친구 관련 내용들이 항상 보여지는 것이 아닌, 해당 버튼 클릭 시에 보여지고 숨겨지는 방식으로 구성
      - JSX 코드 내용 수정
        - 친구 버튼 추가
          - 클릭 시에 friendToggleHandler 함수가 작동되도록 구성
          - 클릭하면 친구 관련된 버튼들이 보여지고 닫히는 구조
        - 모두, 대기중, 친구 추가하기 버튼이 친구 버튼이 클릭되면 조건부로 보여지고, 다시 클릭되면 닫혀서 보이지 않는 구조로 구성
  - 다이렉트 채팅 닫기 관련 타입 정의를 추가해 타입 에러가 발생하지 않지 않는 것을 확인했고, 다이렉트 채팅방 라우터 구조를 변경해 주면서 다이렉트 채팅방 세부 페이지에서 다이렉트 채팅방 목록이 출력되어 홈으로 이동하지 않고 다른 다이렉트 채팅방으로 이동할 수 있는 것까지 문제없이 확인이 되었고, 친구 토글 버튼으로 친구 관련 버튼이 보여지고 숨겨지는 것까지 문제없이 작동되는 것을 확인할 수 있었다.
    - 메시지 추가 시에 다이렉트 채팅방이 다른 사용자 화면에서 실시간 반영되어 보여지도록 구성을 해야 하는데, 생각한 방법이 제대로 구성이 되지 않아서 다른 방법으로 시도해 봐야 함
    - 메시지를 추가할 때, 처음 보내는 메시지면 다이렉트 채팅방을 불러오는 내용이 실행되도록 하는 내용을 생각했는데, 이 내용은 초기 채팅 메시지에만 적용되고 다이렉트 채팅방 닫기가 적용된 채팅방에는 사용이 불가능하기 때문에 현실적으로 불가능하다고 생각이 됨
    - 다른 방법으로, 다이렉트 채팅 메시지가 추가된 후에 업데이트된 다이렉트 채팅방과 다른 채팅방 목록을 불러와서 해당 내용을 소켓 이벤트로 전달하고, 그걸 프론트엔드에서 출력하는 그림은 어떤지 생각을 해봤는데, 이게 제일 현실적이고 가능할 것 같아서 로직을 구성하고 테스트해 볼 생각
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/25f23306640a605f3a9dcc7618f9ec0a6574bd00)

# 오늘 느낀 점

- 다이렉트 채팅방 닫기 관련 내용에 타입 정의를 추가하지 않아서 타입 에러가 발생하기 때문에 관련 오류를 처리하기 위해 타입 정의를 추가해 주었고, 다이렉트 채팅방 세부 페이지에서 다이렉트 채팅방 목록이 보여지도록 다이렉트 채팅방 관련 라우터 구조를 변경해 주었으며, 친구 토글 버튼을 추가해 친구 관련 버튼들이 항상 보여지는 것이 아닌 필요할 때 보여지고 숨겨지도록 구성해 주었다. 이제 다이렉트 채팅방이 닫힌 상태에서 다른 사용자가 메시지를 추가하면 해당 다이렉트 채팅방이 실시간으로 다시 보여지도록 내용을 구성해야 하는데, 앞에서 테스트한 방법으로는 정상적으로 실시간 반영이 될 것 같지 않아서 현재 생각한 방법으로는 다이렉트 채팅 메시지가 추가되고 업데이트되면 그 다이렉트 채팅방 내용과 다른 다이렉트 채팅방 목록을 불러와 소켓 이벤트로 전달하고 프론트엔드에서 출력하는 순서로 생각을 하고 있는데 이 내용은 아직 생각만 한 상태로, 로직을 구성하고 테스트해서 어떤 결과가 생기는지 확인을 해 봐야 한다. 그리고 저 실시간 반영 테스트 전에, 닫힌 다이렉트 채팅방에서 새롭게 추가된 메시지가 알림으로 넘어와 보여지는지 확인이 필요하고, 친구 삭제 시에 다이렉트 채팅방 처리가 어떻게 되고 있는지 확인을 해 줄 생각이다.

<br />

# 내일 할 일

- 실시간 통신 애플리케이션 (Float Chat) 프로젝트 진행

- Zustand 내용 구성

- 다이렉트 채팅방 생성 시에 초기에는 생성한 사용자 화면에서만 보여지고, 이후에 채팅 추가 시에 상대방 화면에도 보여져야 함 (해당 내용은 처리를 해 주었지만, 실시간 반영 내용이 아직 추가되지 않아서 새로고침해야 보이기 때문에 실시간 반영 내용을 추가해 메시지가 추가되면 바로 다른 사용자 화면에서도 보이도록 해야 함)

- 친구 삭제 시에 다이렉트 채팅방 삭제 확인 로직 필요 (친구 삭제 시에 다이렉트 채팅방을 그대로 남겨놓고 삭제 확인창은 따로 추가하지 않을 예정)

- 친구 관련된 내용에서 코드 정리 필요 (코드를 깔끔하게 보이도록 수정 필요)

- 그룹 채팅방 초대하고 알림을 전송하는 기능에서, 로그인한 사용자가 아닌 친구에게 보내는 그런 구조로 작동되도록 수정이 필요 (비로그인 상태여도 상관이 없음 단순하게 친구한테 친구 요청하면 알림 메시지가 전달되어야 함)

- 추가된 친구와 대화를 나눌 수 있는 다이렉트 채팅방 (진행중)

- 여러 Zustand에 구성된 실시간 반영 로직들이 재사용될 수 있도록 커스텀 훅에 옮겨서 구성하는 것을 고려해야 함

<br />

# 앞으로 해야 할 일

- React, TypeScript 공부

- React 상태 관리 도구인 Zustand 공부

- 실시간 통신 애플리케이션 프로젝트 제작
