# 오늘 한 일

### React 프로젝트 제작 (React, NodeJS, MongoDB로 만드는 미니 커뮤니티 플랫폼)

- 구성한 내용

  - 프론트엔드에서 API URL 동적 구성 추가 (관리자 페이지 라우터, 게시글 세부 페이지 라우터, 프로필, 로그인, 회원가입)
    - PostDetailsPage, AdminRootLayout, AdminPostsPage, AdminPostDetailsPage
      - 페이지 라우터 내용의 loader, action 함수에서 구성된 fetch 함수 내용에 apiURL 변수를 추가해주고 API 경로에서 사용될 수 있도록 구성
    - Profile, Login, Signup
      - apiURL 변수 내용을 추가해주고, fetch 함수 내의 API 경로에서 사용될 수 있도록 구성
    - 회원가입은 성공, 로그인은 실패
      - 로그인을 시도하면 500 에러가 뜨기 때문에 추가 확인이 필요
      - 500 에러는 백엔드에서 발생하는 에러로, 어느 부분에서 문제가 생겼는 지 확인이 필요
      - 오류가 발생되는 예상 지점으로는 auth context api에서 로그인 관련 액세스 토큰과 리프레쉬 토큰을 확인하는 fetch 함수가 있는 데, 이 곳에서 apiURL 구성을 해주지 않아서 에러가 발생된다고 생각되기 때문에 추가 수정을 해줘야 한다.
    - 테스트 결과, 회원가입은 성공했지만 로그인은 실패했기 때문에, 로그인 관련 fetch 함수에서 추가로 확인해보고 수정을 해줘야 함
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/829a14837cdf9ea131c0ef4edd98fbdfda28572b)

  <br />

  - 프론트엔드에서 API URL 동적 구성 추가 (auth Context API)
    - auth-context
      - apiURL 변수 내용을 추가해주고, verifyUser, refreshTokenHadler, refreshTokenHandler, logoutHandler 함수에서 구성된 fetch 함수 내의 API 경로에서 사용될 수 있도록 구성
    - 오류 해결 실패
      - 로그인과 관련된 모든 fetch 함수 내용에서 apiURL 내용이 사용될 수 있도록 구성을 해주었으나, 여전히 같은 오류가 발생하고 있기 때문에 추가 확인이 필요
        - 로컬과 배포 환경 모두 오류 발생
      - 콘솔에서 확인해보니, "/login/success"에서 에러가 발생하고 있는데, 이 위치는 메인 헤더에서 구성된 fetch 함수 내용으로, 로그인 상태를 확인하고 유지시켜주는 내용인데 여기서 apiURL 관련 내용이 처리되지 않아서 오류가 발생하기 때문에 추가로 수정해줘야 한다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/b7fe74e730c866f9da75dcadc5124f2a9aead0e0)

  <br />

  - 프론트엔드에서 API URL 동적 구성 추가 (메인헤더의 로그인 성공)
    - MainHeader
      - apiURL 변수 내용을 추가해주고, fetch 함수 내의 API 경로에서 사용될 수 있도록 구성
    - 오류 해결 실패
      - 로컬에서 먼저 수정하고 테스트해본 결과, 문제없이 작동되어서 배포 환경에서 확인해봤으나, 여전히 오류가 발생해서 추가 확인이 필요함
      - 여전히 로그인과 관련된 백엔드에서 500 에러가 발생하므로, 어떤 코드를 통과하지 못하고 500 에러가 반환되는 지 확인이 필요하다.
      - 로컬 환경에서는 정상적으로 작동하고, 배포 환경에서 작동하지 않는 것으로 봐선 코드에서 문제가 있어 보이진 않지만, 혹시 모르니 코드에서 다시 확인을 해봐야 함
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/b52fd33aa266b7d8fce1fbdb001cc352d55d5d3b)

  <br />

  - 백엔드에서 발생하는 에러 체크
    - user-routes
      - 로그인 라우터의 try-catch 내용에서 통과되지 못하고 오류가 발생하기 때문에, 어떤 오류가 발생하는 지 더 자세한 확인을 위해서 catch 블록에 console.error 내용 추가
      - 에러 객체, 에러 메시지, 스택 트레이스를 출력하도록 구성
    - 오류 확인 결과
      - `secretOrPrivateKey must have a value`라는 에러가 발생
      - 해당 에러는 JWT를 생성할 때 사용하는 비밀 키가 설정되지 않았다는 오류로, 배포한 백엔드 내용의 환경 변수에서 액세스 토큰 키와 리프레쉬 토큰 키 관련 설정을 해줘야 함
    - 로컬 환경의 .env 파일에서만 환경 변수 설정을 해놓고, 배포한 백엔드 내용의 환경 변수에서 내용을 설정하지 않아서 발생한 오류로, 키 관련 내용을 추가하면 해결될 것으로 예상됨
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/c5196177eef7dc5dfc4b599a889207db08222362)

<br />

- 추가 및 해결 해야 할 내용
  - 마지막 기능 추가로, 관리자 권한을 부여하는 내용을 생각하고 있음
    - 가입할 때는 일반 사용자로 가입을 할 수 있고, admin 관리자 계정으로 관리자 페이지에서 관리자 권한을 부여하는 내용을 생각 중
  - 새롭게 발견한 문제
    - 관리자 채팅의 사용자 리스트에서 사용자와 나눈 마지막 메시지 내용을 가져오는데, 이 때 새로고침을 하지 않으면 당장 채팅을 나눠도 실시간으로 마지막 메시지가 갱신되지 않아서 새로운 메시지가 있는 지 확인할 수 없기 때문에 추가하는 것도 고려해야 함
    - 한편으로는, 관리자 채팅이라서 사용자가 겪는 불편함이 아니기 때문에 그냥 놔두는 것도 고려 중

# 오늘 느낀 점

- 게시글과 관련된 내용에서 apiURL 관련 내용을 수정해주고, 회원가입과 로그인에서도 수정해줘서 문제없이 작동할 것으로 예상했으나, 회원가입만 정상적으로 이루어지고 로그인에서는 계속 오류가 생기는 문제가 발생해서 추가로 수정하고 테스트 해봐도, 로컬 환경에서만 문제없이 작동하고 배포 환경에서는 계속 오류가 생겨서 그 오류에 대해 파악하고 알아내는 과정에서 좀 애먹었던 것 같다. 발생하는 오류는 JWT 토큰 키에 대한 오류로, 백엔드 로컬 환경에서는 .env 내용에 구성한 JWT 토큰 키 환경 변수 내용을 사용해서 문제가 없었지만, 배포 환경의 환경 변수에서는 추가하지 않아서 발생하기 때문에 JWT 키 관련 내용을 환경 변수에 추가해주면 해결될 것으로 예상되며, 이 오류가 해결되면 로그인한 후에 게시글 추가 및 수정, 삭제와 관련된 기능, 댓글과 답글 관련 기능을 테스트해볼 수 있을 것 같다.

<br />

# 내일 할 일

- React 공부 및 React 프로젝트 조금씩 진행하기

<br />

# 앞으로 해야 할 일

- React, NextJS 공부

- React 프로젝트 제작
