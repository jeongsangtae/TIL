# 오늘 한 일

### React 프로젝트 제작 (React, NodeJS, MongoDB로 만드는 미니 커뮤니티 플랫폼)

- 구성한 내용

  - 백엔드에서 clearCookie 내용에 동적 구성 추가 (secure, sameSite)
    - 로그인 한 후에 로그아웃을 하면 로컬 스토리지에 저장된 내용은 삭제되지만, 쿠키에 저장된 토큰은 삭제되지 않는 문제를 해결
    - user-routes.js 내용의 로그아웃 라우터
      - isProduction 변수를 추가
      - clearCookie 내용에 secure과 sameSite 내용 추가
        - secure
          - 토큰을 쿠키에 저장할 때 구성해준 내용과 마찬가지로, 로컬 환경에서는 false가 적용되고, 배포 환경에서 true가 적용되도록 구성
        - sameSite
          - 여기서도 토큰을 쿠키에 저장할 때 구성해준 내용과 마찬가지로, 로컬 환경에서는 "Lax"가 들어가도록 해주고, 배포 환경에서는 "None"이 들어가도록 구성
    - 오류 해결
      - 쿠키에 토큰을 저장할 때와 마찬가지로, 쿠키에 저장된 내용을 삭제할 때는 secure, sameSite, domain, path 같은 옵션들이 동일하게 설정되지 않으면 쿠키가 제대로 삭제되지 않음
      - 구성한 내용에서 쿠키에 토큰을 저장할 때 domain, path는 사용하지 않고 secure, sameSite만 설정했기 때문에 이 두 가지 내용에 대해서만 구성해주면 정상적으로 쿠키에 저장된 데이터를 지울 수 있음
      - res.clearCookie는 res.cookie에서 설정한 속성들을 동일하게 구성해줘야 오류가 발생하지 않고 정상적으로 동작함
      - 로컬 환경에서 오류가 발생하지 않은 이유는, 기본적으로 clearCookie에서 secure, sameSite 값을 명시하지 않으면 브라우저는 기본적으로 false와 Lax 값으로 처리 하기 때문에 오류가 발생하지 않게 됨
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/96fca6893e6b44316043cf682615a5ce7246a13b)

  <br />

  - 프론트엔드에서 API URL 동적 구성 추가 (댓글, 답글)
    - Comments, Comment, CreateComment, EditComment, Replies, Reply, ReplyForm
      - apiURL 변수 내용을 추가해주고, 댓글과 답글 관련된 fetch 함수 내의 API 경로에서 사용될 수 있도록 구성
        - 댓글 목록, 추가, 수정, 삭제 그리고 답글 목록, 추가, 수정, 삭제 내용 모두에 사용
    - 오류 해결
      - 배포 환경에서 적용될 수 있도록 API URL을 동적으로 구성해주지 않아서, 게시글 세부 페이지를 들어갈 때마다 댓글을 조회할 수 없다는 에러가 떴는데, 이제는 에러가 뜨지 않고 게시글 내용이 보여지는 것을 확인
      - 게시글 세부 페이지에서 댓글과 답글 관련 추가, 수정, 삭제 기능이 모두 정상적으로 작동되는 것도 확인
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/d2fb2cdee5e689e2e42399913c192b68efcbe6bd)

  <br />

  - 프론트엔드에서 API URL 동적 구성 추가 (관리자 채팅, 게시글, 사용자)
    - AdminPosts, AdminChats, AdminUserList, AdminUsers, AdminUser
      - apiURL 변수 내용을 추가해주고, fetch 함수 내의 API 경로에서 사용될 수 있도록 구성
    - 오류 해결
      - 관리자 로그인을 해준 뒤에, 채팅 버튼을 클릭하면 사용자 리스트가 뜨지 않았지만 내용을 구성해준 뒤에는 문제없이 사용자 리스트가 뜨고, 클릭하면 채팅 내용이 보여지는 것을 확인
      - 관리자 페이지의 사용자 페이지에서 사용자 목록이 보여지는 것을 확인했고, 삭제 버튼 클릭 시 해당 사용자가 삭제되는 것도 확인
    - 오류 확인
      - 관리자 채팅에서 사용자 리스트와 채팅 내용이 뜨는 것은 문제가 없지만, 채팅을 입력하면 전송이 안되는 오류가 발생했는데, 확인해보니 socket.io와 연결하는 API 경로와 메시지를 전송하는 fetch 함수 API 경로에서 내용을 동적으로 구성해주지 않아서 발생하는 오류이기 때문에 추가로 수정해줘야 함
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/dd8f1cff23cb2f59abc70d8946ef421bac63a645)

  <br />

  - 프론트엔드에서 API URL 동적 구성 수정 (관리자 채팅)
    - AdminChats
      - WebSocket과 연결하는 API 경로와 메시지를 전송하는 fetch 함수 내의 API 경로에서 apiURL 변수가 사용될 수 있도록 구성
    - 오류 해결
      - 관리자 채팅 부분에서 사용자 리스트가 보여지지 않는 문제를 해결해주면서, WebSocket과 연결하고 메시지가 전달되는 fetch 함수에서도 apiURL 변수가 사용될 수 있도록 구성해줬어야 했는데, 실수로 빼먹었기 때문에 추가로 수정해서 메시지가 전달될 수 있도록 구성
      - apiURL 변수를 사용해서 API 경로를 수정해주니, 문제없이 메시지가 전송되는 것을 확인
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/f1273351c8ac2c9f5e88f9b83d43efb53d359691)

  <br />

  - 프론트엔드에서 API URL 동적 구성 추가 (관리자 댓글, 답글)
    - AdminComments, AdminComment, AdminReplies, AdminReply
      - apiURL 변수 내용을 추가해주고, 댓글과 답글 관련된 fetch 함수 내의 API 경로에서 사용될 수 있도록 구성
        - 댓글 목록, 삭제 그리고 답글 목록, 삭제 내용 모두에 사용
    - 오류 해결
      - 관리자 페이지의 게시글 세부 페이지에서도 댓글과 답글 관련 API URL 구성을 해주지 않아서 에러 메시지가 출력됐는데, apiURL 변수를 사용해서 구성해준 후에는 에러 메시지가 뜨지 않는 것을 확인
      - 댓글과 답글이 정상적으로 출력되고, 삭제 버튼을 클릭했을 때 삭제가 되는 것도 확인
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/3aa28642e7009dd22e5d5f73bc129a2a90c274ad)

<br />

- 추가 및 해결 해야 할 내용
  - 마지막 기능 추가로, 관리자 권한을 부여하는 내용을 생각하고 있음
    - 가입할 때는 일반 사용자로 가입을 할 수 있고, admin 관리자 계정으로 관리자 페이지에서 관리자 권한을 부여하는 내용을 생각 중
  - 새롭게 발견한 문제
    - 관리자 채팅의 사용자 리스트에서 사용자와 나눈 마지막 메시지 내용을 가져오는데, 이 때 새로고침을 하지 않으면 당장 채팅을 나눠도 실시간으로 마지막 메시지가 갱신되지 않아서 새로운 메시지가 있는 지 확인할 수 없기 때문에 추가하는 것도 고려해야 함
    - 한편으로는, 관리자 채팅이라서 사용자가 겪는 불편함이 아니기 때문에 그냥 놔두는 것도 고려 중
  - 배포한 사이트 확인
    - 오류
      - 정상적으로 페이지가 보여지는 상황에서 새로고침하면 "Not Found" 메시지가 화면에 보여지고 내용이 보이지 않기 때문에 이 부분에 대해 수정해줘야 함
    - 모바일 환경
      - 라이트 모드일 때 회원가입과 로그인 버튼 뒤의 배경색이 조금 다르게 구성되어 있음
      - 테마 모드 변경 버튼 위치가 어긋나 있기 때문에 수정 필요
      - 게시글 세부 페이지에서 사용자 이름, 작성 날짜, 조회 수 사이에 점 크기를 조절해야 함

# 오늘 느낀 점

- 관리자 페이지에서 구성된 fetch 함수에서도 API URL이 동적으로 변경될 수 있도록 모두 구성해줬기 때문에 더 이상 API URL 관련 내용에서 변경해줄 부분은 없는 것 같다고 생각이 된다. 마지막으로 한 번 전체적으로 빼먹은 곳은 없는 지 확인을 해줘야 하고, 모바일 환경의 UI에서 조금 어색한 부분이 있어서 이와 관련된 내용을 수정해줘야 한다. 추가로 배포한 사이트의 홈 페이지를 제외하고 다른 페이지를 URL로 입력해서 이동하려고 할 때와 홈 페이지를 제외한 페이지에서 새로고침하면 "Not Found" 내용이 보여지면서 오류가 발생하기 때문에 이와 관련된 오류를 찾아보고 해결해줘야 한다.

<br />

# 내일 할 일

- React 공부 및 React 프로젝트 조금씩 진행하기

<br />

# 앞으로 해야 할 일

- React, NextJS 공부

- React 프로젝트 제작
