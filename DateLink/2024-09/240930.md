# 오늘 한 일

### React 프로젝트 제작 (React, NodeJS, MongoDB로 만드는 미니 커뮤니티 플랫폼)

- 구성한 내용

  - CSS 수정 (점 크기 테스트)
    - 수정한 CSS 내용
      - AdminPost, AdminPostDetails
        - 작은 원 모양의 점으로 구성
        - "\2219"로 구성
      - Post, PostDetails
        - 점 크기를 1rem에서 0.75rem으로 변경해서 크기 확인
        - "\2022" 크기를 0.75rem으로 변경해서, "\2219" 기본 크기와 비교
    - 재배포 후 UI 확인
      - 로컬 환경과 배포 환경에서 점 크기가 다르게 보여서, 배포 후에 확인해줘야 함
      - "\2022" 크기를 0.75rem으로 변경한 내용과 "\2219" 크기를 비교한 결과, "\2022" 크기를 축소한 점도 나쁘진 않지만, 더 작은 크기의 "\2219" 원이 더 보기 좋다고 생각되어, 전체적으로 "\2219" 원이 사용되도록 다시 변경해줘야 함
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/5fc2aa31cfd6c6bb199a6ea2eec0d592de4f5526)

  <br />

  - CSS 수정 (점 크기, 메인헤더 배경색 수정)
    - 수정한 CSS 내용
      - Post, PostDetails
        - "\2022"에서 "\2219"로 변경하고, 폰트 크기를 다시 1rem으로 변경
      - MainHeader, AdminMainHeader
        - 메인헤더 배경색을 통일될 수 있도록 rgb(245, 245, 245)로 변경
    - 재배포 후 UI 확인
      - 점 크기가 모두 작은 원으로 구성된 것을 확인
      - 메인헤더와 관리자 메인헤더의 배경색이 조금 진한 회색으로 구성되면서, 이전보다 더 구분이 잘 되는 것을 확인
      - rgb(250, 250, 250)으로 변경하는 것도 생각했으나, rgb(245, 245, 245)가 좀 더 메인헤더와 그 아래에 구성된 내용 간의 구분이 잘 되기 때문에 rgb(245, 245, 245)로 구성
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/540ee43a791a2f9d1c31706cc3379eec7115ab91)

  <br />

  - Not Found 에러 해결
    - 발생하는 문제
      - 홈 페이지를 제외한 게시글 페이지나 게시글 세부 페이지, 프로필 페이지 등 여러 페이지에서 새로고침을 하거나, URL에 입력해서 이동하려고 할 때 "Not Found"라는 메시지가 보여지며 존재하지 않는 페이지로 이동
    - 해당 문제가 발생하는 원인
      - 원인
        - 클라이언트 측에서 URL을 관리하고 페이지를 렌더링
        - 처음에 접속할 때는 index.html 파일을 로드하고 그 후에 내부적으로 라우팅을 처리
        - 사용자가 페이지를 새로고침하면 서버는 그 경로에 대한 직접적인 요청을 받는다.
        - 서버에는 해당 경로에 대한 처리가 없기 때문에 404 에러가 발생
        - 서버는 경로에 대해 알고 있지 않고, 그 경로가 클라이언트 측에서만 정의되어 있기 때문이다.
        - 즉, SPA에서 서버가 클라이언트 라우터를 처리하지 못할 때 발생하는 문제로, Vite로 빌드한 프로젝트는 기본적으로 정적 파일을 제공하지만, 서버가 라우팅을 처리하지 않아서 발생하게 됨
          - 해결을 위해서는 서버에서 모든 경로를 index.html로 리디렉트하여 클라이언트 측 라우터가 경로를 처리하도록 해야 함
          - Render와 같은 배포 환경에서는 "Rewrite" 또는 "Fallback" 설정을 추가하여 모든 경로가 index.html로 리디렉션되도록 해줘야 함
    - 문제 해결 방법
      - Express 서버 설정 (Vite + Express)
        - 서버쪽 설정에서 프론트엔드 정적 파일을 제공하고, 모든 경로를 index.html로 리다이렉트되도록 해줘야 함
      - Vite 배포 설정 (Netlify, Vercel 등)
        - Netlify
          - "\_redirects" 파일을 프로젝트의 dist 폴더에 추가하여 모든 경로를 index.html로 리디렉트하는 규칙을 설정해서 해결 가능
          - `/* /index.html 200`
        - Vercel
          - vercel.json 파일에 rewrite 설정을 추가하여 모든 경로가 index.html로 리디렉트되도록 할 수 있음
          - `{ "rewrites": [ { "source" : "/(.*)", "destination": "index.html" } ]}`
        - Nginx
          - Nginx를 사용하여 정적 파일을 제공하는 경우, 모든 경로를 index.html로 리디렉트하는 규칙을 추가해야 함
          - `location / { try_files $url /index.html }`
      - 순서 정리
        - Express 서버에서는 app.get("\*")을 사용하여 모든 경로에 index.html로 리디렉트
        - Netlify에서는 "\_redirects" 파일을 사용하여 모든 경로를 리디렉트
        - Vercel에서는 vercel.json 파일에 rewrite 규칙을 추가
        - Nginx를 사용한다면 "try_files $uri /index.html;" 설정을 추가
      - Render에서 Vite 프로젝트를 배포했을 경우 해결 방법
        - 기본 설명
          - Render의 리디렉션 설정을 통해 모든 경로를 index.html로 리디렉트하는 설정을 추가해야 함
          - 이 설정은 서버가 클라이언트 라우팅을 처리할 수 있도록 하여 SPA에서 URL을 직접 입력하거나 새로고침할 때 오류를 방지함
          - Render에서는 "rewrites" 설정을 통해 이 문제를 해결할 수 있음
        - 해결 방법
          - 프론트엔드를 배포한 곳에서 "Redirect and Rewrite Rules" 설정을 수정해야 함
          - 프론트엔드의 모든 경로를 index.html로 리디렉트하여, 클라이언트 사이드 라우터가 경로를 처리하도록 해야 함
        - 설정 방법
          - Render 대시보드에서 Static Site로 배포한 프론트엔드 프로젝트로 이동
          - Redirects/Rewrites (Redirect and Rewrite Rules)에서 규칙 추가
          - Source
            - "/\*"
          - Destinaton
            - "/index.html"
          - Action (Type)
            - Rewrite
          - 이 설정으로 모든 경로 (/posts, /posts/1, /profile 등)가 index.html로 리디렉트되도록 하여, Vite와 같은 클라이언트 사이드 라우터가 해당 경로를 처리할 수 있게 됨
          - Redirect and Rewrite Rules에서 /\*을 /index.html로 Rewrite하는 규칙을 추가하면, 프론트엔드의 모든 경로가 index.html로 리디렉트되어 클라이언트 사이드 라우터가 동작하게 됨
      - Redirect and Rewrite Rules 내용에서 Action 항목을 Rewrite로 선택하는 이유는 ?
        - Rewrite
          - 클라이언트가 요청한 URL을 서버 내부에서 다른 경로로 매핑
          - URL이 브라우저 주소창에서 변경되지 않음
            - "/posts/1"을 요청해도 내부적으로는 "/index.html"을 서버에서 전달하지만, 사용자는 여전히 "/posts/1" URL을 보게 됨
          - 클라이언트 사이드 라우터가 해당 경로를 처리하도록 하는데, 이는 SPA의 본질에 맞는 방식임
        - Redirect
          - 서버가 클라이언트에게 다른 URL로 이동하라는 응답을 보냄
          - URL이 브라우저 주소창에서 변경됨
            - "/posts/1"를 요청하면 클라이언트가 "/index.html"로 리다이렉트되고, 사용자는 브라우저 주소창에서 "/index.html"을 보게 됨
          - SPA에서 원치 않는 동작으로, 클라이언트 사이드 라우터가 아니라 서버가 라우팅을 처리하게 되어, SPA의 장점인 빠르고 동적인 페이지 전환이 사라짐
        - 간단 요약
          - Rewrite
            - 브라우저 주소창의 URL은 유지하면서 요청을 서버 내부적으로 index.html로 매핑하고, 클라이언트 사이드 라우터가 경로를 처리할 수 있도록 함
            - SPA에 적합한 방식
          - Redirect
            - 브라우저 주소창의 URL을 강제로 변경하고, 서버에서 다시 요청을 받음
            - SPA에 적합하지 않는 방식이며, 불필요한 서버 요청이 발생할 수 있음
          - SPA 프로젝트에서는 반드시 "rewrite"를 선택해야 올바르게 동작하며, URL 새로고침이나 경로 이동 시 문제가 발생하지 않음
    - 마무리
      - 프론트엔드에서 페이지 이동이나 새로고침을 할 때, URL이 변경되지만 서버는 그 URL에 맞는 파일을 제공하지 못해 에러가 발생했지만 프론트엔드를 배포한 설정에서 "Rewrite" 내용을 구성해주면서 해결해주었다.

<br />

- 추가 및 해결 해야 할 내용
  - 마지막 기능 추가로, 관리자 권한을 부여하는 내용을 생각하고 있음
    - 가입할 때는 일반 사용자로 가입을 할 수 있고, admin 관리자 계정으로 관리자 페이지에서 관리자 권한을 부여하는 내용을 생각 중
  - 새롭게 발견한 문제
    - 관리자 채팅의 사용자 리스트에서 사용자와 나눈 마지막 메시지 내용을 가져오는데, 이 때 새로고침을 하지 않으면 당장 채팅을 나눠도 실시간으로 마지막 메시지가 갱신되지 않아서 새로운 메시지가 있는 지 확인할 수 없기 때문에 추가하는 것도 고려해야 함
    - 한편으로는, 관리자 채팅이라서 사용자가 겪는 불편함이 아니기 때문에 그냥 놔두는 것도 고려 중
  - 배포한 사이트 확인
    - UI
      - 데스크탑 환경의 라이트 모드에서 드롭다운 메뉴 버튼 배경색 변경해야 함
      - 관리자 페이지의 사용자 페이지에서 점 크기 수정해야 함
    - UI를 수정해주고 최종 확인이 필요함
  - SPA와 서버 사이드 라우팅에 대해 한 번 정리 필요
    - 이전에 정리했었지만, 이번에 배포하면서 새롭게 알게 된 부분이 있기 때문에 추가 정리

# 오늘 느낀 점

- UI 관련 수정을 다 해줬다고 생각했는데, 수정하면서 잘못 수정한 부분이 있었는 지 드롭다운 버튼 배경색이 드롭다운 메뉴 배경색과 달라서 이상하기 때문에 추가로 수정을 해줘야 하고, 관리자 페이지의 사용자 페이지에서 사용되는 점 크기가 문제 있는 것도 확인했기 때문에 이 부분도 추가로 수정해줘야 하며, 그 외에 더 추가로 수정할 UI가 있는 지 데스크탑 환경과 모바일 환경에서 확인해봐야 한다. 그리고 사용자, 관리자 로그인으로 게시글, 댓글, 답글 등 모든 기능에 대해서 한 번씩 테스트해서 올바르게 작동하는 지 확인을 해줘야 한다. 새고로침 관련 문제를 해결하고 테스트했을 때 문제가 없었는데, 생각해보니 URL로 입력하는 것은 제대로 테스트하지 않은 것 같아서 이 부분도 추가로 테스트해보고 문제가 없는 지 확인을 해줘야 한다.

<br />

# 내일 할 일

- React 공부 및 React 프로젝트 조금씩 진행하기

<br />

# 앞으로 해야 할 일

- React, NextJS 공부

- React 프로젝트 제작
