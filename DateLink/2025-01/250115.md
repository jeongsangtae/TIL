# 오늘 한 일

### React + TypeScript 프로젝트 제작 (React, TypeScript, ExpressJS, MongoDB로 만드는 실시간 통신 애플리케이션)

- 리프레시 토큰을 통해 사용자 데이터 반환 및 Zustand에 구성된 여러 액션 수정
  - 액세스 토큰 만료 시간이 지난 후에 페이지에 다시 접속하면 리프레시 토큰 만료 시간이 남아있음에도 로그아웃이 되기 때문에, 리프레시 토큰 만료 시간을 기준으로 로그인 유지와 갱신이 되도록 Zustand에 구성된 여러 액션 내용을 수정하고, 리프레시 토큰 갱신 시에 프론트엔드로 사용자 정보 데이터를 반환하도록 구성을 변경
  - 백엔드
    - jwt-auth
      - refreshToken 함수 내용 수정
        - 디스트럭처링을 통해서 패스워드를 제외한 나머지 사용자 데이터를 가져오도록 구성
        - 가져온 사용자 데이터에 토큰 만료 시간을 추가해 반환하도록 구성
    - user-routes
      - 오류 발생 시 출력하는 메시지 내용을 수정
  - 프론트엔드
    - authStore
      - renewToken 액션
        - 토큰 갱신 및 토큰 갱신 후 로그인 상태를 유지하는 조건문 내용을 수정
        - 리프레시 토큰 만료 시간이 현재 시간보다 큰 경우를 먼저 확인해서 리프레시 토큰이 살아있음을 확인
        - 위 조건문을 통과할 경우, 현재 시간이 액세스 토큰 만료 시간보다 큰 경우를 확인해서 액세스 토큰이 만료된 것을 확인하고 토큰 갱신 및 갱신 후 로그인 상태 유지
        - else if문은 동일하게 현재 시간이 리프레시 토큰 만료 시간보다 클 경우, 리프레시 토큰이 만료되었기 때문에 로그아웃하도록 구성
      - verifyUser 액션
        - response에 문제가 생기면 바로 catch문으로 넘어가서 로그아웃 시키는 것이 아닌, 우선 리프레시 토큰이 만료되었는지 확인하고 만약 만료되었을 경우 로그아웃과 함께 catch문으로 에러를 전송하고, 리프레시 토큰이 만료되지 않았을 경우 토큰을 다시 갱신해서 로그인 유지가 되도록 구성
        - 현재 시간과 리프레시 토큰 만료 시간을 가져온 후에 조건문을 통해 리프레시 토큰 만료 여부를 확인해서 로그아웃 또는 토큰 갱신이 이루어 지도록 구성
        - 브라우저를 닫고 액세스 토큰이 만료된 후에 다시 접속했을 경우에만 response 조건문이 작동하고, 정상적인 로그인에서는 response 조건문이 작동하지 않고 그 아래 인증 및 로그인이 되도록 구성
      - refreshToken 액션
        - 액세스 토큰과 리프레시 토큰 갱신 시에 백엔드에서 사용자 정보를 받아오고, set 상태를 통해 로그인 유무와 사용자 정보를 업데이트해서 로그인 정보가 그대로 유지될 수 있도록 구성
        - 토큰 갱신 오류가 발생하면 로그아웃이 되도록 구성
  - 변경한 내용을 테스트한 결과, 로그인한 후에 브라우저를 닫고 액세스 토큰이 만료되었지만 리프레시 토큰 만료 시간이 남아있는 경우, 다시 브라우저에 접속하면 액세스 토큰과 리프레시 토큰이 갱신되며 로그인이 유지되는 것을 확인할 수 있었다.
    - 추가로 리프레시 토큰이 만료된 후에 브라우저에 접속하면 로그아웃이 되어있었으며, 토큰 만료 시간이 지난 후에 로컬 스토리지 내용이 초기화되지 않는 문제까지 함께 해결이 된 것을 확인할 수 있었다.
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/4b7edf57b0b869a6c115bf4f2040d964b0e3f4dd)

# 오늘 느낀 점

- 백엔드의 리프레시 토큰 로직에서 사용자 정보를 프론트엔드로 전달하고, 토큰이 갱신될 때 그 정보를 사용해 업데이트하면서 로그인 정보가 그대로 유지가 되어 로그인 유지까지 되도록 수정해 주었다. 리프레시 토큰 만료 시간을 기준으로 로그인 유지가 되도록 내용을 수정해 주었는데, 이 수정한 내용으로 인해 리프레시 토큰 만료 시에 로그아웃되고 로컬 스토리지 내용이 초기화되지 않는 내용까지 함께 해결되었기 때문에, 이제 사용자가 직접 로그아웃을 했을 때 인터벌이 계속 작동하는 오류만 수정해 주면 될 것 같다. 해당 오류를 수정하고 전체적으로 작동에 문제가 없는지 다시 확인을 해 봐야 하고, 이제 방과 관련된 내용과 채팅 관련 내용을 추가할 생각이다.

<br />

# 내일 할 일

- 실시간 통신 애플리케이션 (Float Chat) 프로젝트 진행

- Zustand 내용 구성

<br />

# 앞으로 해야 할 일

- React, TypeScript 공부

- React 상태 관리 도구인 Zustand 공부

- 실시간 통신 애플리케이션 프로젝트 제작
