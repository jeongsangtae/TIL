# 오늘 한 일

### React + TypeScript 프로젝트 제작 (React, TypeScript, ExpressJS, MongoDB로 만드는 실시간 통신 애플리케이션)

- 로그인 라우터에 JWT 토큰 관련 내용 추가
  - 백엔드에서 구성한 로그인 라우터에 JWT 토큰 관련 내용을 추가한 후에 로그인을 하면 쿠키에 토큰 관련 내용이 저장되는지 확인
  - 백엔드
    - user-routes
      - 로그인 post 라우터에 JWT 토큰 관련 내용 추가
        - 토큰 키를 가져오도록 구성
        - 액세스 토큰, 리프레쉬 토큰 발급하는 내용 구성
        - env 파일에 저장된 "NODE_ENV" 내용을 확인하도록 구성
          - 확인해서 true 또는 false로 결정
        - 쿠키에 토큰을 저장하는 내용 추가
          - secure, httpOnly, sameSite, maxAge 내용을 구성해서 저장
          - secure, sameSite 속성은 "NODE_ENV" 내용에 따라 달라지도록 구성
          - httpOnly는 true로 설정하고, maxAge는 액세스 토큰은 2시간, 리프레쉬 토큰은 6시간으로 설정
        - 쿠키에 토큰 저장까지 되면 로그인 성공 메시지와 토큰 정보를 프론트엔드로 전달
  - 테스트 결과, 로그인하면 오류없이 쿠키에 액세스 토큰과 리프레쉬 토큰 내용이 저장되고, 설정한 만료 시간이 지난 후에 토큰 정보가 쿠키에서 사라지는 것을 확인할 수 있었다.
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/b528ccc9523e7ee32598168b10aab4a4d994288d)

<br />

- 백엔드 에러 헬퍼 함수 추가
  - 라우터 내용에서 오류 관련 내용을 중복으로 작성하는 문제를 해결하기 위해 에러 헬퍼 함수를 추가해 재사용될 수 있도록 구성
  - 백엔드
    - error-handler
      - 에러 헬퍼 함수를 추가해 구성
        - console.error 내용과 res.status 내용을 구성
    - user-routes, group-chat-routes
      - catch문의 오류 처리 내용에서 console.error, res.status 내용 대신에 에러 헬퍼 함수가 사용되도록 수정
  - 에러 헬퍼 함수를 구성해 주면서, 한 줄로 간단하게 에러를 출력하는 내용이 보여지게 되었다.
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/d94a7ec3647a05965254acbf7e961d2f8d35edaf)

<br />

- Zustand 패키지 추가 및 인증 관련 Zustand 내용 추가
  - 백엔드에서 JWT 토큰을 생성하고, 그 내용을 쿠키에 저장한 후에 다시 프론트엔드로 전달하는데 이 때 프론트엔드에서는 전달 받은 토큰 정보를 전역적으로 관리할 수 있는 상태 도구가 필요하기 때문에, Zustand 패키지를 추가하고 액세스 토큰, 리프레쉬 토큰, 리프레쉬 토큰 만료 시간과 관련된 내용을 추가
  - 프론트엔드
    - authStore
      - Zustand 내용을 import
      - useAuthStore를 생성
        - Zustand 라이브러리의 create 함수를 사용해 useAuthStore라는 상태 관리를 정의
        - set 함수는 Zustand에서 제공하는 메서드로, 상태를 업데이트하는데 사용
      - 초기 상태 정의
        - isLoggedIn
          - 사용자 인증 상태를 나타내는 플래그
          - 기본은 false로, true는 인증된 상태를 나타냄
        - userInfo
          - 인증된 사용자에 대한 정보를 저장
          - 초기값은 null로 설정
        - accessToken
          - 인증된 사용자를 위한 액세스 토큰 값을 저장
          - 초기값은 null
      - verifyUser
        - 서버에서 사용자 인증 상태를 확인하도록 구성
        - fetch 함수를 통해 액세스 토큰 엔드포인트로 요청을 보냄
        - 요청이 성공적이면 서버에서 받은 사용자 정보를 userInfo에 저장
          - isLoggedIn을 true로 변경
        - 요청이 실패하면 에러 메시지 출력
          - isLoggedIn을 false로 설정하고 userInfo를 null로 초기화
      - refreshToken
        - 만료된 액세스 토큰을 갱신하도록 구성
        - 리프레쉬 토큰 엔드포인트로 요청을 보내 새 토큰을 요청
        - 요청이 성공하면 응답 데이터를 accessToken 상태에 저장
          - 현재 시간을 기준으로 2시간 후의 만료 시간을 계산해 로컬 스토리지에 저장
          - isLoggedIn 상태를 로컬 스토리지에 기록
        - 요청이 실패하면 에러 메시지를 출력
      - refreshTokenExp
        - 리프레쉬 토큰의 만료 시간을 서버로부터 받아오도록 구성
        - 리프레쉬 토큰 만료시간 엔드포인트로 요청
        - 요청이 성공하면 서버에서 받은 토큰 만료 시간을 로컬 스토리지에 저장
        - 요청이 실패하면 에러 메시지를 출력
  - Zustand 내용을 추가하고 구성은 해 보았지만, 아직 테스트는 해 보지 못한 상황이기 때문에 테스트를 해 본 후에 추가 수정이 필요할 것 같다.
    - Zustand로 구성한 내용은 아직 토큰과 관련된 내용만 구성하고 로그인 관련 내용은 구성하지 않은 상태이기 때문에 추가해서 테스트해 봐야 함
    - Zustand로 구성한 내용이 제대로 구성된 것인지 확신이 들지 않아서 테스트하지 못했는데, 그래도 일단 테스트를 진행해 보고 그 다음 방향 결정을 해야 함
    - 추가로 로컬 스토리지와 Zustand 상태를 동기화해서 앱이 처음 로드될 때 로컬 스토리지 값을 Zustand 상태에 동기화하는 로직 추가가 필요함
    - 에러 상태를 UI와 연동할 수 있도록 에러 메시지를 상태에 저장하는 내용도 필요해 보임
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/62c63fda1943e5f5ee5a57dc8e3090701362d854)

# 오늘 느낀 점

- 로그인 라우터에 JWT 토큰 관련 내용을 추가하고 확인한 결과, 로그인하면 정상적으로 쿠키에 JWT 토큰 내용이 저장되는 것을 확인했다. 그리고 Zustand 내용을 좀 추가해 봤는데 아직 코드 구성이 마무리되지 않아서 테스트는 해 보지 못했다. 처음 구성해 보는 내용이라서 좀 헤메는 부분도 있고, 이 구성이 맞는지 헷갈리는 부분도 많아서 테스트해 보지 못했는데 여기에 로그인 유지와 관련된 내용, 앱이 처음 로드될 때 로컬 스토리지 값을 불러와 Zustand 상태에 동기화하는 로직 등 좀 더 내용을 추가한 후에 테스트를 해 봐야 할 것 같다. 우선 한가지 확인해 볼 만한 내용으로는 로그인을 하면 토큰 값이 어떤식으로 넘어오는지 확인을 하고, 그 값을 어떻게 활용해 Zustand와 동기화할 지 생각을 해 봐야 할 것 같다. Zustand와 관련된 내용 구성은 차근차근 진행할 생각이며, Zustand에 대한 내용도 간단하게 정리하는 것이 좋다고 생각되어 조금 정리를 해 줄 생각이고, 내용 정리를 한 후에 생각을 다듬고 코드 구성을 해 봐야 할 것 같다.

<br />

# 내일 할 일

- 실시간 통신 애플리케이션 (Float Chat) 프로젝트 진행

- Zustand 내용 정리

<br />

# 앞으로 해야 할 일

- React, TypeScript 공부

- React 상태 관리 도구인 Zustand 공부

- 실시간 통신 애플리케이션 프로젝트 제작
