# 오늘 한 일

### React + TypeScript 프로젝트 제작 (React, TypeScript, ExpressJS, MongoDB로 만드는 실시간 통신 애플리케이션)

- 로그인 백엔드 로직 추가 (jwt 사용 X)
  - 백엔드에 로그인 관련 로직을 추가하고, 프론트엔드에서는 백엔드와 연결한 fetch 함수 로직 주석을 풀어서 백엔드 라우터와 연결하고 로그인 데이터가 DB에 있는 내용을 찾아서 로그인 성공이라는 메시지가 뜨는지 확인
  - 백엔드
    - app
      - user-routes 내용을 추가하고 사용할 수 있도록 구성
    - user-routes
      - 로그인 post 라우터 추가
        - 프론트엔드에서 넘어오는 데이터인 이메일, 패스워드 내용을 변수에 저장
        - 입력한 이메일이 DB에 존재하는지 확인
          - 존재하지 않거나 비밀번호가 일치하지 않을 경우 오류 메시지 전송
        - 이메일에서 문제가 없다면, 사용자가 입력한 비밀번호와 해시된 비밀번호를 비교해 확인
          - 비밀번호가 일치하지 않는다면 오류 메시지 전송
        - 모두 문제없이 처리될 경우 로그인 성공 메시지를 프론트엔드에 전달
        - 중간에 오류 발생시 오류 메시지를 출력
  - 프론트엔드
    - Login
      - 에러 관련 useState, 에러 메시지 관련 useState 주석 해제
      - fetch 함수 내용 주석 해제
      - JSX 코드에 구성한 에러 메시지 출력 관련 내용도 주석 해제
  - 프론트엔드에서 주석 처리했던 fetch 함수 주석을 풀고, 백엔드에서 로그인 관련 라우터를 구성해 연결한 후에 테스트한 결과, 문제없이 로그인 성공 메시지가 출력되는 것을 확인할 수 있었다.
    - 아직 JWT 토큰 관련 구성을 추가하지 않고, 우선 프론트엔드와 백엔드 API 연결에 문제가 없는지 확인해 주었다.
    - 연결이 문제없이 되긴 했지만, 로그인 성공 메시지만 뜨고 변화되는 내용이 없기 때문에 로그인된 것을 확인할 수 있게 내용을 추가해야 함
  - [코드 내용 1](https://github.com/jeongsangtae/float-chat/commit/0a43c0baa29a1a5f854ef47c63aa9ad151fa155a)
  - [코드 내용 2](https://github.com/jeongsangtae/float-chat/commit/d1ddc620128a34120a2eb548dd35e2874687fbdd)

<br />

- 로그인 상태 확인
  - 프론트엔드와 백엔드 연결이 정상적으로 된 것 같긴 하지만, 로그인한 후에 변화가 없어서 제대로 판단이 안된다고 생각되어, 로그인 후 모달창에서 메시지 출력과 버튼이 사라지도록 구성을 추가
  - 백엔드
    - user-routes
      - 모두 문제없이 처리될 경우 로그인 성공 메시지와 함께 true 내용을 프론트엔드에 전달
  - 프론트엔드
    - Login
      - 백엔드에서 전달한 true 내용을 저장할 useState 추가
      - fetch 함수 내에서 응답 데이터를 받고, useState에 업데이트 및 콘솔에 내용을 출력
      - 로그인 후에 모달창이 닫히지 않고 열려있도록 onToggle 주석 처리
        - 모달창이 닫히면 변화된 내용이 초기화되어 확인할 수 없기 때문에 이렇게 구성
      - JSX 코드
        - 로그인이 되었다면 모달창의 로그인 텍스트 위에 로그인 상태라는 메시지가 뜨도록 구성
        - 추가로, 로그인이 되었다면 로그인 버튼은 사라지도록 구성
  - 로그인 상태를 확인하기 위해 간단한 코드를 추가한 후에 확인한 결과, 로그인이 되면 로그인 상태 메시지가 보여지고 로그인 버튼이 사라지는 것을 확인할 수 있었다.
    - 로그인이 되면 문제없이 텍스트 출력이 되고, 버튼이 사라지는 것을 확인했기 때문에 관련 코드를 삭제하고, JWT 토큰을 추가해 인증 관련 내용을 구성해 줘야 함
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/e2d01b3a4f4b09a4b2276ae1ec405829ed90cd46)

<br />

- 로그인 상태 확인 로직 삭제 및 JWT 토큰 내용 추가
  - 로그인하면 텍스트가 보여지고 버튼이 사라지는 것을 확인했기 때문에 문제가 없다고 판단되어 확인을 위한 코드는 삭제해 주었고, 이전에 사용했던 JWT 토큰 구성과 관련된 내용을 가져와 추가
  - 백엔드
    - jwt-auth
      - 액세트 토큰 라우터
        - env 파일에 저장한 액세스 토큰 키를 가져오도록 구성
          - 배포할 때는 환경 변수에서 키를 가져올 예정
        - 쿠키에서 액세스 토큰을 가져오도록 구성
        - 액세스 토큰을 검증하고 해독된 데이터를 얻음
        - DB에서 토큰에 포함된 이메일 내용을 사용해 사용자를 조회
        - 디스트럭처링을 통해 패스워드를 제외한 나머지 사용자 데이터만 가져오도록 구성
        - 패스워드를 제외한 응답 데이터에 토큰 만료 시간을 추가하여 반환
          - 사용자 역할 정보는 아직 관리자 내용을 추가할 지 정하지 않았기 때문에 주석 처리
        - 최종적으로 사용자 데이터를 반환하고, 오류 발생 시 null을 반환하도록 구성
      - 리프레쉬 토큰 라우터
        - env 파일에 저장한 액세스, 리프레쉬 토큰 키를 가져오도록 구성
          - 배포할 때는 환경 변수에서 키를 가져올 예정
        - 쿠키에서 리프레쉬 토큰을 가져오도록 구성
        - 리프레쉬 토큰을 검증하고 해독된 데이터를 얻음
        - DB에서 토큰에 포함된 이메일 내용을 사용해 사용자 조회
        - 새로운 액세스 토큰을 발급
          - 앞에서 얻은 사용자 정보를 활용해 액세스 토큰 발급
          - 유효 시간은 2시간으로 설정
        - 새로 발급한 액세스 토큰을 쿠키에 저장
          - 개발 모드이기 때문에 secure는 false, sameSite는 Lax로 구성
          - 배포 환경에서는 secure는 true, sameSite는 None으로 설정
        - 정상적으로 발급되면 액세스 토큰 재생성 메시지가 반환되고, 오류 시에 null 반환
      - 리프레쉬 토큰 만료시간 라우터
        - env 파일에 저장한 리프레쉬 토큰 키를 가져오도록 구성
          - 배포할 때는 환경 변수에서 키를 가져올 예정
        - 쿠키에서 리프레쉬 토큰을 가져오도록 구성
        - 리프레쉬 토큰을 검증해 해독된 데이터를 얻고, 토큰 만료 시간을 응답 데이터로 반환
          - 잘못된 응답일 시 null 반환
    - user-routes
      - jwt-auth 내용에서 액세스 토큰, 리프레쉬 토큰, 리프레쉬 토큰 만료 시간을 가져오도록 구성
      - 로그인 라우터에서 프론트엔드로 전달하는 true 내용은 삭제
      - 액세스 토큰 라우터 추가
        - jwt-auth에서 반환하는 액세트 토큰 응답 데이터를 가져와 액세스 토큰 확인
        - 확인에 문제가 없다면 반환된 정보를 프론트엔드로 전달
        - 오류 발생 시 오류 메시지를 출력
      - 리프레쉬 토큰 라우터 추가
        - jwt-auth에서 반환하는 리프레쉬 토큰 응답 데이터를 가져와 액세스 토큰 확인
        - 확인에 문제가 없다면 반환된 정보를 프론트엔드로 전달
        - 오류 발생 시 오류 메시지를 출력
      - 리프레쉬 토큰 만료 시간 라우터 추가
        - jwt-auth에서 반환하는 리프레쉬 토큰 만료 시간 응답 데이터를 가져와 액세스 토큰 확인
        - 확인에 문제가 없다면 반환된 정보를 프론트엔드로 전달
        - 오류 발생 시 오류 메시지를 출력
  - 프론트엔드
    - Login
      - 로그인 상태 확인을 위해 추가했던 useState, 응답 데이터, 텍스트 메시지 등 내용 삭제
      - onToggle 내용은 주석을 해제
  - JWT 토큰 구성을 추가하고, 아직 로그인 내용에서 구성하지 않았기 때문에 확인이 불가능하므로, 추가한 후에 확인해 봐야 함
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/e9d865b753df63b650dea52ad98e0176f50e702b)

# 오늘 느낀 점

- 로그인 관련 프론트엔드와 백엔드 연결에 문제가 없는 것은 확인을 했고, 추가한 JWT 토큰 구성을 로그인 라우터에 추가해 토큰을 발급 받고, 쿠키에 저장한 후에 관련 정보를 프론트엔드로 전달해 줘야 한다. 그리고 프론트엔드에서는 전달 받은 내용을 전역적으로 관리해 로그인 유지가 될 수 있도록 구성을 해 줘야 한다. JWT 토큰 관련 내용을 일단 추가만 한 상태로 확인은 해보지 못했기 때문에 확인이 좀 필요하긴 하지만, 만약 문제가 없다면 로그인 유지까지 무난하게 구성이 될 것 같고, 로그인 유지에 Context API를 사용하는 것 대신에 코드가 간결하고 성능 면에서도 효율적인 Zustand를 활용해 구성을 해 볼 생각이다. Zustand는 처음 사용해 보기 때문에 관련된 내용 정리를 조금 해 줄 생각인데, 주 내용으로 초기 파일 구성부터 어떤식으로 내용을 작성하고, 상태 정의와 관리를 어떤식으로 하는지 정리해 줄 생각이다.

<br />

# 내일 할 일

- 실시간 통신 애플리케이션 (Float Chat) 프로젝트 진행

- Zustand 구성하는 방법에 대한 정보 필요

<br />

# 앞으로 해야 할 일

- React, TypeScript 공부

- React 상태 관리 도구인 Zustand 공부

- 실시간 통신 애플리케이션 프로젝트 제작
