# 오늘 한 일

### React + TypeScript 프로젝트 제작 (React, TypeScript, ExpressJS, MongoDB로 만드는 실시간 통신 애플리케이션)

- Zustand 내용 타입 정의 추가 및 Zustand 데이터 출력 테스트
  - Zustand 내용을 구성한 부분에 타입 정의 내용이 빠져 있어서 타입 정의를 해 주고, 로그인 액션 관련 내용을 Zustand에 추가해 로그인하면 실행될 수 있도록 구성
  - 프론트엔드
    - authStore
      - useAuthStore에 대한 타입 정의를 추가
        - 로그인 유무는 boolean, userInfo는 별도의 타입 정의, accessToken, verifyUser, refreshTokenExp는 비동기 함수 타입 정의
      - 추가한 타입 정의에서 userInfo에 대한 별도의 타입 정의를 추가
        - tokenExp는 number, 나머지는 string으로 설정
      - 로그인 액션
        - 로그인 액션이 실행되면 로그인 유무 항목을 로컬 스토리지에 저장하고, 활성화 되었다는 의미로 "1"이 저장되도록 구성
        - 현재 시간에 2시간을 더한 시간이 로컬 스토리지에 저장되도록 구성
        - 로그인 유무 상태를 true로 업데이트
        - 같은 스토어 내에 있는 verifyUser, refreshTokenExp 액션이 실행되도록 호출
        - 오류 발생 시 사용자 인증 오류 메시지와 로그인 유무는 false가 되도록 구성
    - Login
      - verifyUser, userInfo 내용 대신에 login 액션이 실행되도록 수정
      - 로그인하는 fetch 함수 내용에서도 verifyUser가 아닌, login 액션이 실행되도록 수정
    - SideBar
      - useAuthStore 내용을 가져와 import
      - 로그인 유무와 사용자 정보를 useAuthStore에서 가져오도록 구성
      - 콘솔에 로그인 유무와 사용자 정보가 출력되는지 확인
      - JSX 코드에서도 출력되는지 확인
        - 정상적으로 확인되지 않기 때문에 주석 처리
  - 타입 정의를 추가한 부분은 문제가 없는 것을 확인했고, 사이드바 컴포넌트에서 추가한 로그인 유무와 사용자 정보 Zustand 내용이 출력되는지 확인해 봤지만 내용이 출력되지 않고 각각 false, null 내용이 콘솔에 출력되는 것을 확인할 수 있었다.
    - 로그인하면 Zustand 내용에 로그인 유무와 사용자 정보가 있음에도, 사이드바 컴포넌트에서는 정상적으로 출력이 되지 않아서 이에 대한 내용 수정이 필요함
    - 비동기로 인한 문제인지, 아니면 Zustand의 특성에서 뭔가 문제가 있는지 렌더링 부분에서 문제가 있는지 확인이 필요함
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/0e4a002964ed1d70ac1e08a778203735c9ce0fec)

<br />

- Zustand 데이터 출력 오류 수정 및 토큰 만료 시간 테스트
  - 로그인 유무와 사용자 정보 데이터가 정상적으로 출력 되지 않는 부분을 고쳐주고, 토큰 만료 시간을 대폭 줄여서 정상적으로 토큰이 만료 시간이 지나면 제거되는지 확인
  - 백엔드
    - jwt-auth
      - 액세스 토큰 만료 시간을 5분으로 수정
    - user-routes
      - 액세스 토큰 만료 시간을 5분으로 수정, 리프레쉬 토큰 만료 시간은 15분으로 수정
  - 프론트엔드
    - authStore
      - 로컬 스토리지에 저장되는 액세스 토큰 만료 시간을 5분으로 수정
      - 로그인 유무와 사용자 정보 데이터가 초기 렌더링 전에 상태를 업데이트하도록 구성 추가
        - 컴포넌트가 렌더링되기 전에 명시적으로 상태 업데이트를 트리거해서 React 컴포넌트는 최신 상태 값을 사용해 렌더링하도록 구성
        - 데이터가 업데이트되기 전에 넘어가서 정상적으로 출력이 되지 않는 부분을 해결
    - SideBar
      - 로그인 유무와 사용자 정보 데이터가 넘어오는지 확인하기 위해 관련 내용 주석 해제
  - Zustand에서 새롭게 추가한 내용으로 인해 컴포넌트가 렌더링되기 전에 명시적으로 상태 업데이트를 트리거해서, 상태가 업데이트되고 React 컴포넌트는 최신 상태 값을 사용해 렌더링하게 되면서 정상적으로 로그인 유무와 사용자 정보가 보여지는 것을 확인할 수 있었음
    - Zustand에서 새롭게 추가한 내용에 대해 조금 정리가 필요함
    - 내용을 추가하면서 사실 헷갈리는 부분도 많고, 왜 저 코드로 저렇게 해결이 되는지 의문이 많음
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/52d00e141d4d7d0b167b68382debd8a8150a2c9b)

# 오늘 느낀 점

- 빠진 타입 정의 내용도 추가하고 로그인한 후에 로그인 정보가 출력되도록 구성을 해 줬는데, 데이터 출력에는 문제가 없지만 코드가 조금 이해가 안되는 부분이 있어서 그 부분에 대해 정리를 하고 가야 할 것 같다. 그리고 새로고침하면 그대로 로그인이 유지되긴 하지만, 만료 시간에 관한 로그인 유지는 실시간 적용이 되지 않는 상태로 동작하는 것 같아서, 실시간 적용이 되도록 구성을 해 줘야 하는데 Zustand에서는 useEffect를 사용해 구현하는 것이 좀 번거롭기 때문에 다른 방법을 찾아봐야 한다. 현재 생각중인 로그인 유지 동작은 인터벌 방식으로 토큰 만료 시간을 확인하고 만료 시간이 남아있다면 로그인 유지, 만료 시간이 지났다면 로그아웃 되도록 해 주는 것이 현재 생각한 방식이다. 하지만 앞에서도 말했듯이 Zustand에서는 useEffect를 사용해 구현하기 조금 힘들 것 같아서, 어떤 방식으로 구현을 해야 할 지 생각을 좀 해 보고, 정보를 찾아봐야 하기 때문에 우선 로그인 정보가 보여지지 않다가 코드 추가 후 보여지는 내용에 대한 정리를 해 주고, 그 다음 로그인 유지 관련 내용에 대해 찾아보고 구성을 해 봐야 할 것 같다.

<br />

# 내일 할 일

- 실시간 통신 애플리케이션 (Float Chat) 프로젝트 진행

- Zustand 내용 구성

<br />

# 앞으로 해야 할 일

- React, TypeScript 공부

- React 상태 관리 도구인 Zustand 공부

- 실시간 통신 애플리케이션 프로젝트 제작
