# 오늘 한 일

### React 프로젝트 제작 (React, NodeJS, MongoDB로 만드는 미니 커뮤니티 플랫폼)

- 구성한 내용

  - 만료 시간 조건문 수정 및 만료 시간 다시 수정
    - 인터벌을 1분으로 주고, 액세스 토큰 갱신이 5분 단위로 갱신되도록 구성을 했기 때문에 인터벌이 5번 작동되면 액세스 토큰 갱신이 되어야 하지만 6번째에 갱신이 되기 때문에 이 부분을 고치기 위해서 수정해주고, 마지막 인터벌이 실행되며 else if문이 작동해서 로컬 스토리지에 저장된 내용과 쿠키에 저장된 토큰 내용이 모두 삭제되게 해주었다. 그리고 토큰과 로그인 만료 시간을 다시 원래대로 수정했다.
    - 백엔드 구성
      - 테스트하기 위해서 5분으로 구성해놓은 액세스 토큰 시간을 다시 1시간으로 변경
      - 리프레쉬 토큰 또한 테스트를 위해서 10분으로 설정해놓은 내용을 6시간으로 변경
      - 쿠키 만료 시간도 1시간, 6시간으로 변경
    - 프론트엔드 구성
      - 로그인 만료 시간을 5분에서 1시간으로 변경
      - setInterval이 작동하는 시간을 1분에서 30분으로 변경
      - if-else if문의 조건에서 ">"를 ">="로 변경
        - ">="로 변경해줘야 현재 시간과 만료 시간이 일치할 때, if-else if문이 작동해서 바로 만료 시간이 갱신되기 때문에 변경
        - 마지막 인터벌이 실행되면 로그아웃 핸들러가 작동하면서 모든 내용을 삭제하게 된다.
    - 1분 간격으로 인터벌이 작동하도록 구성하고 테스트 해본 결과, 5번 작동되면 현재 시간과 로그인 만료 시간이 같거나 커지면서 바로 액세스 토큰이 재생성되는 것을 확인할 수 있었다.
      - 이제는 현재 시간이 더 커졌을 때가 아닌, 동일할 때도 바로 액세스 토큰, 로그인 만료 시간, 로그인 유무가 갱신되면서 로그인이 바로 유지되게 된다.
      - 마지막 인터벌이 실행되며 현재 시간과 리프레쉬 만료 토큰 시간이 같거나 커졌을 때는, else if문이 작동하면서 로그아웃 핸들러가 작동해서 모든 내용이 삭제되는 것을 확인할 수 있었다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/ca588e8050e87bc5c626d65902be2d16a7322249)

  <br />

  - 쿠키 만료 시간 수정 및 textarea 높이가 동적으로 변경되도록 구성 추가
    - 쿠키 만료 시간을 잘못 설정해서 액세스 토큰과 리프레쉬 토큰이 쿠키에서 바로 삭제되는 문제가 발생했기 때문에 만료 시간을 수정해주고, textarea 높이가 사용자 입력에 따라서 동적으로 변경되도록 내용을 구성해주었다.
    - 백엔드 구성
      - 쿠키 만료 시간에 "\*1000"를 추가해서 정상적으로 작동하도록 구성 변경
    - 프론트엔드 구성
      - textareaHeight useState 추가
        - textarea 높이 크기가 동적으로 변화되는데 사용될 useState
      - commentInputHandler 함수에 스크롤 높이가 동적으로 변경될 내용 추가
        - 사용자 입력에 따라서 높이 크기 값이 동적으로 변경되어 그 값이 useState에 들어가는 내용
      - textarea에서 textarea 높이가 동적으로 변화하는 useState 내용이 적용되도록 style 속성 추가
        - 입력에 따라 자동으로 textarea 높이가 변경된다.
      - CSS에서 초기 높이와 라인 간격을 추가
    - 테스트해본 결과, 높이가 늘어나는 것은 문제가 없지만 텍스트를 삭제했을 때 높이가 줄어드는 부분에서 적용이 되지 않는 문제를 발견했다.
      - 해당 문제를 해결해보기 위해서 onInput도 사용해보고, 다른 코드도 변경해서 해결해보려고 했으나 해결이 되지 않아서 추가 수정이 필요하다.
      - 코드 구성을 좀 복잡하게 하면 가능할 것 같다는 생각도 들지만, 유용한 라이브러리를 찾았기 때문에 해당 라이브러리를 사용해서 구성해볼 생각이다.
        - `react-textarea-autosize` 라이브러리
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/be6ab4759ccbda0d4fa92cc9a35159f92589ccae)

<br />

- 추가 및 해결 해야 할 내용
  - 로그인을 유지하고 있을 때, token이 만료 시간에 가까워지면 자동으로 갱신되는 로직을 추가 해야 함
    - 구성 완료
    - 좀 더 세부적인 시간 조절이 필요해보임
  - 커스텀 Hook에 대한 고려 및 세션 제거 작업
    - 세션과 연동이 가능한 부분이 있는지도 테스트가 필요함
      - 불가능, 세션이나 jwt 토큰 중 하나만 사용하는 것이 좋다.
      - 세션을 삭제하는 작업을 아직 하지 않아서 해줘야 함
    - Context API를 사용하는 것은 좋지만, 이 내용을 사용하려는 파일에서 하나하나 추가해서 사용하기 때문에 커스텀 Hook을 구성해서 재사용할 수 있도록 해줄 필요가 있음
  - 백엔드의 user-router.js에서 accessToken, login/success, profile router에서 모두 accessToken 함수 내용을 재사용하고 있는데, 굳이 3개의 router로 나눌 필요가 있는 지 확인해보고 필요가 없다면 하나로 줄여줘야 함
    - 명확하게 하기 위해서 일단은 하나로 합치지 않고, 그대로 나눠서 사용하도록 유지
    - 내용이 엄청 많은 코드로 구성된 것이 아니기 때문에 현재로서는 크게 문제 없다고 생각되어 그대로 유지
  - 코드 예외 처리 더 필요한 부분이 있는 지 체크해야 함
  - 메인 헤더 깜빡임 확인
    - 콘솔 창을 닫고 새로고침하면 거의 깜빡임을 확인할 수 없음
    - 게시글에는 로딩 인디케이터를 추가해놓은 상태

# 오늘 느낀 점

- 인터벌 내용을 수정해주면서 토큰 갱신이 이제는 원활하게 이루어지고, 생각한대로 작동하기 때문에 더 이상 수정해줄 필요는 없을 것 같아서 만료 시간을 적절한 시간으로 수정해주고 마무리 해주었다. 댓글에서 구성한 입력창에 엔터를 입력하면 textarea가 늘어나는 것이 아닌, 아랫줄로 넘어가기만 하기 때문에 이 문제를 해결하기 위해서 textarea의 크기가 사용자 입력에 따라서 동적으로 늘어나고 줄어들도록 구성을 해주려고 했으나, 구성에 문제가 있는지 아직은 늘어나기만 되고 줄어들지는 않기 때문에 추가 수정이 필요한 상황이다. 현재 해결 방법으로 "react-textarea-autosize"라는 라이브러리를 사용하는 방법을 찾아본 상태인데, 해당 라이브러리를 사용해서 구성해보고 안된다면 좀 복잡한 코드 구성을 추가해서 textarea 크기가 다시 줄어들도록 해줘야 할 것 같다. textarea 크기 조절까지 구성을 해준 후에, 추가로 어떤 내용을 추가해줘야 하는 지 좀 정리가 필요 할 것 같다.

<br />

# 내일 할 일

- React 공부 및 React 프로젝트 조금씩 진행하기

<br />

# 앞으로 해야 할 일

- React, NextJS 공부

- React 프로젝트 제작
