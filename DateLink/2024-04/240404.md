# 오늘 한 일

### React 프로젝트 제작 (React, NodeJS, MongoDB로 만드는 미니 커뮤니티 플랫폼)

- 구성한 내용

  - 세션 코드 삭제 및 주석 처리
    - 로그인 라우터에서 세션과 관련된 내용을 조금 남겨놨었기 때문에 마저 삭제해주고, 세션 내용을 구성하고 있던 app.js, session.js, user.js에서 세션 내용을 주석 처리하고 테스트해보고 문제가 없는 것을 판단하고 삭제 및 주석 처리해주었다.
    - 프론트엔드 구성
      - 로그인 라우터에 남아있는 session 코드 삭제
      - session.js에 있는 세션 구성 모두 주석 처리
      - user.js에 있는 사용자 권한에 사용된 세션 구성 모드 주석 처리
      - app.js에 구성되어 사용되던 세션 내용 모두 삭제
    - 세션에 관한 구성을 모두 주석 처리하고 테스트해본 결과, 정상적으로 작동했기 때문에 app.js에 있는 세션을 사용한 코드는 삭제를 해주고, 다른 파일에 있는 내용은 주석 처리해주었다.
      - user.js, session.js 파일은 모두 삭제해도 되긴 하지만 일단은 만약을 위해서 남겨놓고 나중에 마지막 정리할 때, 삭제를 해줄 예정이다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/82e74754a3ae4e03fb84f9c059c1be86a3a5b453)

  <br />

  - 프론트엔드에 JWT 토큰 유효 시간 전달
    - 액세스 토큰 자동 갱신 기능을 구성하기 위해서, 백엔드에서 JWT 토큰 유효 시간을 쿠키에 저장하는데, 여기서 프론트엔드에 사용자 정보와 함께 JWT 토큰 유효 시간도 함께 포함해서 전달하도록 구성을 변경해주었다.
      - 백엔드에서 JWT 토큰 유효 시간을 프론트엔드로 전달해서, 프론트엔드에서 JWT 토큰 유효 시간을 저장하고, 만료되었을 때 백엔드에 요청해서 자동으로 갱신하도록 하는 구성을 생각 중이다.
    - 백엔드 구성
      - jwt-auth.js의 액세스 토큰 함수에서, 쿠키에 저장된 사용자 이메일과 DB에 저장된 사용자 이메일을 확인하고 일치하는 사용자 정보에서 비밀번호를 뺀 내용만 사용되고 있었지만, 여기에 토큰 만료 시간을 함께 포함시키도록 구성 변경
      - 기존에 액세스 토큰 함수에서 "othersData"로 가져와서 사용하고 있던 내용을 토큰 만료 시간이 함께 포함된 responseData로 변경해서 구성하도록 내용 변경
      - 프로필 라우터에서 "othersData"의 이메일을 확인해서 게시글을 찾았지만, 이제는 "responseData"를 통해 이메일을 확인해서 게시글을 찾도록 구성 변경
      - 프로필 라우터에서 프론트엔드에 "othersData" 내용을 전달하는 것이 아닌, "responseData"를 전달하도록 구성 변경
        - 액세스 토큰 라우터와 로그인 성공 라우터도 "responseData"를 json으로 전달하도록 구성 변경
    - 변경한 코드를 테스트하는 과정에서 "responseData" 데이터를 찾지 못하는 문제가 있었지만, 이제는 문제 없이 정상적으로 작동하는 것을 확인할 수 있었다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/91b208a4b9cb9121d2d54b59f397026aa8022677)

<br />

- 추가 및 해결 해야 할 내용
  - 회원가입 form에서 잘못된 입력을 제출 했을 때, session에 데이터가 저장되는데, 기존의 session 데이터에서 업데이트되는 방식이 아닌 매번 제출할 때마다 새로운 session이 추가되고 있기 때문에 백엔드 코드에서 수정이 필요하다.
    - 계속 원인을 찾아보려고 이것저것 시도해보았지만 아직 어떤 코드가 정확히 원인인지 찾지 못해서 하나씩 천천히 테스트가 필요함
    - 일단 이걸 테스트 해보기전에 먼저 정상적으로 세션 만료가 되는지 확인해보았는데 정상적으로 세션 만료가 되기 때문에, 로그인을 먼저 구성해보고 정상적으로 로그인이 되는지 확인을 해보고 안된다면, session에 저장되는 부분을 다시 확인해봐야 할 것 같다는 생각
    - 이 부분은 session을 삭제하게 되면 더 이상 신경쓰지 않아도 되지만, 현재는 session을 그냥 놔둔 상태이기 때문에 잠시 유지
  - 로그인을 유지하고 있을 때, token이 만료 시간에 가까워지면 자동으로 갱신되는 로직을 추가 해야 함
    - 대충 구성만 되어 있는 상태로, 좀 더 자세한 코드와 테스트가 필요함
  - 커스텀 Hook에 대한 고려 및 세션 제거 작업
    - 세션과 연동이 가능한 부분이 있는지도 테스트가 필요함
      - 불가능, 세션이나 jwt 토큰 중 하나만 사용하는 것이 좋다.
      - 세션을 삭제하는 작업을 아직 하지 않아서 해줘야 함
    - Context API를 사용하는 것은 좋지만, 이 내용을 사용하려는 파일에서 하나하나 추가해서 사용하기 때문에 커스텀 Hook을 구성해서 재사용할 수 있도록 해줄 필요가 있음
  - 백엔드의 user-router.js에서 accessToken, login/success, profile router에서 모두 accessToken 함수 내용을 재사용하고 있는데, 굳이 3개의 router로 나눌 필요가 있는 지 확인해보고 필요가 없다면 하나로 줄여줘야 함
    - 명확하게 하기 위해서 일단은 하나로 합치지 않고, 그대로 나눠서 사용하도록 유지
    - 내용이 엄청 많은 코드로 구성된 것이 아니기 때문에 현재로서는 크게 문제 없다고 생각되어 그대로 유지
  - 액세스 토큰, 리프레시 토큰 버튼을 메인헤더에서 제거해야 함
    - 일단 주석처리해서 사용하지 않도록 변경
  - 코드 예외 처리 더 필요한 부분이 있는 지 체크해야 함
  - 메인 헤더 깜빡임 확인
    - 게시판에서 새로고침 시에는 깜빡임이 없으나, 프로필, 홈 화면에서는 메인헤더의 변경 깜빡임이 조금 있기 때문에 추가 확인 필요

# 오늘 느낀 점

- 토큰 만료를 실시간으로 갱신하도록 구성을 해보고 있는데, 현재 생각한 구성으로는 백엔드에서 액세스 토큰을 쿠키에 저장하면서 유효 시간을 프론트엔드에 전달하고, 프론트엔드에서 액세스 토큰 유효 시간을 저장, 일정 시간 후에 저장된 액세스 토큰 유효 시간이 만료가 되는 것을 확인하고, 다시 백엔드에 액세스 토큰을 요청하면 그 때 새로운 액세스 토큰을 전달하며, 자동으로 갱신이 되는 방식을 생각하고 있다. 물론 리프레쉬 토큰이 유지 되는 동안에 확인이 되도록 해줘야 하지만, 일단은 액세스 토큰 만료와 관련된 내용을 먼저 처리해본 후에 리프레쉬 토큰과 관련된 내용을 연결해서 구성할 생각이다. 현재 생각한 구성과 반대로 백엔드에서 토큰 만료를 확인할 수도 있지만, 프론트엔드에서 토큰 만료를 확인하면 좀 더 로직도 간단하게 구성하고, 빠른 처리가 가능하며, 서버에 부하를 주지 않기 때문에 이 방법을 선택하게 되었다.

<br />

# 내일 할 일

- React 공부 및 React 프로젝트 조금씩 진행하기

<br />

# 앞으로 해야 할 일

- React, NextJS 공부

- React 프로젝트 제작
