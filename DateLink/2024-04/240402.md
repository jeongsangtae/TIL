# 오늘 한 일

### React 프로젝트 제작 (React, NodeJS, MongoDB로 만드는 미니 커뮤니티 플랫폼)

- 구성한 내용

  - 로딩 인디케이터 관련 useState를 Context API로 이동시키고 전역적으로 사용되도록 구성
    - Posts 컴포넌트에서 구성했던 isLoading useState를 Context API로 이동시키고, value를 통해서 전달하고 전역적으로 사용될 수 있도록 변경해주었다.
    - 프론트엔드 구성
      - Context API에서 isLoading useState 내용을 추가
      - 초기 값에 isLoading, setIsLoading 내용을 추가하고 value에 포함시켜서 사용될 수 있도록 구성
        - isLoading은 초기 값으로 false, setIsLoading은 함수로 구성
      - Posts 컴포넌트에서 isLoading과 관련된 useState를 삭제
      - setIsLoading 대신에 Context API에서 전달받은 authCtx.setIsLoading을 사용해서 구성
        - 테스트를 위해 추가했던 setTimeout 코드 주석처리
      - 조건부 렌더링에서 isLoading 대신에 authCtx.isLoading으로 변경
    - 변경한 내용을 테스트한 결과, 이상없이 작동하는 것을 확인할 수 있었다.
      - 이제 Context API에서 내용을 전역적으로 전달할 수 있게 되면서 다른 컴포넌트에서 isLoading useState를 추가하지 않고, Context API에서 내용을 가져와서 바로 구성할 수 있게 되었다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/a735c735498849b9734b4caa5280ced246fe266e)

  <br />

  - PostDetails, Profile 컴포넌트에 로딩 인디케이터 추가 및 사용
    - 게시글 세부 페이지, 프로필 페이지에서 로딩 인디케이터 내용이 보여질 수 있도록 구성을 추가해주었다.
    - 프론트엔드 구성
      - 게시글 세부 페이지에서는 post, 즉 게시글 정보가 없으면 로딩 인디케이터가 보여지도록 구성
      - 게시글 세부 페이지의 loader 함수에서 Context API를 사용해서 로딩 인디케이터 내용을 추가해주려고 했으나, useContext Hook은 loader와 같은 일반적인 비동기 함수 내에서 직접 사용할 수 없기 때문에 loader 함수에서는 로딩 인디케이터 내용을 추가하지 않았다.
      - 프로필 페이지에서 Context API 내용의 isLoading, setIsLoading을 가져오고 사용해서 로딩 인디케이터 내용 추가
    - 테스트해본 결과 정상적으로 작동하는 것을 확인할 수 있었고, 다른 페이지에서도 로딩 인디케이터가 필요하다고 생각되면 더 추가해줄 생각이다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/8f7c1692c097960dc5bed62d711998a84215bb93)

  <br />

  - 백엔드의 회원가입 라우터에서 세션과 관련된 코드를 주석처리하고 테스트
    - 백엔드에 구성된 세션 내용을 완전히 삭제하기 전에 우선 구성해놓은 세션과 관련된 코드를 주석 처리해도 기능이 작동하는 지 확인하기 위해서 작업해주었다.
    - 벡엔드 구성
      - 회원가입과 관련된 post 라우터에서 `req.session.inputData`로 구성된 객체 내용을 모두 주석처리하고, message 부분만 남긴 뒤에 따로 변수로 구성하고 사용되도록 해주었다.
      - 추가로 다른 조건의 `req.session.inputData`의 내용에서도 message 부분만 남기고 나머지 다 주석처리
      - 발생한 오류 message 내용이 프론트엔드로 전달되도록 `req.session.save`가 아닌, `req.status().json()`으로 구성해서 message 내용을 프론트엔드로 전달
      - 회원가입과 관련된 get 라우터는 사용되지 않기 때문에 전체를 주석 처리해주었다.
        - 여기에도 `req.session.inputData`내용이 있는데 get 라우터 내용은 사용하지 않기 때문에 모두 주석처리
        - 회원가입과 관련된 get 라우터를 주석 처리해도 오류 메시지 출력, 회원가입 처리, DB 저장 등이 모두 정상적으로 이루어지기 때문에 문제가 없어보인다.
        - 프론트엔드에서 회원가입과 관련된 get method 내용이 사용되고 있지도 않으며, 굳이 가져와서 사용할 필요성을 못 느껴서 주석 처리하는 것이 맞다고 판단
    - 회원가입에 구성된 session과 관련된 코드를 주석 처리하고 테스트한 결과, 모든 기능이 정상적으로 작동하는 것을 확인했으며, 로그인 부분에서도 session과 관련된 내용을 주석 처리해도 될 것 같다는 생각이 든다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/fc52217f2084021602dd4f2fed1f2ac4f5780218)

<br />

- 추가 및 해결 해야 할 내용
  - 회원가입 form에서 잘못된 입력을 제출 했을 때, session에 데이터가 저장되는데, 기존의 session 데이터에서 업데이트되는 방식이 아닌 매번 제출할 때마다 새로운 session이 추가되고 있기 때문에 백엔드 코드에서 수정이 필요하다.
    - 계속 원인을 찾아보려고 이것저것 시도해보았지만 아직 어떤 코드가 정확히 원인인지 찾지 못해서 하나씩 천천히 테스트가 필요함
    - 일단 이걸 테스트 해보기전에 먼저 정상적으로 세션 만료가 되는지 확인해보았는데 정상적으로 세션 만료가 되기 때문에, 로그인을 먼저 구성해보고 정상적으로 로그인이 되는지 확인을 해보고 안된다면, session에 저장되는 부분을 다시 확인해봐야 할 것 같다는 생각
    - 이 부분은 session을 삭제하게 되면 더 이상 신경쓰지 않아도 되지만, 현재는 session을 그냥 놔둔 상태이기 때문에 잠시 유지
  - 로그인을 유지하고 있을 때, token이 만료 시간에 가까워지면 자동으로 갱신되는 로직을 추가 해야 함
    - 대충 구성만 되어 있는 상태로, 좀 더 자세한 코드와 테스트가 필요함
  - 커스텀 Hook에 대한 고려 및 세션 제거 작업
    - 세션과 연동이 가능한 부분이 있는지도 테스트가 필요함
      - 불가능, 세션이나 jwt 토큰 중 하나만 사용하는 것이 좋다.
      - 세션을 삭제하는 작업을 아직 하지 않아서 해줘야 함
    - Context API를 사용하는 것은 좋지만, 이 내용을 사용하려는 파일에서 하나하나 추가해서 사용하기 때문에 커스텀 Hook을 구성해서 재사용할 수 있도록 해줄 필요가 있음
  - 백엔드의 user-router.js에서 accessToken, login/success, profile router에서 모두 accessToken 함수 내용을 재사용하고 있는데, 굳이 3개의 router로 나눌 필요가 있는 지 확인해보고 필요가 없다면 하나로 줄여줘야 함
    - 명확하게 하기 위해서 일단은 하나로 합치지 않고, 그대로 나눠서 사용하도록 유지
    - 내용이 엄청 많은 코드로 구성된 것이 아니기 때문에 현재로서는 크게 문제 없다고 생각되어 그대로 유지
  - 액세스 토큰, 리프레시 토큰 버튼을 메인헤더에서 제거해야 함
    - 일단 주석처리해서 사용하지 않도록 변경
  - 코드 예외 처리 더 필요한 부분이 있는 지 체크해야 함
  - 메인 헤더 깜빡임 확인
    - 게시판에서 새로고침 시에는 깜빡임이 없으나, 프로필, 홈 화면에서는 메인헤더의 변경 깜빡임이 조금 있기 때문에 추가 확인 필요

# 오늘 느낀 점

- 로그인 부분의 session과 관련된 코드도 삭제를 해줘야 하는데, 여기에서는 session 내용뿐만이 아닌, "isAuthenticated" 내용이 프론트엔드로 전달되어 로그인 관련 내용에서 사용되고 있는데 이 부분을 변경해서 다른 내용이 사용되도록 해줘야 할 것 같다. 현재 생각한 내용으로는, Context API에 있는 내용을 가져다가 사용하면 될 거 같다고 생각이 되는데 이 부분은 우선 session 내용을 주석처리하고 테스트 해본 후에 변경해서 확인해볼 생각이다. 그리고 JWT 토큰의 액세스 토큰 자동 갱신도 한 번 다시 구성해보고 테스트해볼 필요가 있다.

<br />

# 내일 할 일

- React 공부 및 React 프로젝트 조금씩 진행하기

<br />

# 앞으로 해야 할 일

- React, NextJS 공부

- React 프로젝트 제작
