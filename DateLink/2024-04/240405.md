# 오늘 한 일

### React 프로젝트 제작 (React, NodeJS, MongoDB로 만드는 미니 커뮤니티 플랫폼)

- 구성한 내용

  - RefreshToken 함수 편집 및 RefreshToken 토큰 만료 시간을 프론트엔드에 전달
    - 실시간으로 액세스 토큰이 갱신이 되려면, 리프레쉬 토큰이 필요하기 때문에 리프레쉬 토큰 내용이 구성된 백엔드에서 내용을 수정하고, 리프레쉬 토큰 만료 시간을 프론트엔드로 전달하도록 구성해주었다.
    - 백엔드 구성
      - jwt-auth.js에서 구성된 refreshToken 함수에서 리프레쉬 토큰 만료 시간과 메시지를 객체로 구성해서 전달하도록 변경
        - responseData를 사용할 수 있도록 구성
      - user-router.js에서 구성된 리프레쉬 토큰 라우터에서 refreshToken 함수의 responseData를 확인하고, 프론트엔드로 전달하도록 구성
        - responseData에는 리프레쉬 토큰 만료 시간과 메시지 내용이 들어가 있음
    - 프론트엔드 구성
      - 메인헤더에서 주석 처리해놓은 리프레쉬 토큰 버튼을 다시 활성화
        - 백엔드에서 수정한 리프레쉬 토큰 내용이 정상적으로 작동하는지 확인하기 위해서 리프레쉬 토큰 버튼 다시 활성화
    - 테스트해본 결과, 백엔드에서 수정한 리프레쉬 토큰 관련 내용은 정상적으로 작동하는 것을 확인할 수 있었다.
      - 리프레쉬 토큰 만료 시간을 저장하고 활용할 수 있도록 코드를 구성해봐야 함
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/602de431988860f8703e7895f3f327de5bb61b2c)

  <br />

  - Context API에서 refreshTokenHandler를 추가하고, 리프레쉬 토큰 만료 시간을 따로 저장하는 useState 추가
    - 메인헤더에서 리프레쉬 토큰 관련 함수를 비활성화하고 Context API에서 컨트롤하기 위해서 리프레쉬 토큰과 관련된 fetch 함수를 추가 및 사용할 수 있도록 구성, 그리고 리프레쉬 토큰 만료 시간을 따로 저장하는 useState를 추가해서 구성해주었다.
    - 프론트엔드 구성
      - 메인헤더에서 리프레쉬 토큰 버튼은 그대로 사용하지만, 더 이상 리프레쉬 토큰 핸들러는 사용하지 않기 때문에 다시 주석 처리
      - Context API 내용에서 리프레쉬 토큰 핸들러 함수를 추가하고 fetch 함수를 통해, 리프레쉬 토큰 만료 시간을 가져오도록 구성
      - 리프레쉬 토큰 만료 시간을 가져와서, 새롭게 추가한 refreshTokenExp useState에 저장하도록 구성
      - Context API에서 구성한 리프레쉬 토큰 핸들러 함수가 작동되도록 초기 값을 구성해주고, value를 통해서 사용될 수 있도록 구성
    - 변경한 코드를 테스트한 결과, 문제없이 작동하는 것을 확인할 수 있었다.
      - 메인헤더에서 리프레쉬 토큰 버튼을 클릭하면, Context API를 통해서 리프레쉬 토큰 핸들러 함수가 실행되고 액세스 토큰이 재발급 되는 것을 확인할 수 있었다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/dd22dbef66f653e6ef99677a8e3a78219be6e259)

<br />

- 추가 및 해결 해야 할 내용
  - 회원가입 form에서 잘못된 입력을 제출 했을 때, session에 데이터가 저장되는데, 기존의 session 데이터에서 업데이트되는 방식이 아닌 매번 제출할 때마다 새로운 session이 추가되고 있기 때문에 백엔드 코드에서 수정이 필요하다.
    - 계속 원인을 찾아보려고 이것저것 시도해보았지만 아직 어떤 코드가 정확히 원인인지 찾지 못해서 하나씩 천천히 테스트가 필요함
    - 일단 이걸 테스트 해보기전에 먼저 정상적으로 세션 만료가 되는지 확인해보았는데 정상적으로 세션 만료가 되기 때문에, 로그인을 먼저 구성해보고 정상적으로 로그인이 되는지 확인을 해보고 안된다면, session에 저장되는 부분을 다시 확인해봐야 할 것 같다는 생각
    - 이 부분은 session을 삭제하게 되면 더 이상 신경쓰지 않아도 되지만, 현재는 session을 그냥 놔둔 상태이기 때문에 잠시 유지
  - 로그인을 유지하고 있을 때, token이 만료 시간에 가까워지면 자동으로 갱신되는 로직을 추가 해야 함
    - 대충 구성만 되어 있는 상태로, 좀 더 자세한 코드와 테스트가 필요함
  - 커스텀 Hook에 대한 고려 및 세션 제거 작업
    - 세션과 연동이 가능한 부분이 있는지도 테스트가 필요함
      - 불가능, 세션이나 jwt 토큰 중 하나만 사용하는 것이 좋다.
      - 세션을 삭제하는 작업을 아직 하지 않아서 해줘야 함
    - Context API를 사용하는 것은 좋지만, 이 내용을 사용하려는 파일에서 하나하나 추가해서 사용하기 때문에 커스텀 Hook을 구성해서 재사용할 수 있도록 해줄 필요가 있음
  - 백엔드의 user-router.js에서 accessToken, login/success, profile router에서 모두 accessToken 함수 내용을 재사용하고 있는데, 굳이 3개의 router로 나눌 필요가 있는 지 확인해보고 필요가 없다면 하나로 줄여줘야 함
    - 명확하게 하기 위해서 일단은 하나로 합치지 않고, 그대로 나눠서 사용하도록 유지
    - 내용이 엄청 많은 코드로 구성된 것이 아니기 때문에 현재로서는 크게 문제 없다고 생각되어 그대로 유지
  - 액세스 토큰, 리프레시 토큰 버튼을 메인헤더에서 제거해야 함
    - 일단 주석처리해서 사용하지 않도록 변경
  - 코드 예외 처리 더 필요한 부분이 있는 지 체크해야 함
  - 메인 헤더 깜빡임 확인
    - 게시판에서 새로고침 시에는 깜빡임이 없으나, 프로필, 홈 화면에서는 메인헤더의 변경 깜빡임이 조금 있기 때문에 추가 확인 필요

# 오늘 느낀 점

- 리프레쉬 토큰 만료 시간을 프론트엔드로 전달하고, 내용이 뜨는 것까지는 구성을 했는데 여기에서 이 내용을 어떻게 사용하는 지에 대해 정말 많은 고민을 했는데, 현재 생각한 방법으로는 리프레쉬 토큰 만료 시간이 남아 있는 동안, 자동으로 액세스 토큰이 만료 될 때, 리프레쉬 토큰과 관련된 함수가 일정 시간마다 작동해서 액세스 토큰이 재발급 되도록 구성을 해줘야 할 것 같다. 여기서 또 한 가지 신경써야 할 부분은 로그인이 유지 되는 동안에만 자동으로 액세스 토큰 만료를 체크하고, 리프레쉬 토큰과 관련된 함수가 작동해야 하고, 추가로 리프레쉬 토큰이 유효하는 시간동안만 작동하도록 해줘야 할 것 같다.

<br />

# 내일 할 일

- React 공부 및 React 프로젝트 조금씩 진행하기

<br />

# 앞으로 해야 할 일

- React, NextJS 공부

- React 프로젝트 제작
