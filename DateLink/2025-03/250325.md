# 오늘 한 일

### React + TypeScript 프로젝트 제작 (React, TypeScript, ExpressJS, MongoDB로 만드는 실시간 통신 애플리케이션)

- 친구 삭제 시에 그룹 채팅방 초대 목록 삭제되는 이벤트 이름 변경 및 그룹 채팅방 삭제 시에 그룹 채팅방 초대 목록 삭제가 실시간 반영되도록 구성 추가
  - 그룹 채팅방 삭제 시에 해당 그룹 채팅방과 관련된 모든 그룹 채팅방 초대 목록이 삭제되고 해당 내용이 실시간 반영되어 삭제한 사용자와 그룹 채팅방에 참여한 사용자 화면에 적용되도록 로직 추가
  - 백엔드
    - group-chat-routes
      - 그룹 채팅방에 참여한 사용자들에게 실시간 알림을 전송하는 내용에 groupChatInvitesDelete 이벤트 추가
        - groupChatInvitesDelete 이벤트에 roomId를 전달하도록 구성
        - 그룹 채팅방 삭제 시에 그룹 채팅방만이 아닌, 해당 그룹 채팅방과 관련된 그룹 채팅방 초대 목록까지 모두 삭제되도록 구성
    - friend-routes
      - 친구 삭제하는 DELETE 라우터 수정
        - 친구 삭제 시에 그룹 채팅방 초대 목록에 저장된 항목도 함께 삭제되는 이벤트 이름 변경
          - groupChatInvitesDelete -> friendDeleteGroupChatInviteCleanup로 변경
          - 주석 내용도 수정
  - 프론트엔드
    - groupChatStore
      - getGroupChatInvites 액션 수정
        - socket.off를 추가해 이벤트 리스너 중복 실행을 방지
        - socket.on 내용 추가
          - groupChatInvitesDelete 이벤트를 통해 roomId 내용을 전달받도록 구성
          - groupChatInvites 목록에 filter를 사용해 삭제하는 항목을 제외하고 출력하도록 구성 추가
            - 그룹 채팅방 \_id와 roomId 내용을 비교해 일치하는 항목을 제외하고 출력
  - 그룹 채팅방 삭제 시에 해당 그룹 채팅방과 관련된 초대 목록이 제거되고, 실시간 반영되도록 로직을 구성하고 테스트한 결과, 문제없이 작동되어 삭제한 사용자와 그룹 채팅방에 참여한 사용자 화면이 업데이트되는 것을 확인할 수 있었다.
    - 그룹 채팅방 삭제와 관련된 실시간 반영은 모두 처리가 된 것 같고, 그룹 채팅방에 참여한 사용자가 나가기를 했을 때 실시간 반영이 되도록 처리를 해 줘야 함
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/50343e3492754c0d85059cf575f776636ab23198)

<br />

- 그룹 채팅방 나가기 시에 그룹 채팅방 초대 목록 삭제가 실시간 반영되도록 구성 추가
  - 그룹 채팅방에 참여한 사용자가 나가기 버튼으로 그룹 채팅방을 나갈 때, 해당 사용자와 관련된 그룹 채팅방 초대 목록 내용이 모두 삭제되고, 그룹 채팅방에 참여한 사용자 화면에 실시간 반영되어 적용되도록 로직 추가
  - 백엔드
    - group-chat-routes
      - 그룹 채팅방 삭제하는 DELETE 라우터 수정
        - groupChatInvitesDelete 이벤트 이름을 groupChatDeleteInvitesDelete로 수정
      - 그룹 채팅방 나가는 DELETE 라우터 수정
        - socketId 내용이 유효할 때, groupChatLeaveInvitesDelete 이벤트 리스너에 로그인한 사용자 \_id, 방 번호 \_id 내용을 전달
          - userId, roomId 내용 전달
  - 프론트엔드
    - groupChatStore
      - getGroupChatInvites 액션 수정
        - groupChatInvitesDelete 소켓 이벤트 관련 내용
          - groupChatInvitesDelete 이벤트를 groupChatDeleteInvitesDelete로 수정
        - groupChatLeaveInvitesDelete 소켓 이벤트 관련 내용 추가
          - socket.off를 추가해 이벤트 리스너 중복 실행을 방지
          - socket.on 내용 추가
            - groupChatLeaveInvitesDelete 이벤트를 통해 userId, roomId 내용을 전달받도록 구성
            - groupChatInvites 목록에 filter를 사용해 삭제하는 항목을 제외하고 출력하도록 구성 추가
              - 그룹 채팅방 \_id와 roomId가 일치할 경우 추가 조건부를 확인
              - requester와 userId를 비교해 일치하는 모든 항목을 찾도록 구성
              - 또는 receiver와 userId를 비교해 일치하는 모든 항목을 찾고, 해당 항목을 제외해 나머지 내용을 출력
              - 위 두 조건에 일치하는 모든 항목을 제외하고 나머지 내용을 출력하도록 구성
  - 그룹 채팅방 나갈 시에 해당 사용자와 관련된 그룹 채팅방 초대 목록이 모두 삭제되고, 실시간 반영되도록 로직을 구성하고 테스트한 결과, 문제없이 작동되어 나간 사용자와 그룹 채팅방에 참여한 사용자 화면이 업데이트되는 것을 확인할 수 있었다.
    - 그룹 채팅방 초대 목록과 관련된 내용에서 실시간 반영이 되지 않는 부분들이 많아서 이와 관련된 로직 구성이 필요
      - 그룹 채팅방 초대, 수락, 거절 관련된 실시간 반영 내용을 확인해 봐야 함
    - 친구 요청 시에 대기중 항목이 실시간으로 반영되지 않고 있는데, 보낸 사용자 화면에서 실시간 반영이 되지 않고 받은 사용자 화면만 실시간 반영되기 때문에 보낸 사용자 화면에서 실시간 반영이 필요함
    - 친구 수락 시에 클릭한 사용자 화면에서만 실시간 반영되므로, 상대방 화면에서도 실시간 반영되도록 로직 구성이 필요함
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/9e4456280f7930fc95f97dfc07807fbad42dd6b5)

# 오늘 느낀 점

- 그룹 채팅방 삭제 또는 나갈 시에 관련된 그룹 채팅방 초대 목록이 함께 삭제되고 실시간 반영되어 사용자 화면이 업데이트 되도록 구성을 해 주었는데, 이 내용 외에 그룹 채팅방 초대, 수락, 거절 관련된 실시간 반영 내용이 구성되지 않은 것 같아서 확인을 하고 모두 추가해 줘야 한다. 친구 요청과 관련된 내용에서도 실시간 반영이 안되는 부분들이 있어서 추가 확인 후에 처리를 해 줘야 하며, 친구 수락과 거절 내용에서도 실시간 반영이 안되고 있는 것 같아서 확인이 필요하고, 친구 삭제와 관련된 내용에서는 실시간 반영이 다 된 것 같아서 작동에 문제가 없는지 한 번만 더 확인해 주면 될 것 같다.

<br />

# 내일 할 일

- 실시간 통신 애플리케이션 (Float Chat) 프로젝트 진행

- Zustand 내용 구성

- 그룹 채팅방 초대, 수락, 거절 관련된 실시간 반영 내용 확인 필요

- 친구 요청 보냈을 때, 대기 중 항목이 실시간으로 반영되지 않는 문제 (보낸 사용자가 실시간 반영이 되지 않고, 받은 사용자만 실시간 반영됨)

- 친구 수락 시에도 클릭한 사용자만 실시간 반영되고, 상대방은 실시간 반영되지 않기 때문에 로직 구성 필요

- 친구 거절 시에도 실시간 반영이 되는지 확인이 필요함

- 그룹 채팅방 메시지 관련된 오류 및 실시간 알림 관련 오류 등 추가했던 콘솔 로그, 테스트하고 주석 처리한 채로 사용하지 않는 내용들 정리 필요 (실시간 반영 내용 로직을 추가하고 한 번에 정리 예정)

- 친구 관련된 내용에서 코드 정리 필요 (코드를 깔끔하게 보이도록 수정 필요)

- 그룹 채팅방 초대하고 알림을 전송하는 기능에서, 로그인한 사용자가 아닌 친구에게 보내는 그런 구조로 작동되도록 수정이 필요 (비로그인 상태여도 상관이 없음 단순하게 친구한테 친구 요청하면 알림 메시지가 전달되어야 함)

- 추가된 친구와 대화를 나눌 수 있는 다이렉트 채팅방

<br />

# 앞으로 해야 할 일

- React, TypeScript 공부

- React 상태 관리 도구인 Zustand 공부

- 실시간 통신 애플리케이션 프로젝트 제작
