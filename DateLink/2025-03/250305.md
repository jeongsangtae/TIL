# 오늘 한 일

### React + TypeScript 프로젝트 제작 (React, TypeScript, ExpressJS, MongoDB로 만드는 실시간 통신 애플리케이션)

- 그룹 채팅방 출력 오류 수정
  - 그룹 채팅방을 생성하면 생성되었다는 메시지와 함께 추가된 그룹 채팅방이 보여지고, 그 후에 새로고침하면 해당 방이 보이지 않는 문제가 발생해 관련 문제를 해결하기 위해 출력하는 부분에서 알맞은 정보로 데이터를 조회하도록 수정하여 해결
  - 백엔드
    - group-chat-routes
      - 그룹 채팅방 목록을 조회하는 GET 라우터 수정
        - groupChats 컬렉션에서 email 속성이 아닌, hostEmail 속성과 로그인한 사용자 이메일을 비교해 일치하는 항목을 찾도록 수정
  - 메인헤더 컴포넌트는 현재 사용하지 않는 내용이고, 해당 컴포넌트에서 사용하던 내용은 모두 사이드바 컴포넌트에서 관리하기 때문에 메인헤더 컴포넌트 수정은 의미가 없는 것을 확인, 그리고 그룹 채팅방 목록을 조회하는 내용에서 알맞은 정보로 데이터를 조회하도록 수정한 결과, 정상적으로 그룹 채팅방 목록이 보여지는 것을 확인할 수 있었다.
    - 그룹 채팅방을 생성할 때 email이 아닌, hostEmail로 저장하기 때문에 그룹 채팅방 목록을 조회하는 내용에서 hostEmail을 비교해 조회하도록 수정해 해결
    - DB에 저장된 그룹 채팅방이 보이지 않던 문제는, 초기에 특정 DB로 들어가지 않고 관련 컬렉션을 찾는 명령어를 입력해서 확인이 되지 않았고, 정상적으로 DB에 들어가서 조회하면 앞에서 추가한 그룹 채팅방 목록들이 모두 보여지는 것을 확인
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/47eab66e9c7f18a8d79d922123c6c1bd554a6e5d)

<br />

- 그룹 채팅방 초대 알림과 관련된 백엔드 로직 추가 및 알림 내용 구조 수정
  - 그룹 채팅방에 초대를 받게되면 알림 메시지가 넘어오도록 프론트엔드에서 구성한 알림 관련 로직 주석을 풀고, 백엔드에서는 새롭게 그룹 채팅방 초대 알림과 관련된 로직을 추가해 연결해 주었으며, 알림을 출력하는 컴포넌트에서 넘어오는 요청을 확인하고 그에 맞게 메시지를 출력하도록 구조를 변경
  - 백엔드
    - group-chat-routes
      - 그룹 채팅방 초대 요청을 보내는 POST 라우터
        - Express 앱에서 Socket.io 인스턴스를 가져옴
        - onlineUsers Map을 가져옴
        - 로그인되어 있는지 확인하기 위해, 그룹 채팅방 초대 요청을 보낸 사용자 \_id로 사용자를 찾음
        - 찾은 사용자가 유효하면, groupChatInviteNotification 소켓 이벤트에 정보를 전달
          - id
            - 새롭게 생성한 \_id
          - roomTitle
            - 그룹 채팅방 제목
          - message
            - 그룹 채팅방 초대 요청에 관한 알림 메시지
        - 친구 요청 알림 메시지와 동일하게 구성
  - 프론트엔드
    - socketStore
      - groupChatInviteNotification 소켓 이벤트 내용을 사용할 수 있도록 주석 제거
      - 내용 구성은 다른 알림 로직과 동일하게 구성
        - 변수만 다르게 사용
    - DirectChats
      - notificationMessage 변수를 추가
        - 객체에 각 타입별 메시지 포맷을 함수로 정의
        - ex) `friendRequest: (data) => `${data.requester} 님이 친구 요청을 보냈습니다.``
      - 출력하는 JSX 코드 수정
        - notification 상태 배열을 map으로 순회
        - 각 notif.type을 기반으로 notificationMessage 객체에서 메시지를 찾도록 구성
          - `notificationMessage[notif.type]?.(notif.data)`
          - notificationMessage 객체 안에서 notif.type을 키로 사용해 해당 함수를 호출
          - notif.data를 인자로 넘겨서 해당 타입에 맞는 메시지를 생성
        - notif.type이 notificationMessage에 없으면 기본값 출력
          - notif.type이 notificationMessage 객체에 없으면 "알 수 없는 알림"을 출력
        - `notificationMessages[notif.type]?.(notif.data)` 방식으로 객체를 동적으로 접근해서 해당 메시지를 출력하도록 수정
    - types
      - Notification 타입 정의에 "groupChatInviteNotification" 항목을 추가
  - 프론트엔드에서 구성한 그룹 채팅방 초대와 관련된 알림 로직 주석을 풀고, 백엔드에는 그룹 채팅방 초대 요청 알림과 관련된 로직을 구성해 연결하고 테스트한 결과, 그룹 채팅방에 친구를 초대하면 친구 화면에서 그룹 채팅방 제목과 함께 초대 알림 메시지가 보이는 것을 확인할 수 있었다.
    - 그룹 채팅방 초대 알림 메시지가 7초 뒤에 사라지는 것도 확인해 주었는데, 이 내용은 추후에 다이렉트 채팅 메시지로 옮겨서 사라지지 않고 그대로 유지되어 보여지도록 수정할 생각임
    - 넘어오는 요청에 대해 알림 메시지를 출력하는 코드의 구조가 조금 읽기 쉽지 않은 것 같아서 수정을 해 줄 생각임
    - 추가로, 그룹 채팅방 초대를 로그인한 사용자가 아닌, 친구인 사용자에게 보내도록 코드 구성을 수정해야 하는데, 이 부분은 추가로 친구 목록을 저장하는 백엔드 로직이 필요하다는 생각도 들어서 구조에 대해 생각을 해 봐야 함
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/16b044818409ae737bbc734a333e5c2e9122ed40)

# 오늘 느낀 점

- 그룹 채팅방 목록이 잘못된 코드 수정으로 출력되지 않는다고 생각을 했지만, 단순히 DB에 제대로 접속하지 않고 명령어를 실행해서 출력되지 않던 문제였고, 추가로 백엔드에서 그룹 채팅방 목록을 불러올 때 알맞은 조건으로 불러오도록 수정해 주면서 깔끔하게 해결이 되었다. 그룹 채팅방에 친구를 초대하면 초대 알림 메시지가 전송되는 것을 확인했는데, 이 내용은 추후에 다이렉트 메시지 내용에 옮겨서 알림이 사라지지 않고 채팅처럼 남아있도록 수정해 줄 생각이고, 현재 구성된 알림 메시지를 출력하는 코드의 구조가 조금 읽기 쉽지 않은 것 같아서, 사이드바 컴포넌트의 내용처럼 변경을 해 볼 생각이다. 추가로, 그리고 현재 그룹 채팅방 초대 요청만 하고 그에 대한 처리는 해결되지 않아서, 그룹 채팅방 초대 요청을 처리할 수 있는 로직이 필요하기 때문에 추가해 줘야 한다.

<br />

# 내일 할 일

- 실시간 통신 애플리케이션 (Float Chat) 프로젝트 진행

- Zustand 내용 구성

- 그룹 채팅방 초대하는 기능

- 그룹 채팅방을 삭제할 때, 그룹 채팅방에 저장한 모든 채팅 메시지도 함께 삭제되도록 로직 구성 필요

- 새로운 메시지 추가되었을 때 알림 뜨는 기능 (추가하긴 했으나, 미완성)

- 친구 관련된 내용에서 코드 정리 필요 (코드를 깔끔하게 보이도록 수정 필요)

- 그룹 채팅방에서 채팅 메시지가 추가되면 전역적으로 알 수 있도록 알림이 떠야 하고, 그 알림 관리를 소켓 Zustand에서 할 수 있도록 구성 필요

- 그룹 채팅방 초대하고 알림을 전송하는 기능에서, 로그인한 사용자가 아닌 친구에게 보내는 그런 구조로 작동되도록 수정이 필요 (비로그인 상태여도 상관이 없음 단순하게 친구한테 친구 요청하면 알림 메시지가 전달되어야 함)

- 추가된 친구와 대화를 나눌 수 있는 다이렉트 채팅방

<br />

# 앞으로 해야 할 일

- React, TypeScript 공부

- React 상태 관리 도구인 Zustand 공부

- 실시간 통신 애플리케이션 프로젝트 제작
