# 오늘 한 일

### React + TypeScript 프로젝트 제작 (React, TypeScript, ExpressJS, MongoDB로 만드는 실시간 통신 애플리케이션)

- 그룹 채팅방 초대 거절하는 동작에 대한 프론트엔드, 백엔드 로직 추가
  - 그룹 채팅방 초대를 거절하기 위해 거절 버튼을 클릭하면 그룹 채팅방 초대 메시지가 삭제될 수 있도록 프론트엔드와 백엔드 로직을 추가하고 서로 연결해 작동될 수 있도록 구성
  - 백엔드
    - group-chat-routes
      - 그룹 채팅방 초대 거절하는 DELETE 라우터
        - 프론트엔드에서 URL 파라미터로 전달한 내용을 사용할 수 있도록 구성
          - 그룹 채팅방 초대 \_id
        - groupChatInvites 컬렉션에서 \_id와 그룹 채팅방 초대 \_id를 비교해 일치하는 항목을 찾고 삭제
          - 삭제되었는지 확인하는 조건부 내용 추가
        - 삭제가 정상적으로 이루어지면 프론트엔드에 거절과 관련된 메시지를 전달
        - 만약 중간에 잘못된 처리가 생긴다면 오류 메시지 출력
  - 프론트엔드
    - groupChatStore
      - rejectGroupChatInvite 액션 타입 정의 수정
        - groupChatId 내용을 삭제하고, 불러온 GroupChatInviteListProps 내용을 사용하지 않고 groupChatInviteId 내용에 string으로 타입 정의
      - rejectGroupChatInvite 액션 추가
        - 매개변수로 groupChatInviteId를 전달받도록 구성
        - 백엔드와 연결할 fetch 함수를 추가
          - API 경로에 매개변수로 전달받은 groupChatInviteId를 포함시켜서 URL 파라미터로 사용될 수 있도록 구성
          - DELETE 메서드로 구성하고 credentials까지 추가
          - fetch 함수가 정상적으로 작동하는지 확인하는 조건문 내용 포함
        - 백엔드에서 전달한 응답 데이터를 전달받아서 해당 메시지를 콘솔에 출력
        - 그룹 채팅방 초대를 거절하면 실시간 반영되어 해당 메시지가 삭제되도록 구성
          - groupChatInvites 상태에 filter를 사용해 req.\_id와 매개변수로 넘어온 groupChatInviteId가 일치하지 않는 항목만 남기고 나머지는 걸러내도록 처리
          - 즉, req.\_id와 groupChatInviteId가 일치하는 항목은 filter로 인해 걸러져서 보이지않게 됨
        - 오류 발생 시에 에러 메시지를 출력
    - GroupChatInviteList
      - rejectGroupChatInviteHandler 함수 수정
        - rejectGroupChatInvite 액션에 groupChatInviteId 내용만 전달되도록 수정
  - 그룹 채팅방 초대 거절하는 기능이 작동되도록 로직을 구성하고 테스트한 결과, 거절 버튼을 클릭하면 버튼만 안보이는 것이 아닌, 해당 초대 메시지 데이터 자체를 삭제시켜서 DB와 화면에서 모두 안보이도록 구성된 것을 확인
    - 버튼만 사라지게 하는 것이 맞는지, 메시지까지 모두 삭제하는 것이 맞는지 고민한 결과, 그룹 채팅방 초대를 거절하면 그 방에 들어갈 의사가 없는 것으로 판단하고, 확실하게 초대 메시지까지 삭제해 UI/UX가 깔끔하게 보이도록 구성해 주었음
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/c416190d7576a6c8eb4afd7a15913c4c66c6a556)

<br />

- 그룹 채팅방에 참여한 사용자 목록 출력하는 로직 추가
  - 그룹 채팅방에 들어가면 해당 채팅방에 참여한 사용자 목록이 보여지도록 프론트엔드와 백엔드 로직을 추가하고 서로 연결해 작동되어 화면에 사용자 목록이 출력되도록 구성
  - 백엔드
    - group-chat-routes
      - 그룹 채팅방에 참여한 사용자 목록을 출력하는 GET 라우터
        - URL 파라미터로 전달한 내용을 사용할 수 있도록 구성
        - groupChats 컬렉션에서 \_id와 URL 파라미터로 전달받은 roomId를 비교해 일치하는 항목을 찾도록 구성
          - 찾은 그룹 채팅방이 유효한지 확인하는 조건문 추가
        - userIds 변수 추가
          - 그룹 채팅방을 확인해서 존재할 경우, 그룹 채팅방에 저장된 users 배열을 가져와 userIds에 저장
          - 반대의 경우에는 기본 배열을 가져와 저장
        - users 컬렉션에서 users 배열에 포함된 \_id들을 사용하여 해당 사용자들의 정보를 조회
          - `$in` 연산자를 사용해 여러 개의 \_id를 조건으로 사용
          - map 함수를 사용해 새로운 배열로 만듦
          - `.find({ _id: { $in: userIds.map(id => new ObjectId(id)) }})`
        - 찾은 사용자 정보들을 프론트엔드에 전달하도록 구성
        - 오류 발생 시에 오류 메시지를 출력
  - 프론트엔드
    - groupChatStore
      - groupChatUsers 타입 정의 추가
        - 현재는 기본 배열로 타입 정의를 했지만, 추가 수정하여 넘어온 데이터에 대한 타입 정의를 다시 해야 함
        - \_id, nickname, email 등등 내용에 대한 타입 정의 필요
      - getGroupChatUsers 타입 정의 추가
        - 전달받는 roomId는 string으로 타입 정의
        - 비동기 함수로 타입 정의
      - groupChatUsers 상태 추가
        - 배열 형태로 저장되도록 구성
      - getGroupChatUsers 액션 추가
        - fetch 함수 추가
          - API 경로에 roomId를 포함시켜 URL 파라미터로 전달되도록 구성
          - 기본으로 사용되는 GET 메서드를 사용하고, credentials도 추가
          - fetch 함수에 문제가 생겼을 경우를 확인하는 조건문 추가
        - 응답 데이터로 그룹 채팅방에 참여한 사용자 목록을 전달받음
        - set을 통해 groupChatUsers 상태는 응답 데이터로 전달받은 그룹 채팅방에 참여한 사용자 목록으로 업데이트
        - 중간에 오류 발생 시에 에러 메시지 출력
    - GroupChatDetails
      - GroupChatUsers 컴포넌트를 불러오고, roomId를 props로 전달
    - GroupChatUsers
      - 재사용 타입 정의 파일에서 RoomId 타입 정의를 불러오도록 구성
        - props로 전달받은 roomId에 RoomId 타입 정의를 사용
      - useGroupChatStore Zustand를 불러오도록 구성
        - useGroupChatStore Zustand에서 불러온 groupChatUsers 상태와 getGroupChatUsers 액션을 사용할 수 있도록 구성
      - useEffect 추가
        - roomId가 정의되었는지 확인
        - getGroupChatUsers 액션에 roomId를 전달하도록 구성
      - JSX 코드
        - groupChatUsers 상태에 map 함수를 사용해 불러온 내용을 새로운 배열로 만들어서 출력할 수 있도록 구성
        - ul에는 key 속성을 추가해 사용자 \_id가 키로 사용되도록 구성
        - li에는 사용자 닉네임이 출력되도록 구성
  - 그룹 채팅방에 참여한 사용자 목록을 불러오고 화면에 출력할 수 있도록 구성하고 테스트한 결과, 사용자 목록이 출력되긴 하지만 여러 방에서 같은 내용으로 출력되는 것 같아서 추가 수정을 진행 해야 한다.
    - 분명히 사용자가 한명인 채팅방에서도 2명의 참여자가 보여지고, 새로고침하면 다시 한명으로 보이는 상황이기 때문에 출력하는 부분에서 문제가 있는지 확인하고 처리해 줘야 함
    - 예상되는 문제로 현재 별도의 컴포넌를 나누지 않고, GroupChatUsers 내에서 ul, li로 바로 출력하고 있는데 이 부분이 문제가 되는 것 같아서, 별도의 컴포넌트로 나누고 다시 테스트를 진행해 볼 생각이다.
    - 추가로, 백엔드 로직에서 사용자 정보를 조회하는 로직을 조금 수정할 수 있다면 수정해 볼 생각
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/781721d87e157279d880540e7709005708642cda)

# 오늘 느낀 점

- 그룹 채팅방 초대 거절과 관련된 로직을 추가해 주었고, 그룹 채팅방에 참여한 사용자 목록도 출력이 되도록 로직을 추가했는데, 초대 거절과 관련된 로직은 문제없이 작동이 되지만, 사용자 목록을 출력하는 로직은 데이터를 조회하는 부분에서는 문제가 없어보이는데, 출력하는 부분에서 조금 문제가 있어보이기 때문에 추가로 수정이 필요하다고 생각이 된다. 사용자 목록 출력과 관련된 부분은 별도의 컴포넌트로 구성하면 해결이 될 것 같기에 이 방법으로 시도해 볼 생각이고, 그룹 채팅방 초대 수락 시에 바로 적용되어 보여지도록 실시간 반영 내용을 구성해야 하며, 그룹 채팅방 삭제 시에 해당 채팅방에서 작성한 모든 채팅 메시지도 함께 삭제되도록 구성을 해 줄 생각이다.

<br />

# 내일 할 일

- 실시간 통신 애플리케이션 (Float Chat) 프로젝트 진행

- Zustand 내용 구성

- 그룹 채팅방 초대 수락 시에 바로 적용되어 보여지도록 구성 필요

- 그룹 채팅방을 삭제할 때, 그룹 채팅방에 저장한 모든 채팅 메시지도 함께 삭제되도록 로직 구성 필요

- 새로운 메시지 추가되었을 때 알림 뜨는 기능 (추가하긴 했으나, 미완성)

- 친구 관련된 내용에서 코드 정리 필요 (코드를 깔끔하게 보이도록 수정 필요)

- 그룹 채팅방에서 채팅 메시지가 추가되면 전역적으로 알 수 있도록 알림이 떠야 하고, 그 알림 관리를 소켓 Zustand에서 할 수 있도록 구성 필요

- 그룹 채팅방 초대하고 알림을 전송하는 기능에서, 로그인한 사용자가 아닌 친구에게 보내는 그런 구조로 작동되도록 수정이 필요 (비로그인 상태여도 상관이 없음 단순하게 친구한테 친구 요청하면 알림 메시지가 전달되어야 함)

- 추가된 친구와 대화를 나눌 수 있는 다이렉트 채팅방

<br />

# 앞으로 해야 할 일

- React, TypeScript 공부

- React 상태 관리 도구인 Zustand 공부

- 실시간 통신 애플리케이션 프로젝트 제작
