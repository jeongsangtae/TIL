# 오늘 한 일

### React + TypeScript 프로젝트 제작 (React, TypeScript, ExpressJS, MongoDB로 만드는 실시간 통신 애플리케이션)

- 그룹 채팅방 초대 수락 실시간 반영 추가
  - 그룹 채팅방 초대를 수락했을 때, 클릭한 사용자와 상대방 화면에서 즉시 실시간 반영되어 보여지도록 로직 추가
  - 백엔드
    - friend-routes
      - 친구 요청 수락하는 POST 라우터 수정
        - 주석 내용 수정
      - 친구 요청 거절 또는 취소하는 DELETE 라우터 수정
        - 주석 내용 수정
        - 테스트를 위해 추가했던 console.log 삭제
    - group-chat-routes
      - 클릭한 사용자가 요청자인지, 받은 사람인지 판별하는 조건부 추가
        - 로그인한 사용자 \_id와 그룹 채팅방 초대에 저장된 requester를 비교
          - 정확히 비교될 수 있도록 비교하는 데이터에 toString을 추가
        - true일 경우, receiver 내용을 저장
        - false일 경우, requester 내용을 저장
      - 로그인한 사용자 목록 내용과 앞에서 찾은 사용자 \_id를 비교해 일치하는 사용자 socketId를 추출
      - socketId 내용이 유효할 때, acceptGroupChatInvite 이벤트 리스너에 그룹 채팅방 초대 \_id 정보를 전달
        - groupChatInviteId 내용 전달
  - 프론트엔드
    - groupChatStore
      - getGroupChatInvites 액션 수정
        - socket.off를 추가해 이벤트 리스너 중복 실행을 방지
        - socket.on 내용 추가
          - acceptGroupChatInvite 이벤트를 통해 groupChatInviteId 내용을 전달받도록 구성
          - groupChatInvites 목록에 filter를 사용해 수락하는 항목을 제외하고 출력하도록 구성 추가
            - 그룹 채팅방 초대 \_id와 groupChatInviteId 내용을 비교해 일치하는 항목을 제외하고 출력
  - 그룹 채팅방 초대 수락 버튼을 클릭하면 실시간 반영되도록 로직을 구성하고 테스트한 결과, 문제없이 작동되어 클릭한 사용자와 상대방 화면에서 초대 내용이 사라지는 것을 확인할 수 있었다.
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/a4c8900d60a2e33b9c3fdfbc462f80bb62494b3f)

<br />

- 그룹 채팅방 초대 거절 실시간 반영 추가
  - 그룹 채팅방 초대를 거절했을 때, 클릭한 사용자와 상대방 화면에서 즉시 실시간 반영되어 보여지도록 로직 추가
  - 백엔드
    - group-chat-routes
      - 그룹 채팅방 초대 거절하는 DELETE 라우터 수정
        - 로그인한 사용자 정보를 가져오도록 구성 추가
        - 그룹 채팅방 초대 내용을 찾는 구성 추가
          - groupChatInvites 컬렉션 내용에 저장된 \_id와 new ObjectId로 변환된 groupChatInviteId를 비교해 일치하는 항목을 찾음
          - 찾은 내용이 유효한지 확인하는 조건부 포함
        - 클릭한 사용자가 요청자인지, 받은 사람인지 판별하는 조건부 추가
          - 로그인한 사용자 \_id와 그룹 채팅방 초대에 저장된 requester를 비교
            - 정확히 비교될 수 있도록 비교하는 데이터에 toString을 추가
          - true일 경우, receiver 내용을 저장
          - false일 경우, requester 내용을 저장
        - socket.io 및 onlineUsers Map 가져오도록 구성 추가
        - 로그인한 사용자 목록 내용과 앞에서 찾은 사용자 \_id를 비교해 일치하는 사용자 socketId를 추출
        - socketId 내용이 유효할 때, rejectGroupChatInvite 이벤트 리스너에 친구 요청 \_id 정보를 전달
          - groupChatInviteId 내용 전달
  - 프론트엔드
    - groupChatStore
      - getGroupChatInvites 액션 수정
        - socket.off를 추가해 이벤트 리스너 중복 실행을 방지
        - socket.on 내용 추가
          - rejectGroupChatInvite 이벤트를 통해 groupChatInviteId 내용을 전달받도록 구성
          - groupChatInvites 목록에 filter를 사용해 거절하는 항목을 제외하고 출력하도록 구성 추가
            - 그룹 채팅방 초대 \_id와 groupChatInviteId 내용을 비교해 일치하는 항목을 제외하고 출력
  - 그룹 채팅방 초대 거절 버튼을 클릭하면 실시간 반영되도록 로직을 구성하고 테스트한 결과, 문제없이 작동되어 클릭한 사용자와 상대방 화면에서 초대 내용이 사라지는 것을 확인할 수 있었다.
    - 그룹 채팅방 초대 수락, 거절 관련 내용은 모두 처리되었고, 친구 관련 내용도 모두 처리되었기 때문에 콘솔 로그 내용이나 주석 처리된 내용을 정리해 줘야 함
    - 코드 정리를 해 준 뒤에 다이렉트 채팅방에 대한 로직 구성을 해 줘야 하는데, 그룹 채팅방 구조와 조금 다르게 친구인 다른 사용자를 클릭하면 해당 사용자와의 다이렉트 채팅방이 생성되고 이동되도록 구성해 줘야 함
      - 만약 이미 생성된 다이렉트 채팅방이 있다면 해당 다이렉트 채팅방으로 이동해야 함
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/8fc21a6267965ee037b745100d2e996acc48fc20)

<br />

- 그룹 채팅방, 친구 관련 내용 코드 정리
  - 실시간 반영이 추가된 그룹 채팅방, 친구 관련 내용에서 테스트를 위해 사용된 콘솔 로그와 주석 처리된 로직을 삭제해 코드를 정리
  - 백엔드
    - friend-routes
      - 콘솔 로그 내용, 주석 처리된 코드 삭제
      - 라우터에 주석을 추가해 구분
    - group-chat-routes
      - 콘솔 로그 내용, 주석 처리된 코드 삭제
      - 라우터에 작성된 주석 수정
  - 프론트엔드
    - friendStore
      - 여러 콘솔 로그 내용 삭제
      - 소켓 이벤트 내용에 주석 추가
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/4fdd9d276c7f11310cff4dd7df9882acac1ee50e)

# 오늘 느낀 점

- 그룹 채팅방, 친구 관련 실시간 반영을 모두 추가해 주었기 때문에 이제는 다이렉트 채팅방에 대해 구현을 해 줘야 한다. 다이렉트 채팅방을 구현하기 전에 현재 여러 Zustand에 구성된 실시간 반영 로직들이 재사용될 수 있도록 커스텀 훅에 옮겨서 구성하고, 해당 커스텀 훅을 불러와 사용하는 쪽으로도 생각을 해보긴 했는데, 현재 실시간 반영하는 로직이 모두 같은 로직이 아닌 filter, map, some 등 여러 메서드를 사용해 구성되어 있고, 구조도 조금씩 다르기 때문에 여러 정보를 찾아보고 확실하게 가능하다는 판단이 되면 재사용될 수 있도록 구성을 해 줄 생각이다. 추가로, 현재 여러 알림과 관련된 내용이 실시간으로 넘어오도록 구성이 되어 있는데 이 알림 내용이 홈 화면에서 단순히 텍스트로 보여지고 사라지는 것이 아닌, 우측 하단에 조그마한 모달 형식으로 보여지고 사라지도록 미리 구성을 해주면 테스트하기도 편하고 전역적으로 보여지는지 확인도 가능하기 때문에 이와 관련된 내용을 미리 구성하는 것도 고려해 볼만 하다고 생각이 된다.

<br />

# 내일 할 일

- 실시간 통신 애플리케이션 (Float Chat) 프로젝트 진행

- Zustand 내용 구성

- 그룹 채팅방 메시지 관련된 오류 및 실시간 알림 관련 오류 등 추가했던 콘솔 로그, 테스트하고 주석 처리한 채로 사용하지 않는 내용들 정리 필요 (실시간 반영 내용 로직을 추가하고 한 번에 정리 예정)

- 친구 관련된 내용에서 코드 정리 필요 (코드를 깔끔하게 보이도록 수정 필요)

- 그룹 채팅방 초대하고 알림을 전송하는 기능에서, 로그인한 사용자가 아닌 친구에게 보내는 그런 구조로 작동되도록 수정이 필요 (비로그인 상태여도 상관이 없음 단순하게 친구한테 친구 요청하면 알림 메시지가 전달되어야 함)

- 추가된 친구와 대화를 나눌 수 있는 다이렉트 채팅방

<br />

# 앞으로 해야 할 일

- React, TypeScript 공부

- React 상태 관리 도구인 Zustand 공부

- 실시간 통신 애플리케이션 프로젝트 제작
