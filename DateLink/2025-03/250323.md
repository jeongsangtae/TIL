# 오늘 한 일

### React + TypeScript 프로젝트 제작 (React, TypeScript, ExpressJS, MongoDB로 만드는 실시간 통신 애플리케이션)

- 그룹 채팅방 제목 변경 오류 수정 및 그룹 채팅방 제목 변경 실시간 반영 추가
  - 그룹 채팅방 제목 변경과 관련된 백엔드 로직에서 사용하는 변수를 수정해 오류를 해결하고, 그룹 채팅방 제목 변경 시에 그룹 채팅방에 참여한 사용자들 화면에서도 실시간 반영되어 변경되도록 구성 추가
  - 백엔드
    - group-chat-routes
      - 그룹 채팅방 제목 수정하는 PATCH 라우터 수정
        - 중간에 if문을 통해 수정할 권한을 확인하는 부분에서 그룹 채팅방에 저장된 hostEmail과 로그인한 사용자 이메일을 확인하도록 수정
        - 찾은 그룹 채팅방 users 배열에 저장된 사용자 \_id 내용을 가져와 로그인한 사용자 목록 \_id와 일치하는 내용을 찾음
        - 찾은 내용이 유효할 때, groupChatEdit 이벤트 리스너에 수정한 그룹 채팅방 정보를 전달
          - \_id, title 등 내용 전달
  - 프론트엔드
    - RootLayout
      - Link Hook 삭제 및 주석 처리한 Link 컴포넌트 삭제
      - 함수 이름 변경이 필요한 내용에 주석 추가
    - groupChatStore
      - getGroupChats 액션 수정
        - socket 관련 내용을 불러오고 사용할 수 있도록 구성
        - socket.off를 추가해 이벤트 리스너 중복 실행을 방지
        - socket.on 내용 추가
          - 백엔드 groupChatEdit 이벤트 리스너와 연결
          - groupChats에 map을 사용해 기존 그룹 채팅방 목록을 순회하고, 그룹 채팅방 \_id와 업데이트된 그룹 채팅방 \_id가 일치한 경우, 기존 데이터를 스프레드 연산자로 유지하면서 업데이트된 데이터를 덮어씌우도록 구성
          - 만약 그룹 채팅방 \_id와 업데이트된 그룹 채팅방 \_id가 다르면 기존 데이터를 그대로 유지
  - 내용을 수정하고 테스트한 결과, 그룹 채팅방 제목 수정 시에 에러가 발생되지 않는 것을 확인했으며, 제목을 수정한 사용자 화면과 동일하게 그룹 채팅방에 참여한 사용자 화면에서도 실시간 반영되어 그룹 채팅방 제목이 수정되는 것을 확인할 수 있었다.
    - 루트 레이아웃에서 구성한 함수의 이름이 명확하지 않은 것 같아서, 적당한 이름으로 수정을 해 줘야 하고, 주석 처리한 코드 내용을 삭제해 정리를 해 줘야 함
    - 친구 삭제 시에 실시간 반영되도록 로직 추가를 해 줘야 함
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/793ecdf6bc91b192c00ae180f900678b18eb6c69)

<br />

- 친구 삭제 실시간 반영 추가 (클릭한 사용자 화면에서 적용)
  - 친구 삭제 버튼을 클릭 시에 클릭한 사용자 화면에서 실시간 반영되어 친구였던 사용자가 보이지 않도록 구성을 추가
  - 프론트엔드
    - friendStore
      - deleteFriend 액션 타입 정의 수정
        - 매개변수로 전달받은 userId를 추가하고, string으로 타입 정의
      - deleteFriend 액션 수정
        - 매개변수에 userId를 추가
        - friends 목록에서 filter를 통해 삭제하는 항목을 제외하고 출력하도록 구성 추가
          - requester.id와 친구 \_id가 일치하는 항목 또는 receiver.id와 친구 \_id가 일치하는 항목을 찾도록 구성
          - requester.id와 로그인한 사용자 \_id가 일치하는 항목 또는 receiver.id와 로그인한 사용자 \_id가 일치하는 항목을 찾도록 구성
          - 위 두 내용에 &&를 사용해, 두 조건을 만족하는 항목을 제외하고 출력하도록 구성
    - Friends
      - Friend 컴포넌트에 userId를 props로 전달하도록 구성 추가
        - userId는 `userInfo?._id` 내용을 전달
    - Friend
      - userId를 props로 전달 받고 사용할 수 있도록 구성
      - deleteFriendHandler 함수 수정
        - userId가 정의되었는지 확인하는 조건문 추가
        - deleteFriend 액션에 userId 내용을 전달하도록 수정
    - types
      - FriendUser 타입 정의 수정
        - userId 타입 정의를 추가하고, string 또는 undefined로 타입 정의
  - 친구 삭제 버튼을 클릭한 사용자 화면에서 즉시 실시간 반영되어 삭제한 사용자가 보이지 않도록 구성을 추가하고 테스트한 결과, 삭제 버튼을 클릭하면 해당 사용자가 즉시 친구 목록에서 사라져 보이지 않는 것을 확인할 수 있었다.
    - 친구 목록에서 filter를 사용해 삭제한 사용자를 걸러내는 로직이 조금 문제가 있어 보여서, 추가로 수정이 필요
    - 친구 삭제 시에 삭제 버튼을 클릭한 사용자만이 아닌, 상대방 화면에서도 실시간 반영되어 삭제된 친구에 대한 정보가 보이지 않도록 구성 추가가 필요함
    - 삭제 버튼 클릭 시에 현재는 버튼을 클릭한 사용자 화면만 실시간 업데이트되고, 삭제당한 사용자 화면에서는 반영되지 않아서 새로고침이 필요하기 때문에 로직 추가 필요
      - 이 내용과 관련된 로직을 좀 구성했었는데, 구성한 로직이 제대로 작동하지 않고 오류가 발생되기 때문에 추가로 수정해 문제없이 작동될 때 커밋하고 정리할 예정
    - 추가로, 친구 요청 시에 대기중 항목이 실시간으로 반영되지 않고 있는데, 보낸 사용자 화면에서 실시간 반영이 되지 않고 받은 사용자 화면만 실시간 반영되기 때문에 보낸 사용자 화면에서 실시간 반영이 필요함
    - 친구 수락 시에 클릭한 사용자 화면에서만 실시간 반영되므로, 상대방 화면에서도 실시간 반영되도록 로직 구성이 필요함
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/eb9e79c95df322f552baafe68e5bda867ca40560)

# 오늘 느낀 점

- 그룹 채팅방 제목 수정 시에 그룹 채팅방에 참여한 모든 사용자 화면에도 실시간 반영되도록 구성을 추가해 주었고, 친구 삭제 시에 실시간 반영되어 해당 친구가 친구 목록에서 제거되도록 구성을 추가해 주었다. 친구 삭제와 관련된 실시간 반영은 클릭한 사용자 화면에서만 실시간 반영되고 상대방 화면에서는 실시간 반영이 되지 않기 때문에, 구성을 추가해 삭제당한 사용자 화면에서도 실시간 반영되어 즉시 적용되도록 해 줘야 한다. 친구 삭제 외에 친구 요청, 친구 수락 등 일부 내용에서만 실시간 반영이 적용되므로, 이 내용을 수정해 전체적으로 실시간 반영이 되도록 로직을 수정해 줘야 하고, 친구 삭제 시에 해당 친구와 관련된 그룹 채팅방 초대 메시지도 함께 삭제되도록 구성을 추가해야 깔끔한 처리가 될 것 같다. 그룹 채팅방 메시지와 관련된 오류 및 실시간 알림 관련 오류를 수정하면서 추가했던 콘솔 로그 및 테스트하고 주석 처리한 채로 사용하지 않는 내용들을 우선적으로 제거했어야 했는데, 이 내용을 잊어버리고 정리하지 않았기 때문에 이 내용들을 깔끔하게 정리하고 로직 구성을 해 주는 것이 좋다고 생각이 된다.

<br />

# 내일 할 일

- 실시간 통신 애플리케이션 (Float Chat) 프로젝트 진행

- Zustand 내용 구성

- 친구 요청 보냈을 때, 대기 중 항목이 실시간으로 반영되지 않는 문제 (보낸 사용자가 실시간 반영이 되지 않고, 받은 사용자만 실시간 반영됨)

- 친구 수락 시에도 클릭한 사용자만 실시간 반영되고, 상대방은 실시간 반영되지 않기 때문에 로직 구성 필요

- 친구 삭제했을 때 실시간 반영이 되도록 로직 구성 필요

- 친구를 삭제했을 때, 해당 친구와 관련된 그룹 채팅방 초대 메시지 삭제 필요

- 친구 관련된 내용에서 코드 정리 필요 (코드를 깔끔하게 보이도록 수정 필요)

- 그룹 채팅방 초대하고 알림을 전송하는 기능에서, 로그인한 사용자가 아닌 친구에게 보내는 그런 구조로 작동되도록 수정이 필요 (비로그인 상태여도 상관이 없음 단순하게 친구한테 친구 요청하면 알림 메시지가 전달되어야 함)

- 추가된 친구와 대화를 나눌 수 있는 다이렉트 채팅방

<br />

# 앞으로 해야 할 일

- React, TypeScript 공부

- React 상태 관리 도구인 Zustand 공부

- 실시간 통신 애플리케이션 프로젝트 제작
