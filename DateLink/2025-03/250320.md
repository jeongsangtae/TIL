# 오늘 한 일

### React + TypeScript 프로젝트 제작 (React, TypeScript, ExpressJS, MongoDB로 만드는 실시간 통신 애플리케이션)

- 새로운 메시지 알림 관련 이벤트 에러 수정 (중복관련 문제 해결)
  - 새로운 메시지 추가 시에 알림이 전송되어 다른 사용자들이 알 수 있도록 해주는 알림 관련 이벤트 내용이 정상적으로 작동되어 중복된 내용이 프론트엔드에서 출력되지 않도록 수정
  - 백엔드
    - app
      - roomUsers와 관련된 내용 주석 처리
    - group-chat-routes
      - 사용자가 입력한 채팅 메시지를 저장하는 POST 라우터 수정
        - roomUsers와 관련된 내용을 주석 처리
        - 찾은 그룹 채팅방 users 배열에 저장된 사용자 \_id 내용을 가져와 로그인한 사용자 목록 \_id와 일치하는 내용을 찾음
        - 찾은 내용이 유효할 때, messageNotification 이벤트 리스너에 로그인한 사용자 정보를 전송
          - \_id, roomTitle, message 정보를 전달
        - 이전에 roomUsers를 사용해 찾는 내용에서, 간단하게 그룹 채팅방에 참여한 사용자 목록을 확인하고 해당 사용자들에게 새로운 메시지 추가 알림을 전송하도록 수정
  - roomUsers 관련 내용을 주석 처리하고, 그룹 채팅방에 저장된 사용자 목록에게 알림을 전송하도록 수정하고 테스트한 결과, 정상적으로 새로운 메시지 알림이 전송되며 중복이 발생되지 않고 출력되는 것을 확인할 수 있었다.
    - 정상적으로 새로운 메시지 알림이 전송되긴 하지만, 메시지를 전송한 사람에게도 알림이 전송되고 있고, 그룹 채팅방에 들어와 있는 사용자에게도 알림이 전송되기 때문에 이 내용을 수정해 현재 그룹 채팅방에 들어와있지 않은 사용자에게만 전달하도록 해야 함
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/fb83a87b2de3f9b75e083bb3553b050614749615)

<br />

- 새로운 메시지 추가 오류 관련 테스트 및 새로운 메시지 알림 관련 이벤트 추가 수정
  - 새로운 메시지를 추가하면 해당 그룹 채팅방에서만 출력되어 보여져야 하지만, 다른 그룹 채팅방에서 추가된 메시지가 보여지는 오류가 발생해서 이 오류를 확인하기 위해 테스트를 진행해 주었고, 새로운 메시지 추가 시에 메시지를 추가한 사용자를 제외하고 알림이 전송되도록 내용을 수정
  - 백엔드
    - app
      - `socket.leaveAll()` 내용을 추가해 테스트 진행하고 주석 처리
      - 해당 코드를 사용하면, 다른 그룹 채팅방에서 추가된 메시지가 보여지지 않고 해당 그룹 채팅방에서만 보여지도록 해결 가능
      - 하지만, 새로운 메시지 알림이 작동하지 않게 되므로 현재는 주석 처리
    - group-chat-routes
      - 사용자가 입력한 채팅 메시지를 저장하는 POST 라우터 수정
        - if문을 추가하고, 그룹 채팅방 사용자 목록에 저장된 \_id와 로그인한 사용자 \_id를 확인해 일치하는 항목은 건너뛰고 전달하도록 구성
        - 메시지를 보낸 사람을 제외하고 새로운 메시지 알림을 전달하도록 구성
  - 새로운 메시지 추가 시에 해당 그룹 채팅방에서만 출력되고 다른 그룹 채팅방에서 출력되지 않도록 하는 방법은 찾았지만, 해당 방법을 사용하면 새로운 메시지 알림 관련 이벤트가 작동되지 않기 때문에 다른 방법을 찾아야 하고, 새로운 메시지 추가 시에 메시지를 추가한 사용자를 제외하고 알림이 전송되는 것을 확인할 수 있었다.
    - 새로운 메시지 알림과 관련된 내용에서 메시지를 추가한 사용자를 제외하는 것이 쉽게 가능했지만, 현재 그룹 채팅방에 들어와있는 사용자를 제외하고 알림을 전송하는 것은 코드를 추가하고 테스트를 진행해 봤지만, 원하는 동작이 이루어지지 않기 때문에 추가로 확인하고 다시 수정해 테스트를 진행해 봐야 함
    - 새로운 메시지 추가 시에 해당 그룹 채팅방에서만 출력되도록 구성이 가능하긴 하지만, 새로운 메시지 알림 기능이 동작하지 않기 때문에 다른 방법이 필요한데, 현재 생각한 방법으로는 그룹 채팅방을 이동할 때 이전에 참여한 그룹 채팅방을 나가고 그 다음 새로운 그룹 채팅방에 입장하는 형태로 내용을 수정하면 문제가 해결될 수 있다고 생각이 됨
    - 새로운 메시지 추가 시에 다른 그룹 채팅방에서도 메시지가 추가되는 이유는 joinRoom 이벤트가 중복되어서 문제가 발생되는 것으로 예상이 되는데, 여기서 socket.off를 사용하면 에러가 발생해서 문제가 생기기 때문에 앞에서 말한 나가기 기능이 먼저 작동하고 그 다음 참여가 되도록 하거나, 프론트엔드에서 socket.emit이 아닌 socket.on이 사용되도록 구성할 수 있으면 해결될 것 같기도 하기 때문에 여러 방법으로 테스트를 진행해 볼 생각이다.
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/40face166602fb3e7f66b4c5a2a627a8f7d9a0ca)

# 오늘 느낀 점

- 새로운 메시지 추가 시에 알림이 전달되어 출력되는데, 이 때 중복으로 출력되지 않도록 오류를 수정해 준 부분은 문제가 없는 것을 확인했고, 추가로 메시지를 추가한 사용자를 제외하고 나머지 사용자에게 알림을 전송하도록 우선 수정해 주었으며, 그룹 채팅방에 접속중인 사용자들에게도 알림을 전송하지 않도록 추가 수정이 필요하다. 새로운 메시지 추가 시에 해당 그룹 채팅방에서만 출력되어 보여져야 하지만, 다른 그룹 채팅방에서 해당 메시지가 보여지는 오류가 발생해서 관련 오류를 해결하기 위해 "socket.leaveAll" 같은 메서드를 추가해 테스트를 진행한 결과, 메시지 출력과 관련된 오류는 해결이 되지만 알림과 관련된 이벤트 소켓이 작동하지 않는 문제가 발생하기 때문에 다른 방법으로 오류를 수정해 줘야 한다. 현재 예상되는 오류로 방 참여와 관련된 이벤트 내용이 중복되면서 메시지 출력에서도 오류가 생기는 것으로 예상이 되는데, 우선 프론트엔드에서 emit이 아닌, on으로 구성되어 방 참여가 가능한 지 확인을 해보고 만약 가능하다면 off 내용을 추가해 문제가 없는지 테스트해 봐야 하고, 이 방법이 안된다면 다른 방으로 이동할 때 이전 방은 나가고 다른 방으로 참여하도록 로직을 추가해 테스트해 봐야 할 것 같다.

- 메시지 추가 시에 정확히 어떤 방식으로 오류가 발생하고, 어떤 상황에서는 오류가 없는지 정리가 좀 필요하다고 생각이 되며, 그룹 채팅방으로 이동한 후에 홈으로 이동하면 현재 참여한 그룹 채팅방이 초기화되지 않아서 새로운 메시지 관련 알림이 안넘어오기 때문에 이 부분도 수정이 필요하다. 이 내용은 새로운 메시지 추가 시에 해당 그룹 채팅방에 접속한 사용자를 제외하고 알림을 전송하는 로직과 관련되어 있는데, 해당 내용은 그룹 채팅방에 한 번 접속해버리면 알림이 전송되지 않기 때문에 추가 수정이 필요하다.

<br />

# 내일 할 일

- 실시간 통신 애플리케이션 (Float Chat) 프로젝트 진행

- Zustand 내용 구성

- socket.leaveAll() 내용으로 connect 액션 내부에 구성된 알림 관련 이벤트 소켓이 모두 작동하지 않는지 확인이 필요

- 그룹 채팅방 제목 수정과 관련된 실시간 반영이 되는지 확인 필요

- 새로운 메시지 추가되었을 때 알림 뜨는 기능 (로그인하고, 방에 들어가지 않았어도 알림이 넘어오도록 수정해야 하며, 참여한 모든 방에 대해 알림 메시지가 넘어와야 한다고 생각은 하는데, 현재 참여한 채팅방을 제외하고 넘어오도록 하는 것도 고려를 해야 함)

- 친구 삭제했을 때 실시간 반영이 되도록 로직 구성 필요

- 친구를 삭제했을 때, 해당 친구와 관련된 그룹 채팅방 초대 메시지 삭제 필요

- 친구 관련된 내용에서 코드 정리 필요 (코드를 깔끔하게 보이도록 수정 필요)

- 그룹 채팅방에서 채팅 메시지가 추가되면 전역적으로 알 수 있도록 알림이 떠야 하고, 그 알림 관리를 소켓 Zustand에서 할 수 있도록 구성 필요

- 그룹 채팅방 초대하고 알림을 전송하는 기능에서, 로그인한 사용자가 아닌 친구에게 보내는 그런 구조로 작동되도록 수정이 필요 (비로그인 상태여도 상관이 없음 단순하게 친구한테 친구 요청하면 알림 메시지가 전달되어야 함)

- 추가된 친구와 대화를 나눌 수 있는 다이렉트 채팅방

<br />

# 앞으로 해야 할 일

- React, TypeScript 공부

- React 상태 관리 도구인 Zustand 공부

- 실시간 통신 애플리케이션 프로젝트 제작
