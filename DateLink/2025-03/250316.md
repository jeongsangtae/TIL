# 오늘 한 일

### React + TypeScript 프로젝트 제작 (React, TypeScript, ExpressJS, MongoDB로 만드는 실시간 통신 애플리케이션)

- Float Chat 프로젝트 구성중 발생한 에러 내용 추가 (key 중복 관련 에러 추가 정리)
  - key 중복 관련 에러 추가 내용을 정리
    - 발생한 에러에 대한 내용과 원인 추가
    - 해결한 방법과 추가로 내용 정리
  - [추가 내용](https://github.com/jeongsangtae/TIL/commit/740aee0800fa0320c0c582b3f8b519c28610f3aa)

<br />

- 그룹 채팅방 참여자에게 보낸 초대 메시지 관련 버튼 조건부 수정
  - 그룹 채팅방에 이미 참여한 사용자에게 그룹 채팅방 초대 요청을 전송하면, 그룹 채팅방 초대 메시지에 버튼이 수락 또는 거절로 보여지는데, 이 내용이 그룹 채팅방에 참여하고 있지 않을 때는 상관이 없지만 그룹 채팅방에 참여하고 있다면 참여중이라는 버튼이 보여지고, 해당 버튼 클릭 시에 참여한 방으로 이동되도록 내용을 수정
  - 백엔드
    - group-chat-routes
      - 그룹 채팅방 초대하는 POST 라우터 수정
        - 찾은 그룹 채팅방의 users 배열에 some을 사용해 조건에 맞는 요소가 존재할 경우 true, 아닐 경우 false를 반환하도록 내용 구성
          - some 메서드를 사용해 users 배열에 저장된 사용자 \_id 내용과 로그인한 사용자 \_id를 비교해 일치할 경우 true가 되며, 일치하지 않을 경우 false가 되도록 구성
        - DB에 저장되는 그룹 채팅방 초대 데이터의 status 항목 수정
          - 위에서 some 메서드를 통해 반환된 boolean 값을 확인해 true일 경우 "참여중"으로 저장하며, false일 경우 "보류"로 저장
  - 프론트엔드
    - groupChatStore
      - deleteGroupChat, leaveGroupChat 액션 수정
        - 실시간 반영되는 내용의 chat 부분이 명확하지 않은 것 같아서 groupChat으로 변경
    - DirectChats
      - GroupChatInviteList 컴포넌트에 status 내용을 props로 전달하도록 구성
    - GroupChatInvite
      - groupChatInviteHandler 함수 수정
        - 비동기 함수로 변경하고 타입 정의도 수정
        - 내부에서 사용되는 inviteGroupChat 액션 내용에 await 추가
    - GroupChatInviteList
      - useNavigate Hook을 가져오고 사용할 수 있도록 구성
      - status props를 전달받아서 사용할 수 있도록 구성
      - groupChatMoveHandler 함수 추가
        - navigate에 "/group-chat/${groupChatId}" 경로를 추가해 구성
        - 참여중 버튼 클릭 시에 해당 함수가 실행되며, navigate 내용에 구성한 경로로 이동됨
      - participant 변수 추가
        - props로 전달받은 status 내용이 "참여중"일 경우 true, 아닐 경우 false가 되도록 구성
        - JSX 코드 조건부에 사용됨
      - JSX 코드 수정
        - `!sendRequest && !participant`
          - 그룹 채팅방 초대 요청을 보낸 사용자가 아니며, 그룹 채팅방에 참여한 사용자가 아닐 경우에는 수락과 거절 버튼이 출력되도록 구성
        - `!sendRequest && participant`
          - 그룹 채팅방 초대 요청을 보낸 사용자가 아니며, 그룹 채팅방에 참여한 사용자일 경우에는 참여중 버튼이 출력되도록 구성
        - 참여중 버튼
          - onClick에 groupChatMoveHandler 함수를 추가해 실행되도록 구성
    - types
      - GroupChatInviteListProps 타입 정의 수정
        - status 속성을 추가하고 string으로 정의
  - 그룹 채팅방에 참여한 사용자에게 초대 메시지를 전송하면 수락과 거절 버튼 대신에 참여중 버튼이 보여지는 것을 확인했고, 해당 버튼 클릭 시에 참여한 그룹 채팅방으로 이동되는 것까지 문제없이 확인할 수 있었다.
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/c3705b5b33b7049cc0d403c40b2935acb7273ebd)

<br />

- 그룹 채팅방 삭제 실시간 반영 추가 (그룹 채팅방 참여자에 대한 실시간 반영)
  - 그룹 채팅방을 생성한 호스트가 그룹 채팅방을 삭제하면 호스트 화면에 실시간 반영되어 사라지는 것은 문제가 없었지만, 참여한 사용자 화면에는 실시간 반영이 되지 않기 때문에 호스트가 삭제 시에 참여한 사용자 화면에도 그룹 채팅방이 사라지도록 실시간 반영 내용을 추가
  - 백엔드
    - group-chat-routes
      - 그룹 채팅방 삭제하는 DELETE 라우터 수정
        - Socket.io 및 onlineUsers Map을 가져오도록 구성 추가
        - 그룹 채팅방에 참여한 사용자들을 대상으로 이벤트 리스터를 실행시키도록 구성
          - 찾은 그룹 채팅방 users 배열에 저장된 사용자 \_id 내용을 가져와 로그인한 사용자 목록 \_id와 일치하는 내용을 찾음
          - 찾은 내용이 유효할 때, groupChatDelete 이벤트 리스너에 roomId 내용을 전ㅅ몽
          - 사실상 실시간 알림 내용을 전송하는 내용
  - 프론트엔드
    - groupChatStore
      - getGroupChats 액션 수정
        - socket 관련 내용을 불러오고 사용할 수 있도록 구성
        - socket.off를 추가해 이벤트 리스너 중복 실행을 방지
        - socket.on 내용 추가
          - 백엔드 groupChatDelete 이벤트 리스너와 연결
          - groupChats에 filter를 사용해 그룹 채팅방 \_id와 이벤트 리스너로 넘어온 roomId를 비교하고, 일치하지 않는 항목만 남겨서 보여지도록 구성
          - 일치하는 항목은 걸러내서 안보이도록 구성
  - 그룹 채팅방 삭제 시에 참여한 사용자 화면에서도 실시간 반영되도록 내용을 구성하고 테스트한 결과, 정상적으로 반영되어 그룹 채팅방 목록에서 사라지는 것을 확인할 수 있었다.
    - 테스트 중간에 제대로 작동하지 않아서 포기해야 하나 싶었지만, 백엔드 이벤트 리스너에서 roomId 정보를 객체로 전달하고 있어서 해당 내용을 변경해 깔끔하게 해결이 됨
    - 한가지 추가 문제로, 그룹 채팅방에 참여한 사용자 화면에서 해당 그룹 채팅방이 사라지면 홈으로 돌아오지 않는 문제가 있어서 이 부분에 대한 처리가 좀 필요함
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/5ad00c4de55352bc76142328c53b326cb1bec2f1)

# 오늘 느낀 점

- 키 중복과 관련된 오류에 대해 추가로 정리를 해 주었고, 그룹 채팅방에 이미 참여한 사용자에게 초대 메시지를 전송하면 수락과 거절 버튼 대신에 참여중 버튼이 보여져서 해당 버튼 클릭 시에 그룹 채팅방으로 이동되도록 수정해 주었다. 그리고 그룹 채팅방을 호스트가 삭제했을 때, 참여한 사용자 화면에도 실시간 반영되어 해당 그룹 채팅방이 사라지도록 구성을 해 주었는데, 크게 문제없이 작동은 잘 되는 것을 확인했다. 하지만 추가 수정이 필요한데, 제거되는 그룹 채팅방에 있을 경우 홈으로 이동되지 않고 그대로 삭제된 그룹 채팅방에 남아있기 때문에 이 부분에 대한 처리를 해 주면 더 이상 수정할 필요는 없다고 생각이 된다. 그룹 채팅방에 참여하고 다시 그룹 채팅방 초대 메시지를 받은 후에 나가기 버튼을 클릭하면 방은 사라지지만, 다시 전달받은 그룹 채팅방 초대 메시지가 사라지지 않아서 참여중 상태로 보여지며 해당 버튼 클릭 시에 그룹 채팅방으로 이동이 되기 때문에 나가기 버튼 클릭 시에 해당 그룹 채팅방과 관련된 초대 메시지 내용 또한 함께 사라지도록 구성을 해 줘야 한다. 그리고 그룹 채팅방을 나간 사용자가 있을 경우, 해당 그룹 채팅방의 사용자 목록이 실시간으로 업데이트되도록 하는 내용도 추가할 수 있는지 테스트를 진행해 봐야 할 것 같다.

<br />

# 내일 할 일

- 실시간 통신 애플리케이션 (Float Chat) 프로젝트 진행

- Zustand 내용 구성

- 새로운 메시지 추가되었을 때 알림 뜨는 기능 (추가하긴 했으나, 미완성)

- 친구 관련된 내용에서 코드 정리 필요 (코드를 깔끔하게 보이도록 수정 필요)

- 그룹 채팅방에서 채팅 메시지가 추가되면 전역적으로 알 수 있도록 알림이 떠야 하고, 그 알림 관리를 소켓 Zustand에서 할 수 있도록 구성 필요

- 그룹 채팅방 초대하고 알림을 전송하는 기능에서, 로그인한 사용자가 아닌 친구에게 보내는 그런 구조로 작동되도록 수정이 필요 (비로그인 상태여도 상관이 없음 단순하게 친구한테 친구 요청하면 알림 메시지가 전달되어야 함)

- 추가된 친구와 대화를 나눌 수 있는 다이렉트 채팅방

<br />

# 앞으로 해야 할 일

- React, TypeScript 공부

- React 상태 관리 도구인 Zustand 공부

- 실시간 통신 애플리케이션 프로젝트 제작
