# 오늘 한 일

### React + TypeScript 프로젝트 제작 (React, TypeScript, ExpressJS, MongoDB로 만드는 실시간 통신 애플리케이션)

- 그룹 채팅방 사용자 목록 출력하는 부분 오류 수정 및 그룹 채팅방 사용자 목록 관련 타입 정의 추가
  - 그룹 채팅방에 참여한 사용자 목록이 정상적으로 출력되지 않고 오류로 다른 채팅방 사용자 목록이 출력되기 때문에 이와 관련된 오류를 수정해 주고, 그룹 채팅방 사용자 목록 상태와 관련된 내용에서 발생하는 타입 에러를 해결하기 위해 타입 정의를 추가
  - 백엔드
    - group-chat-routes
      - 그룹 채팅방에 참여한 사용자 목록을 불러오는 GET 라우터 수정
        - 그룹 채팅방에 참여한 사용자 목록을 불러올 때, 비밀번호를 제외하고 불러오도록 수정
        - projection을 추가해서 특정 필드를 제외하고 데이터를 가져오도록 구성
          - `{ projection: { password: 0 } }`을 추가
  - 프론트엔드
    - groupChatStore
      - groupChatUser 상태 타입 정의 수정
        - UserInfo 타입 정의에 Omit을 사용해 tokenExp를 제외한 모든 항목을 사용하도록 구성
      - getGroupChatUsers 액션 수정
        - 응답받는 데이터에 groupChatUsers 상태에서 했던 타입 정의와 동일하게 구성
        - Omit을 사용해 tokenExp를 제외한 모든 항목을 사용
    - GroupChatUsers
      - useEffect 수정
        - 의존성 배열로 roomId를 추가
        - 다른 그룹 채팅방 클릭 시에 useEffect가 다시 실행되어 해당 그룹 채팅방에 참여한 사용자 목록을 불러옴
      - JSX 코드
        - groupChatUsers.map에 구성된 ul, li 내용을 삭제하고 GroupChatUser 컴포넌트로 구성
          - key로는 \_id 내용을 사용
          - props로 nickname을 전달
          - GroupChatUser 컴포넌트를 사용하게 되면서, key prop 관련 에러도 사라짐
    - GroupChatUser
      - 재사용 타입 정의 파일에서 UserInfo 타입 정의를 불러오도록 구성
      - props로 전달받은 nickname을 사용할 수 있도록 구성하고 타입 정의
        - UserInfo 타입 정의에 Pick를 사용해 nickname 항목만 사용하도록 구성
      - JSX 코드
        - props로 전달받은 nickname 내용을 출력하도록 구성
  - useEffect에 roomId를 추가한 후 테스트하면, 다른 그룹 채팅방으로 이동 시에 채팅방에 참여한 사용자 목록이 정상적으로 출력되는 것을 확인할 수 있었고, 그룹 채팅방 사용자 목록에서 별도의 컴포넌트로 정보를 넘기고 출력하게 되면서 key prop 관련 에러도 발생하지 않는 것을 확인할 수 있었다.
    - 그룹 채팅방에 참여한 사용자 목록이 문제없이 출력되기 때문에, 이제 그룹 채팅방 삭제 시에 해당 그룹 채팅방과 관련된 채팅 메시지, 그룹 채팅방 초대 내용이 모두 함께 삭제되도록 수정해야 함
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/e02ea40ad2f3435c5e88d2228aa4e40f19ab49e4)

<br />

- 그룹 채팅방 초대 수락 실시간 반영 추가 및 그룹 채팅방 삭제 시에 채팅 메시지, 그룹 채팅방 초대 내용 함께 삭제되도록 수정
  - 그룹 채팅방 초대를 수락하면 해당 채팅방이 실시간 반영되어 그룹 채팅방 목록에 보여지도록 구성하고, 그룹 채팅방 삭제 시에 해당 채팅방에서 나눈 채팅 메시지, 그룹 채팅방 초대와 관련된 내용이 함께 삭제되도록 수정
  - 백엔드
    - group-chat-routes
      - 그룹 채팅방 삭제하는 DELETE 라우터 수정
        - chatMessages 컬렉션에서 roomId 항목과 roomId 내용을 비교해 일치하는 모든 항목을 삭제하도록 구성
          - 그룹 채팅방이 삭제되기 전에 저장되어 있던 채팅 메시지를 모두 삭제하도록 구성
        - groupChatInvites 컬렉션에서 roomId 항목과 roomId 내용을 비교해 일치하는 모든 항목을 삭제하도록 구성
          - 그룹 채팅방이 삭제되기 전에 저장되어 있던 그룹 채팅방 초대 수락 또는 보류 중인 내용을 모두 삭제하도록 구성
  - 프론트엔드
    - groupChatStore
      - getGroupChatUsers 액션 수정
        - 그룹 채팅방 초대를 수락하는 로직이 실행된 뒤에, 그룹 채팅방 목록을 다시 가져오도록 구성해 실시간 반영 기능 추가
          - `await get().getGroupChat()`
  - 그룹 채팅방을 삭제하면 해당 그룹 채팅방에 저장된 채팅 메시지와 그룹 채팅방 초대 수락 또는 보류 관련된 내용이 함께 사라지는 것을 확인할 수 있었고, 그룹 채팅방 초대 수락 버튼을 클릭하면 즉시 실시간 반영되어서 화면에 수락한 그룹 채팅방 항목이 보여지는 것을 확인할 수 있었다.
    - 그룹 채팅방 삭제 시에 관련된 채팅 메시지와 그룹 채팅방 초대 내용도 함께 삭제되는 것은 문제가 없지만, 해당 그룹 채팅방을 생성한 호스트가 아닌 참여한 사용자도 삭제를 할 수 있기 때문에 이와 관련해서 수정을 해야 함
    - 그룹 채팅방에 참여한 일반 사용자는 채팅방을 삭제하는 것이 아닌 나가기 버튼으로 보여지고, 버튼 클릭 시에 users 배열에서 삭제되도록 구성하면 좋을 것 같고, 수정 버튼은 단순하게 보이지 않도록 구성해서 나가기 버튼만 보이도록 수정하면 될 것 같음
    - 그룹 채팅방 초대 수락 버튼을 클릭하면 즉시 반영되는 것은 좋지만, 현재 구조는 getGroupChatUsers 액션에 getGroupChats 액션을 포함시켜서 다시 실행되도록 구성한 상태인데, 이 구성보다 액션을 사용하는 함수에서 실행되도록 하면 의존성도 떨어지기 때문에 테스트를 해 봐야 함
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/5caffd7a3528d48eedc97ed1de2f1c643e26dc9a)

# 오늘 느낀 점

- 그룹 채팅방에 참여한 사용자 목록이 정상적으로 출력되도록 수정한 부분도 문제가 없고, 그룹 채팅방 삭제 시에 채팅 메시지와 그룹 채팅방 초대 내용이 함께 삭제되도록 구성한 부분도 문제가 없으며, 그룹 채팅방 초대 수락 버튼을 클릭하면 해당 채팅방이 실시간으로 그룹 채팅방 목록에 추가되어 보여지는 것을 확인했다. 구성한 내용들이 작동하는데 문제가 없긴 하지만, 내부 로직이나 다른 부분에서 조금씩 문제가 있어서 추가 수정이 필요한 상황으로, 그룹 채팅방 삭제 관련된 내용은 호스트만 삭제할 수 있도록 변경이 필요하고, 일반 참여자는 그룹 채팅방을 삭제하는 것이 아닌 나가기 기능으로 보여지며 클릭 시에 해당 그룹 채팅방을 나가도록 구성해 줘야 한다. 수정 버튼도 있긴 하지만, 이 수정 버튼은 일반 참여자 화면에서는 보이지 않도록 조건부를 추가하면 해결될 것으로 예상된다. 추가로 그룹 채팅방이 삭제되면 해당 채팅방 URL에 계속 머무르는 것이 아닌, 홈 화면으로 이동해서 해당 그룹 채팅방이 그룹 채팅방 목록에서 보이지 않도록 구성해 줘야 할 것 같다. 그룹 채팅방 초대 수락과 관련된 실시간 반영 로직은 액션 내용에서 실행되는 것이 아닌, 액션을 실행시키는 함수에 옮겨서 실행되도록 변경하고 테스트해 봐야 하며, 어떤 문제가 생기는지 확인이 필요하고 만약 문제가 없다면 따로 분리해 실행되도록 구성하는 쪽이 의존성도 낮추고 결합성도 낮추기 때문에 이 방법으로 변경을 해 줘야 할 것 같다.

<br />

# 내일 할 일

- 실시간 통신 애플리케이션 (Float Chat) 프로젝트 진행

- Zustand 내용 구성

- 그룹 채팅방을 삭제할 때, 그룹 채팅방에 저장한 모든 채팅 메시지도 함께 삭제되도록 로직 구성 필요

- 그룹 채팅방을 호스트만 삭제할 수 있도록 해야 하고, 그룹 채팅방에 참여한 다른 사용자는 그룹 채팅방 삭제가 아닌, 나가기 버튼이 보여져야 하며 수정 버튼은 보이지 않도록 수정 필요

- 새로운 메시지 추가되었을 때 알림 뜨는 기능 (추가하긴 했으나, 미완성)

- 친구 관련된 내용에서 코드 정리 필요 (코드를 깔끔하게 보이도록 수정 필요)

- 그룹 채팅방에서 채팅 메시지가 추가되면 전역적으로 알 수 있도록 알림이 떠야 하고, 그 알림 관리를 소켓 Zustand에서 할 수 있도록 구성 필요

- 그룹 채팅방 초대하고 알림을 전송하는 기능에서, 로그인한 사용자가 아닌 친구에게 보내는 그런 구조로 작동되도록 수정이 필요 (비로그인 상태여도 상관이 없음 단순하게 친구한테 친구 요청하면 알림 메시지가 전달되어야 함)

- 추가된 친구와 대화를 나눌 수 있는 다이렉트 채팅방

<br />

# 앞으로 해야 할 일

- React, TypeScript 공부

- React 상태 관리 도구인 Zustand 공부

- 실시간 통신 애플리케이션 프로젝트 제작
