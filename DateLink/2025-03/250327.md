# 오늘 한 일

### React + TypeScript 프로젝트 제작 (React, TypeScript, ExpressJS, MongoDB로 만드는 실시간 통신 애플리케이션)

- 친구 요청 실시간 반영 추가 (클릭한 사용자) 및 친구 수락 요청 실시간 반영 추가
  - 친구 요청 시에 받은 사용자만 실시간 반영되고 보낸 사용자는 실시간 반영되지 않기 때문에, 보낸 사용자 화면에서도 실시간 반영되도록 구성을 추가하고, 친구 요청을 수락하면 보낸 사용자와 받은 사용자 모두 실시간 반영되어 업데이트되도록 구성 추가
  - 백엔드
    - friend-routes
      - 친구 요청 수락하는 POST 라우터 수정
        - 로그인한 사용자 정보를 가져오도록 구성 추가
        - 요청을 보낸 사용자가 요청자인지, 받은 사람인지 판별하는 조건부 추가
          - 로그인한 사용자 \_id와 친구 요청에 저장된 requester를 비교
          - true일 경우, receiver 내용을 저장
          - false일 경우, requester 내용을 저장
        - socket.io 및 onlineUsers Map 가져오도록 구성 추가
        - 로그인한 사용자 목록 내용과 앞에서 찾은 사용자 \_id를 비교해 일치하는 사용자 socketId를 추출
        - socketId 내용이 유효할 때, acceptFriend 이벤트 리스너에 친구 요청 \_id 정보를 전달
          - friendRequestId 내용 전달
  - 프론트엔드
    - friendStore
      - loadFriendRequests 액션 수정
        - socket 관련 내용을 불러오고 사용할 수 있도록 구성
        - socket.off를 추가해 이벤트 리스너 중복 실행을 방지
        - socket.on 내용 추가
          - acceptFriend 이벤트를 통해 friendRequestId 내용을 전달받도록 구성
          - friendRequests 목록에 filter를 사용해 수락하는 항목을 제외하고 출력하도록 구성 추가
            - 친구 요청 \_id와 friendRequestId 내용을 비교해 일치하는 항목을 제외하고 출력
    - AddFriend
      - useFriendStore Zustand에서 loadFriendRequests 액션도 추가로 불러오도록 구성
      - addFriendHandler 함수 수정
        - sendFriendRequest 액션이 실행된 후에 loadFriendRequests 액션이 추가로 실행되어 버튼을 클릭한 사용자 화면에서도 실시간 반영되도록 구성
  - 친구 요청 시에 보낸 사용자도 실시간 반영되도록 구성을 해 주고, 친구 수락과 관련해서 보낸 사용자와 받은 사용자 모두 실시간 반영되도록 구성하고 테스트한 결과, 문제없이 작동되어 친구 요청 보내고 수락하는 내용들이 모두 실시간 반영되는 것을 확인할 수 있었다.
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/af500d5aee05e54ac954800a0fc9d8b8b5feeddb)

<br />

- 친구 거절 또는 취소 요청 실시간 반영 추가
  - 친구 요청을 거절 또는 취소했을 때, 클릭한 사용자와 상대방 화면에서 즉시 실시간 반영되어 보여지도록 로직 추가
  - 백엔드
    - friend-routes
      - 친구 요청 수락하는 POST 라우터 수정
        - 요청을 보낸 사용자가 요청자인지, 받은 사람인지 판별하는 조건부 수정
          - 로그인한 사용자 \_id에 toString 추가
          - 친구 요청에 저장된 requester에 toString을 추가해 비교
      - 친구 거절 또는 취소하는 DELETE 라우터 수정
        - 로그인한 사용자 정보를 가져오도록 구성 추가
        - 친구 요청 내용을 찾는 구성 추가
          - friendRequests 컬렉션 내용에 저장된 \_id와 new ObjectId로 변환된 friendRequestId를 비교해 일치하는 항목을 찾음
          - 찾은 내용이 유효한지 확인하는 조건부 포함
        - 요청을 보낸 사용자가 요청자인지, 받은 사람인지 판별하는 조건부 추가
          - 로그인한 사용자 \_id와 친구 요청에 저장된 requester를 비교
            - 정확히 비교될 수 있도록 비교하는 데이터에 toString을 추가
          - true일 경우, receiver 내용을 저장
          - false일 경우, requester 내용을 저장
        - socket.io 및 onlineUsers Map 가져오도록 구성 추가
        - 로그인한 사용자 목록 내용과 앞에서 찾은 사용자 \_id를 비교해 일치하는 사용자 socketId를 추출
        - socketId 내용이 유효할 때, rejectFriend 이벤트 리스너에 친구 요청 \_id 정보를 전달
          - friendRequestId 내용 전달
  - 프론트엔드
    - friendStore
      - loadFriendRequests 액션 수정
        - socket.off를 추가해 이벤트 리스너 중복 실행을 방지
        - socket.on 내용 추가
          - rejectFriend 이벤트를 통해 friendRequestId 내용을 전달받도록 구성
          - friendRequests 목록에 filter를 사용해 거절 또는 취소하는 항목을 제외하고 출력하도록 구성 추가
            - 친구 요청 \_id와 friendRequestId 내용을 비교해 일치하는 항목을 제외하고 출력
  - 친구 요청 거절 또는 삭제가 실시간 반영이 되도록 구성을 추가하고 테스트한 결과, 문제없이 작동되어서 친구 요청을 한 사용자가 취소를 누르면 상대방 화면에도 실시간 반영되고, 상대방이 거절 버튼을 클릭하면 친구 요청을 한 사용자 화면에서도 실시간 반영되어 사라지는 것을 확인할 수 있었다.
    - 그룹 채팅방 초대 목록과 관련된 내용에서 실시간 반영이 되지 않는 부분들이 많아서 이와 관련된 로직 구성이 필요
      - 그룹 채팅방 초대, 수락, 거절 관련된 실시간 반영 내용을 확인해 봐야 함
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/cf072e0c1ea0725c6660ec4f5c9282c586bec32b)

# 오늘 느낀 점

- 친구 요청, 수락, 거절, 취소 같은 친구 관련된 내용에 모두 실시간 반영을 추가했기 때문에 더이상 친구 관련 내용에서는 추가해 줄 필요가 없고, 그룹 채팅방 초대 관련된 내용에서는 일부만 추가되어 있기 때문에 전체적으로 내용을 테스트한 후에 실시간 반영이 안되는 부분을 추가해 구성해야 한다. 그룹 채팅방 초대 관련해서 실시간 반영 내용이 마무리된다면, 추가했던 내용을 전체적으로 확인하고 사용하지 않는 코드나 주석 처리된 코드, 테스트를 위해 추가했던 콘솔 로그 관련 내용을 정리해 줄 생각이다. 코드 정리까지 해 주면 친구, 그룹 채팅방 관련된 내용 마무리가 된 것 같아서 이제는 다이렉트 채팅방 관련 로직을 추가해 1:1로 대화할 수 있도록 구성해 줘야 하고, 다이렉트 채팅방 관련 라우터나 이동하는 방법 등 여러 내용에 대해서도 생각을 해 봐야 한다.

<br />

# 내일 할 일

- 실시간 통신 애플리케이션 (Float Chat) 프로젝트 진행

- Zustand 내용 구성

- 그룹 채팅방 초대, 수락, 거절 관련된 실시간 반영 내용 확인 필요 (초대는 실시간 적용 중, 수락과 거절 관련 실시간 반영되지 않고 있음)

- 친구 요청 보냈을 때, 대기 중 항목이 실시간으로 반영되지 않는 문제 (보낸 사용자가 실시간 반영이 되지 않고, 받은 사용자만 실시간 반영됨) // 해결함

- 친구 수락 시에도 클릭한 사용자만 실시간 반영되고, 상대방은 실시간 반영되지 않기 때문에 로직 구성 필요 // 해결

- 친구 거절 시에도 실시간 반영이 되는지 확인이 필요함 // 취소까지 해결

- 그룹 채팅방 메시지 관련된 오류 및 실시간 알림 관련 오류 등 추가했던 콘솔 로그, 테스트하고 주석 처리한 채로 사용하지 않는 내용들 정리 필요 (실시간 반영 내용 로직을 추가하고 한 번에 정리 예정)

- 친구 관련된 내용에서 코드 정리 필요 (코드를 깔끔하게 보이도록 수정 필요)

- 그룹 채팅방 초대하고 알림을 전송하는 기능에서, 로그인한 사용자가 아닌 친구에게 보내는 그런 구조로 작동되도록 수정이 필요 (비로그인 상태여도 상관이 없음 단순하게 친구한테 친구 요청하면 알림 메시지가 전달되어야 함)

- 추가된 친구와 대화를 나눌 수 있는 다이렉트 채팅방

<br />

# 앞으로 해야 할 일

- React, TypeScript 공부

- React 상태 관리 도구인 Zustand 공부

- 실시간 통신 애플리케이션 프로젝트 제작
