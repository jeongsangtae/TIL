# 오늘 한 일

### React 프로젝트 제작 (React, NodeJS, MongoDB로 만드는 미니 커뮤니티 플랫폼)

- 구성한 내용

  - 댓글 삭제 실시간 반영 로직 수정
    - 기존에 postId를 가져와서 댓글 삭제시에 postId를 확인하고 삭제를 진행했지만, 그 방법은 잘못된 방법으로 댓글의 \_id를 가져와서 확인하고 삭제가 되도록 수정해주었다.
    - 백엔드 구성
      - 프론트엔드에서 전달 받은 commentId를 `new ObjectId`로 변환하고, 댓글에서 \_id와 일치하는 commentId를 찾아서 삭제하도록 변경
    - 프론트엔드 구성
      - fetch 함수의 body를 통해서 commentId를 전달하도록 구성 추가
    - 이렇게 구성을 변경해서 삭제하려는 댓글을 백엔드와 프론트엔드에서 모두 삭제할 수 있게 되었다.
      - 테스트한 결과 정상적으로 백엔드와 프론트엔드 모두 삭제되는 것을 확인
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/c5f1c29663cac7d480d5ea91a3704421e84f8b58)

  <br />

  - CommentForm 컴포넌트를 재사용하도록 로직 구성 (댓글 추가와 수정에 사용할 계획)
    - 댓글 추가 로직을 CreateComment 컴포넌트에서 구성해 사용하고 있었지만 수정과 관련된 로직을 추가할 계획이기 때문에, 하나의 컴포넌트에서 재사용하면 좋다고 생각되어 내용 구성을 진행
      - 댓글 추가와 수정 작업을 CommentForm 컴포넌트 하나로 재사용해서 실행되도록 구성
      - 게시글 추가와 수정에서 구성한 것과 유사하게 하나의 컴포넌트로 실행되도록 해줘야 함
      - 수정과 관련된 로직은 추가하지 않고, 댓글 추가와 관련된 로직이 정상적으로 CommentForm을 통해서 진행되도록 내용 구성
    - 프론트엔드 구성
      - Comments 컴포넌트에서 CreateComment 컴포넌트에 prop을 전달해서 실행하는 구성을 주석처리하고, Commentform에 method prop과 onAddCommentData prop을 전달해서 실행되도록 변경
      - CommentForm 컴포넌트에서 기존의 CreateComment 컴포넌트의 코드를 가져와서 사용하고, 변경해야 할 내용과 추가해야 할 내용을 추가
        - fetch 함수의 method 부분은 동적으로 내용을 전달 받아서 사용되도록 구성을 변경
        - if문에서 response를 확인하고, else if를 사용해서 정상적인 응답과 어떤 method가 들어오냐에 따라 추가 작업이 이루어지도록 구성 추가
          - POST method가 들어온 경우, resData를 전달받아서 onAddCommentData에 상태 끌어올리기를 통해서 resData.newComment 내용을 전달
          - PATCH method가 들어온 경우는 아직 내용을 추가하지 않은 상태
    - 코드를 테스트해본 결과, 정상적으로 댓글이 추가되는 것을 확인했다.
      - CreateComment 컴포넌트에 있던 코드를 CommentForm에 옮기는 것은 문제없이 진행이 되었다.
    - 앞으로 추가해야 할 내용으로 수정과 관련된 로직 추가와 CommentForm 컴포넌트에서 수정과 관련된 내용을 전달 받았을 때 조금 다른 로직이 작동되어 실행되도록 구성을 해줘야 한다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/f2bf4ad8db9ba741955a42d5c6481cfc76bb0970)

  <br />

  - CommentForm 컴포넌트 POST method와 관련된 로직 완성 및 PATCH method와 관련된 로직 추가
    - CommentForm 컴포넌트를 통해 댓글 추가와 수정 두 가지 작업을 처리하기 위해 로직을 구성
      - 댓글 추가 로직에 대해서는 좀 더 보완을 하고, 수정 로직은 추가를 해주었다.
    - 백엔드 구성
      - router.patch를 추가하고 commentId를 프론트엔드에서 전달 받도록 구성
      - 프론트엔드에서 전달 받은 commentId를 new ObjectId를 사용해서 변환
      - 프론트엔드에서 입력한 내용인 content 내용과 업데이트한 시간으로 date를 업데이트
      - comments 컬렉션에서 댓글 \_id와 변환한 commentId를 확인해서 업데이트하도록 구성
    - 프론트엔드 구성
      - Comment 컴포넌트
        - useState를 추가하고 false로 초기 값을 설정해서 추가
        - 이벤트 핸들러 함수를 추가해서 수정 버튼이 클릭되었을 때 false가 true로 바뀌도록 내용을 구성
        - 수정 버튼을 클릭했을 때 false가 true로 바뀌면서 조건부 렌더링에 의해 CommentForm 컴포넌트가 보여지고, CommentForm 컴포넌트로 method와 commentData를 전달하도록 구성
          - method는 PATCH를 전달
          - commentData는 Comments 컴포넌트에서 prop으로 전달받은 content, commentId를 객체 디스트럭처링을 통해 구성하고 prop으로 전달
      - CommentForm 컴포넌트
        - fetch 함수에 사용되는 body 내용은 POST와 PATCH가 들어왔을 때 다르게 사용되기 위해서 변수를 사용해 구성해주었다.
          - POST가 들어올 때는 content 내용만 전달
          - PATCH가 들어올 때는 content와 commentId도 함께 전달하도록 if문을 사용해 따로 구성
        - textarea에 defaultValue를 추가하고, commentData 내용의 존재 여부에 따라 보여지는 내용이 다르도록 조건부 렌더링으로 구성
    - 백엔드와 fetch 함수에서 수정과 관련된 내용이 전달되었을 때 처리되는 로직을 구성했는데, 아직 수정과 관련된 테스트를 진행하지는 못했다.
      - 따로 CommentEdit이라는 컴포넌트를 추가해서 구성을 해야 한다고 생각을 하고 테스트를 진행하지 않았는데 생각해보니 굳이 필요 없다는 생각도 들어서 바로 테스트를 해볼 생각이다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/d12147fe9af096919f82017e331d7789baa23ba3)

<br />

- 추가 및 해결 해야 할 내용
  - 회원가입 form에서 잘못된 입력을 제출 했을 때, session에 데이터가 저장되는데, 기존의 session 데이터에서 업데이트되는 방식이 아닌 매번 제출할 때마다 새로운 session이 추가되고 있기 때문에 백엔드 코드에서 수정이 필요하다.
    - 계속 원인을 찾아보려고 이것저것 시도해보았지만 아직 어떤 코드가 정확히 원인인지 찾지 못해서 하나씩 천천히 테스트가 필요함
    - 일단 이걸 테스트 해보기전에 먼저 정상적으로 세션 만료가 되는지 확인해보았는데 정상적으로 세션 만료가 되기 때문에, 로그인을 먼저 구성해보고 정상적으로 로그인이 되는지 확인을 해보고 안된다면, session에 저장되는 부분을 다시 확인해봐야 할 것 같다는 생각
  - 로그인 후에, 새로고침 시 로그아웃 되어버리는 상황도 수정을 해야 함
    - 현재 로그인 한 후에, useEffect를 통해서 데이터를 확인하고 토큰이 유효하다면 정상적으로 로그인 유지는 되지만, 새로고침 시 깜빡거리면서 메인헤더가 변경되는 것이 보이기 때문에 이 부분을 수정할 수 있으면 수정할 생각이다.
  - 로그인을 유지하고 있을 때, token이 만료 시간에 가까워지면 자동으로 갱신되는 로직을 추가 해야 함
    - 대충 구성만 되어 있는 상태로, 좀 더 자세한 코드와 테스트가 필요함

# 오늘 느낀 점

- 댓글 삭제와 관련된 실시간 반영되는 로직을 수정해서 정상적으로 작동하는 것을 확인했고, 수정과 관련된 내용을 추가하기 전에 우선 하나의 컴포넌트에서 추가와 삭제 두 가지 작업을 재사용해서 사용할 수 있도록 내용 구성을 해주었다. 현재 추가와 관련된 로직 처리는 문제없이 작동하고 있고 수정과 관련된 내용도 구성은 했는데 아직 테스트해보지 못해서 테스트가 필요한 상황이다. 수정과 관련된 로직에서 따로 컴포넌트를 추가해서 내용 구성을 추가로 해줘야 한다고 생각했는데, 다시 생각해보니 굳이 하지 않아도 된다고 생각이 되어 바로 테스트를 진행해보고 다음 내용 구성으로 넘어갈 생각이다.

<br />

# 내일 할 일

- React 공부 및 React 프로젝트 조금씩 진행하기

<br />

# 앞으로 해야 할 일

- React, NextJS 공부

- React 프로젝트 제작
