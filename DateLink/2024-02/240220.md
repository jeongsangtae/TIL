# 오늘 한 일

### React 프로젝트 제작 (React, NodeJS, MongoDB로 만드는 미니 커뮤니티 플랫폼)

- 구성한 내용

  - 댓글 구조 추가
    - 코드를 구성하기 전에 우선 댓글과 관련된 구조를 추가했는데, 여기서 추가로 수정이 필요해보인다.
    - 댓글 추가, 댓글 수정, 댓글 전체가 보여지는 컴포넌트
      - 이전에 게시글 추가 및 수정과 마찬가지로 댓글도 하나의 컴포넌트로 관리할 수 있을 것 같아서 CommentForm이라는 컴포넌트도 추가해놓은 상태
      - CommentForm을 구성하기 전에, 우선 댓글 추가에서 댓글을 추가하는 로직을 구성해보고 코드를 옮겨서 작업해볼 생각이다.
    - 게시글 세부 페이지에서 댓글이 보여지도록 하기 위해서 PostDetails 컴포넌트에 Comments 컴포넌트 추가
    - 아직 구조만 짜보았기 때문에 코드를 구성해보고 이후에 구조가 바뀔 수도 있다.
    - 댓글은 react router에서 따로 router 페이지 구성을 하지 않을 예정으로, 댓글은 사실상 따로 페이지가 필요한 것이 아닌 게시글 세부 페이지에서 보여지는 내용이기 때문에 따로 react router 구성은 필요 없고, 컴포넌트로 구성할 생각이다.
      - 하지만 react router를 사용하고 있기 때문에, react router의 기능은 가져와서 사용할 수 있을 것 같다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/17a5010ce913f7f57cbdb354ab0dfb8e84df0c27)

  <br />

  - 댓글 추가하고 저장하는 로직 추가
    - Comments 컴포넌트에서 구성을 하려고 했으나, 일단은 CreateComment 컴포넌트에서 댓글 추가 로직부터 구현해보기 위해서 CreateComment 컴포넌트에서 로직을 구성
    - CreateComment 컴포넌트에서 댓글 내용을 입력하고, DB로 전달하는 로직 구현 (프론트엔드)
      - 댓글은 textarea를 통해서 입력하고, 입력한 내용은 useState에 저장되도록 구성
        - textarea에서 입력한 내용은 onChange를 통해서 변경된 내용이 useState에 저장된다.
      - useState에 저장된 내용은 submitHandler가 제출될 때, 함께 서버에 전달되도록 구성
      - submitHandler 구성
        - 우선 useRouteLoaderData를 통해서 가져온 게시글 정보에서 postId를 fetch 함수의 경로에서 사용
        - fetch 함수의 경로는 백엔드에서 구성한 댓글 추가 router 경로와 일치시켜준다.
        - fetch 함수 구성 내용
          - method는 "POST"로 구성
          - body에서는 content에 comment를 넣어서 구성, 즉 useState에 저장된 textarea의 내용을 전달하도록 구성
          - headers는 기존과 동일하게 구성
      - 댓글이 추가된 후에는 그대로 해당 게시글 세부 페이지에 머무를 수 있도록 구성
      - form에서는 onSubmit을 사용해서 등록 버튼을 클릭 시, submitHandler를 실행하도록 구성
        - textarea에서는 name에 "content"를 넣어주고, onChange 이벤트 핸들러를 사용해서 입력한 내용이 변화할 때마다, useState에 저장되도록 구성
          - name에서 "content"로 지정해서 사용하고 있는데 변경할 생각도 있음
    - 프론트엔드에서 전달 받은 댓글 내용을 저장하는 로직 구현 (백엔드)
      - 게시글 id인 postId를 가져오고, 현재 날짜 및 시간을 가져오는 로직 추가
      - findOne을 통해서 postId와 일치하는 게시글을 찾는다.
      - 프론트엔드에서 입력한 댓글 내용, 찾은 게시글의 고유 id인 \_id, 현재 날짜와 시간을 "comments"라는 콜렉션에 저장
        - 여기서 현재 날짜와 시간은 좀 더 간단하고, 간략하게 알아볼 수 있도록 구성
    - 프론트엔드에서 입력한 내용이 백엔드로 전달되고, 백엔드에서 어떤 게시글에서 댓글을 추가했는지 구분할 수 있도록 해당 게시글의 \_id, 그리고 댓글을 저장하는 시간을 따로 추가해서 DB에 저장하도록 구성해주었다.
    - 현재 입력한 내용이 DB에 저장되는 것을 확인했는데, 이제는 DB에 저장된 댓글의 내용이 게시글 세부 페이지에 보여지도록 해주는 부분을 구성해줘야 한다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/d7dedb67d9d282668803a74728f131bf0527bd7b)

<br />

- 추가 및 해결 해야 할 내용
  - 회원가입 form에서 잘못된 입력을 제출 했을 때, session에 데이터가 저장되는데, 기존의 session 데이터에서 업데이트되는 방식이 아닌 매번 제출할 때마다 새로운 session이 추가되고 있기 때문에 백엔드 코드에서 수정이 필요하다.
    - 계속 원인을 찾아보려고 이것저것 시도해보았지만 아직 어떤 코드가 정확히 원인인지 찾지 못해서 하나씩 천천히 테스트가 필요함
    - 일단 이걸 테스트 해보기전에 먼저 정상적으로 세션 만료가 되는지 확인해보았는데 정상적으로 세션 만료가 되기 때문에, 로그인을 먼저 구성해보고 정상적으로 로그인이 되는지 확인을 해보고 안된다면, session에 저장되는 부분을 다시 확인해봐야 할 것 같다는 생각
  - 로그인 후에, 새로고침 시 로그아웃 되어버리는 상황도 수정을 해야 함
    - 현재 로그인 한 후에, useEffect를 통해서 데이터를 확인하고 토큰이 유효하다면 정상적으로 로그인 유지는 되지만, 새로고침 시 깜빡거리면서 메인헤더가 변경되는 것이 보이기 때문에 이 부분을 수정할 수 있으면 수정할 생각이다.
  - 로그인을 유지하고 있을 때, token이 만료 시간에 가까워지면 자동으로 갱신되는 로직을 추가 해야 함
    - 대충 구성만 되어 있는 상태로, 좀 더 자세한 코드와 테스트가 필요함

# 오늘 느낀 점

- 댓글을 추가하는 기능 로직을 구현하고 테스트해본 결과, DB에 정상적으로 저장되는 것을 확인할 수 있었다. 처음에 구성하고 테스트를 진행했을 때는 DB에 저장되긴 했지만 입력한 내용이 저장되지 않아서 당황했지만, 구성한 fetch 함수에서 잘못된 부분을 바로 찾아서 문제를 해결할 수 있었다. 이제는 DB에 저장된 댓글이 게시글 세부 페이지에서 보여지도록 해줘야 하는데, 여기서 모든 게시글에서 댓글이 전부 보여지는 것이 아닌, 댓글에 저장된 게시글의 \_id를 확인하고 \_id가 일치하는 게시글에서 해당 댓글이 보여지도록 구성을 해줄 생각이다. 추가로 \_id로 그대로 진행을 할 지, postId로 변경을 할 지 생각을 좀 해봐야 하는데 postId는 딱히 중복되는 문제가 생기지 않기 떄문에 postId도 괜찮아보여서 생각을 좀 해봐야 한다.

<br />

# 내일 할 일

- React 공부 및 React 프로젝트 조금씩 진행하기

<br />

# 앞으로 해야 할 일

- React, NextJS 공부

- React 프로젝트 제작
