# 오늘 한 일

### React 프로젝트 제작 (React, NodeJS, MongoDB로 만드는 미니 커뮤니티 플랫폼)

- 구성한 내용
  - 백엔드의 patch router와 프론트엔드의 patch method 함수를 연결 그리고 form의 작성자 부분 조건부 렌더링 추가
    - 프론트엔드의 action 함수에서 patch method가 들어왔을 때, 백엔드의 patch router가 작동하도록 하기 위해서 연결해주었다.
      - if문을 통해서 method에 PATCH가 들어온다면 url에 `params.postId`를 추가해주고, 뒤에 `/edit`을 함께 추가해주도록 구성해준다.
        - 이렇게 해주는 이유는 백엔드의 patch router 경로와 일치하도록 구성해야 하기 떄문이다.
      - 올바른 응답이 넘어오지 않는다면 오류 메시지를 전달하도록 구성
      - 프론트엔드의 react router 내용에서 수정과 관련된 router에 action 함수를 추가해서 내용을 변경하고 제출했을 때, action 함수가 작동하도록 해주었다.
    - form의 작성자 부분 조건부 렌더링
      - postData가 넘어오는 경우에는 DB에 저장되어 있는 이름 그대로 넘어와서 변경이 불가능하도록 구성해주고, postData가 넘어오지 않는 경우에는 게시글 생성 input의 내용이 보여지도록 구성해주었다.
    - 연결은 정상적으로 해주었는데, 백엔드의 patch router가 정상적으로 작동하지 않는 것 같은데 이 부분을 다시 확인해보고 코드를 변경해줘야 할 것 같다.
      - 게시글을 수정하고 제출하면 분명히 게시글 목록으로 redirect가 되지만, 변경된 내용이 DB에 저장되지도 않고 보이지도 않기 때문에 수정이 필요함
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/ca6d6ed6217addb1c66f267c382951ba7c1b32f0)

<br />

- 추가 및 해결 해야 할 내용
  - 회원가입 form에서 잘못된 입력을 제출 했을 때, session에 데이터가 저장되는데, 기존의 session 데이터에서 업데이트되는 방식이 아닌 매번 제출할 때마다 새로운 session이 추가되고 있기 때문에 백엔드 코드에서 수정이 필요하다.
    - 계속 원인을 찾아보려고 이것저것 시도해보았지만 아직 어떤 코드가 정확히 원인인지 찾지 못해서 하나씩 천천히 테스트가 필요함
    - 일단 이걸 테스트 해보기전에 먼저 정상적으로 세션 만료가 되는지 확인해보았는데 정상적으로 세션 만료가 되기 때문에, 로그인을 먼저 구성해보고 정상적으로 로그인이 되는지 확인을 해보고 안된다면, session에 저장되는 부분을 다시 확인해봐야 할 것 같다는 생각
  - 로그인이 되는지 확인하고, 로그인이 되었다면 메인헤더가 변경되도록 구성해야 함
    - `req.session.isAuthenticated`를 프론트엔드에 전달해서, useState를 이용해 메인헤더가 변경되도록 해주면 될 것 같음 (완료)
    - 현재 결과로 따지면 로그인도 되고, 메인헤더가 변경되긴 하지만 순환 참조 오류가 있어서 추가 작업이 필요함 (완료)
    - 로그인 시 `isAuthenticated` 정보가 MainHeader 컴포넌트로 넘어가서 useState에 true로 값이 저장되며, 해당 값을 사용해서 조건부 렌더링이 작동하도록 구성해서 순환 참조 오류없이 작동하도록 구성 (완료)
  - 로그인 후에, 새로고침 시 로그아웃 되어버리는 상황도 수정을 해야 함
    - 현재 로그인 한 후에, useEffect를 통해서 데이터를 확인하고 토큰이 유효하다면 정상적으로 로그인 유지는 되지만, 새로고침 시 깜빡거리면서 메인헤더가 변경되는 것이 보이기 때문에 이 부분을 수정할 수 있으면 수정할 생각이다.
  - 로그인을 유지하고 있을 때, token이 만료 시간에 가까워지면 자동으로 갱신되는 로직을 추가 해야 함
    - 대충 구성만 되어 있는 상태로, 좀 더 자세한 코드와 테스트가 필요함

# 오늘 느낀 점

- 처음에 if문을 추가하고 patch method가 넘어왔을 때 다른 url이 작동하도록 하는 코드를 추가하고 테스트를 진행했는데, 오류가 발생해서 확인해보니 react router의 수정과 관련된 router에서 action 함수를 추가하지 않아서 수정 페이지에서 정상적으로 action 함수가 작동하지 않았고, 추가 한 후에 다시 테스트 해보니 이번에는 params를 추가하지 않아서 해당 url이 정상적으로 읽히지 않았고, 또 이후에는 json을 import 하지 않아서 오류 발생, 백엔드의 patch router 경로와 프론트엔드에서 patch method로 들어왔을 때 url 경로를 일치시키지 않아서 오류가 발생했다. 이렇게 로직에서 하나씩 빼먹는 실수로 오류가 발생해서 좀 더 신경써서 코드를 구성해야 한다고 반성하게 되었다. 물론 오류를 확인하고 무엇이 문제였는지, 빠졌는지 바로 찾기는 했지만 그래도 오류가 발생하기 전에 미리 꼼꼼하게 코드를 구성하고 진행하면 더 좋을 것 같다는 생각이 든다.

<br />

# 내일 할 일

- React 공부 및 React 프로젝트 조금씩 진행하기

<br />

# 앞으로 해야 할 일

- React, NextJS 공부

- React 프로젝트 제작
