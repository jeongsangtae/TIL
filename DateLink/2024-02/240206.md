# 오늘 한 일

### React 프로젝트 제작 (React, NodeJS, MongoDB로 만드는 미니 커뮤니티 플랫폼)

- 구성한 내용

  - 주석으로 처리한 코드 정리 및 로그인한 사용자 이름 콘솔에 뜨도록 테스트
    - 주석으로 처리한 쓰지 않는 코드들은 삭제를 해주었다.
      - 이전에 테스트해보고 확인해본 코드들이기 때문에 보이는 부분은 일단 삭제를 진행해주었다.
    - 백엔드에서 넘어오는 로그인한 사용자 데이터가 정상적으로 useState에 저장되지 않는 것 같아서 확인하기 위해서 console.log로 확인
      - 확인해보니 사용자 데이터 하나만 json을 통해서 넘어오고 있는데 객체 형식으로 데이터를 찾으려고 했기 때문에 문제가 발생했다. 그래서 객체 형식으로 특정 내용을 console.log하는 것이 아닌, 전체 응답 받은 데이터를 console.log로 진행해서 확인하니 문제가 없었다.
      - resData를 console.log로 테스트 해본 결과 정상적으로 로그인한 사용자의 정보를 얻을 수 있었고, 해당 데이터를 프로필 페이지에서 어떤 식으로 보이게 해줘야 하는지 내용 구성을 추가해야 한다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/fd8d1ef18c8be476a3779112736c93d27c5f6138)

  <br />

  - 프로필에 로그인한 사용자의 이름이 보이도록 내용 추가
    - 우선 프로필에 로그인한 사용자의 이름을 보이도록 하기 위해서 여러 가지 방법을 생각했음
      - 첫 번째, 단순하게 NavLink를 통해서 MainHeader에서 이미 가져온 로그인한 사용자 정보를 prop으로 전달하려고 했으나, 이 방법은 실패
        - NavLink로 prop을 전달할 수는 없기 때문에 이 방법은 불가능하다.
      - 두 번째, 로그인한 사용자 정보를 가져오는 fetch 함수를 loader 함수로 구성해서 어디에서나 불러와서 사용할 수 있게 하는 방법을 생각
        - 이 방법이 괜찮을 수 있다고 생각이 되었는데 아직 테스트는 해보지 못했음
        - 현재 useEffect에서 fetch 함수를 사용해서 해당 정보를 가져오고 있기 때문에 따로 loader 함수를 구성하고 useEffect에서는 해당 loader 함수의 내용을 불러와서 사용이 가능한 지 확인이 필요함
        - MainHeader는 전체 라우트 페이지에 포함이 되어 있기 때문에 괜찮은 방법이라고 생각이 되어, 사용하는 방향으로 생각중인데 테스트를 해봐야 정확히 판단이 될 것 같다.
      - 세 번째, 현재 사용하고 있는 방법으로 profile이라는 router를 따로 백엔드에서 추가하고 login/success router와 같은 내용의 코드를 구성한 후에, 프론트엔드의 Profile 컴포넌트에서 useEffect를 사용하고 fetch 함수를 통해서 profile router를 가져와서 useState에 로그인한 사용자 정보를 저장한 후에, 사용자의 이름을 프로필 페이지 내용에서 보이도록 구성했다.
        - 이 방법은 정상적으로 작동은 하지만, 아무래도 코드 중복이 백엔드와 프론트엔드 모두 있기 때문에 두 번째 방법을 테스트해서 문제 없이 작동한다면 변경해줄 생각이다.
        - 불필요하게 같은 코드를 여러 곳에서 사용하면 좋지 않다고 생각이 되기 때문에 수정하는 쪽으로 생각하고 있다.
    - 프로필 페이지에서 로그인한 사용자의 이름이 보여지는 것은 문제없이 처리를 했지만, 코드의 내용이 중복되는 부분도 많고, 생각해보면 login/success router 하나로 여러 곳에서 사용할 수 있다고 생각되어, login/success router로 내용 구성을 다시 해볼 생각이다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/2675214dbacea36b44cc66d1fb0ed0c994767bda)

<br />

- 추가 및 해결 해야 할 내용
  - 회원가입 form에서 잘못된 입력을 제출 했을 때, session에 데이터가 저장되는데, 기존의 session 데이터에서 업데이트되는 방식이 아닌 매번 제출할 때마다 새로운 session이 추가되고 있기 때문에 백엔드 코드에서 수정이 필요하다.
    - 계속 원인을 찾아보려고 이것저것 시도해보았지만 아직 어떤 코드가 정확히 원인인지 찾지 못해서 하나씩 천천히 테스트가 필요함
    - 일단 이걸 테스트 해보기전에 먼저 정상적으로 세션 만료가 되는지 확인해보았는데 정상적으로 세션 만료가 되기 때문에, 로그인을 먼저 구성해보고 정상적으로 로그인이 되는지 확인을 해보고 안된다면, session에 저장되는 부분을 다시 확인해봐야 할 것 같다는 생각
  - 로그인이 되는지 확인하고, 로그인이 되었다면 메인헤더가 변경되도록 구성해야 함
    - `req.session.isAuthenticated`를 프론트엔드에 전달해서, useState를 이용해 메인헤더가 변경되도록 해주면 될 것 같음 (완료)
    - 현재 결과로 따지면 로그인도 되고, 메인헤더가 변경되긴 하지만 순환 참조 오류가 있어서 추가 작업이 필요함 (완료)
    - 로그인 시 `isAuthenticated` 정보가 MainHeader 컴포넌트로 넘어가서 useState에 true로 값이 저장되며, 해당 값을 사용해서 조건부 렌더링이 작동하도록 구성해서 순환 참조 오류없이 작동하도록 구성 (완료)
  - 로그인 후에, 새로고침 시 로그아웃 되어버리는 상황도 수정을 해야 함
    - 현재 로그인 한 후에, useEffect를 통해서 데이터를 확인하고 토큰이 유효하다면 정상적으로 로그인 유지는 되지만, 새로고침 시 깜빡거리면서 메인헤더가 변경되는 것이 보이기 때문에 이 부분을 수정할 수 있으면 수정할 생각이다.

# 오늘 느낀 점

- 프로필에서 우선 로그인한 사용자의 이름이 보여지도록 하는 것은 문제없이 작동했지만, 현재 구성한 내용으로는 뭔가 많이 부족하다는 생각과 불필요하게 코드를 중복해서 사용하고 있기 때문에 내용을 변경해줄 생각이다. 코드 중복을 피하고, 재사용하기 위해서 react router를 활용해야 한다고 생각하며, MainHeader가 RootLayout으로 구성이 되어있고 이 곳에 loader 함수를 추가하면 전체적으로 사용할 수도 있으며, 전체적으로 로그인한 사용자가 사용할 수 있는 페이지나 기능이 더 많기 때문에 여기에 loader 함수를 구성하면 될 것 같다는 생각도 들어서 테스트를 해볼 생각이다.

<br />

# 내일 할 일

- React 공부 및 React 프로젝트 조금씩 진행하기

<br />

# 앞으로 해야 할 일

- React, NextJS 공부

- React 프로젝트 제작
