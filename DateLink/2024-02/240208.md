# 오늘 한 일

### React 프로젝트 제작 (React, NodeJS, MongoDB로 만드는 미니 커뮤니티 플랫폼)

- 구성한 내용

  - 로그아웃 로직 수정 및 token 만료 시간 추가
    - 현재 로그아웃 시, cookie의 값을 빈 문자열로 만들어주고 있는데 이 방법 대신에 cookie에서 accessToken을 삭제하도록 내용을 변경했다.
      - 로그아웃을 했다면 깔끔하게 cookie를 비우는 것이 맞다고 생각되어 수정을 해주었는데, 이게 더 나은 방법인 것 같다.
    - accessToken과 refreshToken에 만료 시간을 추가
      - 기존의 accessToken과 refreshToken에는 secure와 httpOnly의 내용만 추가되어 있었지만, 만료 시간인 maxAge가 추가되어 있지 않아서 설정한 시간이 지나고 난 후에도 그대로 cookie에 남아있기 떄문에 만료 시간을 추가해서 설정한 시간이 지나면 없어지도록 구성해주었다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/8036ffb1c0fc1fdf60dc48ec015d6cabd2885d19)

  <br />

  - 로그아웃 로직 수정 2
    - 로그아웃을 시도 했을 때, accessToken만 삭제하고 refreshToken은 삭제하지 않기 때문에 이 내용을 추가해주었다.
      - 앞에서 추가를 해야 했지만 까먹고 추가하지 않아서 로그아웃 시 refreshToken도 함께 삭제되도록 구성
      - 로그아웃 과정에서 클라이언트 측에서는 accessToken와 refreshToken 모두 제거되도록 하는 것이 보안상 올바른 방식이라고 생각했기 때문에 추가
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/7c6d8ff0c6465591a21332a9d27342bdc506ce2d)

  <br />

  - accessToken 만료 시간을 모니터링하는 useEffect 로직 추가 (미완성 로직)
    - 현재 내가 구성한 jwt token인 accessToken과 refreshToken은 정해놓은 만료 시간이 지났을 때, 로그아웃 했을 때 삭제되도록 구성이 되어있는데 여기에 추가로 로그인을 유지하고 있는 상황에서 token을 갱신하는 것과 관련된 내용이 좀 부족한 것 같다는 생각이 들어서 token을 모니터링하면서 만료 시간 전에 갱신하도록 하는 그런 로직을 추가하려고 새로운 useEffect를 추가했다.
    - tokne을 모니터링하면서 자동으로 갱신하도록 하는 useEffect 로직을 어떤 방식으로 시작해야 할 지 몰라서 일단 chatGPT를 통해서 대충 구성을 해놓은 상태인데, 여기에서 내용을 추가해서 조금씩 테스트를 진행해봐야 한다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/93670900b055ec406e27628ccd21b31670f385a5)

<br />

- 추가 및 해결 해야 할 내용
  - 회원가입 form에서 잘못된 입력을 제출 했을 때, session에 데이터가 저장되는데, 기존의 session 데이터에서 업데이트되는 방식이 아닌 매번 제출할 때마다 새로운 session이 추가되고 있기 때문에 백엔드 코드에서 수정이 필요하다.
    - 계속 원인을 찾아보려고 이것저것 시도해보았지만 아직 어떤 코드가 정확히 원인인지 찾지 못해서 하나씩 천천히 테스트가 필요함
    - 일단 이걸 테스트 해보기전에 먼저 정상적으로 세션 만료가 되는지 확인해보았는데 정상적으로 세션 만료가 되기 때문에, 로그인을 먼저 구성해보고 정상적으로 로그인이 되는지 확인을 해보고 안된다면, session에 저장되는 부분을 다시 확인해봐야 할 것 같다는 생각
  - 로그인이 되는지 확인하고, 로그인이 되었다면 메인헤더가 변경되도록 구성해야 함
    - `req.session.isAuthenticated`를 프론트엔드에 전달해서, useState를 이용해 메인헤더가 변경되도록 해주면 될 것 같음 (완료)
    - 현재 결과로 따지면 로그인도 되고, 메인헤더가 변경되긴 하지만 순환 참조 오류가 있어서 추가 작업이 필요함 (완료)
    - 로그인 시 `isAuthenticated` 정보가 MainHeader 컴포넌트로 넘어가서 useState에 true로 값이 저장되며, 해당 값을 사용해서 조건부 렌더링이 작동하도록 구성해서 순환 참조 오류없이 작동하도록 구성 (완료)
  - 로그인 후에, 새로고침 시 로그아웃 되어버리는 상황도 수정을 해야 함
    - 현재 로그인 한 후에, useEffect를 통해서 데이터를 확인하고 토큰이 유효하다면 정상적으로 로그인 유지는 되지만, 새로고침 시 깜빡거리면서 메인헤더가 변경되는 것이 보이기 때문에 이 부분을 수정할 수 있으면 수정할 생각이다.
  - 로그인을 유지하고 있을 때, token이 만료 시간에 가까워지면 자동으로 갱신되는 로직을 추가 해야 함
    - 대충 구성만 되어 있는 상태로, 좀 더 자세한 코드와 테스트가 필요함

# 오늘 느낀 점

- 로그인을 유지하고 있을 때, token이 만료 시간에 가까워지면 자동으로 갱신이 되도록 해주는 내용이 굳이 필요한가 생각을 해보았는데, 솔직히 이게 엄청 필요한 지 조금 의문이었다. 다른 웹 사이트를 생각해보았을 때 보통 로그인을 한 상태에서 브라우저를 닫거나 로그아웃을 하지 않은 상태에서는 로그인이 거의 유지되는 것이 보통이었고, 일부 금융이나 국세청 같은 웹 사이트에서는 정해진 시간이 지나면 자동으로 로그아웃이 되거나 만약 로그인을 좀 더 유지하고 싶다면 연장하기 같은 버튼을 통해서 로그인을 더 유지하는 방식으로 구성이 되어 있었다. 물론 브라우저를 닫거나 로그아웃을 하지 않은 상태에서 계속 로그인이 유지되는 웹 사이트의 뒷면에서는 어떤 방식으로 작동하는 지 모두 알지는 못하지만, 내 생각에 커뮤니티 사이트 같은 경우에는 굳이 로그인 유지에 시간을 짧게 설정할 필요도 없고, 브라우저를 닫았을 때나 로그아웃을 했을 때, token이 사라지고 다시 로그인 했을 때 새로운 token을 발급 받는 방식이 나쁘지는 않다고 생각이 된다. 새로운 useEffect를 사용하는 것에 대해서 좀 더 고민이 필요하다고 생각도 되지만, 그래도 내용 구성을 한 번 해보는 것도 공부가 되기 때문에 부족한 내용을 추가해서 모니터링 하는 내용을 구성은 최대한 해볼 생각이다.

<br />

# 내일 할 일

- React 공부 및 React 프로젝트 조금씩 진행하기

<br />

# 앞으로 해야 할 일

- React, NextJS 공부

- React 프로젝트 제작
