# 오늘 한 일

### React 프로젝트 제작 (React, NodeJS, MongoDB로 만드는 미니 커뮤니티 플랫폼)

- 구성한 내용

  - 백엔드에서 내용을 수정해서 게시글 수정 오류 해결
    - 생각보다 간단한 오류였는데, 이전에는 게시글 번호인 postId를 가져와서 mongodb에서 사용하는 \_id를 찾으려고 해서 정상적으로 업데이트가 불가능했다.
    - 하지만 변경한 코드는 게시글 번호인 postId를 가져와서 확인하고 해당 게시글 번호의 내용을 `$set`을 통해서 업데이트하는 방식으로 처리해주었다.
    - 이렇게 구성함으로써 정상적으로 DB에서 데이터가 업데이트되고, 화면에서도 업데이트된 내용이 출력되는 것을 확인할 수 있었다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/fcb9f11a79d5d0276d0742fdb20745af4e6e3fb2)

  <br />

  - 게시글 삭제 로직 추가 (미완성)
    - 게시글 삭제 로직을 테스트 했으나, 정상적으로 작동하지 않아서 로직을 수정해야 한다.
    - 게시글 삭제 로직을 구성하는데 두 가지 방법을 생각했다.
      - 첫 번째는 버튼을 클릭해서 이벤트 핸들러 함수 안의 fetch 함수가 동작해서 삭제하는 방법
      - 두 번째는 버튼 클릭 시, action 함수로 구성한 내용이 작동해서 삭제되는 방식
    - 두 가지 방법 중에서 첫 번째 방법을 선택해서 구성
      - 두 번째 방법을 사용하면, react router에서 action에 대한 내용을 추가하고, 여기에서 element를 추가해야 하는데 element를 어떤 방식으로 구성해야 할 지 제대로 생각해내지 못해서 첫 번째 방법을 선택하게 되었다.
      - 백엔드에서 삭제와 관련된 API 내용을 추가
        - router.post로 구성
        - 게시글에서 해당되는 postId를 찾고, 그 postId에 맞는 게시글을 삭제
          - 게시글 삭제하는 코드가 빠져있는 것을 확인
        - 삭제된 후에 삭제한 게시글의 번호가 비어있게 되기 때문에 번호가 비어있지 않도록 삭제한 게시글 뒤에 있는 게시글의 번호들을 1씩 감소하도록 구성
          - `$inc` 부분의 내용이 잘못 구성되었음 postId를 사용해서 구성해야 함
          - `$gt` 부분도 혹시 모르니 다시 한 번 확인이 필요함
      - 프론트엔드에서 postDeleteHandler를 추가해서 fetch 함수 내용을 구성
        - `useRouteLoaderData`를 통해서 가져오는 게시글 정보에서 postId를 가져오고, 해당 postId을 사용해서 백엔드 API 경로와 일치하도록 fetch 함수 url을 구성
        - 그 외에 내용은 기존의 내용과 동일
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/f7eb90cc447a016c4335e12ba26021ec735d45e0)

<br />

- 추가 및 해결 해야 할 내용
  - 회원가입 form에서 잘못된 입력을 제출 했을 때, session에 데이터가 저장되는데, 기존의 session 데이터에서 업데이트되는 방식이 아닌 매번 제출할 때마다 새로운 session이 추가되고 있기 때문에 백엔드 코드에서 수정이 필요하다.
    - 계속 원인을 찾아보려고 이것저것 시도해보았지만 아직 어떤 코드가 정확히 원인인지 찾지 못해서 하나씩 천천히 테스트가 필요함
    - 일단 이걸 테스트 해보기전에 먼저 정상적으로 세션 만료가 되는지 확인해보았는데 정상적으로 세션 만료가 되기 때문에, 로그인을 먼저 구성해보고 정상적으로 로그인이 되는지 확인을 해보고 안된다면, session에 저장되는 부분을 다시 확인해봐야 할 것 같다는 생각
  - 로그인이 되는지 확인하고, 로그인이 되었다면 메인헤더가 변경되도록 구성해야 함
    - `req.session.isAuthenticated`를 프론트엔드에 전달해서, useState를 이용해 메인헤더가 변경되도록 해주면 될 것 같음 (완료)
    - 현재 결과로 따지면 로그인도 되고, 메인헤더가 변경되긴 하지만 순환 참조 오류가 있어서 추가 작업이 필요함 (완료)
    - 로그인 시 `isAuthenticated` 정보가 MainHeader 컴포넌트로 넘어가서 useState에 true로 값이 저장되며, 해당 값을 사용해서 조건부 렌더링이 작동하도록 구성해서 순환 참조 오류없이 작동하도록 구성 (완료)
  - 로그인 후에, 새로고침 시 로그아웃 되어버리는 상황도 수정을 해야 함
    - 현재 로그인 한 후에, useEffect를 통해서 데이터를 확인하고 토큰이 유효하다면 정상적으로 로그인 유지는 되지만, 새로고침 시 깜빡거리면서 메인헤더가 변경되는 것이 보이기 때문에 이 부분을 수정할 수 있으면 수정할 생각이다.
  - 로그인을 유지하고 있을 때, token이 만료 시간에 가까워지면 자동으로 갱신되는 로직을 추가 해야 함
    - 대충 구성만 되어 있는 상태로, 좀 더 자세한 코드와 테스트가 필요함

# 오늘 느낀 점

- TIL을 작성하면서 코드를 다시 보았는데 왜 게시글 삭제 로직이 정상적으로 작동하지 않았는지 알게 되었는데, 깃허브에 올린 코드를 확인해보니 백엔드에서 게시글 삭제와 관련된 로직의 내용에서 빼먹은 내용과 수정하지 않은 내용이 있어서 정상적으로 작동하지 않고 있었다. 해당 내용을 정상적으로 추가하면 작동될 것 같다는 생각이 드는데, 내일 바로 수정해서 다시 테스트를 해볼 생각이다. 그리고 action 함수를 사용하는 방법도 가능할 것 같은데, router.post 대신에 router.delete를 사용하면 가능할 것 같다는 생각이 들었다. 백엔드의 API 경로와 프론트엔드의 fetch 함수 경로를 게시글 세부 페이지로 연결해주면 가능할 것 같다는 생각이 들어 내일 두 번째 방법인 action 함수를 활용하는 방법도 테스트해볼 생각이다.

<br />

# 내일 할 일

- React 공부 및 React 프로젝트 조금씩 진행하기

<br />

# 앞으로 해야 할 일

- React, NextJS 공부

- React 프로젝트 제작
