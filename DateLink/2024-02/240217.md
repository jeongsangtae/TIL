# 오늘 한 일

### React 프로젝트 제작 (React, NodeJS, MongoDB로 만드는 미니 커뮤니티 플랫폼)

- 구성한 내용

  - 게시글 삭제 로직 오류 해결
    - 백엔드에서 구성한 게시글 삭제와 관련된 router에 생각보다 빠져있는 부분과 잘못 구성해놓은 부분이 있어서 수정을 해주었다.
      - 경로에서 id를 postId로 수정
      - 게시글을 삭제하는 로직 추가
      - 게시글 삭제 후에, postId의 번호가 비어있지 않게 삭제한 게시글 뒤에 있는 게시글의 번호들을 1씩 감소하도록 구성
      - 백엔드에서 redirect를 동작하는 것이 아닌, json을 전달하도록 변경
    - 프론트엔드의 게시글 삭제 버튼과 관련된 이벤트 핸들러 내용 수정
      - async-await 추가
      - redirect를 추가해서 삭제 후에 게시글 목록으로 이동하도록 내용 추가
    - 삭제는 정상적으로 이루어지지만, 문제는 삭제 후에 redirect를 통해서 페이지 이동이 되지 않기 때문에 이 부분을 확인해줘야 한다.
      - react router dom의 redirect가 작동하지 않아서, action 함수를 사용해서 내용을 구성하고 redirect를 사용하게 해줘야 한다.
        - redirect hook은 react router dom에서 사용되기 때문에, 일반 함수에서는 사용할 수 없다.
      - `window.location.href = "/posts";`
        - 이 코드를 사용해서 redirect 할 수 있지만, action 함수로 게시글을 삭제하고 페이지 이동이 가능하도록 변경해볼 생각이다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/4907b7b60516167c736ccc7d2d83370f99657c5f)

  <br />

  - 게시글 삭제 로직 변경
    - 기존에 구성한 게시글 삭제 로직을 모두 주석 처리하고 action 함수를 사용한 코드로 변경해서 테스트
      - 백엔드에서 게시글 삭제와 관련된 로직에서 `router.post` 대신에 `router.delete`를 사용하고, 경로에서 `/delete`를 삭제해서 구성
      - 프론트엔드에서 이벤트 핸들러 함수를 사용해서 구성한 로직을 action 함수에 옮겨서 테스트
        - 테스트 하기 전에 react router를 관리하는 main.jsx의 PostDetailsPage에서 action 함수를 추가
      - 테스트 해본 결과 오류가 발생하고 정상적으로 작동하지 않아서 확인해보니, PostDetailPage에서 action 함수를 사용하도록 구성해놓고, PostDetail에서 action 함수를 추가하고 테스트해서 오류가 발생함
      - PostDetailPage로 action 함수를 옮겨서 테스트해본 결과, 오류가 발생하지는 않지만 정상적으로 게시글이 삭제되지 않아서 추가 작업이 필요함
    - action 함수가 정상적으로 작동하지 않아서 삭제가 되지 않는 것 같아서, action 함수를 실행할 방법이 필요하다고 생각이 되는데, 이 방법을 찾아야 할 것 같다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/205698520f23acf3724c3f3db950aa94cbffb2d1)

<br />

- 추가 및 해결 해야 할 내용
  - 회원가입 form에서 잘못된 입력을 제출 했을 때, session에 데이터가 저장되는데, 기존의 session 데이터에서 업데이트되는 방식이 아닌 매번 제출할 때마다 새로운 session이 추가되고 있기 때문에 백엔드 코드에서 수정이 필요하다.
    - 계속 원인을 찾아보려고 이것저것 시도해보았지만 아직 어떤 코드가 정확히 원인인지 찾지 못해서 하나씩 천천히 테스트가 필요함
    - 일단 이걸 테스트 해보기전에 먼저 정상적으로 세션 만료가 되는지 확인해보았는데 정상적으로 세션 만료가 되기 때문에, 로그인을 먼저 구성해보고 정상적으로 로그인이 되는지 확인을 해보고 안된다면, session에 저장되는 부분을 다시 확인해봐야 할 것 같다는 생각
  - 로그인이 되는지 확인하고, 로그인이 되었다면 메인헤더가 변경되도록 구성해야 함
    - `req.session.isAuthenticated`를 프론트엔드에 전달해서, useState를 이용해 메인헤더가 변경되도록 해주면 될 것 같음 (완료)
    - 현재 결과로 따지면 로그인도 되고, 메인헤더가 변경되긴 하지만 순환 참조 오류가 있어서 추가 작업이 필요함 (완료)
    - 로그인 시 `isAuthenticated` 정보가 MainHeader 컴포넌트로 넘어가서 useState에 true로 값이 저장되며, 해당 값을 사용해서 조건부 렌더링이 작동하도록 구성해서 순환 참조 오류없이 작동하도록 구성 (완료)
  - 로그인 후에, 새로고침 시 로그아웃 되어버리는 상황도 수정을 해야 함
    - 현재 로그인 한 후에, useEffect를 통해서 데이터를 확인하고 토큰이 유효하다면 정상적으로 로그인 유지는 되지만, 새로고침 시 깜빡거리면서 메인헤더가 변경되는 것이 보이기 때문에 이 부분을 수정할 수 있으면 수정할 생각이다.
  - 로그인을 유지하고 있을 때, token이 만료 시간에 가까워지면 자동으로 갱신되는 로직을 추가 해야 함
    - 대충 구성만 되어 있는 상태로, 좀 더 자세한 코드와 테스트가 필요함

# 오늘 느낀 점

- 게시글 삭제 로직이 작동하도록 수정해주고 테스트 해본 결과 정상적으로 작동하는 것을 확인했다. 하지만 삭제 후에 redirect 하는 부분에서 제대로 작동하지 않아서 확인해보니 react router dom에서만 redirect hook을 사용할 수 있어서 다른 방법으로 redirect 되도록 구성을 해야 했다. redirect 할 수 있는 다른 방법을 찾긴 했지만 이건 이렇게 작동시키면 react와 react router를 사용하는 의미가 없다고 생각이 되어, 최대한 react 그리고 react router를 활용할 수 있는 방법으로 구성하는 것이 맞다고 생각이 되기 때문에 action 함수를 활용해서 게시글을 삭제하고, 이후에 redirect hook이 작동되어 페이지 이동이 되도록 구성할 생각이다.

<br />

# 내일 할 일

- React 공부 및 React 프로젝트 조금씩 진행하기

<br />

# 앞으로 해야 할 일

- React, NextJS 공부

- React 프로젝트 제작
