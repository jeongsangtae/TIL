# 오늘 한 일

### React 프로젝트 제작 (React, NodeJS, MongoDB로 만드는 미니 커뮤니티 플랫폼)

- 구성한 내용

  - accessToken, refreshToken 만료 시간 변경
    - 토큰의 만료 시간을 모니터링하는 내용에 대해 많이 고민해본 결과, 일반적인 웹 사이트에서는 실시간으로 토큰의 만료 시간을 모니터링하고 갱신하는 것이 굳이 필요없다고 생각이 되어, 사용자가 로그인을 유지한 상태에서 정해진 만료 시간이 지나면 토큰이 만료되고, 이에 따라 사용자는 다시 로그인하는 그러한 구조를 유지하기로 결정했다.
      - 금융이나 특별한 개인정보가 필요한 웹 사이트가 아니기 때문에 토큰의 유효 시간을 너무 짧게 설정할 필요도 없고, 실시간으로 토큰을 모니터링해서 갱신할 필요성을 못 느꼈다.
    - 실시간 모니터링 로직을 추가하지 않는 대신에 토큰들의 만료 시간을 변경해서 로그인을 했을 때 좀 더 오래 유지되도록 해주었다.
      - accessToken은 1시간으로 만료 시간을 설정해주었고, refreshToken은 12시간으로 만료 시간을 설정해주었다.
      - 이제는 로그인을 1시간 동안 유지할 수 있고, 1시간이 지난 후에는 accessToken이 폐기되어 삭제되며, 다시 로그인 했을 때 새로운 accessToken을 발급받게 된다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/80e51d5cc6b9862a6ed36fe792d5b94210598f94)

  <br />

  - 게시글 수정 페이지와 관련된 내용 및 게시글 세부 페이지와 관련되 내용 변경
    - 게시글 수정과 관련된 컴포넌트를 추가하고, 게시글 수정 페이지 라우트를 추가해준 후에 연결해주었다.
      - 게시글 수정 컴포넌트에서 보여지는 내용은 단순하게 텍스트만 출력하고 있지만, 추가해야 할 내용으로 게시글 작성할 때 보여지던 form이 보여지고 해당 게시글의 내용이 들어있도록 해줘야 한다.
    - 프론트엔드 라우트를 관리하는 main.jsx에서 PostDetailsPage 내용을 수정하고 PostEditPage를 추가
      - 게시글 수정 페이지는 게시글 세부 페이지의 내용을 그대로 가져와서 변경할 수 있다고 생각이 되기 때문에 게시글 세부 페이지의 자식 라우트로 구성을 해주었다.
      - 자식 라우트로 설정하기 전에, 게시글 세부 페이지의 loader 함수를 사용하도록 구성하기 위해서 id를 추가해서 "post-detail"로 구성
        - id를 추가하는 이유는 loader가 없는 라우트에서 더 높은 수준의 loader에 액세스할 수 있게 해주기 위함이다.
      - PostDetailPage는 index를 true로 설정해서 게시글 세부 페이지의 기본 라우트가 되며, PostEditPage는 하위 라우트로 구성을 해주었다.
    - 게시글 세부 페이지에서 id를 추가해서 사용하고 있기 때문에, 게시글 세부 페이지와 관련된 컴포넌트에서 loader 함수를 불러오기 위해서 useLoaderData가 아닌, useRouteLoaderData를 사용하도록 변경
      - 기존의 useLoaderData 대신에 useRouteLoaderData를 사용하는데, 조금 다른 것이 있다면 useRouteLoaderData는 routeId를 인자로 받는다.
        - 이 경우 앞에서 구성한 id 프로퍼티에 작성한 "post-detail"가 routeId가 된다.
      - 게시글 세부 페이지만이 아닌, 게시글 수정 페이지 또한 useLoaderData 대신에 useRouteLoaderData를 사용해야 한다.
        - 게시글 수정 페이지 또한 useRouteLoaderData에 지정한 id인 "post-detail"을 사용해야 한다.
    - 게시글 세부 페이지에서 Link 컴포넌트를 추가해서 수정 페이지에 연결
      - 연결한 링크를 확인해보면 게시글 수정 페이지가 정상적으로 보여지는 것을 확인할 수 있고, URL 또한 "posts/:postId/edit"로 나오는 것을 확인할 수 있었다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/d6bc67d4c7eb3863c1dcc19cbc98b4242e95e850)

<br />

- 추가 및 해결 해야 할 내용
  - 회원가입 form에서 잘못된 입력을 제출 했을 때, session에 데이터가 저장되는데, 기존의 session 데이터에서 업데이트되는 방식이 아닌 매번 제출할 때마다 새로운 session이 추가되고 있기 때문에 백엔드 코드에서 수정이 필요하다.
    - 계속 원인을 찾아보려고 이것저것 시도해보았지만 아직 어떤 코드가 정확히 원인인지 찾지 못해서 하나씩 천천히 테스트가 필요함
    - 일단 이걸 테스트 해보기전에 먼저 정상적으로 세션 만료가 되는지 확인해보았는데 정상적으로 세션 만료가 되기 때문에, 로그인을 먼저 구성해보고 정상적으로 로그인이 되는지 확인을 해보고 안된다면, session에 저장되는 부분을 다시 확인해봐야 할 것 같다는 생각
  - 로그인이 되는지 확인하고, 로그인이 되었다면 메인헤더가 변경되도록 구성해야 함
    - `req.session.isAuthenticated`를 프론트엔드에 전달해서, useState를 이용해 메인헤더가 변경되도록 해주면 될 것 같음 (완료)
    - 현재 결과로 따지면 로그인도 되고, 메인헤더가 변경되긴 하지만 순환 참조 오류가 있어서 추가 작업이 필요함 (완료)
    - 로그인 시 `isAuthenticated` 정보가 MainHeader 컴포넌트로 넘어가서 useState에 true로 값이 저장되며, 해당 값을 사용해서 조건부 렌더링이 작동하도록 구성해서 순환 참조 오류없이 작동하도록 구성 (완료)
  - 로그인 후에, 새로고침 시 로그아웃 되어버리는 상황도 수정을 해야 함
    - 현재 로그인 한 후에, useEffect를 통해서 데이터를 확인하고 토큰이 유효하다면 정상적으로 로그인 유지는 되지만, 새로고침 시 깜빡거리면서 메인헤더가 변경되는 것이 보이기 때문에 이 부분을 수정할 수 있으면 수정할 생각이다.
  - 로그인을 유지하고 있을 때, token이 만료 시간에 가까워지면 자동으로 갱신되는 로직을 추가 해야 함
    - 대충 구성만 되어 있는 상태로, 좀 더 자세한 코드와 테스트가 필요함

# 오늘 느낀 점

- 게시글 수정 페이지를 연결하는 것까지는 정상적으로 구성했고, 이후에 추가해야 할 내용으로는 수정 버튼 클릭 시 게시글 작성과 동일한 form과 input이 보여져야 하며, input의 내용에 게시글 세부 페이지의 내용이 들어가 있도록 구성해줘야 한다. 삭제 버튼도 게시글 세부 페이지에 추가해놓았는데, 삭제 버튼 클릭 시 해당 게시글이 DB에서 삭제되고, 프론트엔드에서 보이지 않도록 구성을 해줘야 하며, 게시글 페이지로 이동하도록 해줘야 한다. 그리고 삭제된 게시글의 번호가 비어있게 되므로, 해당 번호 비워두지 않고 채우기 위해 삭제한 게시글 뒤의 번호들이 1씩 줄어들도록 해줘야 한다. 토큰을 실시간 모니터링 하지 않기로 결정했기 때문에 refreshToken이 이제는 굳이 필요한가라는 생각이 들어서 해당 내용과 관련된 정보를 찾아보고, 굳이 필요없다면 refreshToken과 관련된 코드를 삭제하는 방향으로 진행을 해야 할 것 같다. refreshToken은 accessToken을 갱신하는 용도로 사용하는데, 현재 토큰 구성은 만료 시간이 지난 후 또는 로그아웃을 하고 이후에 다시 로그인을 하면 accessToken과 refreshToken을 다시 발급하기 때문에 굳이 accessToken을 갱신할 필요가 없어서 refreshToken의 필요 유무를 다시 한 번 생각해봐야 할 것 같다.

<br />

# 내일 할 일

- React 공부 및 React 프로젝트 조금씩 진행하기

<br />

# 앞으로 해야 할 일

- React, NextJS 공부

- React 프로젝트 제작
