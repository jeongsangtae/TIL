# 오늘 한 일

### React 프로젝트 제작 (React, NodeJS, MongoDB로 만드는 미니 커뮤니티 플랫폼)

- 구성한 내용

  - CommentForm 컴포넌트에서 PATCH method와 관련된 로직 구성 완료
    - 이전에 추가한 내용에서 추가 작업없이 코드를 테스트해본 결과, 화면에서는 변경된 모습이 보이지 않았지만 백엔드에서는 정상적으로 데이터가 업데이트된 것을 확인할 수 있었다.
      - 댓글 수정과 관련된 컴포넌트를 따로 추가하려고 생각했는데, 다시 생각해보니 CreateComment 컴포넌트도 사용하지 않으려고 CommentForm 컴포넌트를 사용했는데 수정과 관련된 컴포넌트는 말이 안된다고 생각해서 테스트 해보니 백엔드에서는 정상적으로 업데이트 되는 것을 확인
      - 따로 수정과 관련된 컴포넌트는 추가하지 않고, 기존의 댓글과 관련된 컴포넌트에서 수정해서 완성
    - 백엔드 구성
      - 댓글을 수정한 내용이 정상적으로 업데이트되긴 하지만 화면에서 실시간으로 반영되지 않기 때문에, 이 부분을 해결하기 위해서 프론트엔드에서 전달받은 commentId 정보를 업데이트하는 댓글에 포함시켜서 다시 프론트엔드로 전달
        - 이 코드 구성은 뭔가 변경할 수 있을 것 같다는 생각도 든다.
    - 프론트엔드 구성
      - Comments 컴포넌트
        - patchComment 함수를 추가해서, 업데이트된 데이터를 매개변수로 받는다.
        - setComments에서 이전 상태를 반영해서 업데이트 되도록 내용 구성
          - 이전 상태에 map 함수를 사용하고 댓글의 \_id와 업데이트한 댓글의 commentId(\_id)를 확인해서 일치하는 항목을 찾는다.
          - 일치하는 댓글에서 content 속성을 매개변수로 받은 데이터의 content 값으로 업데이트하고 변경 사항이 적용된 새로운 배열을 반환하도록 구성
        - patchComment 함수를 Comment 컴포넌트에 onPatchCommentData라는 이름의 prop으로 전달
      - Comment 컴포넌트
        - 전달받은 onPatchCommentData prop을 CommentForm 컴포넌트에 prop으로 다시 전달
      - CommentForm 컴포넌트
        - fecth 함수에서 PATCH method와 관련된 else if문에서 router.patch 백엔드를 통해 데이터를 응답받는다.
        - onPatchCommentData prop을 통해 상태 끌어올리기로 응답 받은 내용을 전달
          - 업데이트된 댓글의 정보가 담겨있다.
          - 업데이트된 content, 기존의 commentId, 새로 갱신된 date
    - 어제 미리 구성한 백엔드와 프론트엔드 코드에서 조금의 내용을 추가해서 정상적으로 댓글을 수정했을 때 내용이 업데이트되고, 실시간으로 반영되도록 해주었다.
    - 여러가지 테스트를 해본 결과, 거의 문제 없이 작동을 했는데 한 가지 추가 수정해줘야 할 부분이 있었다.
      - 수정 버튼을 클릭하고 아무것도 입력하지 않은 상태에서 그대로 등록 버튼을 클릭하면 빈 문자열로 백엔드에 저장되며 화면에도 빈 문자열로 보이게 되는데 이 부분을 수정해줘야 한다.
      - 위 문제를 확인하기 위해서 기존의 입력된 내용에서 추가 내용을 입력하고 입력한 추가 내용을 다시 삭제하고 그대로 저장했을 때는 빈 문자열이 아닌, 업데이트 이전의 내용 그대로 저장이 되는 것을 확인할 수 있었다.
      - 수정 버튼을 클릭해서 기존의 내용이 보여지는 상황에서 어떠한 내용도 건드리지 않은 채로 등록 버튼을 클릭했을 때만 이러한 문제가 생기기 때문에, 이 문제를 수정해야 할 것 같다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/0c5753e9a0367d4b49134bdeb9e342cb9eb3b4c7)

  <br />

  - 주석 처리한 코드 정리
    - 테스트에 사용하거나 테스트 하기 전에 사용한 코드들을 주석 처리해놨었는데, 이 코드들을 정리하고 삭제해주었다.
    - 현재는 보이는 부분에서 주석 처리한 코드만 삭제를 진행했는데, 이제 안쓰는 컴포넌트 파일도 삭제를 해야 하고, 확인하기 위해서 추가해놓은 console.log도 찾아서 삭제를 해줘야 한다.
    - 현재는 이 정도 정리한 걸로 만족, 로직을 구성하다가 신경쓰이면 바로 삭제하고 추가 정리를 할 생각이다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/b8463726d6c2309c77624825e91fbf81865b3c1a)

  <br />

  - 댓글 수정 form과 관련된 toggle 로직에서 내용 추가 및 변경
    - 댓글 수정 버튼 클릭 시 댓글 수정하는 form이 열리도록 구성을 해놓았는데, 닫는 기능이 없어서 commentEditToggleHandler 함수를 변경해서 다시 수정 버튼을 클릭했을 때, 댓글 수정 form이 닫히도록 구성을 해주었다.
    - 추가로 CommentForm 컴포넌트에 해당 함수를 prop으로 전달해서, commentEditToggleHandler 함수가 prop으로 전달 되었을 때 댓글 수정 form에서 취소 버튼이 보여지게 되고, 취소 버튼을 클릭했을 때 댓글 수정 form이 닫히도록 구성을 해주었다.
    - 기존의 commentEditToggleHandler 함수에서는 일방적으로 수정 버튼 클릭 시 댓글 수정 form이 true로 변경되면서 열리도록 구성했으나, 로직을 변경해서 클릭할 때마다 "!"가 작동해서 현재 상태에서 반대로 전환되도록 구성을 변경해주었다.
      - 수정 버튼을 처음 클릭하면 수정 form이 열리게 되고, 다시 클릭하면 닫히도록 구성이 되었으며, 추가로 취소 버튼을 클릭했을 때는 수정 form이 닫히게 된다.
      - 수정 버튼과 취소 버튼 둘 다 수정 form을 닫히도록 할 수 있는데, 둘 다 수정 form을 닫기 때문에 문제가 되지 않을까 고민했지만, 사용자에게 선택의 여지를 주는 방식은 괜찮다고 생각되어 변경하지 않고 그대로 진행할 생각이다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/0700c73d484f8e00612242e46971c1db80dd7455)

<br />

- 추가 및 해결 해야 할 내용
  - 회원가입 form에서 잘못된 입력을 제출 했을 때, session에 데이터가 저장되는데, 기존의 session 데이터에서 업데이트되는 방식이 아닌 매번 제출할 때마다 새로운 session이 추가되고 있기 때문에 백엔드 코드에서 수정이 필요하다.
    - 계속 원인을 찾아보려고 이것저것 시도해보았지만 아직 어떤 코드가 정확히 원인인지 찾지 못해서 하나씩 천천히 테스트가 필요함
    - 일단 이걸 테스트 해보기전에 먼저 정상적으로 세션 만료가 되는지 확인해보았는데 정상적으로 세션 만료가 되기 때문에, 로그인을 먼저 구성해보고 정상적으로 로그인이 되는지 확인을 해보고 안된다면, session에 저장되는 부분을 다시 확인해봐야 할 것 같다는 생각
  - 로그인 후에, 새로고침 시 로그아웃 되어버리는 상황도 수정을 해야 함
    - 현재 로그인 한 후에, useEffect를 통해서 데이터를 확인하고 토큰이 유효하다면 정상적으로 로그인 유지는 되지만, 새로고침 시 깜빡거리면서 메인헤더가 변경되는 것이 보이기 때문에 이 부분을 수정할 수 있으면 수정할 생각이다.
  - 로그인을 유지하고 있을 때, token이 만료 시간에 가까워지면 자동으로 갱신되는 로직을 추가 해야 함
    - 대충 구성만 되어 있는 상태로, 좀 더 자세한 코드와 테스트가 필요함

# 오늘 느낀 점

- 댓글 수정과 관련된 로직까지 마무리를 했다고 생각했지만, 마지막 테스트에서 작은 문제를 발견했기 때문에 해당 내용을 수정해줘야 한다. 큰 문제는 아니지만 해당 문제는 사용자가 이용하다가 실수하고 발생할 수 있는 문제이기 때문에 수정을 꼭 해줘야 할 것 같다. 이 부분만 수정하면 댓글 추가, 삭제, 수정과 관련된 내용은 마무리가 될 것 같은데 여기에서 바로 답글 관련 내용을 구성할 지, 사용자 인증과 관련된 내용을 추가 작업할 지 선택해야 하는데 현재 기울어진 쪽은 답글 구성을 하는 쪽으로 생각을 하고 있다. 답글은 댓글과 비슷한 로직으로 구성이 될 것 같기 때문에 빠르게 끝낼 수 있을 것 같다는 생각이 들어서 답글 로직을 구성하는 쪽으로 기울어져 있다. 그리고 CSS를 하나도 추가하지 않아서 현재 좀 많이 보기 불편한데, CSS를 조금이라도 구성하는 쪽으로 생각도 해보고 있지만, 일단 최우선 순위는 아니라고 생각하기 때문에 다른 로직 구성을 우선으로 생각하고 CSS는 차차 조금씩 구성을 해줄 생각이다.

<br />

# 내일 할 일

- React 공부 및 React 프로젝트 조금씩 진행하기

<br />

# 앞으로 해야 할 일

- React, NextJS 공부

- React 프로젝트 제작
