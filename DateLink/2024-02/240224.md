# 오늘 한 일

### React 프로젝트 제작 (React, NodeJS, MongoDB로 만드는 미니 커뮤니티 플랫폼)

- 구성한 내용

  - 댓글 삭제 실시간 반영 로직 추가 (실패)
    - 댓글이 삭제되는 것을 실시간으로 반영하려고 했으나, 코드 구성에서 부족한 부분이 있는지 정상적으로 작동하지 않았다.
    - 백엔드 구성
      - 댓글을 삭제할 때, 삭제하는 댓글의 정보를 프론트엔드로 전달하도록 구성
    - 프론트엔드 구성
      - Comments 컴포넌트에서 따로 deleteComment 이벤트 핸들러를 추가하고, Comment 컴포넌트에 onDeleteCommentData이라는 prop으로 전달
        - deleteComment 이벤트 핸들러에서 댓글을 이전 상태에 반영해서, 업데이트하도록 구성
        - 이 부분에서 코드 구성이 잘못된 것 같음
        - filter 함수를 사용해야 할 것 같다는 생각이 든다.
      - onDeleteCommentData prop을 전달 받고, 댓글을 삭제하는 fetch 함수가 실행될 때, 백엔드에서 삭제하는 댓글의 정보를 받아와서 onDeleteCommentData를 통해 상태 끌어올리기로 백엔드에서 전달받은 정보를 전달
    - 코드를 다시 살펴보니 두 가지 문제가 보인다.
      - 첫 번째 문제는 백엔드에서 프론트엔드로 전달되어야 할 데이터가 정상적으로 전달되지 못하고 있다.
        - 이유는 전달되기 전에 해당 데이터를 삭제하기 떄문에 정상적으로 전달이 이루어지지 않고 있다.
        - 사실 정상적으로 전달되지 않을 것을 알고는 있었지만, 확실하게 안되는 것이 맞는지 확인하기 위해 코드를 구성했다.
      - 두 번째 문제는 Comments 컴포넌트의 deleteComment 이벤트 핸들러 함수의 내용 구성이 잘못되어 있다.
        - setComments에서 이전 상태를 반영해서 업데이트하는 것은 좋지만, 어떻게 데이터를 추려내서 업데이트할 것인지 명확하게 구성하지 않아서 정상적인 작동이 이루어지지 않고 있다.
        - 여기에서 filter 함수를 사용해서 구성하면 될 것 같다는 생각이 든다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/0765543c2d48fab4fd4db0ae3f0ec5fcbb9846f6)

  <br />

  - 댓글 삭제 실시간 반영 로직 수정 (미완성)
    - 댓글을 삭제했을 때 프론트엔드에서 실시간으로 반영이 되긴 하지만, 백엔드에서는 해당 게시글의 제일 먼저 추가된 댓글이 삭제되고 있으며, 버튼을 클릭한 댓글이 삭제되고 있지 않다.
      - 추가로 새로고침을 하면 백엔드에서 없어진 댓글이 화면에서 보이지 않으며 버튼을 클릭했던 댓글은 그대로 남아있게 된다.
    - 테스트해본 백엔드 구성
      - 먼저 백엔드에서 삭제할 댓글의 정보를 따로 찾아서 변수에 저장하고 해당 변수를 프론트엔드로 전달하고, 이후에 따로 댓글을 삭제되도록 하는 코드로 구성
    - 테스트해본 프론트엔드 구성
      - Comment 컴포넌트의 fetch 함수에서 백엔드를 통해 삭제할 댓글의 정보가 넘어오는지 console.log를 통해서 확인하고, onDeleteCommentData prop을 통해서 삭제할 댓글의 정보를 상태 끌어올리기로 전달
      - Comments 컴포넌트의 deleteComment 이벤트 핸들러 함수에서 setComments에서 이전 상태를 반영해서 업데이트하는데, filter 함수를 사용해서 댓글들의 \_id를 확인하고, 삭제할 댓글의 \_id도 확인해서 \_id가 일치하지 않는 댓글만 남겨서 실시간으로 반영되도록 구성
    - 백엔드 구성
      - 굳이 삭제할 댓글의 정보를 전달하지 않고, 프론트엔드에 이미 전달된 comment.\_id를 사용하면 될 것 같기에, 기존의 코드로 되돌려서 댓글이 삭제되도록 해주었으며, json으로 message만 전달하도록 구성
    - 프론트엔드 구성
      - Comments 컴포넌트에서 Comment 컴포넌트로 commentId라는 prop을 추가해서, comment.\_id 내용을 넣어서 전달
      - Comment 컴포넌트에서 commentId prop이 정상적으로 넘어왔는지 확인하고, onDeleteCommentData에 상태 끌어올리기를 통해서 commentId 데이터를 다시 전달
      - Comments 컴포넌트의 deleteComment 이벤트 핸들러 함수에서 이전과 동일하게 이전 상태를 반영해서 업데이트하고, filter 함수를 사용하는데 filter 함수의 내용에서 사용되는 변수만 조금 변경
        - 상태 끌어올리기를 통해 전달받은 commentId를 사용하는데, 댓글들의 \_id를 확인하고, commentId도 확인해서 일치하지 않는 댓글만 남기고 실시간으로 반영되도록 구성
    - 테스트 해본 코드와 변경한 코드 모두 생각한 것과 조금 다르게 작동해서 추가 수정이 필요하다.
      - 테스트 해본 코드는 백엔드와 화면 모두 제일 먼저 추가된 댓글이 삭제되고 있다.
      - 추가로 변경한 코드는 화면에서 클릭한 버튼의 댓글이 삭제되지만, 백엔드에서는 제일 먼저 추가된 댓글이 삭제되고 있으며, 이후에 새로고침하면 백엔드와 연결되어 백엔드에 저장된 댓글 데이터가 보여지고 있다.
    - 코드 구성을 다시 확인해보니 백엔드 로직에서 변경을 좀 해주면 해결이 될 것 같다는 생각이 드는데, 우선 댓글을 삭제하는 로직에서 해당 게시글 \_id를 확인해서 삭제하는 것이 아닌, 댓글의 \_id를 확인해서 삭제하도록 변경하면 문제가 해결될 것 같다.
      - 댓글의 \_id를 확인하기 위해서는 프론트엔드에서 백엔드로 삭제하려는 댓글의 \_id 정보를 전달하는 작업이 필요할 것 같다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/5b7da4bdfce5802caf39f2730a895c93c039509a)

<br />

- 추가 및 해결 해야 할 내용
  - 회원가입 form에서 잘못된 입력을 제출 했을 때, session에 데이터가 저장되는데, 기존의 session 데이터에서 업데이트되는 방식이 아닌 매번 제출할 때마다 새로운 session이 추가되고 있기 때문에 백엔드 코드에서 수정이 필요하다.
    - 계속 원인을 찾아보려고 이것저것 시도해보았지만 아직 어떤 코드가 정확히 원인인지 찾지 못해서 하나씩 천천히 테스트가 필요함
    - 일단 이걸 테스트 해보기전에 먼저 정상적으로 세션 만료가 되는지 확인해보았는데 정상적으로 세션 만료가 되기 때문에, 로그인을 먼저 구성해보고 정상적으로 로그인이 되는지 확인을 해보고 안된다면, session에 저장되는 부분을 다시 확인해봐야 할 것 같다는 생각
  - 로그인 후에, 새로고침 시 로그아웃 되어버리는 상황도 수정을 해야 함
    - 현재 로그인 한 후에, useEffect를 통해서 데이터를 확인하고 토큰이 유효하다면 정상적으로 로그인 유지는 되지만, 새로고침 시 깜빡거리면서 메인헤더가 변경되는 것이 보이기 때문에 이 부분을 수정할 수 있으면 수정할 생각이다.
  - 로그인을 유지하고 있을 때, token이 만료 시간에 가까워지면 자동으로 갱신되는 로직을 추가 해야 함
    - 대충 구성만 되어 있는 상태로, 좀 더 자세한 코드와 테스트가 필요함

# 오늘 느낀 점

- 댓글 삭제가 실시간으로 반영되도록 하는 코드는 간단할 것 같다고 생각을 했으나, 쉽게 구성을 하지 못했다. 앞에서 댓글 추가를 실시간으로 반영하는 코드와 유사하게 구성을 하면 될 것 같았지만, 삭제에서는 좀 더 복잡하고 필요한 데이터와 고려해야 할 사항이 있어서 좀 더 복잡한 구성이 될 것 같다. 처음에 구성한 로직은 제대로 작동이 되지 않았지만, 이후에 수정해서 실시간으로 반영되는 것은 정상적으로 구현이 됐는데 문제는 화면에서 클릭한 댓글이 삭제되는 것처럼 보였으나, 백엔드에서는 처음 추가된 댓글이 삭제되고 있는 문제가 있기 때문에 이 부분을 수정해서 백엔드에서 클릭한 댓글이 삭제되고 프론트엔드에서 그 내용을 반영해서 화면에 출력이 되도록 추가 수정을 해줘야 한다. 구성한 코드를 살펴본 결과 백엔드에서 댓글을 삭제하는 로직에서 문제가 보였는데, 처음에는 게시글의 \_id를 확인해서 삭제가 되도록 해야 한다고 생각했으나, 굳이 확인하지 않고 댓글의 \_id만 확인해서 삭제를 진행해도 문제가 없을 것 같다는 생각이 들어서 프론트엔드에서 댓글의 \_id 정보를 백엔드로 넘겨서 그 정보를 바탕으로 댓글이 삭제되도록 구성을 해야 할 것 같다. 추가로, 게시글의 \_id를 댓글에 추가해서 이 \_id를 바탕으로 다른 게시글과 혼동되지 않고 딱 그 게시물에서 해당 댓글이 삭제되는 로직을 생각했는데, 굳이 그럴 필요없이 댓글의 \_id 정보만 있다면 그 댓글을 삭제할 수 있을 것 같아서 삭제하려는 댓글의 정보만 백엔드에서 사용할 수 있으면 쉽게 문제가 해결될 것 같다는 생각이다.

<br />

# 내일 할 일

- React 공부 및 React 프로젝트 조금씩 진행하기

<br />

# 앞으로 해야 할 일

- React, NextJS 공부

- React 프로젝트 제작
