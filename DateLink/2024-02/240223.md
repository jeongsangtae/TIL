# 오늘 한 일

### React 프로젝트 제작 (React, NodeJS, MongoDB로 만드는 미니 커뮤니티 플랫폼)

- 구성한 내용

  - 댓글 삭제 로직 추가 (오류로 인해 실패)
    - 댓글 삭제 기능을 추가하기 위해서 코드 구성을 했는데, 댓글이 삭제되는 것이 아닌 게시글이 삭제되는 문제가 생겨서 코드를 수정해줘야 한다.
    - 백엔드 구성
      - router.delete로 구성하고, 프론트엔드의 fetch 함수와 연결해줄 API 엔드포인트 경로를 구성
      - 어떤 게시글의 댓글을 삭제하는지 알 수 있도록 postId를 가져온다.
      - 삭제할 게시글을 찾을 수 있도록 게시글 컬렉션에서 postId와 일치하는 게시글을 찾는다.
      - 댓글에 저장된 게시글 고유 \_id인 post_id를 앞에서 찾은 게시글의 \_id와 비교해서 일치하는 댓글을 찾아서 삭제
        - `await db.getDb().collection("comments").deleteOne({ post_id: post._id });`
      - 성공적으로 삭제하면 success 메시지를 전달
    - 프론트엔드 구성
      - useRouteLoaderData를 통해서 게시글 정보를 가져온다.
      - 가져온 게시글 정보에서 게시글 번호를 사용해 fetch 함수의 경로에서 사용
        - 백엔드의 API 엔드포인트 경로와 일치시키기 위한 작업
      - DELETE method를 사용해서 router.delete와 연결되도록 구성
      - 올바른 응답이 넘어오지 않으면, 에러를 반환
      - 정상적으로 삭제가 되면, 콘솔에서 삭제되었다는 메시지를 보여주도록 구성
      - 삭제 버튼을 추가하고, fetch 함수가 구성된 이벤트 핸들러 함수를 onClick을 사용해서 실행
    - 분명 구성에 문제가 없어보였는데 정상적으로 작동하지 않고, 댓글이 아닌 게시글이 삭제되고 있기 때문에 어떤 코드가 문제인지 찾아봐야 한다.
      - delete method가 겹쳐서 발생하는 것 같다는 생각도 드는데, 경로가 분명히 달라서 이 문제는 아닐 것 같지만 그래도 확인이 필요하다.
      - router.delete가 아닌, router.post로도 테스트를 해봐야 할 것 같은데, 코드 자체에서 문제가 생기면 콘솔에서 오류를 보여주는데, 콘솔에서 오류를 보여주지 않고 게시글을 삭제하기 때문에 정확한 문제를 파악하기 힘들어서 여러가지 생각되는 부분을 모두 테스트 해봐야 한다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/08150b9e41d207d7052deec203c442a53045c436)

  <br />

  - 댓글 삭제 코드 오류 수정 완료
    - 프론트엔드 구성
      - fetch 함수 경로에서 "/comment"가 되어야 정상적으로 백엔드 API 엔드포인트와 연결되는데, "comment"로 작성을 해서 정상적으로 연결이 되지 않아서 오류가 발생
    - 이제는 댓글 삭제 코드가 정상적으로 작동하는데, 앞에서 예상한 문제들이 아닌 단순히 fetch 함수 경로에서 실수로 "/"를 빼먹고 구성해서 정상적으로 작동하지 않고 있었다.
      - 경로를 올바르게 연결해주면서 문제가 해결되었다.
    - 문제를 해결하기 전에 앞에서 예상한 문제들을 모두 테스트해보았는데, 내가 예상한 문제들이 전부 틀렸고 단순한 코드 작성 실수로 인해 오류가 발생했음
      - router.post로 변경해서 테스트
      - DELETE method가 아닌, POST method로 테스트
      - 콘솔을 찍어서 데이터가 넘어오는지 테스트
    - 댓글 삭제 기능이 정상적으로 작동하기 때문에, 이제 추가로 실시간으로 삭제된 내용이 반영되어 화면에 보이도록 하는 로직을 구성해줘야 한다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/268ba6e678f06ec14e5b8ce19a1421edb0ec6f99)

<br />

- 추가 및 해결 해야 할 내용
  - 회원가입 form에서 잘못된 입력을 제출 했을 때, session에 데이터가 저장되는데, 기존의 session 데이터에서 업데이트되는 방식이 아닌 매번 제출할 때마다 새로운 session이 추가되고 있기 때문에 백엔드 코드에서 수정이 필요하다.
    - 계속 원인을 찾아보려고 이것저것 시도해보았지만 아직 어떤 코드가 정확히 원인인지 찾지 못해서 하나씩 천천히 테스트가 필요함
    - 일단 이걸 테스트 해보기전에 먼저 정상적으로 세션 만료가 되는지 확인해보았는데 정상적으로 세션 만료가 되기 때문에, 로그인을 먼저 구성해보고 정상적으로 로그인이 되는지 확인을 해보고 안된다면, session에 저장되는 부분을 다시 확인해봐야 할 것 같다는 생각
  - 로그인 후에, 새로고침 시 로그아웃 되어버리는 상황도 수정을 해야 함
    - 현재 로그인 한 후에, useEffect를 통해서 데이터를 확인하고 토큰이 유효하다면 정상적으로 로그인 유지는 되지만, 새로고침 시 깜빡거리면서 메인헤더가 변경되는 것이 보이기 때문에 이 부분을 수정할 수 있으면 수정할 생각이다.
  - 로그인을 유지하고 있을 때, token이 만료 시간에 가까워지면 자동으로 갱신되는 로직을 추가 해야 함
    - 대충 구성만 되어 있는 상태로, 좀 더 자세한 코드와 테스트가 필요함

# 오늘 느낀 점

- 댓글 삭제 기능 로직 자체는 간단하게 바로 구성을 했는데, 문제는 fetch 함수 경로에서 실수를 하고 빨리 발견하지 못해서 해결하는데 많은 시간을 소비했다. 오류의 원인을 찾기 위해서 여러가지 테스트를 많이 해봤는데 전부 내가 예상한 문제와 달라서 어떻게 수정을 해야 하는지 고민했는데, 코드 실수를 발견하고 오류를 해결할 수 있어서 정말 다행이라는 생각도 든다. 분명히 꼼꼼하게 체크하고 진행을 했던 것 같은데 실수를 해서, 다시 한 번 확인해보는 습관을 가져야 한다고 반성하게 되었다. 이제 댓글 삭제 로직도 정상적으로 작동하기 때문에, 댓글을 삭제했을 때 실시간으로 화면에 반영이 되도록 하는 코드도 구성을 해줘야 하는데 이 코드는 앞에서 댓글 추가를 실시간으로 반영한 코드와 유사하게 구성을 하면 될 것 같다는 생각이 든다. 이 로직까지 완성을 하면 이제 댓글 수정 로직을 구성할 생각인데, 아직 댓글 추가 로직과 수정 로직을 공유해서 재사용되도록 할 수 있을지는 정확히 판단이 되지 않아서 댓글 수정 로직을 구성해봐야 정확하게 판단이 될 것 같다.

<br />

# 내일 할 일

- React 공부 및 React 프로젝트 조금씩 진행하기

<br />

# 앞으로 해야 할 일

- React, NextJS 공부

- React 프로젝트 제작
