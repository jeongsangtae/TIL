# 오늘 한 일

### React 프로젝트 제작 (React, NodeJS, MongoDB로 만드는 미니 커뮤니티 플랫폼)

- 구성한 내용

  - 댓글을 추가했을 때, 실시간으로 갱신하는 로직 추가
    - 댓글은 정상적으로 추가가 되고 있으나, 실시간으로 갱신이 되지 않고 새고로침해야 보이기 때문에 실시간으로 갱신되어 보이도록 로직 추가
      - useEffect로 테스트를 진행했을 때, 의존성 배열이 없는 상태에서는 댓글을 추가해도 실시간으로 반영되지 않아서, 댓글을 저장하는 useState의 배열을 의존성 배열로 넣으면 무한 루프가 발생해서 다른 방법을 찾아서 구성해줘야 했다.
    - 프론트엔드 구성
      - 기존의 useEffect에서 의존성 배열로 post를 추가
        - post는 게시글과 관련된 내용이라서 확실하지는 않은데, 테스트를 위해서 의존성 배열로 post를 넣어줌
      - addComment라는 함수를 만들어서, CreateComment 컴포넌트에 prop으로 전달
      - CreateComment 컴포넌트에서 내용을 입력하고 submitHandler를 통해서 내용을 제출하면서, 입력한 댓글의 내용을 DB에서 가져와서 변환한 후에 상태 끌어올리기를 통해서 Comments 컴포넌트에 전달
      - Comments 컴포넌트의 addComment 함수에 상태 끌어올리기를 통해서 댓글에 입력한 내용이 전달되고, setComments에서 이전 상태를 반영해서 배열에 댓글에 입력한 내용이 추가하도록 구성
    - 백엔드 구성
      - 백엔드에서 댓글을 추가할 때 사용하는 router.post에서 응답으로 message만 전달했으나, 추가되는 댓글의 내용을 json으로 전달
    - 상태 끌어올리기를 통해서 댓글의 내용을 추가하면서 해당 내용을 상위 컴포넌트로 전달해서 그 내용이 useState에서 이전 상태를 반영해서 업데이트되며, 화면에 실시간으로 갱신되어 보여지게 된다.
      - 처음에 DB에서 응답 받은 내용이 아닌, CreateComment에서 댓글을 추가한 후에 저장하는 useState의 내용을 전달했는데 그 내용으로는 실시간으로 댓글이 추가되는 것이 반영은 되었지만 내용이 보이지 않아서 문제를 살펴보니 key에 들어갈 내용과 실질적인 내용이 객체 형태로 넘어오지 않아서 Comment 컴포넌트로 내용을 전달하지 못해서 화면에 정상적으로 보이지 않게 되었다.
      - 그래서 현재 구성한 코드처럼 DB에서 댓글을 추가할 때 입력한 내용을 전달 받아서 Comments 컴포넌트로 전달하고 사용하니 문제가 해결되었다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/b6dd749d84fd345a5fe1f313c4972e2176845e5f)

  <br />

  - useEffect에 추가한 의존성 배열 삭제 및 주석 처리된 코드 정리
    - useEffect의 의존성 배열에 추가해놓은 post를 삭제해주었는데, post는 게시글과 관련된 내용의 변수이기 때문에 의존성 배열에서 삭제해도 아무 문제가 없기 때문에 삭제
    - 테스트를 위해서 주석 처리한 기존의 코드를 삭제
      - 새롭게 만든 코드가 정상적으로 작동하기 때문에 기존의 코드 삭제
    - 오류를 확인하기 위해 console.log 해본 내용들을 삭제
      - 오류를 확인하고 테스트하기 위해 추가했었기 때문에, 굳이 남겨놓을 필요가 없어서 정리해주었다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/2118e2aa4b9d1b30347e22dc2574e41cd57af5b1)

<br />

- 추가 및 해결 해야 할 내용
  - 회원가입 form에서 잘못된 입력을 제출 했을 때, session에 데이터가 저장되는데, 기존의 session 데이터에서 업데이트되는 방식이 아닌 매번 제출할 때마다 새로운 session이 추가되고 있기 때문에 백엔드 코드에서 수정이 필요하다.
    - 계속 원인을 찾아보려고 이것저것 시도해보았지만 아직 어떤 코드가 정확히 원인인지 찾지 못해서 하나씩 천천히 테스트가 필요함
    - 일단 이걸 테스트 해보기전에 먼저 정상적으로 세션 만료가 되는지 확인해보았는데 정상적으로 세션 만료가 되기 때문에, 로그인을 먼저 구성해보고 정상적으로 로그인이 되는지 확인을 해보고 안된다면, session에 저장되는 부분을 다시 확인해봐야 할 것 같다는 생각
  - 로그인 후에, 새로고침 시 로그아웃 되어버리는 상황도 수정을 해야 함
    - 현재 로그인 한 후에, useEffect를 통해서 데이터를 확인하고 토큰이 유효하다면 정상적으로 로그인 유지는 되지만, 새로고침 시 깜빡거리면서 메인헤더가 변경되는 것이 보이기 때문에 이 부분을 수정할 수 있으면 수정할 생각이다.
  - 로그인을 유지하고 있을 때, token이 만료 시간에 가까워지면 자동으로 갱신되는 로직을 추가 해야 함
    - 대충 구성만 되어 있는 상태로, 좀 더 자세한 코드와 테스트가 필요함

# 오늘 느낀 점

- 댓글을 추가했을 때, 실시간으로 갱신되면서 출력하는 부분을 성공적으로 구성했는데 솔직히 쉬울 것 같다는 생각이 들었으나, 좀 많이 애를 먹었던 것 같다. useEffect를 사용해서 구성을 하는데 의존성 배열에서 어떤 내용을 넣어줘야 하는지 많이 고민을 했는데, 막상 코드를 구성하고 보니 굳이 의존성 배열을 넣어주지 않아도 댓글을 추가했을 때 실시간으로 화면에 보이도록 구성할 수 있었다. 정말 많은 코드를 테스트 해봤는데, 구성하고 보니 생각보다 복잡한 내용이 아니었고, 너무 복잡하게 생각해서 간단하게 구성을 하지 못했던 것 같다. 문제를 해결할 때 console.log를 많이 찍어보면서 테스트해보니 어디가 문제인지 알 수 있었고 하나씩 찾아가면서 해결할 수 있었는데 앞으로도 오류가 생기거나, 코드에서 정상적으로 작동하지 않는 것은 console.log를 찍어서 확인해보면서 테스트해보는 습관을 가져야할 것 같다.

<br />

# 내일 할 일

- React 공부 및 React 프로젝트 조금씩 진행하기

<br />

# 앞으로 해야 할 일

- React, NextJS 공부

- React 프로젝트 제작
