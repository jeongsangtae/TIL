# 오늘 한 일

### JS 토이 프로젝트 제작 (JS, ExpressJS, MongoDB로 만드는 게시판 + EJS)

- 게시판 제작 진행 과정

  - 로그인 상태에서 글쓰기 페이지를 들어간 상태로 로그아웃을 하고 뒤로가기 버튼으로 다시가면 문제없이 글쓰기 페이지로 이동되는 오류를 해결함

    - 로그아웃을 하고 뒤로가기 버튼으로 이동시 페이지 내용이 그대로 보이고 헤더의 내용도 변경되지않았는데 이 부분을 수정해서 로그아웃하고 뒤로가기로 이동시 인증되지않음 페이지가 보이도록 바꿔주었다.
    - 먼저 app.js에 res.setHeader로 캐시 제어 헤더를 설정해주었는데 아래 내용이 들어간다.

      ```
      ExpressJS

      app.use((req, res, next) => {
        res.setHeader('Cache-Control', 'no-cache, no-store, must-revalidate');
        res.setHeader('Pragma', 'no-cache');
        res.setHeader('Expires', '0');
        next();
      });
      ```

    - 저렇게 캐시 제어를 통해 캐시를 비활성화하고, 서버 측에서의 캐시 제어를 통해 브라우저에게 페이지를 캐시하지 않도록 지시할 수 있다. expressjs에서 서버 측에서 저런식으로 가능하고 클라이언트 측에서 html을 통해 캐시 제어도 할 수 있다.

      ```
      HTML

      <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
      <meta http-equiv="Pragma" content="no-cache" />
      <meta http-equiv="Expires" content="0" />
      ```

    - 나는 여기서 서버 측에서 캐시 제어를 해주면서 로그아웃 후 뒤로가기 버튼을 사용했을 때, 캐시된 페이지가 아닌 실제로 서버로부터 새로운 페이지가 로드되도록 해주었다.
    - 캐시 제어 헤더 내용
      - Cache-Control: no-cache, no-store, must-revalidate
        - Cache-Control 헤더는 캐시 제어 지시자를 정의한다.
        - no-cache는 요청 시 서버로부터 새로운 데이터를 얻도록 지시한다.
        - no-store는 캐시를 저장하지 않도록 지시한다.
        - must-revalidate는 캐시가 만료되었을 때 원본 서버로 재검증을 요청하도록 지시한다.
      - Pragma: no-cache
        - Pragma 헤더는 캐시 제어를 위한 추가 지시자를 정의한다.
        - no-cache는 요청 시 서버로부터 새로운 데이터를 얻도록 지시한다.
      - Expires: 0
        - Expires 헤더는 캐시의 만료 일시를 정의한다.
        - 0은 즉시 만료되도록 지시한다.

  - 글쓰기 페이지로 뒤로가기 했을 때와 마찬가지로 수정 페이지에서 로그아웃하고 뒤로가기 버튼 눌렀을 때 똑같이 에러가 발생하는 부분도 함께 수정됨
  - `const userEmail = req.session.user.email;` 에러로 인한 페이지 접속 오류 해결
    - 뒤로가기 버튼 에러를 수정하고 여러가지 확인을 해보았는데 글쓰기 페이지에서 로그아웃을 하고 뒤로가기하면 401페이지가 뜨는데 글쓰기 페이지에서 내용을 작성하고, 완료를 누른 후에 모달창이 뜨고 닫은 후 마찬가지로 로그아웃을 하고 뒤로가기 버튼을 누르면 `const userEmail = req.session.user.email` 에러가 발생하면서 페이지가 접속이 안되는 문제가 생겼다. 그래서 다른 페이지로도 접속이 되지않아 이 부분을 조건문을 추가해 수정해주었다.
    - 일단 먼저 에러가 발생하는 글쓰기 페이지와 그걸 가져와 보여주는 게시글 목록 페이지에 추가해주었는데 게시글 목록 페이지에는 `!res.locals.isAuth`를 확인하는 조건문이 따로 없는데 이유는 로그인 하지않은 사용자도 게시글 목록을 볼 수 있기 때문인데 그래서 `!req.session.user`를 확인하는 조건만 추가해 저런 에러가 발생했을 때 401페이지로 이동하도록 해주었다.
    - 글쓰기 페이지나 다른 페이지에서는 `!res.locals.isAuth`를 확인하는 조건문이 있기 때문에 이 조건문에 `!res.locals.isAuth || !req.session.user` 이런식으로 추가해 함께 확인하도록 해주었다. 이렇게 해줌으로서 로그인 여부를 확인하는 것보다 더 안정성이 향상되었다.
    - 다른 라우터에서도 위와 같이 조건을 추가해주면서 더욱 안정적으로 정확하게 확인할 수 있게 되었다.

  <br />

- 게시판 제작 진행 다음 목표

  - 페이지당 5개의 게시글까지만 보여지도록 해놓았으니, 이제 페이지네이션도 똑같이 한 화면에는 5개까지의 페이지버튼이 보이도록하고, 그 다음 6~10 이런 페이지 버튼은 다음 페이지 버튼을 클릭 시 보이도록 하려고 생각 중 (보류)
  - 한 가지 확인해야 할만한게 수정 페이지에 가게되면 조회수가 1씩 계속 증가되는데 수정하지 않고, 취소해도 증가하는 부분을 확인해봐야함 (이 부분은 로그인 기능을 추가하면 그 ID를 통해서 쿠키나 세션을 사용해 저장하고, 사용자가 클릭 시 조회수가 중복으로 상승하지 않도록 하는 로직을 구상 중)
  - 삭제할 때 비밀번호 확인이 필요한가...? 좀 고민해봐야 함 애초에 권한 유무로 삭제하기 때문에 굳이 라는 생각도 들기 때문에 좀 의견을 물어볼 필요가 있음
  - url에서 임의로 무작위로 url을 추가했을 때 404 페이지로 이동하도록 해줘야함 작성한 에러처리 로직이 제대로 작동하지 않는 것 같아서 확인도 필요함
  - 문제가 하나 있는데 비밀번호를 확인하고 일치했을 때 게시글이 생성되는 것은 좋은데 그 비밀번호를 저장하는게 사용자의 비밀번호를 그대로 저장을 하고 있기 때문에 이 부분을 변경해야 함
    - 방법1 해싱된 상태의 비밀번호가 저장이 되도록 한다. (테스트는 해봄)
    - 방법2 비밀번호는 게시글에 저장하지 않도록 한다. (현재는 이 방법으로 구성)
    - 이 부분은 더 이상 생각하지 않아도 될 거 같음 굳이 해싱된 비밀번호를 저장하지 않아도 될 거 같다는 생각 그래서 아이에 비밀번호를 게시글에 저장하지 않도록 해놓음
  - 패스워드, 수정, 삭제 에러 관련 동작 처리
    - 최종적으로 다시 모달창으로 변경해주었다. 이벤트리스너 에러를 if문으로 조건을 추가해 해당 페이지에 들어왔을 때 바로 작동하지 않도록 해주며 해결하였다.
    - 수정, 삭제는 그냥 게시글 작성자가 아니라면 버튼이 보이지 않도록 해 막아주었다.
    - 추가로 해당 게시글 작성자가 아닌데 url로 접속시도를 하는경우 401페이지로 이동하도록 해주었다.

<br />

# 오늘 느낀 점

- 로그인하고 글쓰기 페이지 이동 후 로그아웃하고 뒤로가기로 글쓰기 페이지를 문제 없이 들어가는 문제를 해결했는데 이 부분은 여러가지로 생각해보았는데 전혀 방향성이 틀려서 chatgpt의 도움을 받아서 캐시 제어를 통해 해결했다. 솔직히 이 부분은 처음 접하는 내용이여서 좀 헷갈리고 내용이 확 들어오는 느낌이 없어서 좀 더 찾아봐야할 것 같다. 물론 무조건적으로 외워야하는 것은 아니지만 가져다 쓴다고 해도 내용은 어느정도 파악하고 있어야한다고 생각하기 때문에 캐시 제어에 대해 조금 찾아볼 필요성을 느낀다.

- req.session.user.email 에러에 대해서 조건문 추가로 간단하게 해결되었는데 이 부분을 생각하기까지 조금 걸린 것 같다. 단순히 조건만 추가하면 되는건지 좀 헷갈려했는데 다른 부가적인게 문제가 아닌가 하는 생각이 있어서 저 에러 메시지를 보고 그 내용대로 수정하는 것이 아닌 혼자서 부가적인 부분을 생각해서 시간이 좀 걸렸던 것 같다. 결과적으로 에러는 해결하고 401페이지가 보이도록 처리했지만 빠르게 해결하지 못한게 좀 아쉽다는 생각이 든다. 다른 부분에서도 저런 에러가 생기면 조건문을 추가해 처리해주면 될 것 같다. 그리고 저 에러가 생기면 게시판 전체 페이지가 새로고침해도 페이지가 뜨지 않고 새로고침 페이지가 뜨는 문제가 있었는데 저 에러를 고치면서 전체 페이지가 새로고침이 뜨는 오류 부분이 해결되어 다행이라고 생각이 된다. 배포했을 때도 저런 문제가 생기면 어쩌지 로컬 환경에서만 저러는건가 많은 고민과 생각을 했었는데 이제는 해결되었기 때문에 배포를 했을 때 전체 페이지에 문제가 생기는 걱정은 하지 않아도 될 것 같다. 물론 추가 테스트는 필요하다고 생각한다.

- 수정 페이지에서도 앞에서 발생한 로그아웃하고 뒤로가기 했을 때 똑같이 페이지 접속되는 문제가 함께 해결되었는데 app.js에서 캐시 제어 헤더를 추가해주면서 함께 해결되었다. 물론 req.session.user.email 에러는 똑같이 발생하는 것을 확인해 !req.session.user 조건문을 함께 추가해주면서 에러를 고쳐주었다. 기존에 !res.locals.isAuth의 조건을 가지고 있던 부분은 !req.session.user 추가해 함께 확인하고, 없는 부분은 !req.session.user만 추가해서 확인해주도록 구성했다. 이 후에 또 저런 에러가 발생하면 추가로 추가해줄생각이다. 아마 배포하고나서 테스트를 또 해봐야할 것 같다.

- 이제 내일은 페이지네이션에서 또 다른 페이지네이션?을 추가할 것 같은데 다른 네이버, 다음 카페처럼 여러 페이지를 보여주는 페이지네이션 기능에서 정해놓은 페이지번호를 초과하면 다음 페이지로 다음 페이지 번호로 넘어가면서 페이지 이동이 되도록 해야할 것 같아서 이 부분을 수정해줄 생각이다. 이렇게 해주지않으면 페이지 버튼이 제한없이 무제한으로 늘어나기 때문에 제한을 어느정도 줘야한다고 생각이 되기 때문에 추가해볼 생각이다.

<br />

# 내일 할 일

- JS, ExpressJS, MongoDB로 게시판 제작 + (EJS)

<br />

# 앞으로 해야 할 일

- Advanced-js(고급 JS)에 대해 공부하며 이해하기 (JS 공부)

- Python으로 웹 스크래퍼 만들어보기

- Python, PHP 공부할 거 찾아보기

- Python 셀레니움, 브라우저 드라이버에 대해 한번 찾아보기

- Python 데이터 분석도 한번 봐보기
