# 오늘 한 일

### JS 토이 프로젝트 제작 (JS, ExpressJS, MongoDB로 만드는 게시판 + EJS)

- 게시판 제작 진행 과정

  - 댓글 수정 기능 추가
    - 수정과 취소 버튼이 한 줄에 나오지 않고, 취소가 다음 줄로 넘어가게 되면서 한 줄에 나오게 하기 위해서 div를 추가해서 하나로 묶어주고 거기서 display: flex로 바꿔주면서 flex-end를 주면서 오른쪽 구석으로 밀어주었다. 그 외에 css는 기존대로 유지했는데 여기서 수정, 취소, 등록 버튼을 조금 다르게 할까 생각중이다.
    - 기존에 textarea에 대해 텍스트 영역 높이를 조정하는 함수를 스크립트로 추가해주었는데 기존에는 댓글을 입력하는 textarea만 필요해서 id로 지정해서 하나의 textarea를 사용하기 때문에 문제가 없었으나, 현재는 수정을 클릭하면 textarea가 나오기 때문에 여기서 사용하려면 class로 바꿔줘서 다른 곳에서도 사용될 수 있게 스크립트 부분도 getElementById에서 querySelectorAll로 바꿔주었다.
    - 그리고 querySelector를 사용하면 첫 번째에 있는 textarea 필드만 선택되기 때문에 querySelectorAll로 바꿔주면서 forEach 메서드를 사용해서 각각의 요소에 이벤트 처리를 적용시켰다. 텍스트 영역 높이를 조정하는 함수들 내에서는 `this`키워드를 사용해 현재 처리 중인 textarea를 참조하도록 해주었다.
    - 수정 버튼에 대한 스크립트도 추가했는데 먼저 수정 버튼인 연필 모양을 클릭하면 그 아래에 입력하는 필드가 보이도록 해주었는데 이 필드는 먼저 display: none으로 보이지않다가 수정 버튼을 클릭시 display: block이 되면서 입력 필드가 보이도록 해주었다. 그리고 여기서도 어떤 댓글이 클릭되었는지 확인하기 위해서 forEach를 사용했다.
    - 취소 버튼도 스크립트를 추가해주었는데 처음에는 수정 버튼을 클릭했을 때 display: block으로 바뀌는 부분을 다시 none으로 바꿔주면서 보이지않게 해주기만 했는데 여러가지 테스트를 해보니 어떤 내용을 추가로 입력하고 취소 버튼을 누르면 그 입력 내용이 그대로 textarea 필드에 추가되어있는 것을 확인해 이 부분에서 취소 버튼을 누르면 원래 내용으로 다시 돌아가야하기 때문에 먼저 ejs에서 data-comment-content라는 dataset을 만들어주고 그 안에 원래 저장되어있는 데이터를 말해주는 `<%= comment.content %>`를 추가해주고, 취소 버튼의 이벤트리스너에 어떤 textarea인지 인덱스 요소로 접근하고, 해당 textarea.value 값에 먼저 ejs에서 추가했던 dataset 내용을 넣어주었다. 그러면서 이제 원래대로 display:none으로 바꿔주며 보이지않도록 해주었다. 
    - ejs에서 `data-comment-content="<%= comment.content %>"` 이렇게 dataset을 만든 내용은 js에서 dataset.commentContent로 사용할 수 있다. 여기서 `data-comment` 이렇게 사용하면 dataset.comment 또 다른 방식으로 `data-commentcontent` 이렇게 사용하면 dataset.commentcontent 이렇게 사용가능하다. 결국 data-commentcontent 이런식으로 사용하게 되면 표기법은 틀리다고 할 수 있다. 저 방식으로 사용하려면 data-comment-content 이렇게 사용해서 js에서 dataset.commentContent 처럼 사용해서 camelcase 방식을 사용해야한다. 또, data- 이게 dataset이므로, data- 뒤에 오는 부분이 객체의 속성 이름이 된다. 그래서 js에서 속성 이름을 camelcase로 변환해서 접근해야한다. 앞의 예시처럼 comment-content가 객체의 속성 이름이 되므로 dataset.commentContent가 된다.
    - 마지막으로 수정 관련 router에서 작업한 부분인데 이 부분은 원래 router.get으로 댓글 수정 부분 내용 페이지를 url로 이동해서 그 내용이 보이도록 해야하나 좀 고민을 했는데 router.get으로 따로 페이지를 이동해서 보여주는 것 없이 router.post로만 그냥 업데이트만 가능할 거 같아서 시도했는데 결과적으로는 제대로 업데이트되는 것을 확인했다.
    - router.get을 사용하면 할 수는 있는데 사용하게 되면 한번 웹 사이트가 새로고침 했을 때처럼 리로드되는게 불편해서 그렇게 하지않고 어떻게 해야하나 싶어서 router.post만 추가하고 그 내용이 보여지는 부분은 클라이언트 코드에서 처리를 해주었다. ejs와 스크립트로 처리해주었는데 이게 정답이었던 거 같다.
    - router.post("/posts/:id/comments/edit", ...) 부분에서는 기존의 delete와 내용이 거의 유사한데 거기서 변경된 건 입력한 내용이 업데이트가 되도록 해주는 부분인데 해당 수정 form의 name="content"에 해당하는 부분이 입력되어 mongodb 메서드인 updateOne을 통해서 업데이트 되게 해주었다. 
    - 생각보다 간단한 작업이었는데 여기서 혹시나 다른 form이 있고, name="content"를 사용하는데 req.body.content 부분이 제대로 작동할까 생각해보았는데 action 값이 서로 다른 경우 각각의 form은 독립적으로 데이터를 전송하기 때문에 name="content"가 겹치는 것은 문제가 되지 않는다. 결국 각 form은 자신의 action 경로로 데이터를 전송하고 해당 경로에 정의된 라우터에서 데이터를 처리하기 때문에 아무런 문제가 되지않는다.


  <br />

- 게시판 제작 진행 다음 목표

  - 댓글 기능
    - 답글쓰는 부분 기능을 추가해야함
    - 수정 부분도 해결은 함 근데 여기서 추가해야할 부분이 있는데 빈 문자열일 때 저장이 된다는 점인데 이 부분을 스크립트 처리로 해줘야할 것 같음
  - 구성은 되어있는데 혹시나 수정할 수도 있는 부분
    - 문제가 하나 있는데 비밀번호를 확인하고 일치했을 때 게시글이 생성되는 것은 좋은데 그 비밀번호를 저장하는게 사용자의 비밀번호를 그대로 저장을 하고 있기 때문에 이 부분을 변경해야 함
      - 방법1 해싱된 상태의 비밀번호가 저장이 되도록 한다. (테스트는 해봄)
      - 방법2 비밀번호는 게시글에 저장하지 않도록 한다. (현재는 이 방법으로 구성)
      - 이 부분은 더 이상 생각하지 않아도 될 거 같음 굳이 해싱된 비밀번호를 저장하지 않아도 될 거 같다는 생각 그래서 아이에 비밀번호를 게시글에 저장하지 않도록 해놓음
    - 패스워드, 수정, 삭제 에러 관련 동작 처리
      - 최종적으로 다시 모달창으로 변경해주었다. 이벤트리스너 에러를 if문으로 조건을 추가해 해당 페이지에 들어왔을 때 바로 작동하지 않도록 해주며 해결하였다.
      - 수정, 삭제는 그냥 게시글 작성자가 아니라면 버튼이 보이지 않도록 해 막아주었다.
      - 추가로 해당 게시글 작성자가 아닌데 url로 접속시도를 하는경우 401페이지로 이동하도록 해주었다.
    - 페이지당 5개의 게시글까지만 보여지도록 해놓았으니, 이제 페이지네이션도 똑같이 한 화면에는 5개까지의 페이지버튼이 보이도록하고, 그 다음 6~10 이런 페이지 버튼은 다음 페이지 버튼을 클릭 시 보이도록 하려고 생각 중
      - 이 부분도 수정해서 예로 13번까지 페이지 버튼이 있다면 5개 단위로 끊어져있고, 5페이지에서 다음 버튼 클릭시 6번으로 넘어가면서 6~10이 보여지고 또 10 페이지에서 다음 버튼 클릭시 11~13이 보여지도록 되어있다. (이 방법으로 구성되어있음)
      - 다른 방법으로 페이지 버튼이 이전과 다음 버튼으로 아이에 정해진 단위대로 이동하는 것
      - 또 다른 방법으로 현재 보이는 페이지를 페이지 버튼에서 중앙으로 잡고 이전과 다음 버튼으로 -1, +1 씩 이동하는 방식
    - 한 가지 확인해야 할만한게 수정 페이지에 가게되면 조회수가 1씩 계속 증가되는데 수정하지 않고, 취소해도 증가하는 부분을 확인해봐야함
      - 조회 수를 시간 간격을 10초 정도로 주며, 중복된 사용자나 다른 사용자가 다시 클릭해도 10초가 지나지않으면 오르지 않도록 설정해놓았다.
        - 이 부분도 시간을 좀 수정하거나 이 정도만 확인하면 될 것 같다.
      - 세션 만료시 일정 시간 후에 세션 데이터가 자동으로 삭제되도록 하는 코드를 추가해놓았는데 정상적으로 작동해서 이 부분은 이제 해결이 된 것 같다. (세션 부분 파일을 따로 분리해놓은 곳에서 추가해놓음)
    - 삭제할 때 비밀번호 확인이 필요한가...? 좀 고민해봐야 함 애초에 권한 유무로 삭제하기 때문에 굳이 라는 생각도 들기 때문에 좀 의견을 물어볼 필요가 있음
    - 방법1. 그냥 삭제가 되도록한다.
    - 방법2. 예, 아니오 창이 떠서 거기서 한번 더 의사를 물어보고 삭제할지 안할지 결정(이 방법으로 구성)
    - 방법3. prompt창을 사용해서 비밀번호를 입력해서 삭제한다.
    - 방법4. 모달창에서 비밀번호를 입력해서 비밀번호가 맞을 시 삭제

<br />

# 오늘 느낀 점

- 현재 댓글 부분의 수정, 등록, 취소가 모두 같은 css를 사용하고 있는데 여기서 수정과 등록은 통일성있게 같은걸로 해주고 취소만 변경해주면 될 거 같은데 이 부분은 조금 UI를 고민해봐야한다. 기존의 게시글 등록, 수정, 취소 이런 css를 그대로 가져와서 사용하기엔 조금 댓글부분에서는 아쉬운 부분이 있어서 변경해주려고 생각중이다.

- 댓글 수정 기능을 만들 때 많은 고민을 했는데 페이지를 다시 리로드하는 방식은 댓글 작성에 맞지 않다고 생각되어 router.post만 사용해서 작업을 하고 싶어 ejs에서 특정 조건을 추가해서 댓글 수정이 보이도록 해주고, 그걸 클릭했을 때 아래에 수정할 수 있는 입력창이 뜨도록 해주었는데 꽤 괜찮은 거 같다. 처음에는 수정 가능한 댓글 전체가 뜨도록해서 이것저것 방법을 시도했는데 여기서 스크립트를 추가해서 스크립트에서 어떤 댓글을 선택했는지 확인해서 수정할 수 있도록 해주니 문제가 해결되었다.

- 댓글 수정 부분에서 다른 카페나, 게시글에서 수정 부분 기능을 사용할 때 페이지가 리로드 되지않는 부분을 참고해서 비슷하게 구현해보았는데 꽤나 만족스럽다고 느낀다. 페이지를 리로드하면서 하는 방법도 있겠지만 뭔가 큰 차이는 아니지만 UX 부분에서 저게 좀 더 깔끔하고 좋다고 생각이 되며, 일반 사용자는 잘 못 느낄수도 있지만 개발자가 저 페이지를 본다면 분명히 뭔가 불편함을 느꼈을 것이라고 생각이 되는데 결과는 페이지가 리로드 되지않고 수정 부분을 입력할 수 있고 저장할 때만 리로드 되기 때문에 꽤 만족스러운 기능 추가라고 생각이 된다.

- 사실 댓글을 추가하고, 삭제하는 부분까지는 어떻게 되겠다 라는 생각은 했는데 여기서 수정 부분을 어떻게 추가해야할까 생각했을 때 조금 막막했는데 막상 해보니까 가능하기도 했고, 어떻게든 구현은 한 거 같다. 그리고 마지막으로 답글 쓰는 부분도 남았는데 이 부분 또한 수정과 비슷하다고 생각이 되는데 아마 가능하지 않을까 생각이 된다. 마지막 답글 쓰는 부분까지만 해결하면 생각했던 모든 기능이 완성이 되는데 포기하지않고 모든 기능을 완성해서 배포하는게 최종 목표이다.


<br />

# 내일 할 일

- JS, ExpressJS, MongoDB로 게시판 제작 + (EJS)

<br />

# 앞으로 해야 할 일

- Advanced-js(고급 JS)에 대해 공부하며 이해하기 (JS 공부)

- Python으로 웹 스크래퍼 만들어보기

- Python, PHP 공부할 거 찾아보기

- Python 셀레니움, 브라우저 드라이버에 대해 한번 찾아보기

- Python 데이터 분석도 한번 봐보기
