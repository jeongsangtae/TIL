# 오늘 한 일

### JS 토이 프로젝트 제작 (JS, ExpressJS, MongoDB로 만드는 게시판 + EJS)

- 게시판 제작 진행 과정

  - 수정 페이지에서 비밀번호 오류가 생겼을 때 입력한 값이 변경되지 않고 원래대로 돌아가는 부분을 수정
    - expressjs 라우터에서 처리해서 ejs로 보내는 방식으로 해결을 하려고 했으나, ejs에서 이미 에러 메시지를 전달 받기 때문에 그 에러 메시지를 보여줘야할 때 value나 textarea의 값이 수정되었던 값으로 나오도록 수정해주었다.
    - 게시글 내용에서 수정 페이지로 들어올 때는 에러 메시지를 띄우지 않기 때문에 게시글 내용의 내용을 그대로 보여주도록 함
    - 비밀번호 오류가 생겼을 때 에러 메시지를 보여주면서 그 수정한 값이 정상적 유지된다.
    - ejs에서 title, content에 if문을 추가하는데 조건으로 에러 메시지 전달받을 때 참으로 설정해 그때 변경되어있는 input 값으로 나오게 해주도록 하고, 그렇지않은 경우에 기존의 내용이 들어오도록 했다.
  - 수정 페이지에서 비밀번호 오류가 발생시 모달창을 띄우는 기능 추가
    - 기존의 새로운 게시글을 생성하는 페이지에서 추가한 모달창을 가져와서 사용하는데 비밀번호가 틀렸을 때 모달창을 띄우고 그 모달창에 비밀번호가 틀리다는 것을 알려준다.
    - 스크립트 파일을 따로 분리해 id를 바꿔 만들어주고, 기존의 모달창이 띄워진 상태에서 닫기 이벤트리스너 에러가 생길 수 있기 때문에 if문을 추가해 이벤트리스너 에러가 없도록 구성하였다.
    - 확인 결과 이벤트리스너 에러가 발생하지않는 것을 확인할 수 있었다.
  - 본인이 쓴 게시글이 아닌 경우 수정 페이지로 접근을 못해야 하는데 게시글 내용을 보여주는 페이지에서는 접근을 못하지만, url로 접근이 가능해 이 부분을 수정함
    - 내가 쓴 게시글이 아닌 다른 게시글을 클릭해 내용을 확인하고 버튼이 있는지 확인해봤는데 버튼은 목록 버튼만 있는 것을 확인할 수 있었다.
    - 버튼을 확인후에 혹시 다른 사용자의 게시글 수정 페이지를 url로 접근가능한지 확인해보니 분명 다른 사용자가 만든 게시물이고 수정, 삭제 버튼이 보이지않음에도 url로는 접근이 가능한 것을 알게되어 내용을 수정해서 완료까지 해보니 수정이 되는 것을 파악함
    - 수정 페이지를 보여주는 router.get에서 게시글 작성자 이메일과 현재 로그인한 사용자의 이메일을 비교하고, 다를 경우 401페이지로 이동하도록 해주었다.
    - if문을 사용해 게시글 작성자 이메일과 현재 로그인한 사용자의 이메일을 비교해 처리해주었는데 정상적으로 작동하는 것을 확인

  <br />

- 게시판 제작 진행 다음 목표

  - 페이지당 5개의 게시글까지만 보여지도록 해놓았으니, 이제 페이지네이션도 똑같이 한 화면에는 5개까지의 페이지버튼이 보이도록하고, 그 다음 6~10 이런 페이지 버튼은 다음 페이지 버튼을 클릭 시 보이도록 하려고 생각 중 (보류)
  - 한 가지 확인해야 할만한게 수정 페이지에 가게되면 조회수가 1씩 계속 증가되는데 수정하지 않고, 취소해도 증가하는 부분을 확인해봐야함 (이 부분은 로그인 기능을 추가하면 그 ID를 통해서 쿠키나 세션을 사용해 저장하고, 사용자가 클릭 시 조회수가 중복으로 상승하지 않도록 하는 로직을 구상 중)
  - 새로운 문제를 발견했는데 로그인 상태에서 글쓰기 페이지를 들어간 상태로 로그아웃을 하고 뒤로가기 버튼으로 다시가면 문제없이 글쓰기 페이지로 이동되는 문제를 발견
    - 확인해본 결과 글쓰기 페이지로 이동은 되지만 거기서 게시글을 생성해도 생성되지않고, 페이지 오류가 뜨면서 막히긴 하지만 그 이후에 다시 게시글 목록 페이지나 다른 페이지도 보여지지않고 페이지 오류가 뜨는 문제를 수정해야한다.
    - 로컬에서 테스트를 해서 계속 페이지 오류가 뜨는건지 이 부분은 확실하게 모르겠는데 이 부분은 좀 찾아볼 필요가 있다.
    - js파일을 다시 저장하면 페이지 오류 문제는 해결된다.
  - 문제가 하나 있는데 비밀번호를 확인하고 일치했을 때 게시글이 생성되는 것은 좋은데 그 비밀번호를 저장하는게 사용자의 비밀번호를 그대로 저장을 하고 있기 때문에 이 부분을 변경해야 함
    - 방법1 해싱된 상태의 비밀번호가 저장이 되도록 한다. (테스트는 해봄)
    - 방법2 비밀번호는 게시글에 저장하지 않도록 한다. (현재는 이 방법으로 구성)
    - 이 부분은 더 이상 생각하지 않아도 될 거 같음 굳이 해싱된 비밀번호를 저장하지 않아도 될 거 같다는 생각 그래서 아이에 비밀번호를 게시글에 저장하지 않도록 해놓음
  - 패스워드, 수정, 삭제 에러 관련 동작 처리
    - 최종적으로 다시 모달창으로 변경해주었다. 이벤트리스너 에러를 if문으로 조건을 추가해 해당 페이지에 들어왔을 때 바로 작동하지 않도록 해주며 해결하였다.
    - 수정, 삭제는 그냥 게시글 작성자가 아니라면 버튼이 보이지 않도록 해 막아주었다.
    - 추가로 해당 게시글 작성자가 아닌데 url로 접속시도를 하는경우 401페이지로 이동하도록 해주었다.
  - 삭제할 때 비밀번호 확인이 필요한가...? 좀 고민해봐야 함 애초에 권한 유무로 삭제하기 때문에 굳이 라는 생각도 들기 때문에 좀 의견을 물어볼 필요가 있음

<br />

# 오늘 느낀 점

- 수정 페이지에서 비밀번호가 틀렸을 때 스크립트를 추가해서 모달창이 뜨도록 추가해주었는데, 기존의 새 게시글을 추가하는 ejs 파일에서 내용을 가져와서 사용했는데 정상적으로 작동하는 것을 확인했다. console에서도 에러가 뜨는지 확인해보았는데 if문으로 똑같이 작업해주니 이벤트리스너 에러는 발생하지 않는 것을 확인할 수 있었다.

- 수정 페이지에서 내용을 변경하고 수정 버튼을 누른 후 비밀번호가 틀렸을 때 다시 그 페이지를 보여주면서 변경한 input 값이 보이도록 해야했는데 그 부분은 ejs파일에서 value와 textarea에서 if-else 조건문을 추가해 변경한 값이 보이도록 해주었다. 어제 라우터에서 작업할 때는 좀 처럼 해결하지 못했는데 좀 생각해보니 에러 메시지를 ejs에 전달하고 있는데 에러 메시지는 패스워드가 틀렸을 때 나오기 때문에 그걸 사용해서 ejs에서 에러 메시지가 전달되었을 때 수정한 값이 보이도록 해주니 간단하게 해결할 수 있었다.

- 로그인이 안된 상태에서 게시글을 볼 수 없어서 user에 null을 기본으로 주면서 조건문을 사용해 req.session.user가 존재하고 email 속성도 가지고 있는지 확인해서 해당 이메일 값을 기존처럼 userEmail에 할당해 findOne 메서드로 users의 이메일과 세션에 사용자 인증이 된 이메일을 확인해 일치하는 사용자를 조회한다. 그 다음 ejs파일에서 조건문을 사용하는데 이 내용에는 현재 로그인한 사용자가 게시글의 작성자인지 확인하는데 여기서 조건이 true가 된다면 목록, 수정, 삭제 버튼이 모두 보이도록 하고, false일 경우 목록 버튼만 보이도록한다. 참일 경우는 user가 존재하는데 null 값이 아니며, user.email과 post.email이 동일한 경우 참이 된다. 즉, 현재 로그인한 사용자가 게시글의 작성자인 경우가 된다. 거짓일 경우에는 user가 존재하지 않는 경우 즉, user가 null 값인 경우 그리고 user.email과 post.email이 동일하지 않은 경우 앞의 참일 때 2가지 조건중 하나라도 거짓이면 현재 로그인한 사용자가 게시글의 작성자가 아니거나, 로그인하지 않은 사용자로 판단해 목록 버튼만 보이도록 해주었는데 괜찮게 변경이 된 것 같다. 확실하게 로그인 했는지, 게시글 작성자인지 구분해서 버튼을 보여주기 때문에 좋은 것 같다.

- 본인이 쓴 게시글이 아닌 경우 수정, 삭제 버튼을 없애면서 수정, 삭제를 할 수 없도록 막아놓았는데 url에서 /edit을 추가하면 해당 게시글을 쓴 사용자가 아닌데도 그 페이지로 접속이 되는 것을 확인할 수 있었다. 심지어 게시글의 내용을 수정할 수 있었고, 비밀번호만 알맞게 입력한다면 변경한 내용을 그대로 업데이트할 수도 있었다. 그래서 if문을 추가해 게시글에 저장된 이메일과 사용자의 이메일을 확인해 일치하지 않는다면 401페이지를 보여주게 해주며 해결하였는데 이렇게 다른 페이지들도 저런 비슷한 문제들이 있는지 확인을 해봐야할 것 같다. 로그인을 하지 않은 상태에서 특정 페이지 접속은 처리를 다 해놓았던 것 같은데 한번 더 확인이 필요해보인다.

<br />

# 내일 할 일

- JS, ExpressJS, MongoDB로 게시판 제작 + (EJS)

<br />

# 앞으로 해야 할 일

- Advanced-js(고급 JS)에 대해 공부하며 이해하기 (JS 공부)

- Python으로 웹 스크래퍼 만들어보기

- Python, PHP 공부할 거 찾아보기

- Python 셀레니움, 브라우저 드라이버에 대해 한번 찾아보기

- Python 데이터 분석도 한번 봐보기
