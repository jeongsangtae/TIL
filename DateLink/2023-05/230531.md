# 오늘 한 일

### JS 토이 프로젝트 제작 (JS, ExpressJS, MongoDB로 만드는 게시판 + EJS)

- 게시판 제작 진행 과정

  - 답글 부분 기능 추가 (현재는 데이터가 mongodb에 저장되는 부분까지 구현)
    - 답글을 작성한 데이터를 어떤식으로 저장할까 두 가지 방법에서 많은 고민을 했는데 한 가지는 기존의 comments 컬렉션에 새로운 필드를 추가해서 저장하는 방식이고, 다른 한 가지 방법은 새로운 컬렉션을 만들어서 저장하는데 여기서 comments의 _id를 새로운 컬렉션에 저장해 부모-자식 관계로 묶는 방식을 생각했다.
    - 최종 선택은 새로운 컬렉션을 만들어서 거기서 부모-자식 관계를 comments의 _id를 저장해 구분할 수 있게 해주는 방식을 선택했다.
    - 먼저 스크립트로 답글쓰기를 클릭하면 답글을 작성할 수 있는 부분이 나오도록 해주었는데 이 부분은 기존의 css를 다른 수정처럼 display:none을 주었다가 답글쓰기 버튼을 클릭 시 block으로 바꿔주면서 보이도록 해주었다.
    - 그리고 취소 버튼을 추가해 기존과 같이 클릭했을 때 다시 none으로 바꿔주면서 답글쓰는 창이 보이지않도록 해주었다.
    - ejs에서는 기존에 사용하는 댓글 작성 공간을 가져와서 사용해 그냥 내용이 길게 추가되었을 뿐 크게 달라진건 없다. 기존의 form action은 당연히 연결해주기 위해서 조금씩 변경되었고 답글 부분에서 댓글과 부모 자식으로 연결해주기 위해서 해당 댓글의 _id값을 저장할 수 있게 input hidden 값을 추가해주었다.
    - 그리고 로그인하지 않은 사용자는 답글 쓰기를 할 수 없도록 `<% if (locals.isAuth) { %>`로 사용자 인증 관련 처리를 해주고 로그인하지 않은 사용자는 답글 쓰기 버튼에 opacity가 추가되어 아이에 답글 쓰기 버튼이 비활성화 되게 해주었다.
    - 마지막으로 ejs에서 이제 답글 부분을 라우터에서 데이터를 가져와서 보여주는 부분을 일단 추가는 해놓았는데 아직 라우터에서 저장은 되는데 이 데이터를 ejs로 보내서 보여지게 하는 부분이 제대로 작동하지않아서 수정이 필요한 상태이다.
    - 라우터 부분에서 데이터를 저장하는 부분은 ejs에서 input hidden 값을 서버로 받아와서 그 내용을 비교해서 확인 후 댓글에 대한 _id를 답글 부분에 저장하면서, 부모-자식 관계로 연결해서 데이터를 저장하도록 해주었다.
    - 데이터를 저장하는 부분은 정상적으로 되는 것을 확인했는데 이걸 보여지게 하는 부분에서 문제가 좀 생겼는데 이 부분을 수정해줘야할 것 같다. router.get("/posts/:id", ...) 이 부분에서 결국 reply를 넘겨서 그 내용이 보여져야하는데 아직 제대로 보여지지 않아서 처리가 필요하다.

  <br />

- 게시판 제작 진행 다음 목표

  - 댓글 기능
    - 답글쓰는 부분 기능을 추가해야함
    - 수정 부분도 해결은 함 근데 여기서 추가해야할 부분이 있는데 빈 문자열일 때 저장이 된다는 점인데 이 부분을 스크립트 처리로 해줘야할 것 같음
  - 구성은 되어있는데 혹시나 수정할 수도 있는 부분
    - 문제가 하나 있는데 비밀번호를 확인하고 일치했을 때 게시글이 생성되는 것은 좋은데 그 비밀번호를 저장하는게 사용자의 비밀번호를 그대로 저장을 하고 있기 때문에 이 부분을 변경해야 함
      - 방법1 해싱된 상태의 비밀번호가 저장이 되도록 한다. (테스트는 해봄)
      - 방법2 비밀번호는 게시글에 저장하지 않도록 한다. (현재는 이 방법으로 구성)
      - 이 부분은 더 이상 생각하지 않아도 될 거 같음 굳이 해싱된 비밀번호를 저장하지 않아도 될 거 같다는 생각 그래서 아이에 비밀번호를 게시글에 저장하지 않도록 해놓음
    - 패스워드, 수정, 삭제 에러 관련 동작 처리
      - 최종적으로 다시 모달창으로 변경해주었다. 이벤트리스너 에러를 if문으로 조건을 추가해 해당 페이지에 들어왔을 때 바로 작동하지 않도록 해주며 해결하였다.
      - 수정, 삭제는 그냥 게시글 작성자가 아니라면 버튼이 보이지 않도록 해 막아주었다.
      - 추가로 해당 게시글 작성자가 아닌데 url로 접속시도를 하는경우 401페이지로 이동하도록 해주었다.
    - 페이지당 5개의 게시글까지만 보여지도록 해놓았으니, 이제 페이지네이션도 똑같이 한 화면에는 5개까지의 페이지버튼이 보이도록하고, 그 다음 6~10 이런 페이지 버튼은 다음 페이지 버튼을 클릭 시 보이도록 하려고 생각 중
      - 이 부분도 수정해서 예로 13번까지 페이지 버튼이 있다면 5개 단위로 끊어져있고, 5페이지에서 다음 버튼 클릭시 6번으로 넘어가면서 6~10이 보여지고 또 10 페이지에서 다음 버튼 클릭시 11~13이 보여지도록 되어있다. (이 방법으로 구성되어있음)
      - 다른 방법으로 페이지 버튼이 이전과 다음 버튼으로 아이에 정해진 단위대로 이동하는 것
      - 또 다른 방법으로 현재 보이는 페이지를 페이지 버튼에서 중앙으로 잡고 이전과 다음 버튼으로 -1, +1 씩 이동하는 방식
    - 한 가지 확인해야 할만한게 수정 페이지에 가게되면 조회수가 1씩 계속 증가되는데 수정하지 않고, 취소해도 증가하는 부분을 확인해봐야함
      - 조회 수를 시간 간격을 10초 정도로 주며, 중복된 사용자나 다른 사용자가 다시 클릭해도 10초가 지나지않으면 오르지 않도록 설정해놓았다.
        - 이 부분도 시간을 좀 수정하거나 이 정도만 확인하면 될 것 같다.
      - 세션 만료시 일정 시간 후에 세션 데이터가 자동으로 삭제되도록 하는 코드를 추가해놓았는데 정상적으로 작동해서 이 부분은 이제 해결이 된 것 같다. (세션 부분 파일을 따로 분리해놓은 곳에서 추가해놓음)
    - 삭제할 때 비밀번호 확인이 필요한가...? 좀 고민해봐야 함 애초에 권한 유무로 삭제하기 때문에 굳이 라는 생각도 들기 때문에 좀 의견을 물어볼 필요가 있음
    - 방법1. 그냥 삭제가 되도록한다.
    - 방법2. 예, 아니오 창이 떠서 거기서 한번 더 의사를 물어보고 삭제할지 안할지 결정(이 방법으로 구성)
    - 방법3. prompt창을 사용해서 비밀번호를 입력해서 삭제한다.
    - 방법4. 모달창에서 비밀번호를 입력해서 비밀번호가 맞을 시 삭제

<br />

# 오늘 느낀 점

- 답글 부분을 엄청 고민을 많이 했는데 댓글과 마찬가지로 페이지 리로드를 하지않고 하기위해서 작업을 해봤는데 생각보다 간단하지 않은 거 같다. 데이터를 저장하는 부분에서는 문제없이 저장했는데 그 후에 보이는 부분에서 간단하게 해결될 거 같았던 문제가 생각보다 간단하게 해결되지 않아서 좀 어려움을 겪고 있다. 그래서 스크립트로 fetch를 사용해서 보내는 방법도 생각해보고 있고, 여러 방면으로 생각을 좀 해봐야할 것 같다.

- 아무래도 댓글에서 그냥 추가 필드로 저장을 했으면 조금 더 쉬웠을 거 같은 생각이 드는데 그래도 데이터를 관리함에 있어서 따로 컬렉션을 만들어서 부모-자식 관계로 연결하는게 더 데이터 관리하는데 도움도 되고 공부도 된다고 생각해 따로 저장해서 할 생각이다.

- 현재 데이터는 잘 저장이 되고 있기 때문에 한 단계는 해결을 한 거 같은데 이제 진짜 문제는 데이터를 보여지게 하는 부분인데 이 부분이 생각보다 순탄치 못한거 같다. 기존에 하던 방식으로 했는데 여기서 문제가 댓글의 _id를 가져오는 방식인데 이게 좀 문제가 있는거 같다. 게시글의 _id는 아주 쉽게 url에서 가져올 수 있는데 댓글의 _id는 input hidden으로 가져오고 있기 때문에 좀 더 복잡한 거 같은데 한번 머리를 열심히 굴려서 해결을 해봐야할 것 같다.

<br />

# 내일 할 일

- JS, ExpressJS, MongoDB로 게시판 제작 + (EJS)

<br />

# 앞으로 해야 할 일

- Advanced-js(고급 JS)에 대해 공부하며 이해하기 (JS 공부)

- Python으로 웹 스크래퍼 만들어보기

- Python, PHP 공부할 거 찾아보기

- Python 셀레니움, 브라우저 드라이버에 대해 한번 찾아보기

- Python 데이터 분석도 한번 봐보기
