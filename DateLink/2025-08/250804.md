# 오늘 한 일

### React + TypeScript 프로젝트 제작 (React, TypeScript, ExpressJS, MongoDB로 만드는 실시간 통신 애플리케이션)

- 다른 사용자 친구 목록 에러 해결 및 함께 아는 친구 목록 관련 내용 추가 및 함께 아는 친구 갯수 출력
  - 다른 사용자 친구 목록을 불러오는 부분에서 에러가 발생해 제대로 진행하지 못하고 있었는데, 변수 관련 오류를 수정해 정상적으로 다른 사용자 친구 목록을 불러올 수 있게 되었고, 로그인한 사용자와 다른 사용자 친구 목록을 비교해 함께 아는 친구 목록을 찾아서 갯수를 출력하도록 구성
  - 백엔드
    - friend-routes
      - 다른 사용자 친구 목록 조회하는 GET 라우터 수정
        - 프론트엔드에서 데이터가 넘어오는지 확인하기 위한 콘솔 로그 추가
        - otherUserfriends 변수 이름을 otherUserFriends로 수정
          - 잘못된 변수 이름과 연결로 인해 정상적인 데이터를 찾지 못했음
        - 프론트엔드로 전달하는 내용도 otherUserFriends로 수정
  - 프론트엔드
    - friendStore
      - loadOtherUserFriends 액션 수정
        - 콘솔 로그를 추가해 백엔드에서 데이터가 넘어오는지 확인
    - DirectChatDetails
      - useFriendStore Zustand에서 otherUserFriends 상태와 loadOtherUserFriends 액션을 불러오도록 구성
      - 새롭게 추가한 useEffect 주석 해제
        - 의존성 배열로 `otherUser?._id`를 추가해 다른 사용자가 변경되면 다시 실행되도록 구성
        - if문을 통해 `otherUser?._id`를 확인하고 loadOtherUserFriends 액션을 실행하며, 액션이 실행될 때 `otherUser?._id` 내용이 전달되도록 구성
      - otherUserFriendIds useMemo 내용 주석 처리
        - 해당 내용 대신에 사용자 친구 목록과 다른 사용자 친구 목록을 비교해 바로 공통된 친구 목록을 찾는 내용 추가
      - mutualFriends 변수 추가
        - 친구 목록에 map 함수를 사용
        - userFriendId 변수 추가
          - requester.id와 사용자 \_id를 비교
          - 일치할 경우 receiver.id를 반환
          - 일치하지 않을 경우 requester.id를 반환
        - userFriendId 변수와 다른 사용자 \_id를 비교
          - 같을 경우 return false가 실행되어 결과가 filter에서 제외
          - 다를 경우 다른 사용자 친구 목록에 some을 사용
        - otherUserFriendId 변수 추가
          - filter에서 제외되지 않은 내용에 some을 사용해 비교
          - requester.id와 다른 사용자 \_id를 비교해 일치하면 receiver.id
          - 일치하지 않으면 requester.id를 반환
        - return을 통해 반환하는 내용
          - otherUserFriendId와 userFriendId가 같고 otherUserFriendId와 사용자 \_id가 같지 않는 제 3자만 필터링해 반환하도록 구성
      - mutualFriendUsers 변수 추가
        - mutualFriends 내용에 map을 사용하도록 구성
        - requester.id와 사용자 \_id를 비교해 일치하면 receiver 내용을 반환
        - 일치하지 않으면 requester 내용을 반환하도록 구성
      - 추가로 확인을 위한 콘솔 로그 추가
      - JSX 코드 내용 수정
        - 다이렉트 채팅 패널 컴포넌트에 mutualFriendUsers props를 통해 mutualFriendUsers 내용이 전달되도록 구성
    - DirectChatPanel
      - JSX 코드 내용 수정
        - groupChatsShared의 길이와 mutualFriendUsers의 길이를 확인해 하나라도 0이 아닐 경우에만 내용이 보여지도록 조건부 수정
        - groupChatsShared의 길이가 0이 아닐 경우, 같이 있는 그룹 채팅방 갯수가 보여지도록 구성
        - groupChatsShared의 길이와 mutualFriendUsers의 길이 둘 다 0이 아닐 경우에만 중간에 밑줄이 보여지도록 구성
        - mutualFriendUsers의 길이가 0이 아닐 경우, 같이 아는 친구 갯수가 보여지도록 구성
  - 백엔드에서 다른 사용자 친구 목록을 전달하는 변수와 프론트엔드에서 전달받는 변수를 일치하도록 구성하지 않아 제대로 데이터를 불러오지 못하는 오류가 발생해 관련 오류를 수정했고, 정상적으로 전달받은 다른 사용자 친구 목록을 기존 사용자 친구 목록과 비교해 다른 사용자와 사용자 친구 관계를 제외한 공통적으로 알고 있는 친구만 필터링하도록 구성 및 해당 내용을 전달해 같이 아는 친구 갯수가 화면에 출력되도록 구성하고 확인한 결과, 이제는 오류없이 다른 사용자 친구 목록을 불러오며 사용자 친구 목록과 비교해 공통적으로 아는 친구 목록 갯수를 화면에 출력하는 것을 확인할 수 있었다.
    - 다른 사용자 친구 목록 관련 내용 오류는 해결되었지만, 갑자기 이전에 로그인했던 사용자 정보가 중복으로 친구 목록에서 보여지는 키 중복 오류가 발생하기 때문에 이와 관련된 수정 필요
    - 다이렉트 채팅방 패널 내에 구성된 함께 참여중인 그룹 채팅방 목록 관련 CSS 내용 추가 수정 필요
    - 다이렉트 채팅방 패널에 같이 아는 친구 관련 내용을 전달해 출력해야 함
    - 그룹 채팅방 패널에 현재 참여 인원 수를 보여주고, 접는 기능을 추가해 펼치면 닉네임 리스트를 보여주고 접으면 보이지 않는 내용, 채팅방 설명이나 소개 문구를 호스트가 간단하게 작성하고 수정하는 내용, 공지사항 또는 고정 메시지를 짧게 보여주는 내용, 참여자 역할을 구분하는 내용(방장, 일반, 초대 대기중 등) 등 여러 내용을 생각중
    - 정리해야 할 내용은 정리하고 채팅 목록과 관련된 스크롤 관련 기능을 수정해봐야 함
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/395dae859081873c15ce7d7f18644d218fea3724)

# 오늘 느낀 점

- 다른 사용자 친구 목록을 정상적으로 불러오도록 구성하고 해당 데이터와 사용자 친구 목록을 비교해 공통적으로 아는 친구 목록을 추출해 갯수를 출력하는 것까지는 문제없이 구성을 해주었는데, 갑자기 친구 목록에서 다시 키 중복 오류가 발생하게 되어 이와 관련된 오류를 수정해줘야 한다. 키 중복 오류가 다시 발생하게된 원인을 찾아봐야 하고 새롭게 추가한 내용들 때문에 키 중복이 발생하는지, 아니면 이전부터 키 중복이 발생했는데 관련 기능을 사용하지 않아서 발견하지 못했는지 확인이 필요한 상황이다. 저번에도 친구 목록쪽에서 비슷하게 키 중복 오류가 발생했던 기억이 있는데 한 번 오류 관련해 정리한 내용을 다시 살펴봐야 할 것 같고, 만약 빠르게 오류를 해결한다면 함께 참여한 그룹 채팅방 목록과 함께 아는 친구 목록을 갯수만 출력하는 것이 아닌, 전체 목록을 출력해 이동할 수 있도록 구성해볼 생각이다.

<br />

# 내일 할 일

- 실시간 통신 애플리케이션 (Float Chat) 프로젝트 진행

- Zustand 내용 구성

- 닉네임 수정과 그룹 채팅방 제목 수정 내용에서 사용하지 않거나 필요없는 정보를 삭제해 코드 정리를 해야 함 (중복된 데이터 전송이나 사용하지 않는 데이터 전송 관련 내용 등)

- 그룹 채팅방에서 다른 사용자를 클릭할 수 있고, 클릭 시에 다이렉트 채팅방이 생성되어 채팅을 나눌 수 있도록 구성하는 것을 고려중 (이 방법 대신, 다른 사용자 클릭 시에 프로필이 보여지도록 구성하고 그 내용을 통해 다이렉트 메시지를 보내거나 프로필 내용을 보는 그런 방식으로 구성해야 함)

- 출력되는 채팅 메시지 목록에 스크롤 관련 내용을 추가 수정해야 함

- 채팅 입력창에 적용된 스크롤 기능 추가 수정 필요

- 다이렉트 채팅방 목록이 정렬될 때 부드럽게 위로 올라가고 내려가는 CSS 적용 필요

- 친구 관련된 내용에서 코드 정리 필요 (코드를 깔끔하게 보이도록 수정 필요)

- 여러 Zustand에 구성된 실시간 반영 로직들이 재사용될 수 있도록 커스텀 훅에 옮겨서 구성하는 것을 고려해야 함

<br />

# 앞으로 해야 할 일

- React, TypeScript 공부

- React 상태 관리 도구인 Zustand 공부

- 실시간 통신 애플리케이션 프로젝트 제작
