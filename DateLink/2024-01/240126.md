# 오늘 한 일

### React 프로젝트 제작 (React, NodeJS, MongoDB로 만드는 미니 커뮤니티 플랫폼)

- 구성한 내용

  - JWT 코드 사용 및 테스트
    - JWT 코드 주석을 풀고 테스트를 진행했는데 로그인 시 토큰을 저장하는 로직이 뭔가 제대로 작동하지 않는 것 같다.
    - jwt-auth.js에서 토큰이 없는 경우 메시지를 전달하는 내용이 계속 표시되는데, 로그인 성공과 함께 토큰이 생성되어야 하는데 제대로 생성되고 저장되지 않는 것 같아서 추가 확인이 필요하다.
    - 만약 토큰이 추가되면 해당 토큰이 존재하는지 확인하고 로그인을 유지하는 코드도 구성을 했는데, 아직 토큰 추가가 제대로 작동하지 않아서 로그인 유지 코드가 정상적으로 작동하는지는 나중에 확인이 필요
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/bdd346814db910e04f51b49a171e61249f1b49c9)

  <br />

  - 토큰이 없다는 에러 문제
    - 로그인 시 토큰이 없다는 에러가 계속 발생해서 문제를 해결하기 위해서 수정해보고 작업을 진행해보았지만, 서버 측 코드가 문제인지 클라이언트 측 코드가 문제인지 정확히 파악을 하지 못했다.
    - 서버와 클라이언트 코드 모두 문제가 없어보이는데 계속 토큰이 없다고 하기 때문에 어떤식으로 수정을 해야 할 지 감을 전혀 못잡고 있다.
    - JWT를 처음 사용해서 아무래도 제대로 코드 구성을 못한 거 같다는 생각도 드는데 내용을 찾아봐도 뭔가 명확하게 알 수가 없어서 오히려 혼란스럽다고 생각이 된다.
    - 로그인을 먼저 성공시킨 후에 토큰이 생성되고 저장되도록 하는 것이 맞다고 생각되어 그런 방식으로 코드를 작성한 것 같은데, 조금 다른 방법을 생각해봐야 할 것 같다.
    - JWT 관련 내용을 좀 더 찾아보고 문제를 해결해야 할 것 같음
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/c9cf4cd8c4ab25e3e3d930a6b85956cbfce50aa0)

<br />

- 추가 및 해결 해야 할 내용
  - 회원가입 form에서 잘못된 입력을 제출 했을 때, session에 데이터가 저장되는데, 기존의 session 데이터에서 업데이트되는 방식이 아닌 매번 제출할 때마다 새로운 session이 추가되고 있기 때문에 백엔드 코드에서 수정이 필요하다.
    - 계속 원인을 찾아보려고 이것저것 시도해보았지만 아직 어떤 코드가 정확히 원인인지 찾지 못해서 하나씩 천천히 테스트가 필요함
    - 일단 이걸 테스트 해보기전에 먼저 정상적으로 세션 만료가 되는지 확인해보았는데 정상적으로 세션 만료가 되기 때문에, 로그인을 먼저 구성해보고 정상적으로 로그인이 되는지 확인을 해보고 안된다면, session에 저장되는 부분을 다시 확인해봐야 할 것 같다는 생각
  - 로그인이 되는지 확인하고, 로그인이 되었다면 메인헤더가 변경되도록 구성해야 함
    - `req.session.isAuthenticated`를 프론트엔드에 전달해서, useState를 이용해 메인헤더가 변경되도록 해주면 될 것 같음 (완료)
    - 현재 결과로 따지면 로그인도 되고, 메인헤더가 변경되긴 하지만 순환 참조 오류가 있어서 추가 작업이 필요함 (완료)
    - 로그인 시 `isAuthenticated` 정보가 MainHeader 컴포넌트로 넘어가서 useState에 true로 값이 저장되며, 해당 값을 사용해서 조건부 렌더링이 작동하도록 구성해서 순환 참조 오류없이 작동하도록 구성 (완료)
  - 로그인 후에, 새로고침 시 로그아웃 되어버리는 상황도 수정을 해야 함
    - JWT를 사용해서 클라이언트 측에서 state를 유지하게 해줘야 한다.
      - 사용자의 인증 정보를 클라이언트에 저장해서 지속적으로 유지해야 함
    - session에서 넘어온 데이터를 통해 sessionStorage에 저장해서 로그인이 유지되도록 구성되어 있으며, 이 내용에 JWT를 추가해서 구성해볼까 생각중
      - 로그인은 새로고침 시에도 문제없이 유지됨
  - 로그아웃 기능도 추가해야 함
    - 로그인이 성공하면 메인헤더가 변경되고 로그아웃 버튼이 추가되며, 로그아웃 버튼 클릭 시 메인 헤더의 내용이 초기 상태로 돌아오도록 구성을 해줘야 함 (완료)
    - 구성한 내용을 테스트 해본 결과 정상적으로 동작하고 있기 때문에 이 상태로 유지하고 추가로 로그인 관련 코드를 변경하면 추가 수정을 해줄 생각이다.
  - JWT 관련 코드 추가 후 문제
    - 로그인을 시도하면 토큰이 없다는 메시지와 함께 로그인이 불가능함
    - 로그인을 먼저 성공시키고 토큰이 생성되고 저장되도록 구성을 한 것 같은데, 뭔가 순서가 잘못된 건지 토큰이 계속 없다는 메시지만 나오고 있는 상황
    - 현재 생각한 내용으로는 백엔드에서 토큰이 없다면 토큰을 먼저 생성하도록 하는 if문을 추가해볼까 생각을 해보고 있는데 테스트를 해봐야 알 것 같음

# 오늘 느낀 점

- JWT 내용을 사용하는 방향으로 생각하고 테스트를 진행했는데 내가 원하는대로 작동이 안되고 있기 때문에 코드를 변경해봐야 할 것 같다. 현재 토큰이 생성되지 않은 상황에서 로그인 성공과 함께 토큰이 자연스럽게 추가가 되도록 코드를 구성한 것 같은데 아직 이 코드가 정상적으로 작동하지 않는 것 같아서, 조금 다르게 생각해서 먼저 토큰이 있는지 확인하고 해당 토큰이 없다면 생성부터 진행이 되도록 코드를 변경해볼까 생각을 해보고 있는데, 좀 더 JWT의 예시 코드를 찾아본 후에 코드를 수정해야 할 것 같다.

<br />

# 내일 할 일

- React 공부 및 React 프로젝트 조금씩 진행하기

<br />

# 앞으로 해야 할 일

- React, NextJS 공부

- React 프로젝트 제작
