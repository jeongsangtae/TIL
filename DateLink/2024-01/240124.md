# 오늘 한 일

### React 프로젝트 제작 (React, NodeJS, MongoDB로 만드는 미니 커뮤니티 플랫폼)

- 구성한 내용

  - 로그아웃 로직 추가
    - 백엔드에서 logout router를 추가하고, 해당 라우터에는 user 데이터를 null로 만들고, isAuthenticated를 false로 변경한 후에 isAuthenticated를 클라이언트로 전달하도록 구성
    - 프론트엔드의 메인헤더에서 직접 logout router를 post하고, 로그아웃 버튼 클릭 시 sessionStorage에 있는 "isAuthenticated"를 삭제하고, authenticated를 false로 지정
      - logout router에서 받아온 isAuthenticated가 false이기 때문에 false의 내용이 useState에 들어가게 되면서, 조건부 렌더링 또한 작동해서 변경되록 구성
    - 현재 이 상태로 정상적으로 작동하긴 하지만 굳이 logout router를 사용하지 않고 작동하도록 변경할 수 있을 것 같아서 변경해볼 생각
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/7c5015674945bc3054f40d5939bfa88db04b98fa)

  <br />

  - 로그아웃 로직 변경
    - 백엔드에 있는 logout router를 주석 처리하고 테스트를 진행
    - 프론트엔드 코드에서 logout router를 post하는 부분도 삭제를 한 후에, 버튼 클릭 시 sessionStorage에서 "isAuthenticated"가 삭제되도록 해주고, authenticated useState는 `!authenticated`로 구성해서 기존의 true가 되어있던 내용을 false가 되도록 구성
    - 이 상태로도 문제없이 로그아웃이 가능되기 때문에 굳이 백엔드에 추가할 필요성을 못 느낌
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/4aadfce4bf8cc30b800c08ae8c3f74e40f2b1a45)

  <br />

  - 백엔드 로그아웃 로직을 사용해야 할 필요가 있는가 ?
    - 현재는 굳이 없다고 판단됨
    - 이유는 로그아웃 처리를 클라이언트에서 처리할 수 있고, 클라이언트 측에서 로그아웃을 처리하는 것이 일반적으로 더 빠르고 유연한 방법이기 떄문이다.
    - 그리고 무엇보다 현재 session으로 추가해놓은 코드가 제대로 활용이 되고 있는지, 필요성을 못 느끼고 있는 상황이기 때문에 로그아웃에서는 일단 백엔드 코드 없이 클라이언트 측에서 처리하는 것으로 결정
      - 예전에 구성한 게시판에서는 session 데이터가 뭔가 정상적으로 작동하는 느낌이었는데 React와 함께 구성하면서 느낀 건 내가 생각한 것과는 다르게 session 데이터가 계속 저장되고 있기 때문에 원치 않은 동작을 하고 있다고 생각되어 변경할 필요성을 느낀다.
    - JWT를 사용해서 함께 구성할 때, 필요할 수도 있을 거 같다는 생각이 있기 때문에 완전히 삭제보다는 주석처리하고 진행할 생각이다.

<br />

- 추가 및 해결 해야 할 내용
  - 회원가입 form에서 잘못된 입력을 제출 했을 때, session에 데이터가 저장되는데, 기존의 session 데이터에서 업데이트되는 방식이 아닌 매번 제출할 때마다 새로운 session이 추가되고 있기 때문에 백엔드 코드에서 수정이 필요하다.
    - 계속 원인을 찾아보려고 이것저것 시도해보았지만 아직 어떤 코드가 정확히 원인인지 찾지 못해서 하나씩 천천히 테스트가 필요함
    - 일단 이걸 테스트 해보기전에 먼저 정상적으로 세션 만료가 되는지 확인해보았는데 정상적으로 세션 만료가 되기 때문에, 로그인을 먼저 구성해보고 정상적으로 로그인이 되는지 확인을 해보고 안된다면, session에 저장되는 부분을 다시 확인해봐야 할 것 같다는 생각
  - 로그인이 되는지 확인하고, 로그인이 되었다면 메인헤더가 변경되도록 구성해야 함
    - `req.session.isAuthenticated`를 프론트엔드에 전달해서, useState를 이용해 메인헤더가 변경되도록 해주면 될 것 같음 (완료)
    - 현재 결과로 따지면 로그인도 되고, 메인헤더가 변경되긴 하지만 순환 참조 오류가 있어서 추가 작업이 필요함 (완료)
    - 로그인 시 `isAuthenticated` 정보가 MainHeader 컴포넌트로 넘어가서 useState에 true로 값이 저장되며, 해당 값을 사용해서 조건부 렌더링이 작동하도록 구성해서 순환 참조 오류없이 작동하도록 구성 (완료)
  - 로그인 후에, 새로고침 시 로그아웃 되어버리는 상황도 수정을 해야 함
    - JWT를 사용해서 클라이언트 측에서 state를 유지하게 해줘야 한다.
      - 사용자의 인증 정보를 클라이언트에 저장해서 지속적으로 유지해야 함
    - session에서 넘어온 데이터를 통해 sessionStorage에 저장해서 로그인이 유지되도록 구성되어 있으며, 이 내용에 JWT를 추가해서 구성해볼까 생각중
      - 로그인은 새로고침 시에도 문제없이 유지됨
  - 로그아웃 기능도 추가해야 함
    - 로그인이 성공하면 메인헤더가 변경되고 로그아웃 버튼이 추가되며, 로그아웃 버튼 클릭 시 메인 헤더의 내용이 초기 상태로 돌아오도록 구성을 해줘야 함 (완료)
    - 구성한 내용을 테스트 해본 결과 정상적으로 동작하고 있기 때문에 이 상태로 유지하고 추가로 로그인 관련 코드를 변경하면 추가 수정을 해줄 생각이다.

# 오늘 느낀 점

- 로그아웃에서 백엔드 관련 내용을 추가하고 프론트엔드로 해당 데이터를 전달하고 사용해서 구성했는데 문제 없이 작동했다. 백엔드 코드 없이 프론트엔트에서의 구성만으로도 로그아웃을 할 수 있을 것 같다는 생각이 들어서 제거하고 구성한 결과 문제 없이 작동하는 것도 확인할 수 있었다. 현재 session 데이터가 인증의 문제를 처리하는 것이 아닌, 단순하게 데이터를 저장하고 확인하는 용도로 사용되고 있는 것 같아서 굳이 필요한가라는 생각이 들어서 좀 고민이 된다. 물론 회원가입이나 로그인 시 잘못된 정보 입력에 대해 오류 메시지를 저장하고 전달하는 역할도 하지만 과연 이 역할만으로 session을 사용할 필요가 있는지 좀 의문이라서 내용을 찾아봐야 할 것 같다는 생각이 든다. 예전에 게시판을 만들 때는 session을 통해서 사용자를 인증하고 확인해서 가입도 되도록 해주고, 로그인도 되도록 사용했었는데 이번에 클라이언트 측을 나눠서 구성할 때는 뭔가 내가 생각한대로 동작하지 않아서 빼는 방향도 생각을 해보고 있는데 정보를 찾아보고 확실하게 결정을 해야 할 것 같다.

<br />

# 내일 할 일

- React 공부 및 React 프로젝트 조금씩 진행하기

<br />

# 앞으로 해야 할 일

- React, NextJS 공부

- React 프로젝트 제작
