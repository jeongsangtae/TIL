# 오늘 한 일

### React 프로젝트 제작 (React, NodeJS, MongoDB로 만드는 미니 커뮤니티 플랫폼)

- 구성한 내용

  - 코드 정및 및 변수 이름 변경
    - login get router에서 추가했던 안쓰는 코드를 삭제
    - 변수 이름을 조금씩 변경해주었는데, 최대한 React 관습에 맞게 변경해주었다.
      - 함수를 prop을 통해서 전달할 때 on을 붙여서 좀 더 구분이 쉽도록 해주었고, 겹치는 변수명도 수정해주었다.
      - 원래라면 주석처리한 코드도 삭제하고 추가로 정리를 해야 했지만, 일단 주석 처리된 코드는 혹시 몰라서 유지해놓고 구성 내용이 안정적이고 문제가 없다면 그 때 삭제할 생각이다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/a8f522d67fde7d7640d8db664e01053feceefd41)

  <br />

  - 로그인 후, 새로고침 시 로그아웃 되는 문제를 해결하기 위한 해결책
    - 방법을 찾아보니 React에서는 클라이언트 측에서 사용자의 상태를 관리해야 하기 때문에, JWT 같은 클라이언트 측에서 사용되는 인증 방식이 필요하다고 한다.
      - JWR 같은 인증 방식을 사용해서 새로고침에도 React 컴포넌트의 상태가 초기화되지 않고 유지될 수 있다.
    - React에서의 state는 기본적으로 컴포넌트의 라이프사이클과 관련이 있기 때문에 새로고침이 발생하면 컴포넌트의 상태가 초기화된다.
      - React 컴포넌트 내에서의 상태는 클라이언트 측에서만 유지되며, 새로고침 시 초기화되는 것이 일반적이다.
      - 클라이언트 측에서는 JWT 등을 사용해 인증 정보를 유지하는 것이 일반적인 패턴
    - JWT (JSON Web Token)
      - React에서는 클라이언트 측에서 사용자의 인증 정보를 관리하기 위해 JWT와 같은 방법을 사용
      - JWT는 클라이언트 측에서 안전한 저장소에 저장되어, 새로고침이나 페이지 이동과 관계없이 계속해서 유지될 수 있다.
    - 서버 측 구성
      - express-session 그리고 connect-mongodb-session를 사용해서, 서버 측에서 세션을 처리하고 사용자의 세션 데이터를 안전하게 저장
    - 클라이언트 측 구성
      - 클라이언트 측에서는 JWT를 사용해서 사용자의 인증 정보를 안전하게 저장하고 전송하도록 한다.
      - JWT는 클라이언트의 안전한 저장소 (localStorage, sessionStorage)에 저장
      - 클라이언트에서 저장할 때는 보안을 고려해서 localStorage보다는 sessionStorage를 사용하는 것이 좋다고 함
    - 작동하는 방식
      - 사용자가 로그인하면 서버는 세션을 생성하고, 클라이언트에게 세션 ID나 토큰 등을 전달
      - 동시에 서버는 클라이언트에게 JWT(토큰)를 생성하여 전달
        - JWT에는 사용자의 식별 정보와 기타 필요한 정보가 담겨있음
      - 클라이언트는 받은 JWT를 안전한 저장소에 저장하고, 세션 ID와 함께 요청 시에 서버에 전달
        - 클라이언트는 JWT(토큰)을 이용하여 인증된 요청을 서버에 보낸다.
      - 서버는 세션 ID를 이용하여 서버 측의 세션에서 사용자를 인증하고, 클라이언트가 제공한 JWT를 검증하여 추가적인 사용자 정보를 확인
        - 서버는 클라이언트에서 받은 JWT(토큰)을 검증하여 사용자를 인증
    - 요약하면 백엔드에서 세션을 유지하고, 클라이언트에서는 해당 세션 정보를 안전하게 저장하는 방식 그리고 클라이언트에서 요청 시에 서버에 JWT를 전달해서 인증 및 검증하고 확인하는 방식

<br />

- 추가 및 해결 해야 할 내용
  - 회원가입 form에서 잘못된 입력을 제출 했을 때, session에 데이터가 저장되는데, 기존의 session 데이터에서 업데이트되는 방식이 아닌 매번 제출할 때마다 새로운 session이 추가되고 있기 때문에 백엔드 코드에서 수정이 필요하다.
    - 계속 원인을 찾아보려고 이것저것 시도해보았지만 아직 어떤 코드가 정확히 원인인지 찾지 못해서 하나씩 천천히 테스트가 필요함
    - 일단 이걸 테스트 해보기전에 먼저 정상적으로 세션 만료가 되는지 확인해보았는데 정상적으로 세션 만료가 되기 때문에, 로그인을 먼저 구성해보고 정상적으로 로그인이 되는지 확인을 해보고 안된다면, session에 저장되는 부분을 다시 확인해봐야 할 것 같다는 생각
  - 로그인이 되는지 확인하고, 로그인이 되었다면 메인헤더가 변경되도록 구성해야 함
    - `req.session.isAuthenticated`를 프론트엔드에 전달해서, useState를 이용해 메인헤더가 변경되도록 해주면 될 것 같음 (완료)
    - 현재 결과로 따지면 로그인도 되고, 메인헤더가 변경되긴 하지만 순환 참조 오류가 있어서 추가 작업이 필요함 (완료)
    - 로그인 시 `isAuthenticated` 정보가 MainHeader 컴포넌트로 넘어가서 useState에 true로 값이 저장되며, 해당 값을 사용해서 조건부 렌더링이 작동하도록 구성해서 순환 참조 오류없이 작동하도록 구성 (완료)
  - 로그인 후에, 새로고침시 로그아웃 되어버리는 상황도 수정을 해야 함
    - 순환 참조 오류는 해결했지만, 로그인하고 새로고침하면 다시 메인헤더가 로그인하지 않은 상태로 돌아오기 때문에 수정이 필요하다.
    - JWT를 사용해서 클라이언트 측에서 state를 유지하게 해줘야 한다.
      - 사용자의 인증 정보를 클라이언트에 저장해서 지속적으로 유지해야 함
  - 로그아웃 기능도 추가해야 함
    - 로그인이 성공하면 메인헤더가 변경되고 로그아웃 버튼이 추가되며, 로그아웃 버튼 클릭 시 메인 헤더의 내용이 초기 상태로 돌아오도록 구성을 해줘야 함

# 오늘 느낀 점

- React에서 새로고침시 state 값이 초기화되고, 로그인 정보가 날아가는 것을 해결하기 위해서 방법을 찾아보았는데 JWT를 사용해서 클라이언트 측에서도 사용자의 인증 정보를 저장해서 유지해야 해줘야 한다. 예전에 JS + ExpressJS + EJS + MongoDB로 제작한 게시판에서는 express-session과 connect-mongodb-session으로도 세션을 유지하고 관리하며, 새로고침에도 무관하게 사용자의 인증 상태를 유지할 수 있었지만, React 애플리케이션에서는 클라이언트 측에서 사용자의 상태를 관리해야 하기 때문에 JWT와 같은 클라이언트 측에서 사용되는 인증 방식이 필요하다. 이를 통해 새로고침에도 React 컴포넌트의 상태가 초기화되지 않고 유지될 수 있게 된다. 이제 JWT를 추가하고 sessionStorage에 저장해서 로그인 후에 새로고침을 진행해도 로그아웃이 자동으로 되지 않도록 구성해줄 생각이다.

<br />

# 내일 할 일

- React 공부 및 React 프로젝트 조금씩 진행하기

<br />

# 앞으로 해야 할 일

- React, NextJS 공부

- React 프로젝트 제작
