# 오늘 한 일

### React 프로젝트 제작 (React, NodeJS, MongoDB로 만드는 미니 커뮤니티 플랫폼)

- 구성한 내용

  - sessionStorage를 사용해서 데이터 저장 테스트
    - JWT를 확인해보기 전에 기존의 session 데이터를 통해서, sessionStorage에 저장하고 로그인이 유지되게 할 수 있을 것 같아서 테스트
    - JWT로 추가한 코드를 주석처리하고 기존의 코드인 Login.jsx에서는 sessionStorage에 setItem을 사용해서, isAuthenticated라는 이름에 isAuthenticated 데이터를 넣어준다.
    - 그 후에, MainHeader.jsx에서 useEffect를 추가하고 sessionStorage에 getItem을 사용해서, isAuthenticated라는 이름에 true가 존재하는지 확인하고 true가 존재한다면 로그인을 유지, 존재하지 않는다면 로그인이 유지되지 않는다.
    - 이렇게 구성함으로써 새로고침 시에도 useEffect가 동작하고 확인해서 로그인을 유지할 수 있게 된다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/8441a48df982b27d6f1f8f6ca72320c6ebdff0a3)

  <br />

  - JWT를 사용해서 로그인 유지 또는 session을 사용해서 로그인 유지
    - 이제까지 useState가 새로고침 시 초기화되는 라이프사이클로 인해, session을 사용해서는 로그인 유지가 불가능하다고 생각을 했는데 이 것은 session이 문제가 아닌, storage에 저장하는 방법을 생각하지 못해서 발생한 문제였다고 생각이 된다.
    - 그래서 추가한 JWT를 사용해서 구성하는 것이 옳은지, 기존에 추가한 session을 계속 사용해서 진행하는 것이 옳은 지 생각을 좀 해봐야 한다.
    - 그리고 sessionStorage에 사용자 로그인과 관련된 boolean 내용을 저장하는 것이 옳은 지도 판단을 해야 한다.
    - 생각한 방법 정리
      - JWT 사용
        - JWT를 사용하면 서버에서 생성한 JWT 토큰을 클라이언트에 전달하고 클라이언트에서는 이 토큰을 sessionStorage나 쿠키에 저장하는 방법은 일반적으로 많이 사용한다고 하기 떄문에 여기서 한 번 사용해볼까 생각을 하고 있다.
        - 보안 부분에서는 JWT는 서명되어 있기 때문에 데이터 위조가 어려워서 안전하다고 하며, 클라이언트 측에서 편리하게 저장 및 사용 가능하다고 한다.
        - XSS 공격에 취약할 수 있다고 하는데, 토큰이 클라이언트 측에 저장되기 때문에 탈취된 경우 보안에 취약할 수 있다고 함
      - Express-session과 Connect-mongodb-session 사용
        - 이 session들을 사용하면 서버 측에서 세션을 유지하기 때문에 안전하게 유지할 수 있다.
        - 클라이언트에는 세션 정보가 저장되지 않아 XSS 공격에 강하지만, 서버 자원을 사용해서 세션을 유지하므로 서버 부하가 있을 수 있다.
        - 이 방법을 사용해도 역시나, 로그인이 되었을 때의 인증과 관련된 boolean 같은 정보를 클라이언트에 저장해야 하기 때문에 JWT와 비슷하다고 볼 수도 있을 것 같다. 물론 JWT는 조금 다르게 다른 정보도 저장될 수 있지만 작동하는 방식은 결국 storage를 사용해야 하기 때문에 비슷하다고 생각이 된다.
      - localStorage, sessionStorage, 쿠키 등 어디에 저장되어야 할까 ?
        - localStorage
          - 브라우저를 닫아도 지속된다. 장기간 정보를 저장하기에 적합
        - sessionStorage
          - 세션이 끝날 때까지만 유지, 브라우저를 닫으면 데이터가 삭제된다.
        - 쿠키
          - 만료 시간을 설정하여 장기간 유지할 수 있으며, 서버로 자동 전송
        - 결론적으로 고민해보았을 때, sessionStorage가 적당하다고 생각이 되었다. 세션에 정해놓은 만료 시간도 있고, 브라우저를 닫으면 로그아웃이 되는 것이 좋다고 생각을 했기 때문이다.
      - 최종 결론
        - 많이 고민해보고 생각해본 결과, 일단은 session을 사용한 내용으로 로그아웃까지 구현을 한 후, JWT로 변경을 해볼까 생각하고 있다. 그리고 조금 복잡할 수도 있지만 session과 JWT를 함께 사용하는 방향도 생각중이다. 그 전에 우선 JWT만 사용해서 구성해볼 생각이다. 클라이언트에서 저장하는 곳은 sessionStorage으로 결정했는데, storage나 쿠키의 장점을 생각해보았을때, 내가 구상한 내용과 가장 잘 맞는 것은 sessionStorage 이라고 생각이 되어, sessionStorage로 결정

<br />

- 추가 및 해결 해야 할 내용
  - 회원가입 form에서 잘못된 입력을 제출 했을 때, session에 데이터가 저장되는데, 기존의 session 데이터에서 업데이트되는 방식이 아닌 매번 제출할 때마다 새로운 session이 추가되고 있기 때문에 백엔드 코드에서 수정이 필요하다.
    - 계속 원인을 찾아보려고 이것저것 시도해보았지만 아직 어떤 코드가 정확히 원인인지 찾지 못해서 하나씩 천천히 테스트가 필요함
    - 일단 이걸 테스트 해보기전에 먼저 정상적으로 세션 만료가 되는지 확인해보았는데 정상적으로 세션 만료가 되기 때문에, 로그인을 먼저 구성해보고 정상적으로 로그인이 되는지 확인을 해보고 안된다면, session에 저장되는 부분을 다시 확인해봐야 할 것 같다는 생각
  - 로그인이 되는지 확인하고, 로그인이 되었다면 메인헤더가 변경되도록 구성해야 함
    - `req.session.isAuthenticated`를 프론트엔드에 전달해서, useState를 이용해 메인헤더가 변경되도록 해주면 될 것 같음 (완료)
    - 현재 결과로 따지면 로그인도 되고, 메인헤더가 변경되긴 하지만 순환 참조 오류가 있어서 추가 작업이 필요함 (완료)
    - 로그인 시 `isAuthenticated` 정보가 MainHeader 컴포넌트로 넘어가서 useState에 true로 값이 저장되며, 해당 값을 사용해서 조건부 렌더링이 작동하도록 구성해서 순환 참조 오류없이 작동하도록 구성 (완료)
  - 로그인 후에, 새로고침시 로그아웃 되어버리는 상황도 수정을 해야 함
    - JWT를 사용해서 클라이언트 측에서 state를 유지하게 해줘야 한다.
      - 사용자의 인증 정보를 클라이언트에 저장해서 지속적으로 유지해야 함
    - JWT 대신에 기존에 사용하던 session의 정보를 클라이언트에 저장해서 유지할 수 있게 구성 즉, 로그인 유지는 가능하게 되었음
      - 그러나, 보안과 관련된 문제가 조금 있어서 JWT를 사용해야 하나 고민중
  - 로그아웃 기능도 추가해야 함
    - 로그인이 성공하면 메인헤더가 변경되고 로그아웃 버튼이 추가되며, 로그아웃 버튼 클릭 시 메인 헤더의 내용이 초기 상태로 돌아오도록 구성을 해줘야 함

# 오늘 느낀 점

- 기존에 구성한 session의 내용을 사용해서 클라이언트의 sessionStorage에 내용을 저장하고 로그인이 유지되도록 구성했는데 결과적으로 잘 작동하는 것 같아서 나쁘지 않다고 생각이 된다. 계속 useEffect를 생각하긴 했지만, 제대로 적용시키지 못해서 어떻게 해야 하는 건지 많이 고민했는데 결국 클라이언트 측에서도 무언가 저장하는 곳이 필요했는데 그 내용을 생각하지 못해서 많이 돌아온 것 같다. localStorage는 이미 몇 번 다뤄보았고 알고 있는 내용인데도 전혀 생각하지 못했고, 또 너무 어렵게 생각해서 놓쳤던 것 같다. 그래도 이제 방법을 찾았기 때문에 session을 사용할 지, JWT를 사용할 지, 둘 다 사용할 지 결정하면 된다고 생각이 된다. 그리고 클라이언트 측에 저장하는 것도 sessionStorage를 사용할 생각이고, 간단한 데이터만 저장하면 보안과 관련된 문제도 없기 때문에 괜찮다고 생각이 된다. 이제 session의 데이터로 로그인이 되기 때문에 로그아웃 코드를 추가하고 이후에 JWT의 토큰을 사용해서 작업도 진행해보고 여러가지 테스트를 진행해볼 생각이다.

<br />

# 내일 할 일

- React 공부 및 React 프로젝트 조금씩 진행하기

<br />

# 앞으로 해야 할 일

- React, NextJS 공부

- React 프로젝트 제작
