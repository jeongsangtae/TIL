# 오늘 한 일

### React + TypeScript 프로젝트 제작 (React, TypeScript, ExpressJS, MongoDB로 만드는 실시간 통신 애플리케이션)

- 사용자 프로필 수정 폼 관련 내용 수정 및 사용자 프로필 다이렉트 메시지 관련 내용 수정
  - 사용자 프로필 수정 폼에서 전달하는 내용 관련된 타입 정의를 수정해 타입 에러를 없애고 주석 처리된 내용이나 콘솔 로그 내용을 정리해주었으며, 사용자 프로필에서 다이렉트 메시지 전송 시에 사용될 함수와 액션 타입을 수정하고, 백엔드에 다이렉트 메시지를 전달받아 저장될 수 있도록 구성
  - 백엔드
    - chat-routes
      - JWT 토큰에서 사용자 정보를 불러오도록 구성
        - 불러온 사용자 정보가 유효한지 확인
      - 클라이언트에서 보낸 데이터를 추출하도록 구성
        - userId, message, email, nickname, avatarColor, avatarImageUrl로 구성
      - 날짜 데이터를 처리하는 여러 변수 추가
        - date, kstDate, formatKSTDate
      - existingChat 변수 추가
        - directChats 컬렉션 내의 participants.\_id에 othersData.\_id.toString()와 userId를 사용해 해당 내용 모두 포함된 다이렉트 채팅방을 찾도록 구성
      - 다이렉트 채팅방이 이미 존재할 경우 조건부
        - existingChat를 통해 존재하는지 확인
        - directChats 컬렉션 내의 \_id와 participants.\_id를 확인해 일치하는 채팅방을 찾고 isVisible 항목이 true로 업데이트되도록 구성
        - newMessage 변수 추가
          - roomId는 찾은 다이렉트 채팅방의 \_id를 new ObjectId 형식으로 변환해 저장하도록 구성
          - email, nickname, message, avatarColor, avatarImageUrl는 프론트엔드에서 보낸 데이터로 구성
          - date는 앞에서 포맷팅한 날짜 데이터로 구성
        - directChats 컬렉션 내의 \_id를 확인해 isVisible을 true로 업데이트하고, lastMessageDate는 새롭게 추가한 메시지 날짜로 업데이트
        - chatMessages 컬렉션에 새로운 메시지를 추가하도록 구성
      - 다이렉트 채팅방이 존재하지 않을 경우 내용
        - newDirectChat 변수
          - participants 항목의 사용자 내용
            - \_id, nickname, avatarColor, avatarImageUrl을 JWT 토큰에서 불러온 사용자 정보로 구성
            - isVisible은 true로 구성
          - participants 항목의 다른 사용자 내용
            - \_id는 userId, isVisible은 false로 구성
              - isVisible을 true로 해야 할 것으로 예상
            - nickname, avatarColor, avatarImageUrl을 프론트엔드에서 아직 받지 않아서 해당 내용을 전달받아 구성해야 함
          - date와 lastMessageDate는 포맷팅한 날짜 데이터로 구성
    - direct-chat-routes
      - 다이렉트 채팅방 추가하는 POST 라우터 수정
        - newDirectChat 변수 수정
          - participants에 저장되는 사용자와 친구 내용에 avatarImageUrl 항목을 추가하고, ohterData.avatarImageUrl로 구성
          - 친구 내용을 friendData.avatarImageUrl로 구성해야 하는데, othersData.avatarImageUrl로 구성했기 때문에 수정 필요
  - 프론트엔드
    - authStore
      - editUserProfileForm 액션 타입 수정
        - avatarMode를 전달받도록 구성하고, boolean으로 타입정의
        - modalData는 ModalData로 타입 정의
      - ModalData 타입 정의 추가
        - method는 "POST" | "PATCH" | "DELETE"로 타입 정의
        - \_id, nickname, avatarColor, avatarImageUrl는 옵셔널 타입에 string으로 타입 정의
      - RequestBody 타입 정의 추가
        - nickname은 string으로 타입 정의
        - avatarColor, avatarImageUrl은 옵셔널 타입에 string 또는 null이 적용되도록 타입 정의
        - modalData는 ModalData로 타입 정의
      - editUserProfileForm 액션 수정
        - requestBody 내용을 RequestBody로 타입 정의해 타입 에러 해결
        - 콘솔 로그 내용 및 주석 처리한 내용 모두 삭제
    - chatStore
      - ChatStore 타입 정의에 userProfileDirectSendMessage 항목을 추가
        - userProfileDirectSendMessage 내용에서 전달받는 userId, message는 string 그리고 userInfo는 UserInfo로 타입 정의
        - userProfileDirectSendMessage는 함수 형태로 타입 정의
    - UserProfile
      - JSX 코드 내용 수정
        - UserProfileChatInput 컴포넌트에 추가로 nickname, avatarColor, avatarImageUrl을 props로 전달하도록 구성
    - EditUserProfileForm
      - submitHandler 함수 수정
        - 콘솔 로그 내용 및 주석 처리한 내용 삭제
    - UserProfileChatInput
      - nickname, avatarColor, avatarImageUrl를 추가로 전달받도록 구성
      - useChatStore Zustand에서 userProfileDirectSendMessage 액션을 불러오도록 구성
      - sendMessageHandler 함수 수정
        - userId와 userInfo가 유효한지 확인하는 조건부 추가
        - otherUser 객체 변수 추가
          - userId, nickname, avatarColor, avatarImageUrl로 구성
        - userProfileDirectSendMessage 액션에 userId, message.trim(), userInfo를 전달하도록 구성
  - 사용자 프로필 수정 폼에서 액션으로 내용을 전달하고 그 내용 관련 타입 에러가 발생해 이와 관련된 문제를 해결하고, 이전에 테스트하기 위해 추가한 뒤 주석 처리한 내용과 콘솔 로그로 확인한 내용 모두 삭제하고, 사용자 프로필에서 다이렉트 메시지 전송 시에 실행될 함수와 액션 타입을 수정하고 백엔드에 사용자 프로필에서 다이렉트 메시지 전송 시에 실행될 라우터를 구성해 확인한 결과, 타입 에러 문제가 모두 해결된 것을 확인했고 불필요한 콘솔 로그와 주석 처리된 내용 모두 삭제된 것도 확인했으며, 백엔드에서 다이렉트 메시지를 저장하기 전에 이미 채팅방이 존재하는지 확인하고 있을 경우 여러 항목을 업데이트한 뒤 메시지가 저장되도록 구성하고 채팅방이 존재하지 않을 경우 새롭게 채팅방을 만들도록 구성했지만 아직 제대로 테스트를 해보지 못한 상태이기 때문에 내용을 좀 더 추가하고 수정한 뒤 테스트해볼 예정
    - 사용자 프로필에서 상대방에게 다이렉트 메시지를 보낼 수 있도록 추가 구성 필요
    - 사용자 프로필에서 내용 클릭 시에 모달창으로 세부 내용이 보여지도록 구성 필요
    - 로그인, 회원가입 페이지 배경에 사용되는 여러 이미지를 더 추가해 테스트해봐야 함
    - 해야 할 일에 정리된 내용 처리 필요
    - 다이렉트 채팅방 순서가 변경될 때 부드럽게 변경되는 기능
    - 그룹 채팅방 위치를 자유롭게 변경하는 기능
    - 그룹 채팅방 우클릭 시에 보여지는 컨텍스트 메뉴 CSS 수정 필요 (위치, UI 등)
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/1e2316de25c851941ba1554c1a18d181147a2398)

# 오늘 느낀 점

- 사용자 프로필 수정 폼에서 전달하는 내용과 받는 액션 부분에서 발생한 타입 에러 그리고 다이렉트 메시지 전송 시에 실행될 함수와 관련된 액션에서도 발생한 타입 에러를 수정해 타입 에러 문제를 해결해주었고, 주석 처리된 내용과 확인을 위해 추가한 콘솔 로그를 모두 삭제해 정리해주었으며, 백엔드에 사용자 프로필에서 다이렉트 메시지로 전달한 메시지를 저장하기 전에 기존 채팅방이 있는지 확인하고 기존 채팅방이 있을 경우 여러 항목을 업데이트한 뒤 메시지가 저장되도록 구성하고 기존 채팅방이 없다면 새롭게 채팅방을 생성하도록 구성을 하긴 했지만 아직 부족한 내용과 수정할 부분을 발견했기 때문에 추가로 수정해 테스트해볼 생각이다. 얼추 틀은 잡힌 거 같은데 구성하면서 이 내용이 들어가도 되는지 또는 이 내용은 어떻게 처리할지 등 여러 복잡한 생각이 들어서 조금 생각이 많은데, 좀 더 단순하게 생각해서 일단 추가하고 테스트한 뒤 다시 수정하고 테스트하는 방식으로 빠르게 구성해볼 생각이다.

<br />

# 내일 할 일

- 실시간 통신 애플리케이션 (Float Chat) 프로젝트 진행

- Zustand 내용 구성

- 닉네임 수정과 그룹 채팅방 제목 수정 내용에서 사용하지 않거나 필요없는 정보를 삭제해 코드 정리를 해야 함 (중복된 데이터 전송이나 사용하지 않는 데이터 전송 관련 내용 등)

- 그룹 채팅방에서 다른 사용자를 클릭할 수 있고, 클릭 시에 다이렉트 채팅방이 생성되어 채팅을 나눌 수 있도록 구성하는 것을 고려중 (이 방법 대신, 다른 사용자 클릭 시에 프로필이 보여지도록 구성하고 그 내용을 통해 다이렉트 메시지를 보내거나 프로필 내용을 보는 그런 방식으로 구성해야 함)

- 다이렉트 채팅방 목록이 정렬될 때 부드럽게 위로 올라가고 내려가는 CSS 적용 필요

- 친구 관련된 내용에서 코드 정리 필요 (코드를 깔끔하게 보이도록 수정 필요)

- 여러 Zustand에 구성된 실시간 반영 로직들이 재사용될 수 있도록 커스텀 훅에 옮겨서 구성하는 것을 고려해야 함

- 다크 모드 고려해야 함

<br />

# 앞으로 해야 할 일

- React, TypeScript 공부

- React 상태 관리 도구인 Zustand 공부

- 실시간 통신 애플리케이션 프로젝트 제작
