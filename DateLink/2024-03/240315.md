# 오늘 한 일

### React 프로젝트 제작 (React, NodeJS, MongoDB로 만드는 미니 커뮤니티 플랫폼)

- 구성한 내용

  - 테스트 해본 내용 및 고려해본 내용
    - Comments 컴포넌트에서 CreateComment 컴포넌트로 userData를 prop으로 전달해서 사용하는 부분 테스트
      - 전달 받은 userData를 다시 테스트하기 위해서 useEffect에서 의존성 배열에 추가하고, if문을 통해서 userData가 들어올 때와 들어오지 않을 때 다른 내용이 useState에 저장되도록 구성
      - useState에 저장된 내용을 댓글의 사용자 이름에서 보여주도록 구성
      - 테스트해본 결과 실시간으로 반영되지 않는 것을 확인
      - CreateComment 컴포넌트에 userData를 prop으로 전달하고 있지만 이 경우 항상 전달하는 것이 아닌 게시글 세부 페이지 접속이 되었을 때 전달이 되기 때문에 useEffect에서 의존성 배열로 추가해도 즉시 적용될 수가 없었다.
      - 그래서 이 방법으로는 댓글 작성자 이름이 실시간으로 변경되도록 구성하는 것은 불가능하고, Context API에 로그인한 사용자의 정보를 저장하기 때문에 이 내용을 사용하는 방향으로 구성할 생각이다.
    - 여러 사람이 로그인 했을 때, 사용자 정보를 혼동하지 않고 전달할 수 있는 지에 관한 내용 (Context API를 사용했을 때, 사용자 정보가 겹치는 문제를 생각)
      - 여러 사용자가 로그인했을 때, Context API에 정보가 겹치거나 다른 사용자의 정보가 저장되는 문제는 발생하지 않는다고 한다.
        - 이유는, React 앱의 Context는 클라이언트 측에서 동작하고, 각 사용자의 브라우저에서 개별적으로 실행되기 때문이라고 함
        - 각 사용자의 브라우저는 독립적인 React 앱 인스턴스를 가지고 있고, 그 인스턴스 내의 Context API도 그 사용자만의 데이터를 관리
        - 서버 측에서 JWT 토큰을 생성하고 쿠키에 저장한 후, 이를 프론트엔드로 전송하여 Context API를 통해 관리하는 구조라면, 서버는 각 요청을 개별 사용자로부터 받은 것으로 처리
        - 사용자 A가 로그인하여 생성된 토큰은 사용자 A의 브라우저에서만 처리되고, 사용자 B가 로그인하여 생성된 토큰은 사용자 B의 브라우저에서만 처리된다.
      - 요약하면, 각 사용자의 브라우저는 독립적인 실행 환경을 가지므로, Context API를 사용하여 사용자 정보를 관리하는 것은 안전하며, 다른 사용자의 데이터가 섞이는 일은 발생하지 않는다.
        - SSR을 사용하고 있다면, 사용자마다의 독립적인 세션 관리에 대해서는 좀 더 주의를 기울여야 할 수 있다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/6b8bf58f9cde6b4e637b512522b0dac07dea9fd1)

  <br />

  - accessToken router를 활용해서, Context API에서 사용자 정보를 전달받아 저장하고 사용
    - 로그인할 때, JWT 토큰을 쿠키에 추가하고 바로 decoded해서 프론트엔드로 전달하고, 전달받은 사용자 정보를 다시 Context API에 전달하도록 구성을 했었는데 이 내용을 저장하고 사용하는 부분에 있어서 조금 문제가 있어서 변경해주었다.
      - 사용자 정보를 전달하고 useState에 저장하는 것까지는 문제가 없지만, useState에서 저장한 후에 사용하려고 해도 새로고침을 하면 해당 정보가 초기화되는 문제가 있기 때문에 해당 부분에 대해 추가 구성이 필요했다.
      - 유지하도록 하기 위해서 localStorage를 생각했으나, 보안상 문제가 될 수 있기 때문에 다른 방법을 사용하는 쪽으로 구성을 생각했다.
      - 생각해본 결과, 굳이 로그인할 때 decoded 하지 않고 예전에 백엔드에서 구성한 "/accessToken" 경로의 router를 useEffect에 추가해서 사용하는 방향으로 구성 진행했다.
    - 백엔드 구성
      - 백엔드에서 따로 추가한 내용은 없으며, decoded하는 코드를 주석처리해서 사용하지 않도록 변경해주었다.
    - 프론트엔드 구성
      - 앞에서 userData를 마지막으로 테스트해보기 위해 추가한 코드가 작동되지 않도록 전부 주석 처리
      - Login 컴포넌트에서 로그인시 Context API에 전달하는 사용자 정보도 전달하지 않도록 주석 처리
      - Context API의 useEffect에 "/accessToken" router에서 사용자 정보를 받을 수 있도록 fetch 함수 내용 구성
      - 응답 받은 데이터가 있다면 setUserInfo를 통해서 사용자 정보를 업데이트하고 없다면 그대로 nulL
      - 이제는 로그인을 통해서 사용자 정보를 받지 않기 때문에, loginHandler에서 setUserInfo로 업데이트하는 내용은 주석처리
    - 변경한 코드를 테스트해본 결과, 로그인을 했을 때는 바로 댓글 작성자 이름이 변경되지 않았지만, 로그아웃을 했을 때는 바로 변경되는 것을 확인할 수 있었다.
      - 테스트 결과로 확실히 알게 된 부분이 있다면, loginHandler 또는 logoutHandler에서 작업이 추가되어야 실시간 반영이 된다는 것, 그리고 useEffect는 데이터를 유지하도록 도움을 주며, 실시간 반영을 위한 매커니즘에 도움은 줄 수 있지만 useEffect만으로는 실시간 반영 자체를 구현할 수 없다는 것을 확실하게 알게 되었다.
      - loginHandler를 통해서 사용자 정보를 입력받도록 하는 부분이 필요하며, 이 정보를 useEffect에 추가해서 유지하도록 하는 내용이 추가적으로 필요하다고 생각되며 코드를 추가로 수정해야 할 것 같다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/90380788fad2b1dd2a0e7afc355e56140da25601)

  <br>

  - 생각 및 추가해봐야 할 내용
    - Context API에서 "GUEST"라는 이름을 조건부로 미리 넘겨주는 방법
      - 정확히는 조건부로 "GUEST" 또는 사용자 이름 미리 저장하고 넘겨서 사용하는 방법도 생각해봄
    - Context API의 useEffect에서 조건부를 다시 봐보고, 새로고침 시에도 "GUEST"라는 이름이 유지될 수 있도록 구성
      - 비로그인 상태일 때, "GUEST"라는 명이 분명히 존재하지만, 새로고침 시에 JWT 토큰에 이상한 이름이 들어가서 해당 이름이 보여지는 이유를 찾아보고 해결해야 함
    - userInfo에서 사용자 이름만 따로 빼내서 저장하는 방향도 생각해봐야 함
      - 사용자 이름, 사용자 이메일을 따로 분리해서 저장하고 사용하는 방향도 생각해봐야 함
      - 따로 분리해서 전달하면 사용하기 더 편리할 것 같다는 생각도 듦
      - 추가로 분리한 정보도 localStorage에 저장해서는 안되는가에 대해 생각해봐야 함
    - 로그인을 했을 때, 댓글의 작성자 이름이 실시간으로 변경되어 보이도록 userInfo 관련 추가 작업이 필요함
      - 주석 처리한 decoded 내용을 다시 풀고 전달해서 테스트를 해봐야 할 것 같음
    - verifyUser 함수를 바깥으로 빼서 재사용하는 방향도 생각해봐야 함
    - Context API에서 미리 작업해서 전달하는 방향도 생각해봐야 함

<br />

- 추가 및 해결 해야 할 내용
  - 회원가입 form에서 잘못된 입력을 제출 했을 때, session에 데이터가 저장되는데, 기존의 session 데이터에서 업데이트되는 방식이 아닌 매번 제출할 때마다 새로운 session이 추가되고 있기 때문에 백엔드 코드에서 수정이 필요하다.
    - 계속 원인을 찾아보려고 이것저것 시도해보았지만 아직 어떤 코드가 정확히 원인인지 찾지 못해서 하나씩 천천히 테스트가 필요함
    - 일단 이걸 테스트 해보기전에 먼저 정상적으로 세션 만료가 되는지 확인해보았는데 정상적으로 세션 만료가 되기 때문에, 로그인을 먼저 구성해보고 정상적으로 로그인이 되는지 확인을 해보고 안된다면, session에 저장되는 부분을 다시 확인해봐야 할 것 같다는 생각
  - 로그인 후에, 새로고침 시 로그아웃 되어버리는 상황도 수정을 해야 함
    - 현재 로그인 한 후에, useEffect를 통해서 데이터를 확인하고 토큰이 유효하다면 정상적으로 로그인 유지는 되지만, 새로고침 시 깜빡거리면서 메인헤더가 변경되는 것이 보이기 때문에 이 부분을 수정할 수 있으면 수정할 생각이다.
  - 로그인을 유지하고 있을 때, token이 만료 시간에 가까워지면 자동으로 갱신되는 로직을 추가 해야 함
    - 대충 구성만 되어 있는 상태로, 좀 더 자세한 코드와 테스트가 필요함
  - 로그인 시 주어지는 토큰을 확인하고, 해당 토큰을 통해 인증하고 게시글, 댓글, 답글 관련 기능을 활성화해주는 코드를 구성해야 함
    - 전체적으로 저 인증을 확인할 수 있게 해주는 것이 1차 목표로, 애플리케이션 전체에서 인증을 확인할 수 있게 된다면 쉽게 구성이 될 것으로 예상된다.
      - Context API를 추가해서, 로그인 유무를 전체에서 알 수 있도록 구성해주고 필요할 때 내용을 가져와서 사용 할 수 있다.
    - 세션과 연동이 가능한 부분이 있는지도 테스트가 필요함
      - 불가능, 세션이나 jwt 토큰 중 하나만 사용하는 것이 좋다.
      - 세션을 삭제하는 작업을 아직 하지 않아서 해줘야 함
    - Context API를 사용하는 것은 좋지만, 이 내용을 사용하려는 파일에서 하나하나 추가해서 사용하기 때문에 커스텀 Hook을 구성해서 재사용할 수 있도록 해줄 필요가 있음
  - 오류 페이지 이동에 대한 처리가 필요
    - ex) 게시글 추가 버튼이 로그인하지 않았음에도 활성화되어 클릭되면 오류 페이지로 이동해서 서버에서 문제가 생기지 않도록 조치가 필요함
    - ex) 로그인을 하지 않은 채로 강제로 URL을 통해서 이동하려고 할 때, 오류 페이지로 이동하도록 구성을 해줘야 함

# 오늘 느낀 점

- 추가한 구성을 테스트해보고, 몇 가지 생각을 다시 해보게 되었는데 첫 번째로 "GUEST" 또는 사용자 이름을 미리 저장하고 넘겨서 사용하는 방향으로 생각해보았고, 두 번째는 비로그인 상태일 때 "GUEST"라는 명이 존재하지만, 새로고침 시에 JWT 토큰에 이상한 이름이 들어가서 해당 이름이 보여지는 부분을 확인하고 조치를 해줘야 한다. 세 번째로 userInfo 내용에서 이름과 이메일을 분리해서 저장하고 사용하는 방향도 생각해봤는데, 따로 분리해서 전달하면 사용하기 더 편리할 것 같다는 생각도 들었고, 여기서 분리한 정보를 localStorage에 저장하면 안되는지 또는 이름이나 이메일 둘 중에 하나만 저장하는 것은 어떤지에 대해 다시 생각해봐야 한다. 마지막으로 로그인을 했을 때 댓글의 작성자 이름이 실시간으로 변경되어 보이도록 추가 작업을 어떤식으로 해줘야 하는지도 다시 생각해보았다. 처음에는 되게 간단한 작업으로 해결이 될 것 같았는데 생각보다 신경써야 할 부분도 많고, 사용자 정보를 localStorage에 저장하고 사용하기에는 보안과 관련된 문제도 있기 때문에 다른 방법을 생각해보느라 좀 어려움이 있는 것 같다. 생각해본 여러 방법을 테스트해보고, Context API에 적용해주면 다른 곳에서는 편하게 가져와서 사용하기만 하면 되기 때문에 이 문제만 해결하면 그 뒤는 좀 더 간단할 것 같다는 생각이 된다.

<br />

# 내일 할 일

- React 공부 및 React 프로젝트 조금씩 진행하기

<br />

# 앞으로 해야 할 일

- React, NextJS 공부

- React 프로젝트 제작
