# 오늘 한 일

### React 프로젝트 제작 (React, NodeJS, MongoDB로 만드는 미니 커뮤니티 플랫폼)

- 구성한 내용

  - 답글을 출력하는 다른 로직 추가
    - 댓글에서 추가한 답글을 백엔드에서 프론트엔드로 모두 전달한 후에 filter로 걸러내서 보여주는 것이 아닌 다른 방법으로 구성
      - URL 파라미터를 사용해서 프론트엔드에서 백엔드로 commentId를 전달하고 답글에 저장된 댓글의 \_id 정보와 전달받은 commentId를 비교해서 확인한 뒤에 일치하는 데이터를 프론트엔드로 전송해서 보여주도록 구성
    - 백엔드 구성
      - API 엔드포인트를 `"/posts/:postId/replies/:commentId"` 이와 같이 변경
      - 프론트엔드에서 URL 파라미터로 전달받은 commentId를 new ObjectId를 사용해서 변환
      - 답글 컬렉션에서 comment_id와 commentId를 비교해서 일치하는 항목을 찾아서 프론트엔드로 전달
    - 프론트엔드 구성
      - fetch 함수의 URL 구성에서 comment 컴포넌트에서 전달받은 commentId prop을 사용해서 내용 변경
        - 백엔드 API 엔드포인트와 일치하도록 구성
        - `"http://localhost:3000/posts/" + postId + "/replies/" + commentId`
      - URL 파라미터로 commentId 정보를 전달해서 백엔드에서 사용할 수 있도록 변경
    - URL 파라미터를 사용해서 프론트엔드에서 백엔드로 commentId 정보를 전달하고 백엔드에서 commentId를 사용해, 답글에서 일치하는 정보를 찾아서 프론트엔드로 전달해서 출력하도록 변경해주었다.
      - 이전에 했던 방식은 모든 답글을 불러와서 프론트엔드에서 filter를 사용해서 걸러내고 보여주는 방식이였지만, 변경한 방식은 필요한 데이터만 정확히 요청해서 받기 때문에 데이터 전송량을 최소화할 수 있다.
      - 이전 방식은 불필요한 데이터를 받기 때문에 데이터 전송량도 많고, 클라이언트의 처리 부담이 증가될 수 있는 반면에 변경한 방식은 서버 측에서 데이터를 사전에 필터링해서 전송하기 때문에 클라이언트의 처리 부담이 적어진다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/7070766d53952254f7e8f3366b48ee72cc94e5d8)

  <br />

  - 게시글 추가 및 수정과 관련된 redirect 내용을 수정
    - 게시글을 추가, 수정 했을 때 전부 게시글 목록 페이지로 이동하기 때문에 이 내용을 수정해서 추가가 되었을 때는 게시글 목록 페이지로 이동하고, 수정했을 때는 게시글 세부 페이지로 이동하도록 구성해주었다.
    - 프론트엔드 구성
      - postId를 PATCH method가 들어왔을 때만 사용하고 있기 때문에, 밖으로 빼내주며 스코프 문제를 해결
      - postId를 함수 내에서 문제 없이 사용하도록 해주고, POST method로 들어와서 데이터 저장이 되면 게시글 목록 페이지로 이동하도록 구성
      - POST method가 아닌, method가 들어왔을 때는 게시글 세부 페이지로 이동하도록 구성
        - ex) PATCH method
    - 이렇게 구성해줌으로서 POST method가 넘어오고 데이터가 정상적으로 저장되면 게시글 목록 페이지로 이동시켜주고, PATCH method가 넘어오고 데이터가 저장되면 게시글 세부 페이지로 이동해서 어떻게 내용이 변경되었는 지 알 수 있게 되었다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/a2de5f1540cfc8d4bc7496ade5c4995a7978dac7)

<br />

- 추가 및 해결 해야 할 내용
  - 회원가입 form에서 잘못된 입력을 제출 했을 때, session에 데이터가 저장되는데, 기존의 session 데이터에서 업데이트되는 방식이 아닌 매번 제출할 때마다 새로운 session이 추가되고 있기 때문에 백엔드 코드에서 수정이 필요하다.
    - 계속 원인을 찾아보려고 이것저것 시도해보았지만 아직 어떤 코드가 정확히 원인인지 찾지 못해서 하나씩 천천히 테스트가 필요함
    - 일단 이걸 테스트 해보기전에 먼저 정상적으로 세션 만료가 되는지 확인해보았는데 정상적으로 세션 만료가 되기 때문에, 로그인을 먼저 구성해보고 정상적으로 로그인이 되는지 확인을 해보고 안된다면, session에 저장되는 부분을 다시 확인해봐야 할 것 같다는 생각
  - 로그인 후에, 새로고침 시 로그아웃 되어버리는 상황도 수정을 해야 함
    - 현재 로그인 한 후에, useEffect를 통해서 데이터를 확인하고 토큰이 유효하다면 정상적으로 로그인 유지는 되지만, 새로고침 시 깜빡거리면서 메인헤더가 변경되는 것이 보이기 때문에 이 부분을 수정할 수 있으면 수정할 생각이다.
  - 로그인을 유지하고 있을 때, token이 만료 시간에 가까워지면 자동으로 갱신되는 로직을 추가 해야 함
    - 대충 구성만 되어 있는 상태로, 좀 더 자세한 코드와 테스트가 필요함
  - textarea 내용 수정 필요
    - 게시글, 댓글, 답글에서 사용하는 textarea의 크기가 고정되도록 변경해주고 다음 라인으로 넘겨서 입력한 내용이 그대로 보여지게 구성을 해줘야 함
  - 댓글을 추가한 후에, CommentForm의 내용이 초기화되지 않고 추가한 내용이 그대로 남겨져 있기 때문에 이 부분을 수정해야 함

# 오늘 느낀 점

- 오늘 주 목표는 백엔드에서 모든 답글의 정보를 전달받아서 filter로 걸러내서 보여주는 방식이 아닌, URL 파라미터로 백엔드에 commentId 정보를 전달하고 해당 내용을 사용해서 먼저 필터링하고 정확한 데이터를 전달해서 보여주는 방식으로 변경하는 것이었다. 테스트해본 결과 문제 없이 작동하고 답글에 저장된 댓글의 \_id와 commentId가 일치하는 내용만 보여주게 되었다. URL 파라미터에 대한 내용을 잘못 이해하고 있었는데, 일반적으로 API 엔드포인트와 fetch 함수의 내용이 일치해야 한다는 것은 알고 있고 `:postId` 이러한 params 내용이 들어가면 URL을 보여주는 것으로 알고 있었는데 이 부분은 내가 잘못 알고 있던 내용으로 URL 문자열 자체가 브라우저의 주소 표시줄에 직접 표시되는 것은 아니며, 단지 HTTP 요청을 보내는데 사용될 논리적인 주소를 형성하는 데 사용된다고 한다. URL 파라미터를 사용함으로써 commentId 정보를 보낼 수 있었고, commentId 내용을 사용해서 백엔드에서 필터링해서 전달하기 떄문에 데이터 전송량을 최소화하고 클라이언트의 처리 부담을 줄일 수 있게 되었다. 이제 GET method에서 데이터를 전달해야 할 때는 URL 파라미터를 활용해서 데이터를 전달해서 사용하면 될 것 같다.

- 이제 수정해줘야 할 내용으로, 댓글을 추가한 후에 form의 내용이 그대로 남아있고 빈 문자열로 초기화 되지 않기 때문에 이 부분을 수정해주고 textarea의 크기도 고정해준 후에 다음 라인으로 넘겨서 입력한 내용이 저장이 되도록 해줘야 한다. 이 부분들을 수정하면 CSS도 조금 손봐주며 좀 더 알아보기 쉽게 변경해주고 게시글 삭제 시에 해당 게시글에 저장된 댓글과 답글 모두 삭제되도록 해주며, 댓글 삭제 시 해당 댓글에 저장된 답글이 모두 삭제되도록 구성을 추가해줘야 한다.

<br />

# 내일 할 일

- React 공부 및 React 프로젝트 조금씩 진행하기

<br />

# 앞으로 해야 할 일

- React, NextJS 공부

- React 프로젝트 제작
