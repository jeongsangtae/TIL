# 오늘 한 일

### React 프로젝트 제작 (React, NodeJS, MongoDB로 만드는 미니 커뮤니티 플랫폼)

- 구성한 내용

  - 에러 페이지 기본 구성 추가
    - URL에서 존재하지 않는 페이지나, 존재하지 않는 URL로 이동하려고 할 때 에러 페이지를 표시하기 위해서 추가
      - 현재는 테스트해본 내용으로, 아직 구성이 제대로 되지 않은 상태
    - 프론트엔드 구성
      - ErrorPage 컴포넌트를 추가하고, 페이지로 구성
      - main.jsx에서 ErrorPage 컴포넌트를 import
      - path 경로는 "\*"로 설정, element는 ErrorPage 컴포넌트
    - RootLayout에서 errorElement를 사용해서, 구성하려고 했으나 errorElement는 action, loader, 컴포넌트 렌더링 중 발생하는 예외를 처리하기 때문에, 다른 fetch 함수에서 발생하는 에러는 따로 처리해야 하기 때문에 일단은 path 경로를 전체로 설정하는 방식으로 구현했다.
      - 테스트 해본 결과, 일단은 잘못된 URL에 대해서 ErrorPage에서 설정한 내용으로 이동되는 것을 확인할 수 있었다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/70ea5223d9c27e774ac983bc44b16c3e5df3ded5)

  <br />

  - 에러 페이지, 보호된 라우트 구성에 관한 내용
    - 에러 페이지
      - React에서 에러 페이지를 어떤 방식으로 구현을 해야 하는지 많이 생각해보고 찾아보았는데, 일단은 errorElement를 사용하거나 `path: "*"`로 구성해서 전체 경로에서 문제가 있을 때 에러 페이지를 보여주는 방법 이렇게 두 가지 중에서 선택해서 사용해야 할 것 같다.
      - 다른 fetch 함수에서 발생하는 에러를 처리하기 위해서는 해당 요청을 수행하는 loader 함수 내에서 try-catch 블록을 사용하거나, 에러 경계 (Error Boundaries)를 사용해야 한다고 하기 때문에, 굳이 전체 경로로 처리할 필요 없이 errorElement로 구성해도 괜찮을 것 같다는 생각이 든다.
    - 보호된 라우트 구성
      - 로그인 유무에 따라서 접근 가능한 페이지와 접근 불가능한 페이지를 어떻게 구분해야 하는 지 많이 고민하고 찾아본 결과, 따로 로그인 유무를 판단하고 만족할 때 접근할 수 있도록 제한하는 보호된 라우트를 추가하고, 보호가 필요한 라우트에서 해당 라우트를 래퍼 형식으로 감싸서 사용하도록 하는 방법을 생각 중이다.
      - 보호되는 라우트를 따로 추가해서 로그인 유무를 판단하도록 구성
      - 보호되는 라우트가 필요한 라우트에서 래퍼로 감싸서 로그인이 되었을 때만, 해당 라우트가 작동해서 페이지 이동이 되도록 구성하는 방향으로 생각 중
    - 에러 페이지는 메인헤더만 보이도록 해주면 크게 문제가 없을 것 같다고 생각이 되었는데, 추가로 더 생각해보니 어떤 에러인지에 따라서 이동하는 페이지가 달라져야 한다고 생각이 되기 때문에 내용 구성을 좀 더 세부적으로 해주는 방향도 생각 중이다.
    - 보호된 라우트 구성은 로그인을 하지 않은 상태에서, 프로필 페이지나 게시글 수정 페이지, 게시글 추가 페이지처럼 접근이 불가능한 페이지에 접근했을 때, 에러 페이지를 보여주도록 하는 방향으로 생각 중
    - 정리
      - 전체적으로 잘못된 URL에 대해서 종합적인 에러 페이지 필요
      - 로그인하지 않은 상태에서 프로필 페이지, 게시글 수정 페이지, 게시글 추가 페이지에 URL을 통해서 접근했을 때 에러 페이지 필요
      - 로그인하고 프로필 페이지, 게시글 수정 페이지, 게시글 추가 페이지에 있는 상태에서 로그아웃을 했을 경우 다른 페이지로 이동하거나, 에러 페이지가 표시되거나 다른 대체 방안이 필요
        - 이 경우 일단 1차적으로 로그아웃 했을 때, 게시글 수정 버튼, 게시글 추가 버튼 등 내용들을 비활성화 해줄 필요가 있음
      - 에러 페이지에서, 메인 헤더가 보이도록 구성해줄 필요도 있음
        - 현재는 메인 헤더가 보이지 않은 상태로 에러 페이지만 보이는 상태

<br />

- 추가 및 해결 해야 할 내용
  - 회원가입 form에서 잘못된 입력을 제출 했을 때, session에 데이터가 저장되는데, 기존의 session 데이터에서 업데이트되는 방식이 아닌 매번 제출할 때마다 새로운 session이 추가되고 있기 때문에 백엔드 코드에서 수정이 필요하다.
    - 계속 원인을 찾아보려고 이것저것 시도해보았지만 아직 어떤 코드가 정확히 원인인지 찾지 못해서 하나씩 천천히 테스트가 필요함
    - 일단 이걸 테스트 해보기전에 먼저 정상적으로 세션 만료가 되는지 확인해보았는데 정상적으로 세션 만료가 되기 때문에, 로그인을 먼저 구성해보고 정상적으로 로그인이 되는지 확인을 해보고 안된다면, session에 저장되는 부분을 다시 확인해봐야 할 것 같다는 생각
    - 이 부분은 session을 삭제하게 되면 더 이상 신경쓰지 않아도 되지만, 현재는 session을 그냥 놔둔 상태이기 떄문에 잠시 유지
  - 로그인 후에, 새로고침 시 로그아웃 되어버리는 상황도 수정을 해야 함
    - 현재 로그인 한 후에, useEffect를 통해서 데이터를 확인하고 토큰이 유효하다면 정상적으로 로그인 유지는 되지만, 새로고침 시 깜빡거리면서 메인헤더가 변경되는 것이 보이기 때문에 이 부분을 수정할 수 있으면 수정할 생각이다.
  - 로그인을 유지하고 있을 때, token이 만료 시간에 가까워지면 자동으로 갱신되는 로직을 추가 해야 함
    - 대충 구성만 되어 있는 상태로, 좀 더 자세한 코드와 테스트가 필요함
  - 로그인 시 주어지는 토큰을 확인하고, 해당 토큰을 통해 인증하고 게시글, 댓글, 답글 관련 기능을 활성화해주는 코드를 구성해야 함
    - 전체적으로 저 인증을 확인할 수 있게 해주는 것이 1차 목표로, 애플리케이션 전체에서 인증을 확인할 수 있게 된다면 쉽게 구성이 될 것으로 예상된다.
      - Context API를 추가해서, 로그인 유무를 전체에서 알 수 있도록 구성해주고 필요할 때 내용을 가져와서 사용 할 수 있다.
        - 구성 함
    - 세션과 연동이 가능한 부분이 있는지도 테스트가 필요함
      - 불가능, 세션이나 jwt 토큰 중 하나만 사용하는 것이 좋다.
      - 세션을 삭제하는 작업을 아직 하지 않아서 해줘야 함
    - Context API를 사용하는 것은 좋지만, 이 내용을 사용하려는 파일에서 하나하나 추가해서 사용하기 때문에 커스텀 Hook을 구성해서 재사용할 수 있도록 해줄 필요가 있음
  - 오류 페이지 이동에 대한 처리가 필요
    - ex) 게시글 추가 버튼이 로그인하지 않았음에도 활성화되어 클릭되면 오류 페이지로 이동해서 서버에서 문제가 생기지 않도록 조치가 필요함
    - ex) 로그인을 하지 않은 채로 강제로 URL을 통해서 이동하려고 할 때, 오류 페이지로 이동하도록 구성을 해줘야 함
  - 백엔드의 user-router.js에서 accessToken, login/success, profile router에서 모두 accessToken 함수 내용을 재사용하고 있는데, 굳이 3개의 router로 나눌 필요가 있는 지 확인해보고 필요가 없다면 하나로 줄여줘야 함
    - 명확하게 하기 위해서 일단은 하나로 합치지 않고, 그대로 나눠서 사용하도록 유지
    - 내용이 엄청 많은 코드로 구성된 것이 아니기 때문에 현재로서는 크게 문제 없다고 생각되어 그대로 유지
  - 액세스 토큰, 리프레시 토큰 버튼을 메인헤더에서 제거해야 함
    - 일단 주석처리해서 사용하지 않도록 변경
  - 코드 예외 처리 더 필요한 부분이 있는 지 체크해야 함
  - 프로필 페이지 구성은 했지만, 로그아웃하고 난 후에 그대로 프로필 페이지에 남아있으며 해당 게시글이 보이는 문제에 대해 고민해봐야 함
    - 사실 게시글 보이는 것도 괜찮고, 게시글 클릭 시 게시글 세부 페이지 이동하는 것도 문제 없다고 생각이 됨
    - 게시글 세부 페이지 이동 후에 댓글 작성이나 게시글 수정 기능이 비활성화 되어있기 때문에 큰 문제는 없지만, 로그아웃 후에 페이지네이션 기능을 통해서 페이지 이동했을 때 게시글이 보이지 않는 부분이 부자연스럽게 생각이 될 수 있기 때문에, 해당 내용에 대해 생각해봐야 함

# 오늘 느낀 점

- React에 대해 배울 때 에러 페이지 구성은 해봤지만, 로그인 유무 즉, 권한에 따라서 에러 페이지를 보여주고 하는 것은 처음이라서 좀 더 정보가 필요했다. 그래서 어떤식으로 구성을 해야 하는 지 내용을 찾아보고, 정리를 해놓은 상태인데 이제는 좀 어떤 방향으로 구성을 하고 테스트해봐야 할 지 감이 잡히는 것 같아서, 보호된 라우트를 먼저 구성하고 해당 라우트를 필요한 곳에서 사용해서 테스트해볼 생각이다. 그리고 예전에 에러 페이지를 구성할 때 봤던 내용을 다시 한 번 봐야 할 것 같은데, 단순하게 에러 페이지를 구성하는 것만이 아닌 다른 내용도 있었는지 확인이 필요하기 때문이다. 일단은 로그인 여부에 따라 페이지에 접근을 제한하는 내용 구성을 할 수 있을 것 같아서, 이것만으로도 1단계는 넘겼다고 생각되며 바로 내용 구성을 해보고 테스트하면서 하나씩 구성해볼 생각이다.

<br />

# 내일 할 일

- React 공부 및 React 프로젝트 조금씩 진행하기

<br />

# 앞으로 해야 할 일

- React, NextJS 공부

- React 프로젝트 제작
