# 오늘 한 일

### React 프로젝트 제작 (React, NodeJS, MongoDB로 만드는 미니 커뮤니티 플랫폼)

- 구성한 내용

  - 게시글, 댓글, 답글에서 사용하는 loggedIn useState 대신에, Context API에 저장된 로그인 유무 관련 내용을 바로 사용하도록 구성 변경
    - Context API에서 로그인 유무와 관련된 내용을 useState에 저장하고, 해당 내용을 내보내서 사용하려는 컴포넌트에 가져오고 다시 useState에 저장해서 사용을 하고 있는 구조로 이루어져있다. 하지만 이 구조는 불필요하게 로그인 유무와 관련된 내용을 다시 useState에 저장하고 사용하기 때문에, 바로 가져와서 사용할 수 있도록 구성을 변경해주었다.
    - 프론트엔드 구성
      - 게시글, 댓글, 답글에서 `authCtx.isLoggedIn`을 새로운 useState에 저장하는 부분을 삭제
      - useEffect도 이미 Context API에서 구성해놓은 상태이기 때문에 삭제
      - textarea, button, className을 조건부로 넘겨주는 곳 등 여러 곳에서 Context API 내용을 바로 사용하도록 변경
        - `authCtx.isLoggedIn`를 사용해서 바로 적용되도록 변경
      - useEffect를 EditComment, ReplyForm 컴포넌트에서는 남겨놓고 `authCtx.isLoggedIn`를 if문으로 확인해서 로그인 상태가 아닐 경우, 토글 기능이 작동해서 입력 form이 닫히도록 구성을 해주었다.
    - 다른 컴포넌트에서는 useEffect를 삭제했지만, EditComment, ReplyForm 컴포넌트에서 남겨놓고, 토글 내용이 실행되도록 해준 이유는 useEffect 없이 if문 놔둔채로 테스트해본 결과 문제가 발생했다.
      - 렌더링 중에 상태 설정자, 즉 React에서 상태를 업데이트하는 함수인 setState나 useState Hook을 렌더링 함수 안에서 직접 호출해서 문제가 발생
      - React 업데이트 사이클에 의해, 상태 업데이트는 보통 이벤트 핸들러나 useEffect와 같은 React의 라이프사이클 메서드 안에서 이루어져야 한다.
      - 즉, if문이 문제가 아닌, 토글 함수가 문제가 되는데 토글 함수 내부에서 상태를 업데이트하고 있는데, 이 함수가 렌더링 중에 호출되고 있기 때문에 문제가 발생하는 것으로 React는 렌더링 중에 상태를 변경하거나 업데이트하는 것을 허용하지 않는다.
        - 이것이 에러 발생의 이유이며, 이 문제를 해결하기 위해서 useEffect를 사용해서 구성한 것
    - EditComment, ReplyForm 컴포넌트에서 useEffect 없이, if문만 사용해서 구성했을 때는 콘솔에 에러가 표시됐지만, useEffect를 다시 추가해서 구성해주니 이제는 콘솔에 에러도 없고 문제없이 작동하는 것을 확인할 수 있었다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/5bdbe8069afe8964f0f039f823c7cf1d3fb6fbdf)

  <br />

  - 백엔드에서 사용하는 accessToken 코드 관련 재사용하도록 변경
    - 게시글, 댓글, 답글에서 accessToken 관련 내용을 중복으로 사용하고 있기 때문에, 재사용해서 중복 코드를 줄이고, 유지보수도 쉽게 해주도록 변경해주었다.
    - 백엔드 구성
      - jwt-auth.js에서 기존에 존재하는 accessToken 함수를 주석처리
      - 새로운 accessToken 함수를 추가하는데, 내용은 거의 비슷하지만 여기서 바로 res를 통해서 데이터를 전달하는 것이 아닌, return으로 데이터를 반환해서 사용할 수 있게 구성
        - 에러가 발생하면 null을 반환
      - user-routes.js에서는 res도 따로 사용하지 않고 이전의 accessToken 함수를 그대로 사용해서 바로 응답 데이터를 전송했었으나, 변경해서 반환받은 othersData를 구성하고 확인해서 문제가 없을 때, res를 통해서 프론트엔드로 데이터를 전달하도록 구성
      - board-routes.js에서는 accessToken을 import
      - 게시글, 댓글, 답글의 추가, 수정, 삭제 부분에서 모두 accessToken 관련 내용을 확인하고 사용하고 있었는데, 이제는 import한 accessToken 함수를 사용해서 재사용하도록 구성을 변경해주었다.
    - 구성한 내용을 테스트한 결과 문제없이 작동하는 것을 확인할 수 있었다. 그리고 accessToken 함수 하나로 accessToken이 필요한 곳에서 재사용되도록 변경해준 덕분에 유지보수도 편해지고, 일관성도 있게 되었으며, 코드가 많이 줄어서 가독성도 좀 더 높아진 것 같다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/8513a71402558c6baf6217d6df9240e957357f26)

<br />

- 추가 및 해결 해야 할 내용
  - 회원가입 form에서 잘못된 입력을 제출 했을 때, session에 데이터가 저장되는데, 기존의 session 데이터에서 업데이트되는 방식이 아닌 매번 제출할 때마다 새로운 session이 추가되고 있기 때문에 백엔드 코드에서 수정이 필요하다.
    - 계속 원인을 찾아보려고 이것저것 시도해보았지만 아직 어떤 코드가 정확히 원인인지 찾지 못해서 하나씩 천천히 테스트가 필요함
    - 일단 이걸 테스트 해보기전에 먼저 정상적으로 세션 만료가 되는지 확인해보았는데 정상적으로 세션 만료가 되기 때문에, 로그인을 먼저 구성해보고 정상적으로 로그인이 되는지 확인을 해보고 안된다면, session에 저장되는 부분을 다시 확인해봐야 할 것 같다는 생각
    - 이 부분은 session을 삭제하게 되면 더 이상 신경쓰지 않아도 되지만, 현재는 session을 그냥 놔둔 상태이기 떄문에 잠시 유지
  - 로그인 후에, 새로고침 시 로그아웃 되어버리는 상황도 수정을 해야 함
    - 현재 로그인 한 후에, useEffect를 통해서 데이터를 확인하고 토큰이 유효하다면 정상적으로 로그인 유지는 되지만, 새로고침 시 깜빡거리면서 메인헤더가 변경되는 것이 보이기 때문에 이 부분을 수정할 수 있으면 수정할 생각이다.
  - 로그인을 유지하고 있을 때, token이 만료 시간에 가까워지면 자동으로 갱신되는 로직을 추가 해야 함
    - 대충 구성만 되어 있는 상태로, 좀 더 자세한 코드와 테스트가 필요함
  - 로그인 시 주어지는 토큰을 확인하고, 해당 토큰을 통해 인증하고 게시글, 댓글, 답글 관련 기능을 활성화해주는 코드를 구성해야 함
    - 전체적으로 저 인증을 확인할 수 있게 해주는 것이 1차 목표로, 애플리케이션 전체에서 인증을 확인할 수 있게 된다면 쉽게 구성이 될 것으로 예상된다.
      - Context API를 추가해서, 로그인 유무를 전체에서 알 수 있도록 구성해주고 필요할 때 내용을 가져와서 사용 할 수 있다.
        - 구성 함
    - 세션과 연동이 가능한 부분이 있는지도 테스트가 필요함
      - 불가능, 세션이나 jwt 토큰 중 하나만 사용하는 것이 좋다.
      - 세션을 삭제하는 작업을 아직 하지 않아서 해줘야 함
    - Context API를 사용하는 것은 좋지만, 이 내용을 사용하려는 파일에서 하나하나 추가해서 사용하기 때문에 커스텀 Hook을 구성해서 재사용할 수 있도록 해줄 필요가 있음
  - 오류 페이지 이동에 대한 처리가 필요
    - ex) 게시글 추가 버튼이 로그인하지 않았음에도 활성화되어 클릭되면 오류 페이지로 이동해서 서버에서 문제가 생기지 않도록 조치가 필요함
    - ex) 로그인을 하지 않은 채로 강제로 URL을 통해서 이동하려고 할 때, 오류 페이지로 이동하도록 구성을 해줘야 함
  - 사용자 프로필 페이지 내용 구성 필요
    - 사용자 정보를 가져오고, 그와 관련된 게시글만 따로 모아서 보여줘야 함
  - 백엔드의 user-router.js에서 accessToken, login/success, profile router에서 모두 accessToken 함수 내용을 재사용하고 있는데, 굳이 3개의 router로 나눌 필요가 있는 지 확인해보고 필요가 없다면 하나로 줄여줘야 함
  - 액세스 토큰, 리프레시 토큰 버튼을 메인헤더에서 제거해야 함
    - 테스트하기 위해서 추가한 내용인데, 굳이 필요한 지 확인하고 필요없다면 삭제해줘야 함
  - 코드 예외 처리 더 필요한 부분이 있는 지 체크해야 함

# 오늘 느낀 점

- 오늘은 중복 코드를 줄이고, 재사용성을 높이는 위주로 내용을 변경해주었는데, 변경된 내용을 보니 많이 줄여진 것 같다는 생각이 든다. 코드 중복을 줄이면서 유지보수도 더 쉽게 되었고, 코드의 일관성도 있게 구성이 된 것 같아서 좀 뿌듯한데, 추가로 재사용할 부분과 줄일 수 있는 부분 더 있는 지 확인을 해봐야 할 것 같다. 이제 프로필 페이지 구성을 해주고 백엔드의 user-router.js에서 accessToken 함수를 사용하고 있는데 중복으로 사용되고 있는 부분을 발견해서 이 부분도 변경을 해줄 생각이다. 액세스 토큰, 리프레시 토큰 버튼을 예전에 테스트하기 위해서 추가해놨었는데, 현재는 이 버튼을 사용하지 않기 때문에 제거하고, 자동으로 토큰 만료 시간이 지났을 때 액세스 토큰, 리프레시 토큰 코드가 실행되도록 구성을 변경해볼 생각이다.

<br />

# 내일 할 일

- React 공부 및 React 프로젝트 조금씩 진행하기

<br />

# 앞으로 해야 할 일

- React, NextJS 공부

- React 프로젝트 제작
