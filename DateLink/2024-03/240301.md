# 오늘 한 일

### React 프로젝트 제작 (React, NodeJS, MongoDB로 만드는 미니 커뮤니티 플랫폼)

- 구성한 내용

  - 답글 출력 로직 추가
    - 답글이 정상적으로 백엔드에 저장은 되고 있지만, 아직 화면에 보이지 않기 때문에 보이도록 내용을 추가
    - 백엔드 구성
      - postId를 가져오고, 일치하는 게시글을 찾아서 \_id를 가져오고, 답글에 저장된 게시글 \_id 정보와 가져온 \_id를 비교해서 일치하는 답글을 모두 보여주도록 구성
    - 프론트엔드 구성
      - useEffect를 추가하고, fetch 함수를 구성해서 백엔드에 구성한 API 엔드포인트와 연결
      - 응답 받은 데이터를 가져오고, setReplies에 응답받은 데이터의 답글들을 보여주도록 구성
      - addReply에서는 정상적으로 데이터가 들어오고 저장되는지 확인하기 위해서 console.log 추가해서 테스트
      - replies를 map 함수로 구성하기 전에 0보다 큰지 확인해서 답글들이 존재하는지 확인해줘야 하는데, length가 빠져있어서 내용 추가
      - Reply 컴포넌트에 답글의 내용을 prop으로 전달해서 출력하도록 구성
      - Reply 컴포넌트에서는 전달받은 답글의 내용을 출력
    - 현재 구성한 내용을 테스트해본 결과 정상적으로 답글이 추가되고, 실시간으로 화면에도 반영되는 것을 확인할 수 있었다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/3699fa72d643285455e0416c3ef3bf02f49a8f59)

  <br />

  - 답글 form toggle 위치 변경
    - Comment 컴포넌트에서 구성해놓은 replyToggle과 관련된 내용을 Replies 컴포넌트로 옮겨서 구성
    - 답글이 존재한다면 항시 보여져야 하는데, 이전의 방식에서는 답글쓰기 버튼을 클릭했을 때 답글이 보여지고 있기 때문에 내용을 변경
      - 현재는 답글이 존재할 때 항상 답글이 보여지도록 구성되어 있다.
    - 답글 form을 toggle하는 위치는 답글 쪽에서 관리하는 것이 맞다고 생각되어 변경하게 되었다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/3de3c6d4abeff5629bf587b49ac25fc0efda6fbe)

  <br />

  - 답글 삭제 로직 추가
    - 댓글에서 추가한 삭제 로직을 이용해서 거의 유사하게 구성
    - 백엔드 구성
      - 댓글의 로직과 동일하며, 사용하는 변수의 이름과 컬렉션을 변경
      - API 엔드포인트 경로도 답글 경로에 맞춰서 구성
    - 프론트엔드 구성
      - 댓글에서 구성한 내용과 거의 유사하며, 사용하는 변수가 다르게 구성되었다.
      - commentId를 사용하던 부분에서 replyId를 사용하고, 백엔드의 API 엔드포인트와 연결해주도록 경로도 변경
      - 백엔드에 replyId를 전달하도록 body를 구성
      - 삭제 버튼을 클릭했을 때, 저장된 답글의 \_id와 전달받은 답글의 \_id를 비교한 후에 filter를 통해 일치하는 항목을 제외하고 보여지도록 구성
    - 댓글의 내용과 거의 유사하며 사용하는 변수 이름을 변경해주었으며, 데이터가 넘어오고 삭제가 되는지 테스트한 결과 정상적으로 작동하는 것을 확인할 수 있었다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/67e50a8871310935bcfc7ef5932eeca7852493f5)

  <br />

  - 답글 수정 로직 추가
    - 댓글에서 추가한 수정 로직을 이용해서 거의 유사하게 구성
    - 백엔드 구성
      - 댓글 로직과 동일하며, commentId 대신에 replyId를 사용해서 구성
      - 굳이 commentId는 필요하지 않을 것 같아서 데이터를 전달받지 않도록 구성
    - 프론트엔드 구성
      - 댓글에서 사용한 로직을 가져와서 사용하고, 변수 이름만 변경해주었다.
      - 댓글에서와 마찬가지로 수정 버튼 클릭 시 ReplyForm이 toggle되도록 내용을 추가
      - ReplyForm의 submitHandler 내용은 댓글과 조금 다르게 구성이 되었는데, method에 POST와 PATCH 둘 중에 어떤 내용이 들어오는지에 따라 객체 구성이 다르게 되도록 해주었다.
      - POST method가 들어온다면 commentId 내용이 추가되며, PATCH method가 들어온다면 replyId 내용이 추가된다.
        - 조건부로 method 내용에 따라 객체에 포함되는 내용이 다르도록 구성을 해주었는데, 여기서 다른 방법의 조건부도 구성해보았는데 최종 선택은 가독성과 유지보수성을 위해서 명확하게 구성한 첫 번째 조건부 로직을 선택했다.
        - 재사용성도 가장 높다고 생각이 되기 때문에 첫 번째 로직을 선택했다.
      - 이 외에는 거의 동일하게 내용을 구성해주고, 답글을 닫는 toggle 함수의 위치만 조금 수정해주었다.
        - 댓글에서의 추가는 항상 보여지고 수정만 form이 닫히도록 구성했지만, 답글에서는 추가와 수정 모두 제출되면 닫히도록 하기 위해서 if문이 끝난후에 form이 닫히도록 구성해주었다.
    - 수정과 관련된 내용을 구성하면서, 수정과 관련된 변수 이름을 조금 변경해줘야 할 필요성을 느꼈는데 댓글에서도 그렇고 수정을 나타내는 변수 이름에서 edit, update, patch 이렇게 3가지가 섞여있어서 하나로 일관성있도록 변경을 해줘야 한다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/41916f577ab92be3db232f10f25e65144eaaede1)

<br />

- 추가 및 해결 해야 할 내용
  - 회원가입 form에서 잘못된 입력을 제출 했을 때, session에 데이터가 저장되는데, 기존의 session 데이터에서 업데이트되는 방식이 아닌 매번 제출할 때마다 새로운 session이 추가되고 있기 때문에 백엔드 코드에서 수정이 필요하다.
    - 계속 원인을 찾아보려고 이것저것 시도해보았지만 아직 어떤 코드가 정확히 원인인지 찾지 못해서 하나씩 천천히 테스트가 필요함
    - 일단 이걸 테스트 해보기전에 먼저 정상적으로 세션 만료가 되는지 확인해보았는데 정상적으로 세션 만료가 되기 때문에, 로그인을 먼저 구성해보고 정상적으로 로그인이 되는지 확인을 해보고 안된다면, session에 저장되는 부분을 다시 확인해봐야 할 것 같다는 생각
  - 로그인 후에, 새로고침 시 로그아웃 되어버리는 상황도 수정을 해야 함
    - 현재 로그인 한 후에, useEffect를 통해서 데이터를 확인하고 토큰이 유효하다면 정상적으로 로그인 유지는 되지만, 새로고침 시 깜빡거리면서 메인헤더가 변경되는 것이 보이기 때문에 이 부분을 수정할 수 있으면 수정할 생각이다.
  - 로그인을 유지하고 있을 때, token이 만료 시간에 가까워지면 자동으로 갱신되는 로직을 추가 해야 함
    - 대충 구성만 되어 있는 상태로, 좀 더 자세한 코드와 테스트가 필요함

# 오늘 느낀 점

- 답글과 관련된 추가, 수정, 삭제 및 출력까지 현재는 다 구성을 했지만, 테스트해본 결과 조금 자잘한 문제들이 있어서 그 부분들을 수정해줘야 한다. 첫 번째로 수정 form을 열고 그대로 수정 버튼 클릭 시 빈 문자열로 저장되는 것을 확인했는데 이 문제는 댓글에서 해결해본 경험이 있기 때문에 그 내용을 바탕으로 다시 수정해주면 될 것 같다. 두 번째로 답글의 내용이 추가하지 않은 댓글에서도 보여지고 수정, 삭제 기능이 작동하고 있기 때문에 이 문제를 수정해줘야 한다. 두 번째 문제가 발생한 이유를 생각해보면 댓글에 Replies 컴포넌트를 import해서 구성했는데, 이 부분이 문제가 되는 것 같다. 댓글마다 답글들이 모여있는 컴포넌트가 포함되어 있기 때문에 답글들의 내용이 중복으로 보여지는 것 같은데, 해결 방법으로 Replies 컴포넌트의 위치를 옮기거나 답글에 저장된 댓글의 \_id를 확인해서 일치하는 내용만 보여지도록 구성하면 해결될 것으로 생각된다. 마지막으로 현재 댓글이나 답글 부분의 수정과 관련된 변수 이름에서 edit, update, patch 이런식으로 이름이 다르게 되어있는데 변수 이름에 일관성을 주기 위해서 edit으로 통일해서 변경을 해줄 생각이다.

<br />

# 내일 할 일

- React 공부 및 React 프로젝트 조금씩 진행하기

<br />

# 앞으로 해야 할 일

- React, NextJS 공부

- React 프로젝트 제작
