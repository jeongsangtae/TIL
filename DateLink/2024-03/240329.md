# 오늘 한 일

### React 프로젝트 제작 (React, NodeJS, MongoDB로 만드는 미니 커뮤니티 플랫폼)

- 구성한 내용

  - 메인헤더 내용에서 authenticated 대신에, Context API의 로그인 유무 내용을 사용해서 구성
    - 기존에는 메인헤더에서 authenticated useState를 따로 구성해서 로그인이 정상적으로 진행되었을 때, 로그아웃했을 때, authenticated 내용이 변경되도록 구성해서 해당 내용을 사용하는 구조였으나, 이제는 authenticated 대신에 Context API에 저장된 로그인 유무 내용인 authCtx.isLoggedIn을 바로 사용하도록 구성을 변경해주었다.
    - 프론트엔드 구성
      - authenticated useState 삭제
      - fetch 함수, 로그아웃 이벤트 핸들러 등 authenticated의 내용을 변경하는 부분 삭제
      - authenticated 대신에 authCtx.isLoggedIn 내용을 사용
      - authenticatedHandler 함수도 삭제
      - Login 컴포넌트에 더 이상 authenticatedHandler를 전달하지 않도록 삭제
      - Login 컴포넌트에서 메인헤더 컴포넌트에서 전달받은 onLogin을 삭제
    - 1차 테스트에서는 Login 컴포넌트의 onLogin을 삭제하지 않고 테스트 진행했는데 그 때는 로그아웃을 하고 난 후에 로그인 모달이 뜨는 것을 확인할 수 있었다.
    - 2차로 onLogin 부분을 삭제하고 다시 테스트한 결과, 로그아웃을 하면 정상적으로 로그인 모달이 뜨지 않고, 로그인이 필요하다는 메시지를 확인할 수 있었다.
      - onLogin 부분이 작동하면서 자동으로 로그인 모달이 띄워지는데 이건 원치 않은 동작이기 떄문에 onLogin을 삭제해줌으로써 해결되었다.
    - 테스트 결과, 모두 기존과 동일하게 정상적으로 작동하는 것을 확인할 수 있었고, 추가로 새로고침 시 메인헤더의 깜빡임이 없어진 것 같은 느낌이 들었는데, 다시 테스트해보니 홈, 프로필에서는 아주 조금 깜빡임이 남아있지만 게시판에서는 깜빡임이 없는 것을 확인할 수 있었다.
      - 이전에는 useState만을 사용해서 로그인 유무를 저장하고 새로고침 시 재렌더링되며, 상태가 초기화되었기 때문에 깜빡임이 존재했었음
      - 이제는 localStorage에 로그인 상태를 저장하고 새로고침 시에도 유지가 되기 때문에, 이 방법으로 깜빡임 현상 없이 일관된 UI를 제공하고 있다.
      - 작은 문제로, 메인헤더는 공통으로 사용되고 있기 때문에 사라진다면 모든 곳에서 사라져야 할텐데 게시판에서는 깜빡임이 없고 다른 곳에서는 깜빡임이 조금 남아있는 것이 의문이 들어서 추가 확인이 필요해보인다.
      - 결과적으로 깜빡임 문제를 해결하고 싶었는데 어느정도 해결이 된 것 같아서 결과는 좋다고 생각이 된다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/bd427f3f37187fba212e6bd211b0f317036a1b12)

  <br />

  - 게시글 추가 페이지 name 오류 수정
    - 게시글 추가 페이지에서 로그아웃하고 새로고침한 후에 다시 로그인하면 name과 관련해서 undefined 에러가 뜨기 때문에, 정상적으로 name 데이터가 전달될 수 있도록 CreatePostPage 컴포넌트에서 useLoaderData Hook을 사용해서 가져온 데이터를 전달하는 대신에, Context API를 통해서 가져온 데이터를 PostForm에 전달하도록 구성을 변경해주었다.
    - 프론트엔드 구성
      - CreatePostPage 컴포넌트에서 Context API를 통해서 사용자 정보 데이터를 가져오도록 구성
      - 가져온 사용자 정보 데이터를 PostForm 컴포넌트 userData prop으로 전달
      - PostForm 컴포넌트의 작성자 부분에서 userData?.name으로 구성해서 사용
    - 1차 테스트에서 userData.name으로 실행한 결과, null 에러가 뜨는 것을 확인
    - 2차 테스트에서 userData?.name으로 변경해서 실행한 결과, 정상적으로 작동하며 로그아웃하고 새로고침하고 다시 로그인해도 에러가 뜨지 않으며, 작성자에 로그인한 사용자의 이름이 들어가는 것을 확인할 수 있었다.
    - 모두 정상적으로 작동하는 것을 확인할 수 있었고, `?.` 연산자를 사용함으로써 에러를 방지하고 객체가 유효한 경우에 정상적으로 데이터를 출력할 수 있게 되었다.
      - `?.` 연산자는 코드의 안정성을 높이는 동시에 유효한 데이터 접근을 보장하기 때문에, 조건부 접근이나 객체 데이터를 가져올 때 유용하게 사용할 수 있다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/5239bd3db61b8ec3ea293bcd77d3f975be3ce8f1)

<br />

- 추가 및 해결 해야 할 내용
  - 회원가입 form에서 잘못된 입력을 제출 했을 때, session에 데이터가 저장되는데, 기존의 session 데이터에서 업데이트되는 방식이 아닌 매번 제출할 때마다 새로운 session이 추가되고 있기 때문에 백엔드 코드에서 수정이 필요하다.
    - 계속 원인을 찾아보려고 이것저것 시도해보았지만 아직 어떤 코드가 정확히 원인인지 찾지 못해서 하나씩 천천히 테스트가 필요함
    - 일단 이걸 테스트 해보기전에 먼저 정상적으로 세션 만료가 되는지 확인해보았는데 정상적으로 세션 만료가 되기 때문에, 로그인을 먼저 구성해보고 정상적으로 로그인이 되는지 확인을 해보고 안된다면, session에 저장되는 부분을 다시 확인해봐야 할 것 같다는 생각
    - 이 부분은 session을 삭제하게 되면 더 이상 신경쓰지 않아도 되지만, 현재는 session을 그냥 놔둔 상태이기 떄문에 잠시 유지
  - 로그인을 유지하고 있을 때, token이 만료 시간에 가까워지면 자동으로 갱신되는 로직을 추가 해야 함
    - 대충 구성만 되어 있는 상태로, 좀 더 자세한 코드와 테스트가 필요함
  - 커스텀 Hook에 대한 고려 및 세션 제거 작업
    - 세션과 연동이 가능한 부분이 있는지도 테스트가 필요함
      - 불가능, 세션이나 jwt 토큰 중 하나만 사용하는 것이 좋다.
      - 세션을 삭제하는 작업을 아직 하지 않아서 해줘야 함
    - Context API를 사용하는 것은 좋지만, 이 내용을 사용하려는 파일에서 하나하나 추가해서 사용하기 때문에 커스텀 Hook을 구성해서 재사용할 수 있도록 해줄 필요가 있음
  - 백엔드의 user-router.js에서 accessToken, login/success, profile router에서 모두 accessToken 함수 내용을 재사용하고 있는데, 굳이 3개의 router로 나눌 필요가 있는 지 확인해보고 필요가 없다면 하나로 줄여줘야 함
    - 명확하게 하기 위해서 일단은 하나로 합치지 않고, 그대로 나눠서 사용하도록 유지
    - 내용이 엄청 많은 코드로 구성된 것이 아니기 때문에 현재로서는 크게 문제 없다고 생각되어 그대로 유지
  - 액세스 토큰, 리프레시 토큰 버튼을 메인헤더에서 제거해야 함
    - 일단 주석처리해서 사용하지 않도록 변경
  - 코드 예외 처리 더 필요한 부분이 있는 지 체크해야 함
  - 메인 헤더 깜빡임 확인
    - 게시판에서 새로고침 시에는 깜빡임이 없으나, 프로필, 홈 화면에서는 메인헤더의 변경 깜빡임이 조금 있기 때문에 추가 확인 필요

# 오늘 느낀 점

- 게시판에서는 새로고침해도 메인헤더의 깜빡임이 더이상 발생하지 않지만 홈, 프로필에서는 미세하게 깜빡임이 남아 있기 때문에 이 부분에 대해서 추가적인 확인이 필요하다. 그리고 CreatePostPage에서 더 이상 useLoaderData를 통해 가져온 데이터를 사용하지 않기 때문에, main.jsx의 CreatePostPage 부분에서 추가해놓은 loader 함수의 내용도 삭제해주고 문제가 없는지 다시 테스트해줘야 한다. 이 두 가지를 확인한 후에 세션과 관련된 내용을 정리해주려고 생각하고 있는데, 백엔드에서 로그인 시 session에 사용자 정보와 isAuthenticated를 true로 저장하며, isAuthenticated를 프론트엔드에 전달해서 사용하고 있기 때문에, 백엔드와 프론트엔드 내용을 전체적으로 확인을 해보고 구성을 변경해서 세션과 관련된 내용을 정리해줄 생각이다.

<br />

# 내일 할 일

- React 공부 및 React 프로젝트 조금씩 진행하기

<br />

# 앞으로 해야 할 일

- React, NextJS 공부

- React 프로젝트 제작
