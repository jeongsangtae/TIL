# 오늘 한 일

### React 프로젝트 제작 (React, NodeJS, MongoDB로 만드는 미니 커뮤니티 플랫폼)

- 구성한 내용

  - 댓글 수정 form이 로그아웃 후에 닫히도록 구성 변경 & 댓글 수정, 삭제 시 작성자 본인만 수정, 삭제할 수 있도록 구성 추가 (백엔드)
    - 로그인을 한 상태에서 댓글 수정 form을 열고, 로그아웃을 하게 되면 그대로 댓글 수정 form이 열려있는 채로 내용을 입력할 수 없게 변경되는데, UX에서 좋지 경험이 될 수 있기 때문에, 댓글 수정 form이 로그아웃을 했을 때 완전히 닫히도록 구성을 추가해주었다.
    - 댓글 수정, 삭제 기능은 댓글을 작성한 본인일때만 수정, 삭제가 가능하도록 해주기 위해서 백엔드에서 우선 댓글 작성자와 로그인한 사용자가 일치하는 지 확인할 수 있도록 구성을 추가
    - 백엔드 구성
      - 댓글 수정, 삭제 라우터에서 쿠키에 저장된 JWT 토큰을 확인하는 코드를 추가
      - JWT 토큰에 있는 email 내용과 DB에 저장된 사용자 email이 일치하는 사용자를 찾고, 해당 사용자 정보에서 비밀번호를 제외한 내용만 따로 저장
      - 프론트엔드에서 전달 받은 commentId 내용을 활용해서, 저장된 댓글 중에서 commentId와 \_id가 일치하는 항목을 찾는다.
      - if문을 추가해서, 댓글에서 찾은 항목의 email과 비밀번호를 제외한 내용의 이메일 부분을 비교하도록 조건을 추가
      - 조건이 일치하는 경우, 기존에 구성한 수정 및 삭제와 관련된 로직이 작동, 만약 조건이 일치하지 않는 경우, message만 전달하도록 구성
    - 프론트엔드 구성
      - useEffect 내에서, 비로그인 상태를 확인하는 if문을 추가
      - `authCtx.isLoggeIn`가 false로 설정이 되어 있는 지 확인
      - if문의 조건이 작동한다면 로그인을 하지 않은 상태이기 때문에, 이 때 `onCommentToggle` prop을 작동시켜서 댓글 수정 form이 닫히도록 구성을 추가
      - 댓글 수정, 삭제와 관련된 백엔드에서 if문을 통과하지 못한 잘못된 동작의 경우 message를 전달하는데, 이 내용을 console에서 확인하기 위한 내용을 추가
    - 구성한 내용을 테스트해본 결과, 문제없이 작동하는 것을 확인할 수 있었다.
      - 댓글 수정 form을 열어놓은채로 로그아웃하면 이제는 수정 form이 닫히며 로그인하지 않은 사용자가 더 이상 수정 form에 접근할 수 없게 된다.
      - test2로 로그인하고 test가 작성한 댓글의 수정, 삭제를 시도해본 결과, 내용이 변경되지도 않고, 삭제되지도 않으며, console에서 오류 메시지가 뜨는 것을 확인할 수 있었다.
      - test로 로그인하고 수정, 삭제를 시도하면 정상적으로 내용이 수정되고 저장되며, 삭제도 문제없이 진행되는 것을 확인할 수 있었다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/d61890260dcb66434e65f92a1253dd126f5fc36c)

  <br />

  - 댓글 수정, 삭제 시 작성자 본인만 수정, 삭제 할 수 있도록 구성 추가 (프론트엔드)
    - 프론트엔드에서 댓글을 작성한 사용자와 로그인한 사용자 정보를 비교해서 일치하는 경우에만 댓글 수정, 삭제가 이루어질 수 있도록 구성을 추가
    - 프론트엔드 구성
      - Comments 컴포넌트에서 prop을 통해, 댓글에 저장된 \_id, 이름, 내용 등 정보를 Comment 컴포넌트로 전달하고 있는데 여기에서 이메일 정보는 빠져있었기 때문에 이메일 정보도 함께 전달
      - Comment 컴포넌트에서는 전달 받은 이메일 정보를 활용해서, Context API에 저장된 사용자 정보의 이메일과 일치하는 지 확인하고 만약 일치한다면 수정, 삭제 버튼이 보여지도록 해주고, 일치하지 않는 경우 수정, 삭제 버튼이 화면에서 보이지않도록 구성을 해주었다.
      - 위 조건에서 `email === authCtx.userInfo?.email` 이렇게 구성을 해주었는데, 여기에서 `?.`를 사용해서 `authCtx.userInfo?.email`에 접근하기 전에 `authCtx.userInfo`의 정보가 null 또는 undefined 인지 확인하도록 구성을 해주었다.
        - `authCtx.userInfo.email`로 구성한 경우, `authCtx.userInfo`부분이 null이 되면, null 값에 `.email`을 조회하려고 하기 때문에 에러가 발생한다.
          - email 값이 null인 것이 문제가 아닌, `authCtx.userInfo` 자체가 null이거나 undefined인 상황에서 .email에 접근하려고 하는 것이 문제가 된다.
          - authCtx.userInfo.email에 null이 들어가는 상황에서 발생하는 문제는 주로 JS에서 null 값에 대해 프로퍼티를 조회하려고 할 때 나타나는 에러
          - 이 문제를 해결하기 위해서 `?.`로 구성
        - `?.`는 Optional Chaining으로 객체의 프로퍼티에 접근할 때 그 객체가 null이나 undefined인 경우 에러를 발생시키지 않고 undefined를 반환해준다.
        - 다른 대체 방법으로 논리 연산자를 활용해서 `authCtx.userInfo`가 null이나 undefined가 아닐 때만 `.email`에 접근하도록 해줄 수 있다.
          - `authCtx.userInfo && email === authCtx.userInfo.email`
        - 위 두 가지 방법 중 `Optional Chaining (?.)` 방식이 더 깔끔하고 현대적인 접근 방식이기 때문에 이 방식을 사용했다.
    - 구성한 내용은 정상적으로 작동하며, 이제는 로그인한 사용자 본인이 작성한 댓글이 아닌 경우 수정, 삭제 작업을 진행할 수 없도록 버튼이 보이지 않고, 댓글을 작성한 사용자와 로그인한 사용자가 일치하는 경우에는 수정, 삭제 버튼이 보이며 작업을 진행할 수 있게 되었다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/de5d74921fe7eb140bfd85411f7f4e6e5515c179)

  <br />

  - 답글 부분에서 로그인 유무에 따른 실시간 내용 변화 추가 (1단계 작업)
    - 답글 부분에서도 로그인 유무에 따라서 실시간으로 form, button 등 내용들이 변경되도록 구성을 추가해주었다.
      - 아직 백엔드에서 세부 작업은 해주지 않고, 프론트엔드에서 보이는 부분 작업을 추가
    - 프론트엔드 구성
      - Replies 컴포넌트에서 Context API 내용을 가져와서 로그인 유무를 판단하고, 로그인이 되었다면 답글쓰기 버튼이 보이고, 비로그인 상태라면 답글쓰기 버튼은 보이지 않도록 구성
      - Reply 컴포넌트에서 Context API 내용을 추가하고, 아직 사용은 하지 않는 상태
        - Reply 컴포넌트는 관련된 백엔드에서 JWT 토큰 내용을 추가한 후에 작업이 진행될 예정
      - ReplyForm 컴포넌트도 Context API 내용을 가져와서 로그인 유무를 판단하고, 로그인 유무에 따라 button의 className이 변경되거나, textarea 내용이 다르게 보이도록 구성
      - EditComment 컴포넌트와 마찬가지로, ReplyForm 컴포넌트에서도 추가, 수정 form을 열어놓은 채로 로그아웃을 하면 자동으로 form이 닫히며 보이지않도록 해주었다.
    - 구성한 내용은 모두 정상적으로 작동하며, 1단계 작업만 진행이 되었기 때문에 답글과 관련된 백엔드에서 내용 구성 및 프론트엔드에서 답글 작성자와 로그인한 사용자 일치 유무를 확인해서 수정, 삭제할 수 있도록 해줄 필요가 있다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/6992d0f48846bd2a608e6ea7c758741c89cf5344)

<br />

- 추가 및 해결 해야 할 내용
  - 회원가입 form에서 잘못된 입력을 제출 했을 때, session에 데이터가 저장되는데, 기존의 session 데이터에서 업데이트되는 방식이 아닌 매번 제출할 때마다 새로운 session이 추가되고 있기 때문에 백엔드 코드에서 수정이 필요하다.
    - 계속 원인을 찾아보려고 이것저것 시도해보았지만 아직 어떤 코드가 정확히 원인인지 찾지 못해서 하나씩 천천히 테스트가 필요함
    - 일단 이걸 테스트 해보기전에 먼저 정상적으로 세션 만료가 되는지 확인해보았는데 정상적으로 세션 만료가 되기 때문에, 로그인을 먼저 구성해보고 정상적으로 로그인이 되는지 확인을 해보고 안된다면, session에 저장되는 부분을 다시 확인해봐야 할 것 같다는 생각
  - 로그인 후에, 새로고침 시 로그아웃 되어버리는 상황도 수정을 해야 함
    - 현재 로그인 한 후에, useEffect를 통해서 데이터를 확인하고 토큰이 유효하다면 정상적으로 로그인 유지는 되지만, 새로고침 시 깜빡거리면서 메인헤더가 변경되는 것이 보이기 때문에 이 부분을 수정할 수 있으면 수정할 생각이다.
  - 로그인을 유지하고 있을 때, token이 만료 시간에 가까워지면 자동으로 갱신되는 로직을 추가 해야 함
    - 대충 구성만 되어 있는 상태로, 좀 더 자세한 코드와 테스트가 필요함
  - 로그인 시 주어지는 토큰을 확인하고, 해당 토큰을 통해 인증하고 게시글, 댓글, 답글 관련 기능을 활성화해주는 코드를 구성해야 함
    - 전체적으로 저 인증을 확인할 수 있게 해주는 것이 1차 목표로, 애플리케이션 전체에서 인증을 확인할 수 있게 된다면 쉽게 구성이 될 것으로 예상된다.
      - Context API를 추가해서, 로그인 유무를 전체에서 알 수 있도록 구성해주고 필요할 때 내용을 가져와서 사용 할 수 있다.
    - 세션과 연동이 가능한 부분이 있는지도 테스트가 필요함
      - 불가능, 세션이나 jwt 토큰 중 하나만 사용하는 것이 좋다.
      - 세션을 삭제하는 작업을 아직 하지 않아서 해줘야 함
    - Context API를 사용하는 것은 좋지만, 이 내용을 사용하려는 파일에서 하나하나 추가해서 사용하기 때문에 커스텀 Hook을 구성해서 재사용할 수 있도록 해줄 필요가 있음
  - 오류 페이지 이동에 대한 처리가 필요
    - ex) 게시글 추가 버튼이 로그인하지 않았음에도 활성화되어 클릭되면 오류 페이지로 이동해서 서버에서 문제가 생기지 않도록 조치가 필요함
    - ex) 로그인을 하지 않은 채로 강제로 URL을 통해서 이동하려고 할 때, 오류 페이지로 이동하도록 구성을 해줘야 함

# 오늘 느낀 점

- JWT 토큰 관련 코드를 router 여러 곳에서 중복으로 사용 하고 있는데 이 내용을 재사용할 수 있게 해줘야 할 것 같다는 생각이 든다. 같은 내용의 코드를 계속 반복적으로 사용하는데 너무 불필요한 작업이라고 생각되기 떄문에 수정을 해줄 생각이다. 댓글 부분에서 이제 작성자한 본인만 수정, 삭제를 할 수 있게 되었고 답글에서도 거의 비슷한 내용이기 때문에 빠르게 작업을 해준 뒤에, URL을 통해서 수정 페이지에 접근하려고 했을 때, 에러 페이지로 이동하도록 구성을 추가해줄 생각이다. 게시글 수정, 삭제 부분에서 작성자 본인인지 확인하는 로직을 구성하지 않은 것 같아서, 이 부분도 추가를 해줄 생각이다.

<br />

# 내일 할 일

- React 공부 및 React 프로젝트 조금씩 진행하기

<br />

# 앞으로 해야 할 일

- React, NextJS 공부

- React 프로젝트 제작
