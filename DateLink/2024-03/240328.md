# 오늘 한 일

### React 프로젝트 제작 (React, NodeJS, MongoDB로 만드는 미니 커뮤니티 플랫폼)

- 구성한 내용

  - 게시글 수정 페이지에서 에러 메시지가 조건부로 출력되도록 구성 (실패)
    - 프로필 페이지, 게시글 추가 페이지와 다르게 게시글 수정 페이지는 작성자 본인이 아닐 경우 수정이 불가능해야 하지만, 현재는 어떤 사용자든 다른 사용자의 게시글을 수정할 수 있기 때문에, 이 부분을 확인하기 위해서 게시글의 이메일과 로그인한 사용자의 이메일이 일치하는지 확인하고, 결과에 따라 내용을 보여주거나 에러 메시지를 보여주도록 구성을 추가해주었다.
      - 일반적으로 로그인을 하고 다른 사용자의 게시글 세부 페이지에 들어가면, 수정과 삭제 버튼이 비활성화 되어있지만, URL을 통해서 접근이 가능하기 때문에 이 부분의 문제를 처리해주기 위해서 내용을 추가하게 되었다.
      - 조건부를 추가해서 구성해보았지만, 현재 구성된 내용으로는 완벽하게 처리를 하지 못하기 때문에 추가 수정이 필요하다.
    - 프론트엔드 구성
      - Authentication 컴포넌트에서 useRouteLoaderData Hook을 추가해서, 게시글의 정보를 가져오도록 구성
      - if문을 통해서 사용자의 로그인 유무를 확인
        - 로그인이 되었다면 children prop을 사용해서 정상적으로 내용이 보여지도록 해준다.
        - 비로그인 상태라면 NoAccess 컴포넌트에 로그인 유무를 전달하면 로그인 유무 조건에 따라 내용이 보여지도록 구성
      - 다음 if문을 통해서 사용자가 로그인 했는지 확인하고 로그인이 상태라면, 게시글의 이메일과 로그인한 사용자의 이메일을 확인
        - 이메일이 일치하는 경우 그대로 children prop을 사용해서 정상적으로 내용이 보여지도록 해준다.
        - 이메일이 불일치하는 경우 NoAccess 컴포넌트에 로그인 유무를 전달하며 로그인 유무 조건에 따라 내용이 보여지도록 구성
      - NoAccess 컴포넌트에서는 들어오는 로그인 유무 boolean에 따라 에러 메시지가 다르게 보여지도록 구성
      - PostEditPage 컴포넌트에서 따로 게시글 이메일과 사용자 이메일을 확인하고 일치할 경우 내용을 보여주고, 불일치 할 경우 에러 메시지를 보여주도록 구성하려고 했으나, 이 컴포넌트가 아닌 보호 라우트에서 처리를 해보고 싶기에 일단 여기는 보류
    - 테스트 결과, 게시글 추가 페이지와 프로필 페이지에서도 보호 라우트인 Authentication 컴포넌트를 함께 사용하고 있는데, 두 곳에서는 email 정보를 모르기 때문에 에러가 발생했다.
      - email과 관련된 에러뿐만이 아닌, 에러 메시지도 내 생각과 다르게 출력이 되고 있기 때문에 다른 방법으로 구성을 해봐야 할 것 같다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/09266d8575a0dbd3541af77848774a4be7e82b32)

  <br />

  - 게시글 수정 페이지에서 에러 메시지가 조건부로 출력되도록 구성 (고침)
    - 앞에서 구성한 내용을 테스트한 결과, email 오류도 있고 에러 메시지도 원하는 대로 출력이 되지 않기 떄문에 구성을 변경해서 PostEditPage 컴포넌트에서 내용을 처리하도록 구성 변경
    - 프론트엔드 구성
      - Authentication 컴포넌트와 NoAccess 컴포넌트의 내용을 이전 상태로 다시 변경
      - PostEditPage 컴포넌트에서 이전에 추가한 useRouteLoaderData Hook을 사용해서 게시글 정보를 가져오도록 구성
      - 게시글 정보에서 이메일 정보와 로그인한 사용자의 이메일 정보가 일치하는 지 확인하는 조건부 추가
        - 일치한다면 수정 form을 보여주도록 구성
        - 일치하지 않는다면 에러 메시지가 출력되도록 구성
    - Authentication, NoAccess 컴포넌트에서 구성한 내용을 모두 초기화하고 이전의 상태로 되돌린 후에, PostEditPage 컴포넌트에서 게시글의 이메일과 사용자의 이메일을 확인하고 그에 따른 조건을 추가해서 처리하니까 내가 생각한 구성대로 작동하는 것을 확인할 수 있었다.
      - 이 방법으로 구성하려고 생각했었지만, 이 것보다는 보호 라우트에서 구성하고 거기서 내용을 처리해서 에러 메시지를 전달하는 것이 더 보기 좋을 것 같아서 시도했으나 쉽지 않은 작업이었던 것 같다.
      - 이제 로그인이 된 상태에서 다른 사용자의 게시글을 수정하기 위해서 URL로 접근했을 때 해당 게시글을 수정할 수 있는 것이 아닌, 에러 메시지가 보이기 때문에 게시글을 수정할 수 없게 되었다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/6a4b1e4cd15dca8dbd22f3067780be0a04ba9a09)

  <br />

  - 게시글 수정 페이지에서 에러 메시지가 동적으로 출력되도록 구성
    - 게시글 수정 페이지에서 두 가지 에러 메시지가 존재하는데, 하나는 로그인을 하지 않았을 때, 다른 하나는 게시글 작성자 본인이 아닐 때 다른 에러 메시지가 출력되고 있는데, PostEditPage와 Authentication에서 각각 에러 메시지를 NoAccess 컴포넌트에 전달해서 NoAccess 컴포넌트에서 전달받은 내용을 출력하도록 구성을 해주었다.
    - 프론트엔드 구성
      - Authentication에서 로그인이 되지 않았을 경우, NoAccess 컴포넌트에 message라는 prop에 title, description으로 에러 메시지 내용을 전달
      - PostEditPage에서 게시글에 저장된 이메일과 로그인한 사용자 이메일이 일치하지 않을 때, NoAccess 컴포넌트에 message라는 prop에 title, description으로 에러 메시지 내용을 전달
      - NoAccess 컴포넌트에서는 message prop을 사용해서 h1에는 message.title 내용을, p에는 message.description 내용이 출력되도록 구성
    - Authentication 컴포넌트에서는 NoAccess 컴포넌트를 사용해서 에러 메시지를 출력하고 있었지만, PostEditPage에서는 NoAccess 컴포넌트를 사용하는 것이 아닌, 해당 컴포넌트에서 자체적으로 정적인 에러 메시지를 출력하고 있었기 때문에 내용을 변경해서 NoAccess 컴포넌트에 에러 메시지를 전달해서 출력되도록 구성해주었다.
      - 테스트 결과 문제 없이 출력되는 것을 확인할 수 있었고, 이제는 NoAccess 컴포넌트가 재사용되며 전달받은 에러 메시지를 동적으로 출력하게 되었다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/986aa886521ade509c3fd5b7f0830a2385763c2c)

<br />

- 추가 및 해결 해야 할 내용
  - 회원가입 form에서 잘못된 입력을 제출 했을 때, session에 데이터가 저장되는데, 기존의 session 데이터에서 업데이트되는 방식이 아닌 매번 제출할 때마다 새로운 session이 추가되고 있기 때문에 백엔드 코드에서 수정이 필요하다.
    - 계속 원인을 찾아보려고 이것저것 시도해보았지만 아직 어떤 코드가 정확히 원인인지 찾지 못해서 하나씩 천천히 테스트가 필요함
    - 일단 이걸 테스트 해보기전에 먼저 정상적으로 세션 만료가 되는지 확인해보았는데 정상적으로 세션 만료가 되기 때문에, 로그인을 먼저 구성해보고 정상적으로 로그인이 되는지 확인을 해보고 안된다면, session에 저장되는 부분을 다시 확인해봐야 할 것 같다는 생각
    - 이 부분은 session을 삭제하게 되면 더 이상 신경쓰지 않아도 되지만, 현재는 session을 그냥 놔둔 상태이기 떄문에 잠시 유지
  - 로그인 후에, 새로고침 시 로그아웃 되어버리는 상황도 수정을 해야 함
    - 현재 로그인 한 후에, useEffect를 통해서 데이터를 확인하고 토큰이 유효하다면 정상적으로 로그인 유지는 되지만, 새로고침 시 깜빡거리면서 메인헤더가 변경되는 것이 보이기 때문에 이 부분을 수정할 수 있으면 수정할 생각이다.
  - 로그인을 유지하고 있을 때, token이 만료 시간에 가까워지면 자동으로 갱신되는 로직을 추가 해야 함
    - 대충 구성만 되어 있는 상태로, 좀 더 자세한 코드와 테스트가 필요함
  - 로그인 시 주어지는 토큰을 확인하고, 해당 토큰을 통해 인증하고 게시글, 댓글, 답글 관련 기능을 활성화해주는 코드를 구성해야 함
    - 전체적으로 저 인증을 확인할 수 있게 해주는 것이 1차 목표로, 애플리케이션 전체에서 인증을 확인할 수 있게 된다면 쉽게 구성이 될 것으로 예상된다.
      - Context API를 추가해서, 로그인 유무를 전체에서 알 수 있도록 구성해주고 필요할 때 내용을 가져와서 사용 할 수 있다.
        - 구성 함
    - 세션과 연동이 가능한 부분이 있는지도 테스트가 필요함
      - 불가능, 세션이나 jwt 토큰 중 하나만 사용하는 것이 좋다.
      - 세션을 삭제하는 작업을 아직 하지 않아서 해줘야 함
    - Context API를 사용하는 것은 좋지만, 이 내용을 사용하려는 파일에서 하나하나 추가해서 사용하기 때문에 커스텀 Hook을 구성해서 재사용할 수 있도록 해줄 필요가 있음
  - 오류 페이지 이동에 대한 처리가 필요
    - 다른 오류 페이지는 구성이 되었고, 본인이 작성하지 않은 게시글 수정에 접근하는 것에 대한 오류 페이지 이동만 추가하면 된다.
    - 추가로 프로필 페이지나 게시글 수정 페이지는 문제가 없는데, URL에서 게시글 추가 페이지를 먼저 접근하고 오류 페이지에서 로그인하면 name이 전송되지 않아서 에러가 뜨기 떄문에 이 부분 확인이 필요함
  - 백엔드의 user-router.js에서 accessToken, login/success, profile router에서 모두 accessToken 함수 내용을 재사용하고 있는데, 굳이 3개의 router로 나눌 필요가 있는 지 확인해보고 필요가 없다면 하나로 줄여줘야 함
    - 명확하게 하기 위해서 일단은 하나로 합치지 않고, 그대로 나눠서 사용하도록 유지
    - 내용이 엄청 많은 코드로 구성된 것이 아니기 때문에 현재로서는 크게 문제 없다고 생각되어 그대로 유지
  - 액세스 토큰, 리프레시 토큰 버튼을 메인헤더에서 제거해야 함
    - 일단 주석처리해서 사용하지 않도록 변경
  - 코드 예외 처리 더 필요한 부분이 있는 지 체크해야 함

# 오늘 느낀 점

- 게시글 추가, 게시글 수정, 프로필 페이지에 보호 라우트를 추가해주면서, 이제는 URL로 접근해도 해당 페이지에 접근 권한이 없다면 에러 메시지를 출력하게 되면서 좀 더 나은 UX가 구성이 된 것 같다. 이제 새롭게 내용을 추가하는 것보다 위에서 해야 할 내용 정리해놓은 부분을 하나씩 처리하고 고쳐볼 생각을 하고 있다. 저 내용을 먼저 처리하는 것도 좋았을 것 같지만, 일단 어느정도 내용이 구성되어 더 틀이 잡혀진 상태에서 오류를 처리하는 것이 더 좋을 것 같다고 생각되어, 좀 미룬 상태였는데 이제는 처리해줘야 할 때가 된 것 같아서 하나씩 처리를 해줄 생각이다.

<br />

# 내일 할 일

- React 공부 및 React 프로젝트 조금씩 진행하기

<br />

# 앞으로 해야 할 일

- React, NextJS 공부

- React 프로젝트 제작
