# 오늘 한 일

### React 프로젝트 제작 (React, NodeJS, MongoDB로 만드는 미니 커뮤니티 플랫폼)

- 구성한 내용

  - 쿠키에 저장된 jwt 토큰을 확인해서, 인증 관련 동작을 추가하기 위해 방법 구상
    - 현재 로그인 했을 때 jwt 토큰이 쿠키에 저장되는데, 이 내용을 가지고 로그인 전후로 게시글, 댓글, 답글 기능을 사용 유무를 컨트롤 해줘야 한다.
      - 로그인을 했을 때 메인헤더가 변경되는 부분은 구성이 되어 있으므로, 추가로 로그인 유무를 통해 기능을 사용할 수 있도록 해줘야 하지만, 현재는 로그인을 하지 않아도 사용이 가능한 상태이기 때문에 이 내용을 변경해줘야 한다.
      - 로그인에 따른 기능 사용 유무를 컨트롤 하기 위해 로직을 구성하는데 어떤 방법으로 구성을 할 것인지에 대한 방법을 찾아보고 정리하는 시간
    - 첫 번째 방법
      - 프론트엔드에서 js-cookie 라이브러리를 사용해서, 쿠키에 저장된 데이터를 읽어서 사용하는 방법
      - 프론트엔드에서 js-cookie 라이브러리를 게시글, 댓글, 답글에서 추가하고 로그인을 하면 쿠키에 jwt 토큰 데이터가 추가되면서 라이브러리로 데이터를 확인해서, 존재한다면 기능들이 활성화되는 방향으로 구성을 생각했다.
      - 문제는 js-cookie 라이브러리를 게시글, 댓글, 답글에서 매번 추가해서 작업을 해줘야 하는 부분이 조금 신경쓰이고 쿠키에 저장된 데이터를 읽는데, 인코딩되어 있는 토큰의 정보를 읽어낼 수 있는 지 확실하지 않음
    - 두 번째 방법
      - 백엔드에서 구성한 jwt-auth.js 파일의 내용을 user-router에 불러와서 사용하는 방법
      - 이미 jwt-auth.js 파일에서 accessToken이 인증되었는지 확인하는 코드가 있기 떄문에, 이 내용을 활용하면 될 것 같다고 생각이 된다.
      - accessToken 함수가 req.cookies로 토큰이 존재하는지 확인하고 있고, 토큰과 토큰 키를 통해서 인증해준 후에, db에 저장된 사용자의 정보와 일치하는지 확인을 하고 있기 때문에 이 코드를 사용하면 될 것 같다는 생각이 든다.
        - 위 과정을 다 통과하면 비밀번호를 제외한 데이터를 json으로 전달하고 있기 때문에 사실상 전부 구성이 되어있다는 생각이 든다.
      - jwt-auth.js 파일의 accessToken을 게시글, 댓글, 답글 로직에서 추가한 후에 먼저 확인해주고, 통과가 된다면 해당 데이터를 프론트엔드로 전달해서 작업이 이루어지도록 해주는 방향으로 생각 중이다.
      - 게시글, 댓글, 답글이 출력되는 부분은 인증과 관련 없이 전체 내용이 보여지도록 해주고, 추가 및 수정 그리고 삭제는 인증과 연결해서 로그인 하지 않았을 때, 어떠한 기능도 사용하지 못하도록 해주는 방향으로 생각했다.
      - 로그인을 하면 토큰이 추가되면서 게시글, 댓글, 답글의 추가, 수정, 삭제가 되도록 해주고 로그인을 하지 않았다면 읽기만 가능하도록 해주면서, 추가로 토큰에 저장된 email과 게시글, 댓글, 답글에 저장된 email을 확인해서 일치하는 항목만 수정, 삭제할 수 있도록 해주는 로직으로 생각 중이다.
    - 수정해줘야 하는 부분
      - 현재 jwt 토큰과 session이 묶여 있어서 우선 코드를 수정해서 session은 사용하지 않고 jwt 토큰으로만 사용하는 쪽으로 변경해줘야 한다.
      - jwt 토큰이 정상적으로 응답될 때, session에 저장된 isAuthenticated를 확인해서 boolean 값을 프론트엔드로 전달하고 있기 때문에 이 부분을 제거하고 다른 방법으로 프론트엔드에 boolean 값을 전달하도록 구성해줘야 함
      - 프론트엔드에서도 isAuthenticated를 확인해서 useState를 변경하고 있기 때문에, 이 부분을 변경해주는 쪽으로 생각을 해봐야 함

<br />

- 추가 및 해결 해야 할 내용
  - 회원가입 form에서 잘못된 입력을 제출 했을 때, session에 데이터가 저장되는데, 기존의 session 데이터에서 업데이트되는 방식이 아닌 매번 제출할 때마다 새로운 session이 추가되고 있기 때문에 백엔드 코드에서 수정이 필요하다.
    - 계속 원인을 찾아보려고 이것저것 시도해보았지만 아직 어떤 코드가 정확히 원인인지 찾지 못해서 하나씩 천천히 테스트가 필요함
    - 일단 이걸 테스트 해보기전에 먼저 정상적으로 세션 만료가 되는지 확인해보았는데 정상적으로 세션 만료가 되기 때문에, 로그인을 먼저 구성해보고 정상적으로 로그인이 되는지 확인을 해보고 안된다면, session에 저장되는 부분을 다시 확인해봐야 할 것 같다는 생각
  - 로그인 후에, 새로고침 시 로그아웃 되어버리는 상황도 수정을 해야 함
    - 현재 로그인 한 후에, useEffect를 통해서 데이터를 확인하고 토큰이 유효하다면 정상적으로 로그인 유지는 되지만, 새로고침 시 깜빡거리면서 메인헤더가 변경되는 것이 보이기 때문에 이 부분을 수정할 수 있으면 수정할 생각이다.
  - 로그인을 유지하고 있을 때, token이 만료 시간에 가까워지면 자동으로 갱신되는 로직을 추가 해야 함
    - 대충 구성만 되어 있는 상태로, 좀 더 자세한 코드와 테스트가 필요함
  - 로그인 시 주어지는 토큰을 확인하고, 해당 토큰을 통해 인증하고 게시글, 댓글, 답글 관련 기능을 활성화해주는 코드를 구성해야 함
    - 현재 생각한 방법으로는 res.locals를 사용해서, 전체적으로 인증을 확인할 수 있는지 테스트가 필요하다.
    - 전체적으로 저 인증을 확인할 수 있게 해주는 것이 1차 목표로, 애플리케이션 전체에서 인증을 확인할 수 있게 된다면 쉽게 구성이 될 것으로 예상된다.
    - 세션과 연동이 가능한 부분이 있는지도 테스트가 필요함
    - 일단 너무 어렵게 생각하는 것보다는 로그인 유무로 메인 헤더가 변경되기 때문에 이 내용을 가지고 테스트해보면서 하나씩 확인하면서 구성하면 될 것으로 예상됨

# 오늘 느낀 점

- jwt 토큰을 추가하는 코드를 구성해놓고 어떻게 활용해야 하는지 많은 고민을 했었는데, 계속 생각해보고 찾아보고 정리를 해본 결과 어느정도 답을 찾은 것 같다. 두 가지 방법을 생각했는데, 첫 번째 방법은 확실하게 장담은 못하지만 테스트해봐도 좋을 거 같은 방법이고 두 번째 방법은 뭔가 확신이 생기는 방법이었다. 이전에 구성한 jwt 토큰 관련 코드를 다시 살펴보면서 두 번째 방법을 떠올렸는데, 이미 구성을 해놓았기 때문에 활용만 하면 될 것 같다는 생각이 들었다. 우선 두 번째 방법을 먼저 테스트해보고 이 방법으로 해결이 안된다면 첫 번째 방법을 테스트해볼 생각이다. 두 번째 방법이 예전에 만든 프로젝트와 유사하게 백엔드에서 처리하는 방법이기 때문에 이 방법을 우선 테스트해볼 생각이다.

<br />

# 내일 할 일

- React 공부 및 React 프로젝트 조금씩 진행하기

<br />

# 앞으로 해야 할 일

- React, NextJS 공부

- React 프로젝트 제작
