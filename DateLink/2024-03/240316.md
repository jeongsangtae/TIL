# 오늘 한 일

### React 프로젝트 제작 (React, NodeJS, MongoDB로 만드는 미니 커뮤니티 플랫폼)

- 구성한 내용

  - 생각 및 추가해봐야 할 내용 (결과 추가)
    - Context API에서 "GUEST"라는 이름을 조건부로 미리 넘겨주는 방법
      - 정확히는 조건부로 "GUEST" 또는 사용자 이름 미리 저장하고 넘겨서 사용하는 방법도 생각해봄
        - 결과 : 이 방법은 일관성 유지, 중복 코드 감소, 성능 최적화, 코드의 가독성, 유지보수성 향상 등의 이유로 더 효율적이고 깔끔하다고 생각되어 구성하는 걸로 결정
    - Context API의 useEffect에서 조건부를 다시 봐보고, 새로고침 시에도 "GUEST"라는 이름이 유지될 수 있도록 구성
      - 비로그인 상태일 때, "GUEST"라는 명이 분명히 존재하지만, 새로고침 시에 JWT 토큰에 이상한 이름이 들어가서 해당 이름이 보여지는 이유를 찾아보고 해결해야 함
        - 결과 : 서버에서 JWT 토큰이 제공되지 않았을 때, 클라이언트 측에서 예외 상황을 제대로 처리하지 않아서 발생하는 문제로 예외 상황을 추가해서 처리할 생각이다.
    - userInfo에서 사용자 이름만 따로 빼내서 저장하는 방향도 생각해봐야 함
      - 사용자 이름, 사용자 이메일을 따로 분리해서 저장하고 사용하는 방향도 생각해봐야 함
        - 결과 : 데이터 일관성, 성능 최적화, 코드 간결함, 관리 등의 이유로 분리하는 것은 불필요한 작업이라고 생각되어, 하나의 useState를 사용해서 관리할 생각이다.
        - 추가로 필요하다면 구조 분해 할당을 활용해서 접근해서 사용할 계획
      - 추가로 분리한 정보도 localStorage에 저장해서는 안되는가에 대해 생각해봐야 함
        - 결과 : 이 부분은 보안상 문제가 될 수 있기 때문에, 옳지 못하기 때문에 localStorage에는 저장하지 않을 생각
    - 로그인을 했을 때, 댓글의 작성자 이름이 실시간으로 변경되어 보이도록 userInfo 관련 추가 작업이 필요함
      - verifyUser 함수를 useEffect 바깥으로 빼내고, loginHandler에서도 사용할 수 있게 구성해서 실시간으로 반영되도록 해봐야 함
        - 결과 : verifyUser 함수를 useEffect 밖으로 빼내고 useEffect와 loginHandler에서 활용할 수 있도록 테스트해볼 예정
      - verifyUser 함수를 밖으로 빼내는게 문제가 된다면, 주석 처리한 decoded 내용을 다시 풀고 전달해서 테스트를 해봐야 할 것 같음
        - 결과 : 굳이 테스트하지 않아도 가능 할 것 같은데, 만약 verifyUser 함수를 밖으로 빼내는게 안될 경우 테스트할 예정

  <br />

  - Context API에서 전달 받은 사용자 데이터를 선 처리후 전달하도록 변경 & JWT 토큰 예외 처리 추가
    - 백엔드를 통해 전달받은 사용자 정보를 Context API에 저장하고, 사용자 정보를 사용하는 컴포넌트에서 조건문을 활용해서 처리하고 사용했으나, 코드를 수정해서 Context API에서 먼저 조건문을 통해 처리하고 value를 통해서 전달해 사용하도록 변경 그리고 백엔드에서 JWT 토큰이 제공되지 않는 경우를 예외 처리해서 JWT 토큰 이름이 이상하게 나오는 오류를 수정
    - 프론트엔드 구성
      - verifyUser 함수 내에서 response에 대한 처리를 추가하지 않아서, "JsonWebTokenError"라는 오류가 JWT 토큰의 이름에 들어가는 문제가 발생하기 때문에, 잘못된 응답에 대한 예외 처리를 추가
      - 에러가 발생하면 userInfo를 null로 만들어서 "JsonWebTokenError"라는 이름이 JWT 토큰에 들어가지 않도록 구성
      - Context API에서 userInfo의 데이터 존재 유무에 따라 userName 구성이 변경되도록 해주는 조건문을 추가해서, 먼저 처리하고 value로 해당 내용을 전달
      - CreatComment 컴포넌트에서 사용하고 있던 userName useState는 사용하지 않고, Context API에서 전달 받은 userName을 바로 댓글 작성자 부분에 사용해서 구성
    - 변경한 코드는 문제없이 작동되며, 이제 JWT 토큰이 쿠키에 존재하지 않아도 "JsonWebTokenError"라는 오류가 JWT 토큰 이름에 들어가지 않고, "GUEST"가 댓글 작성자 이름에 정상적으로 들어간다. 그리고 Context API에서 미리 조건문으로 처리해서 따로 userName을 전달하고 있기 때문에, Context API를 사용하는 컴포넌트에서 userInfo를 가져와서 useState와 조건문을 추가할 필요 없이 바로 재사용할 수 있도록 구성이 되었다.
      - 즉, 로그인하지 않은 상태에서 새로고침을 해도 "JsonWebTokenError"라는 이름 대신에 "GUEST"라는 이름이 계속 들어가 있게 되었다.
      - userName를 다이렉트로 재사용하는 것처럼, loggedIn도 바로 재사용할 수 있도록 구성을 변경하는 것도 생각해봐야 한다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/7e567774c097f51d75d21e4b1e9b08a878b37fb7)

  <br />

  - verifyUser 함수 재사용하도록 변경
    - verifyUser 함수를 useEffect 내에서 사용하고 있는데, 이 verifyUser 함수를 loginHandler에서도 사용할 수 있게 변경해주면 로그인 즉시 댓글에서 사용자 이름을 실시간으로 변경시킬 수 있기 때문에, verifyUser 함수를 loginHandler에서도 재사용할 수 있도록 useEffect 밖으로 빼내서 구성해주었다.
    - 프론트엔드 구성
      - useEffect에서 verifyUser 함수를 밖으로 빼내서 구성
      - useEffect와 loginHandler에서는 verifyUser에 setUserInfo를 매개변수로 전달해서 실행하도록 구성
    - 변경한 구성을 테스트한 결과, 로그인 했을 경우에 실시간으로 댓글 작성자 이름이 "GUEST"에서 사용자 이름으로 변경되고, 새로고침해도 사용자 이름으로 유지되는 것을 확인할 수 있었다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/18c1d7d22a191952476e4b50bff503eb57930dba)

<br />

- 추가 및 해결 해야 할 내용
  - 회원가입 form에서 잘못된 입력을 제출 했을 때, session에 데이터가 저장되는데, 기존의 session 데이터에서 업데이트되는 방식이 아닌 매번 제출할 때마다 새로운 session이 추가되고 있기 때문에 백엔드 코드에서 수정이 필요하다.
    - 계속 원인을 찾아보려고 이것저것 시도해보았지만 아직 어떤 코드가 정확히 원인인지 찾지 못해서 하나씩 천천히 테스트가 필요함
    - 일단 이걸 테스트 해보기전에 먼저 정상적으로 세션 만료가 되는지 확인해보았는데 정상적으로 세션 만료가 되기 때문에, 로그인을 먼저 구성해보고 정상적으로 로그인이 되는지 확인을 해보고 안된다면, session에 저장되는 부분을 다시 확인해봐야 할 것 같다는 생각
  - 로그인 후에, 새로고침 시 로그아웃 되어버리는 상황도 수정을 해야 함
    - 현재 로그인 한 후에, useEffect를 통해서 데이터를 확인하고 토큰이 유효하다면 정상적으로 로그인 유지는 되지만, 새로고침 시 깜빡거리면서 메인헤더가 변경되는 것이 보이기 때문에 이 부분을 수정할 수 있으면 수정할 생각이다.
  - 로그인을 유지하고 있을 때, token이 만료 시간에 가까워지면 자동으로 갱신되는 로직을 추가 해야 함
    - 대충 구성만 되어 있는 상태로, 좀 더 자세한 코드와 테스트가 필요함
  - 로그인 시 주어지는 토큰을 확인하고, 해당 토큰을 통해 인증하고 게시글, 댓글, 답글 관련 기능을 활성화해주는 코드를 구성해야 함
    - 전체적으로 저 인증을 확인할 수 있게 해주는 것이 1차 목표로, 애플리케이션 전체에서 인증을 확인할 수 있게 된다면 쉽게 구성이 될 것으로 예상된다.
      - Context API를 추가해서, 로그인 유무를 전체에서 알 수 있도록 구성해주고 필요할 때 내용을 가져와서 사용 할 수 있다.
    - 세션과 연동이 가능한 부분이 있는지도 테스트가 필요함
      - 불가능, 세션이나 jwt 토큰 중 하나만 사용하는 것이 좋다.
      - 세션을 삭제하는 작업을 아직 하지 않아서 해줘야 함
    - Context API를 사용하는 것은 좋지만, 이 내용을 사용하려는 파일에서 하나하나 추가해서 사용하기 때문에 커스텀 Hook을 구성해서 재사용할 수 있도록 해줄 필요가 있음
  - 오류 페이지 이동에 대한 처리가 필요
    - ex) 게시글 추가 버튼이 로그인하지 않았음에도 활성화되어 클릭되면 오류 페이지로 이동해서 서버에서 문제가 생기지 않도록 조치가 필요함
    - ex) 로그인을 하지 않은 채로 강제로 URL을 통해서 이동하려고 할 때, 오류 페이지로 이동하도록 구성을 해줘야 함

# 오늘 느낀 점

- 어제 생각했던 내용을 정리하면서 가능한 것과 불가능한 것을 나누고 가능한 내용을 테스트했는데 모두 성공적인 결과를 얻었다. Context API 내용을 사용하는 컴포넌트에서 좀 더 Context API을 간결하게 사용하기 위해서, Context API에 변경해줘야 할 내용이 있지만, 우선 다른 컴포넌트에서도 Context API 내용을 정상적으로 사용할 수 있는 지 테스트하기 위해서, 댓글뿐만이 아닌 답글에서도 Context API를 추가해서 확인해볼 생각이다. 그리고 댓글이나 답글이 출력될 때, 작성한 사용자의 이름이 아닌 GUEST로 출력이 되기 때문에 이 부분도 수정을 해줘야 한다. 현재 구성한 로직은 게시글, 댓글, 답글을 로그인했다면 누구나 삭제하고 수정할 수 있도록 되어 있지만, 로직을 변경해서 본인이 쓴 게시글, 댓글, 답글만 삭제하고 수정할 수 있도록 변경을 해줄 생각이다.

<br />

# 내일 할 일

- React 공부 및 React 프로젝트 조금씩 진행하기

<br />

# 앞으로 해야 할 일

- React, NextJS 공부

- React 프로젝트 제작
