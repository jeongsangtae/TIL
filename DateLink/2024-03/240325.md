# 오늘 한 일

### React 프로젝트 제작 (React, NodeJS, MongoDB로 만드는 미니 커뮤니티 플랫폼)

- 구성한 내용

  - Authentication 컴포넌트 추가 및 사용
    - 로그아웃 상태에서 접근이 불가능한 페이지를 보호하기 위해서 Authentication 컴포넌트를 추가하고, 라우트 구성에서 필요한 라우트에 래퍼로 감싸서 보호하도록 구성
    - 프론트엔드 구성
      - Authentication 컴포넌트를 Users 폴더에 추가
      - useEffect, useContext, useNavigate import
      - useEffect 내에서, Context API에 저장된 로그인 유무를 확인하고 비로그인 상태일 때, 홈 화면으로 돌려보내도록 구성
        - 의존성 배열로 로그인 유무와 navigate를 설정
      - 비로그인 상태라면 children prop이 적용되며 래퍼로 감싼 Authentication 컴포넌트가 적용 되고, 로그인 상태인 경우 null로 Authentication 컴포넌트가 적용되지 않게 되도록 구성
      - 라우트 구성에서 게시글 추가, 게시글 수정, 프로필 페이지의 element 부분에서 Authentication 컴포넌트를 래퍼로 감싸서 보호하도록 구성
    - 구성을 테스트해본 결과, 로그인 상태에서 프로필 페이지에 접근한 후에 로그아웃을 하게 되면 홈 화면으로 돌아가는 것을 확인할 수 있었다.
      - 존재하지 않는 URL로 접근한 경우에는 404 페이지가 그대로 보이도록 구성이 되어있다.
      - URL을 통해서 프로필 페이지, 수정 페이지, 추가 페이지 접근하면 홈 화면으로 돌아오는 것을 확인할 수 있었다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/8cc9d56cfe8311f837340683d194d0553e32f078)

  <br />

  - Authentication 컴포넌트에서 여러 유형을 테스트
    - 보호되고 있는 페이지에서 로그인 후에 로그아웃을 하면 홈으로 돌아오고, URL로 들어가도 홈으로 돌아오는데, 이 경우 404 페이지나 다른 내용이 들어올 수도 있는지 확인해보기 위해서 테스트를 진행
    - 첫 번째 테스트
      - navigate는 ErrorPage 컴포넌트 내용으로 구성
      - JSX 코드의 false는 ErrorPage 컴포넌트 내용으로 구성
      - 이 경우, navigate 내용은 작동되지 않고 JSX 코드의 ErrorPage 내용이 보여지는 것을 확인
    - 두 번째 테스트
      - navigate는 홈으로 이동하는 URL로 구성
      - JSX 코드의 false는 ErrorPage 컴포넌트 내용으로 구성
      - 이 경우, 홈으로 이동하는 것이 작동되며 ErrorPage 내용은 보여지지 않았다.
    - 세 번째 테스트
      - navigate는 홈으로 이동하는 URL로 구성
      - JSX 코드의 false는 null로 구성
      - 이 경우, 홈으로 이동하는 것이 작동되며 JSX 코드의 null은 작동되지 않았다.
    - 네 번째 테스트
      - navigate는 ErrorPage 컴포넌트 내용으로 구성
      - JSX 코드의 false는 null로 구성
      - 이 경우, navigate 내용은 작동되지 않고 JSX 코드의 null이 작동되어 메인헤더만 보여지고 아무런 내용이 보이지 않는 것을 확인
    - 테스트해보고 알게 된 것은 navigate에서는 URL 형식의 구성만 작동이 되며, 컴포넌트를 구성해도 정상적으로 작동이 되지 않는다.
      - 추가로 useEffect에 있는 navigate가 먼저 작동되기 때문에 navigate 코드가 정상적으로 구성이 되어있으면 JSX 코드에서 구성한 false는 작동되지 않는다.
      - 반대로 navigate 코드가 정상적인 구성이 아닌 경우, JSX 코드에서 구성한 false가 작동해서 화면에 보여지게 된다.
      - useEffect 내의 리디렉션이 주된 처리를 하고, 해당 로직이 예상대로 작동하지 않을 때는 조건부 렌더링이 보조적인 역할을 하며 작동하는 방식으로 구성
    - navigate 함수는 URL 경로를 인자로 받아야 하며, 컴포넌트를 인자로 받으면 정상적인 동작을 하지 않으며 리디렉션이 발생하지 않는다.
      - navigate 함수에 컴포넌트를 직접 전달하는 것은 올바른 사용 방법이 아니며, 리디렉션하고자 하는 경로를 문자열 형태로 전달해야 한다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/ab580cea73b552895a8fe011375a5130ec74a2d6)

  <br />

  - Authentication 컴포넌트 수정 및 NoAccess, NotFound 컴포넌트 추가
    - Authentication 컴포넌트에서 useEffect를 사용하지 않아도 정상적으로 Context API 내용을 통해서 로그인 유무에 따라 실시간으로 화면이 갱신되기 때문에 useEffect를 삭제해주고, 보호된 페이지에서 로그아웃 시 다른 URL로 이동되지 않고 해당 페이지에서 오류와 관련된 컴포넌트가 나오도록 해주기 위해서 useNavigate도 삭제, 그리고 따로 NoAccess, NotFound 컴포넌트를 추가해서 사용자가 다른 에러에 대해 다른 화면을 볼 수 있도록 구성해주었다.
    - 프론트엔드 구성
      - Authentication 컴포넌트에서 useEffect, useNavigate 등 주석 처리된 코드들을 삭제
        - 굳이 useEffect가 없어도, Context API에서 로그인 유무에 따라 자동으로 화면이 실시간으로 변경되는 것을 확인할 수 있기 때문에 useEffect 코드를 삭제
        - useEffect를 사용하지 않고 있으며, 로그아웃 시 이제는 URL로 이동되는 것이 아닌, 해당 페이지에서 오류와 관련된 컴포넌트 내용이 출력되기 때문에 useNavigate를 더 이상 필요가 없기에 삭제
      - NoAccess 컴포넌트 추가
        - 내용은 일단 NotFound 컴포넌트와 다른 내용이 보이도록 간단한 텍스트로 구성
        - 해당 컴포넌트는 접근이 불가능하다며, 로그인을 해달라는 내용을 보여주도록 구성할 계획
      - NotFound 컴포넌트 추가
        - ErrorPage 컴포넌트의 내용을 가져와서 그대로 사용
        - ErrorPage는 삭제 예정
        - 404 페이지 내용을 보여주며, 존재하지 않는 URL에 접근했을 때 해당 내용을 알려주도록 구성할 계획
      - 존재하지 않는 URL에 대한 오류 페이지인 404 페이지를 NotFound 컴포넌트로 변경하고, 메인헤더가 보이도록 루트 레이아웃의 자식 라우트로 구성 변경
        - 이 부분은 조금 더 내용을 찾아보고, 문제가 없다면 그대로 유지하고 만약 문제가 될 부분이 있다면 루트 레이아웃의 형제로 변경하고 메인헤더 내용을 NotFound 컴포넌트에 추가해서 구성해줄 생각이다.
    - 따로 "/no-access"라는 라우트 구성을 추가하고 테스트한 결과, 로그아웃을 하게 되면 "/no-access" URL로 이동이 되는데, 이 상태에서 다시 로그인하면 그대로 해당 페이지에 머무르기 때문에 이 동작은 UX에서 불편함을 제공하기에 해당 라우트는 삭제하고 Context API에서 들어오는 내용을 바로 사용해서 작동하는 방식으로 구성해주었다.
      - "/no-access" 라우트를 그대로 사용하려면, 로그인 후 페이지로 리디렉션 하도록 따로 구현을 해야 하는데 이 방법은 사용자가 로그인 페이지로 리디렉션되기 전에, 이전 페이지의 URL을 따로 저장하고 사용하도록 좀 번거로운 구성을 추가해줘야 하기 때문에, Context API에서 들어오는 내용을 바로 사용하고, 로그아웃을 했을 때 바로 에러 페이지를 보여주고 로그인이 되면 다시 해당 페이지를 보여주는 방식으로 구성해주었다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/a30bc05a66148b7f1bd0b8fe593689d5645ca7a2)

<br />

- 추가 및 해결 해야 할 내용
  - 회원가입 form에서 잘못된 입력을 제출 했을 때, session에 데이터가 저장되는데, 기존의 session 데이터에서 업데이트되는 방식이 아닌 매번 제출할 때마다 새로운 session이 추가되고 있기 때문에 백엔드 코드에서 수정이 필요하다.
    - 계속 원인을 찾아보려고 이것저것 시도해보았지만 아직 어떤 코드가 정확히 원인인지 찾지 못해서 하나씩 천천히 테스트가 필요함
    - 일단 이걸 테스트 해보기전에 먼저 정상적으로 세션 만료가 되는지 확인해보았는데 정상적으로 세션 만료가 되기 때문에, 로그인을 먼저 구성해보고 정상적으로 로그인이 되는지 확인을 해보고 안된다면, session에 저장되는 부분을 다시 확인해봐야 할 것 같다는 생각
    - 이 부분은 session을 삭제하게 되면 더 이상 신경쓰지 않아도 되지만, 현재는 session을 그냥 놔둔 상태이기 떄문에 잠시 유지
  - 로그인 후에, 새로고침 시 로그아웃 되어버리는 상황도 수정을 해야 함
    - 현재 로그인 한 후에, useEffect를 통해서 데이터를 확인하고 토큰이 유효하다면 정상적으로 로그인 유지는 되지만, 새로고침 시 깜빡거리면서 메인헤더가 변경되는 것이 보이기 때문에 이 부분을 수정할 수 있으면 수정할 생각이다.
  - 로그인을 유지하고 있을 때, token이 만료 시간에 가까워지면 자동으로 갱신되는 로직을 추가 해야 함
    - 대충 구성만 되어 있는 상태로, 좀 더 자세한 코드와 테스트가 필요함
  - 로그인 시 주어지는 토큰을 확인하고, 해당 토큰을 통해 인증하고 게시글, 댓글, 답글 관련 기능을 활성화해주는 코드를 구성해야 함
    - 전체적으로 저 인증을 확인할 수 있게 해주는 것이 1차 목표로, 애플리케이션 전체에서 인증을 확인할 수 있게 된다면 쉽게 구성이 될 것으로 예상된다.
      - Context API를 추가해서, 로그인 유무를 전체에서 알 수 있도록 구성해주고 필요할 때 내용을 가져와서 사용 할 수 있다.
        - 구성 함
    - 세션과 연동이 가능한 부분이 있는지도 테스트가 필요함
      - 불가능, 세션이나 jwt 토큰 중 하나만 사용하는 것이 좋다.
      - 세션을 삭제하는 작업을 아직 하지 않아서 해줘야 함
    - Context API를 사용하는 것은 좋지만, 이 내용을 사용하려는 파일에서 하나하나 추가해서 사용하기 때문에 커스텀 Hook을 구성해서 재사용할 수 있도록 해줄 필요가 있음
  - 오류 페이지 이동에 대한 처리가 필요
    - ex) 게시글 추가 버튼이 로그인하지 않았음에도 활성화되어 클릭되면 오류 페이지로 이동해서 서버에서 문제가 생기지 않도록 조치가 필요함
    - ex) 로그인을 하지 않은 채로 강제로 URL을 통해서 이동하려고 할 때, 오류 페이지로 이동하도록 구성을 해줘야 함
  - 백엔드의 user-router.js에서 accessToken, login/success, profile router에서 모두 accessToken 함수 내용을 재사용하고 있는데, 굳이 3개의 router로 나눌 필요가 있는 지 확인해보고 필요가 없다면 하나로 줄여줘야 함
    - 명확하게 하기 위해서 일단은 하나로 합치지 않고, 그대로 나눠서 사용하도록 유지
    - 내용이 엄청 많은 코드로 구성된 것이 아니기 때문에 현재로서는 크게 문제 없다고 생각되어 그대로 유지
  - 액세스 토큰, 리프레시 토큰 버튼을 메인헤더에서 제거해야 함
    - 일단 주석처리해서 사용하지 않도록 변경
  - 코드 예외 처리 더 필요한 부분이 있는 지 체크해야 함
  - 프로필 페이지 구성은 했지만, 로그아웃하고 난 후에 그대로 프로필 페이지에 남아있으며 해당 게시글이 보이는 문제에 대해 고민해봐야 함
    - 사실 게시글 보이는 것도 괜찮고, 게시글 클릭 시 게시글 세부 페이지 이동하는 것도 문제 없다고 생각이 됨
    - 게시글 세부 페이지 이동 후에 댓글 작성이나 게시글 수정 기능이 비활성화 되어있기 때문에 큰 문제는 없지만, 로그아웃 후에 페이지네이션 기능을 통해서 페이지 이동했을 때 게시글이 보이지 않는 부분이 부자연스럽게 생각이 될 수 있기 때문에, 해당 내용에 대해 생각해봐야 함

# 오늘 느낀 점

- 프로필 페이지, 수정 페이지, 추가 페이지는 이제 비로그인 상태에서는 해당 페이지에 접근할 수 없고, URL을 통해서도 접근할 수 없게 되었다. 그리고 보호되는 페이지에서 로그아웃을 하면 에러 페이지가 뜨는데, 그 상황에서 다시 로그인을 하면 바로 해당 페이지가 보여지도록 구성이 되어있다. 여기에서 추가로 게시글 수정 페이지는 작성한 사용자가 아닌 다른 사용자 로그인하고 URL을 통해서 해당 페이지에 접속하는 것을 막도록 내용을 구성해줘야 한다. 그리고 한 가지 더 추가하는 것을 생각해봐야 할 부분이 있는데, 잘못된 URL을 입력했을 때 해당 URL로 이동하면서 에러 페이지가 뜨고 있는데 여기에서 로그인을 하게 되면 그 페이지에서 바로 로그인이 되며 에러 페이지가 계속 보여지게 된다. 이 경우 차라리 에러 페이지에서 메인헤더가 안보이도록 에러 페이지 라우트 위치를 수정해주고 따로 에러 페이지에서 홈으로 이동할 수 있는 버튼을 추가해서 이동할 수 있도록 해주거나, 잘못된 URL에서 다시 로그인을 하게 되면 홈으로 이동하도록 구성하는 방법을 생각 중인데 후자보다 전자가 더 구성하기 쉽고 사용자가 바로 클릭해서 이동할 수 있을 것 같아서, 버튼을 따로 추가해서 홈으로 이동하도록 구성을 해줄 생각이다.

<br />

# 내일 할 일

- React 공부 및 React 프로젝트 조금씩 진행하기

<br />

# 앞으로 해야 할 일

- React, NextJS 공부

- React 프로젝트 제작
