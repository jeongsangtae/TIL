# 오늘 한 일

### React 프로젝트 제작 (React, NodeJS, MongoDB로 만드는 미니 커뮤니티 플랫폼)

- 구성한 내용

  - 로그인 유무에 따라서 댓글 버튼의 className이 실시간으로 변경되도록 구성, 댓글 textarea도 마찬가지로 변경되도록 구성, 댓글에 사용자 정보 추가
    - 댓글에서도 로그인 유무에 따라서 버튼이 활성화 되거나 비활성화 되도록 해주고, 댓글 내용을 입력하는 textarea도 활성화 되거나 비활성화 되도록 구성, 댓글을 추가할 때 로그인한 사용자의 이름이 보여지고 함께 저장되도록 구성 추가
    - 백엔드 구성
      - 댓글을 가져오는 부분에서 쿠키에 저장된 jwt 토큰을 확인하고 토큰이 없다면, 댓글의 내용만 프론트엔드로 전달, 토큰이 있다면 사용자 정보도 함께 전달
      - 댓글을 추가하는 부분에서 토큰을 확인하고 토큰의 정보와 users 컬렉션에 저장된 사용자 정보를 비교해서 일치하는 사용자를 찾아냄
        - 즉, 로그인한 사용자가 존재하는 사용자인지 찾아내는 작업
      - 댓글이 저장될 때 로그인한 사용자의 이름과 이메일을 함께 저장
    - 프론트엔드 구성
      - Comments 컴포넌트에서 백엔드를 통해 전달받은 데이터인 사용자 정보 데이터를 useState에 저장하고 저장한 데이터를 CreateComment 컴포넌트에 prop을 통해서 전달
      - CreateComment 컴포넌트에서 useContext를 추가해서 Context API를 활용할 수 있도록 구성
      - 새로운 useState를 추가하고, 로그인 유무를 저장
      - useEffect를 추가해서 Context API 내용을 의존성 배열로 사용하고, 로그인이 되었을 때 새롭게 추가한 useState를 업데이트
      - 로그인 유무에 따라서 버튼이 활성화, 비활성화 되도록 className에 적용될 변수를 추가
      - textarea는 따로 className을 추가하지 않고, 로그인이 되었을 때는 required를 사용, 로그인이 되지 않았을 때는 readOnly를 통해서 읽기만 가능하도록 변경
      - Comments 컴포넌트에서 전달받은 userData를 활용해서, 로그인을 했다면 댓글 작성자 이름이 로그인한 사용자의 이름이 들어가고, 만약 로그인을 하지 않았다면 GUEST로 표시되도록 구성
    - 이렇게 구성해서 테스트 해본 결과, textarea와 버튼은 로그인 유무에 따라 실시간으로 반영되는 것을 확인할 수 있었다. 하지만 댓글 작성자 이름은 즉시 반영되지 않았는데, 이유를 생각해보면 userData는 Context API에서 가져온 내용도 아니며, Comments 컴포넌트에서 전달받은 내용이고 useEffect에도 추가되어 있지 않기 때문이었다.
      - 댓글 작성자 이름이 즉시 실시간으로 반영되기 위해서 수정을 해줘야 하며, 생각한 방법으로, useState를 하나 추가해서 useEffect 내에서 if문을 통한 결과를 저장해서 사용하는 방법, 또는 Context API에 사용자 정보를 저장하고 불러와서 사용할 수 있도록 구성을 해줘야 할 것 같다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/fe73a3aa4573ce8f7ec62a850c2e811693efba38)

  <br />

  - accessToken decoded, 로그인한 사용자 정보를 Context API로 전달 및 저장
    - useState를 추가하고, useEffect에서 if문을 통해서 결과를 저장하고 테스트 해보았지만 원하는 동작이 이루어지지 않아서 Context API에 로그인 정보를 저장하고 사용하는 방향으로 변경
    - 백엔드 구성
      - 로그인할 때, 토큰을 생성하며 쿠키에 저장되는데 이 때 해당 토큰을 decoded해서 프론트엔드에도 함께 전달하도록 구성
      - 정상적인 로그인이 이루어질 때만 decoded된 토큰의 내용을 함께 전달, 그렇지 않은 경우 토큰에 담긴 사용자 정보는 전달하지 않도록 구성
    - 프론트엔드 구성
      - 로그인할 때, 백엔드에서 전달한 decoded된 토큰의 내용을 전달받아서 Context API에 전달
        - 여기서 전달되는 토큰의 내용은 비밀번호를 제외한 사용자의 이름과 이메일로 구성 그리고 \_id 정보까지 포함
      - Context API에서 전달받은 토큰의 내용을 새롭게 추가한 useState에 저장
        - 추가한 useState의 초기 값은 null로 설정
        - 굳이 배열로 설정해줄 필요가 없음, 사용자 정보는 하나만 들어오기 때문이다.
      - 로그아웃할 때 Context API에서 저장한 사용자 정보가 다시 null로 변경되도록 구성
      - Context API의 초기 값에 사용자 정보와 관련된 내용을 추가하고 초기 값은 null로 설정
        - useState와 동일하게 null로 설정해줌
    - 로그인을 했을 때, 사용자 정보가 정상적으로 Context API로 넘어오는 것을 확인했고 useState에 저장되는 것까지는 구성이 되었다. 하지만 아직 새로고침 했을 때, useState에 저장된 데이터가 날라가는 문제를 해결하지 못해서 해당 부분을 추가로 구성해줘야 한다.
      - useState에 저장된 데이터가 새로고침 했을 때, 사라지는 문제를 해결하고 사용해야 함
    - 추가로 한 가지 테스트해봐야 할 부분이 있는데, Comments 컴포넌트에서 CreateComment 컴포넌트로 전달하는 userData가 분명히 전달이 되어서 작성하는 사용자 명이 변경이 되었던 것 같아서 이 부분을 다시 한 번 테스트하고 확인해봐야 한다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/7ba74c1d2413f2646b54c5325f6e720a166f64a4)

<br />

- 추가 및 해결 해야 할 내용
  - 회원가입 form에서 잘못된 입력을 제출 했을 때, session에 데이터가 저장되는데, 기존의 session 데이터에서 업데이트되는 방식이 아닌 매번 제출할 때마다 새로운 session이 추가되고 있기 때문에 백엔드 코드에서 수정이 필요하다.
    - 계속 원인을 찾아보려고 이것저것 시도해보았지만 아직 어떤 코드가 정확히 원인인지 찾지 못해서 하나씩 천천히 테스트가 필요함
    - 일단 이걸 테스트 해보기전에 먼저 정상적으로 세션 만료가 되는지 확인해보았는데 정상적으로 세션 만료가 되기 때문에, 로그인을 먼저 구성해보고 정상적으로 로그인이 되는지 확인을 해보고 안된다면, session에 저장되는 부분을 다시 확인해봐야 할 것 같다는 생각
  - 로그인 후에, 새로고침 시 로그아웃 되어버리는 상황도 수정을 해야 함
    - 현재 로그인 한 후에, useEffect를 통해서 데이터를 확인하고 토큰이 유효하다면 정상적으로 로그인 유지는 되지만, 새로고침 시 깜빡거리면서 메인헤더가 변경되는 것이 보이기 때문에 이 부분을 수정할 수 있으면 수정할 생각이다.
  - 로그인을 유지하고 있을 때, token이 만료 시간에 가까워지면 자동으로 갱신되는 로직을 추가 해야 함
    - 대충 구성만 되어 있는 상태로, 좀 더 자세한 코드와 테스트가 필요함
  - 로그인 시 주어지는 토큰을 확인하고, 해당 토큰을 통해 인증하고 게시글, 댓글, 답글 관련 기능을 활성화해주는 코드를 구성해야 함
    - 전체적으로 저 인증을 확인할 수 있게 해주는 것이 1차 목표로, 애플리케이션 전체에서 인증을 확인할 수 있게 된다면 쉽게 구성이 될 것으로 예상된다.
      - Context API를 추가해서, 로그인 유무를 전체에서 알 수 있도록 구성해주고 필요할 때 내용을 가져와서 사용 할 수 있다.
    - 세션과 연동이 가능한 부분이 있는지도 테스트가 필요함
      - 불가능, 세션이나 jwt 토큰 중 하나만 사용하는 것이 좋다.
      - 세션을 삭제하는 작업을 아직 하지 않아서 해줘야 함
    - Context API를 사용하는 것은 좋지만, 이 내용을 사용하려는 파일에서 하나하나 추가해서 사용하기 때문에 커스텀 Hook을 구성해서 재사용할 수 있도록 해줄 필요가 있음
  - 오류 페이지 이동에 대한 처리가 필요
    - ex) 게시글 추가 버튼이 로그인하지 않았음에도 활성화되어 클릭되면 오류 페이지로 이동해서 서버에서 문제가 생기지 않도록 조치가 필요함
    - ex) 로그인을 하지 않은 채로 강제로 URL을 통해서 이동하려고 할 때, 오류 페이지로 이동하도록 구성을 해줘야 함

# 오늘 느낀 점

- 댓글 부분에서 버튼들과 textarea는 문제 없이 실시간 반영이 되고 있지만, 댓글을 작성하는 곳의 사용자 이름 부분은 실시간 반영이 되지 않는 문제 때문에 추가 작업이 필요했고, 이 문제를 해결하기 위해서는 로그인한 사용자 정보를 전달 받아서 사용할 수 있도록 구성을 해야 한다고 생각이 되었다. 우선 사용자 정보가 프론트엔드에서 필요하기 때문에 사용자 정보를 백엔드에서 프론트엔드로 전달하도록 구성했고, 해당 내용을 Context API에 저장해서 전역적으로 사용하는 방향으로 내용을 구성해보고 있는데 여기서 localStorage에 저장하는 것은 보안상 문제가 될 수 있기 때문에, useState에 저장해서 사용하는 방향으로 구성을 해보고 있으나 새로고침 시에 useState의 내용이 초기화 되는 부분이 문제가 되기 때문에 해당 내용을 수정한 후에 사용해야 한다. 커스텀 Hook도 구성을 해줘야 하지만, 아직 Context API의 구성이 끝난 것이 아니기 때문에 다른 내용도 Context API를 사용하고 모두 테스트한 후에 커스텀 Hook을 추가해서 재사용할 수 있도록 변경할 생각이다.

- 생각해봐야 할 문제가 여러가지 있는데, 여러 사용자가 이 애플리케이션을 사용한다고 가정하면 과연 Context API나 다른 곳에서 사용자 정보를 혼동하지 않고 전달할 수 있는지 그런 내용들을 생각해봐야 한다. 추가로 Comments 컴포넌트에서 CreateComment 컴포넌트에 userData가 전달되어 분명히 댓글의 사용자 이름을 변경했던 것을 확인했던 것 같은데 다시 테스트해보고 정확히 넘어왔었는지 테스트가 필요하다.

<br />

# 내일 할 일

- React 공부 및 React 프로젝트 조금씩 진행하기

<br />

# 앞으로 해야 할 일

- React, NextJS 공부

- React 프로젝트 제작
