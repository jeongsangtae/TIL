# 오늘 한 일

### React 프로젝트 제작 (React, NodeJS, MongoDB로 만드는 미니 커뮤니티 플랫폼)

- 구성한 내용

  - 로컬 스토리지 에러 테스트 (만료 시간, console.log)
    - 백엔드
      - jwt-auth
        - 리프레쉬 토큰이 액세스 토큰을 갱신할 때, 유효시간을 1분으로 구성
        - 기존에는 1시간으로 설정했지만, 테스트를 위해서 1분으로 수정
      - user-routes
        - 로그인 시에 액세스 토큰 만료 시간은 1분, 리프레쉬 토큰 만료 시간은 5분으로 수정해서 테스트
        - 쿠키에 토큰이 저장되어 있는 시간도 1분, 5분으로 수정해서 테스트
        - 이전에 테스트를 위해서 추가했던 console.log 삭제
    - 프론트엔드
      - auth-context
        - 현재 시간, 토큰 만료 시간, 리프레쉬 토큰 만료 시간을 확인하기 위해 console.log 활성화
        - 인터벌 시간을 1분으로 수정해서 테스트
        - 로그인할 때 만료 시간을 로컬 스토리지에 저장하는데 이 때 시간도 수정해서 저장
    - 재배포 후 확인
      - 로그인을 해놓은 상태로 브라우저를 닫고 시간이 많이 지난 후에 다시 들어가보면 쿠키에 저장된 토큰만 사라지고 로컬 스토리지가 초기화되지 않는 문제를 찾기 위해서, 액세스 토큰과 리프레쉬 토큰 그리고 만료 시간도 대폭 수정해서 테스트
      - 테스트해보니, 리프레쉬 만료 시간을 초과하게 되면 정상적으로 로컬 스토리지를 초기화하고 쿠키에 저장된 토큰도 삭제해서 로그아웃되는 것을 확인할 수 있었음
      - 시간을 줄여서 테스트할 때는 전혀 문제가 없었는데, 이 문제가 생기는 이유는 무료 서버와 무료 백엔드를 사용해서 자동으로 중간에 일시 정지되거나 리소스를 절약하기 위해서 중단되어서 오류가 발생했다고 생각이 된다.
        - 이로 인해 토큰 갱신 요청이나 만료 체크가 제대로 작동하지 않아서 문제가 될 수 있음
      - 차라리 중간에 일시 정지되거나, 중단되기 전에 테스트해볼 수 있도록 만료 시간을 적절히 조절하는 것도 고려를 해봐야 함
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/e551890cea21efd018631de6688467e71574e97e)

  <br />

  - 로컬 스토리지 에러 테스트 (만료 시간, 인터벌 시간)
    - 백엔드
    - jwt-auth
      - 리프레쉬 토큰이 액세스 토큰을 갱신할 때, 유효시간을 30분으로 구성
      - 한 번 더 테스트해보기 위해서 30분으로 수정
    - user-routes
      - 로그인 시에 액세스 토큰 만료 시간은 30분, 리프레쉬 토큰 만료 시간은 2시간으로 수정
      - 쿠키에 토큰이 저장되어 있는 시간도 30분, 2시간으로 수정
      - 한 번 더 확인해보기 위해서 30분/2시간으로 설정
    - 프론트엔드
      - auth-context
        - 토큰을 갱신하는 리프레쉬 토큰 함수에서 재갱신 후에 만료 시간을 30분으로 설정하도록 수정
        - 인터벌 시간을 15분으로 수정
        - 로그인할 때 만료 시간을 로컬 스토리지에 저장하는데 이 때 만료 시간을 30분으로 설정해서 저장
        - 이 내용들 또한, 한 번 더 확인해보기 위해서 30분으로 저장되도록 해주고 인터벌은 15분으로 구성
    - 재배포 후 확인
      - 테스트하던 도중에 액세스 토큰이 갱신될 때 서버나 백엔드에서 일시 정지해서 오류가 생겼던 것 같은데 추가로 더 지켜보고 확인을 해봐야 할 것 같다.
      - 새로고침을 다시 해줬을 때 오류가 고쳐졌던 것 같기도 해서 확인이 필요함
      - 다시 한 번 브라우저를 닫고, 시간이 지난 후에 확인해볼 생각
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/1efc798cc434f60c1233501e4c02f63900e119f8)

<br />

- 추가 및 해결 해야 할 내용
  - 마지막 기능 추가로, 관리자 권한을 부여하는 내용을 생각하고 있음
    - 가입할 때는 일반 사용자로 가입을 할 수 있고, admin 관리자 계정으로 관리자 페이지에서 관리자 권한을 부여하는 내용을 생각 중
  - 새롭게 발견한 문제
    - 관리자 채팅의 사용자 리스트에서 사용자와 나눈 마지막 메시지 내용을 가져오는데, 이 때 새로고침을 하지 않으면 당장 채팅을 나눠도 실시간으로 마지막 메시지가 갱신되지 않아서 새로운 메시지가 있는 지 확인할 수 없기 때문에 추가하는 것도 고려해야 함
    - 한편으로는, 관리자 채팅이라서 사용자가 겪는 불편함이 아니기 때문에 그냥 놔두는 것도 고려 중
  - 배포한 사이트 확인
    - 추가 오류
      - 배포한 사이트에서 로그인하고 일정 시간이 지난 후에 자동으로 로그아웃 되면서 쿠키에 저장된 데이터는 삭제되지만, 로컬 스토리지에 저장된 데이터는 삭제되지 않는 문제가 발생해서 이 부분에 대한 수정이 필요
        - 이 문제는 일단 코드는 정상 작동하지만, 무료 서버와 백엔드로 인해서 발생하는 것으로 확인
        - 추가 확인을 위해서 토큰 만료 시간을 대폭 줄여서 다시 테스트 진행해봐야 함
    - UI를 수정해주고 최종 확인이 필요함

# 오늘 느낀 점

- 만료 시간을 대폭 줄이고 테스트해본 결과, 리프레쉬 토큰이 만료된 후에 쿠키에 저장된 토큰과 로컬 스토리지에 저장된 정보가 문제없이 삭제되는 것을 확인할 수 있었다. 이렇게 되면 코드에서는 문제없이 작동하는 것으로 생각되는데, 다른 문제로 예상되는 것은 무료로 사용중인 서버와 백엔드에서 중간에 일시 정지하거나 중단되는 문제 때문에 쿠키에 저장된 토큰은 삭제되지만 로컬 스토리지에 저장된 내용은 초기화되지 않을 수 있다고 생각이 된다. 만료 시간을 대폭 줄이고 테스트했을 때 초기화 기능이 문제없이 작동되었고, 만료 시간을 다시 늘리고 토큰이 유효한 상태에서 브라우저를 닫고 배포한 사이트에 다시 접속하면 문제없이 로그인이 유지되어 있기 때문에 기능적으로는 문제가 없다고 판단되므로, 이전보다 줄어든 만료 시간이 문제없는 지 테스트해보고 중간에 어떤 오류가 발생하는 지 추가로 확인해볼 생각이다.

- 줄인 만료 시간을 테스트하면서 두 가지 상황을 확인해볼 예정인데, 하나는 브라우저를 켜놓은 상태로 2시간이 지난 상태, 나머지 하나는 브라우저와 pc를 종료하고 더 오랜 시간이 지난 상태를 확인해볼 생각이다. 그리고 브라우저를 켜놓은 상태에서는 중간 중간 콘솔에서 에러가 발생하는 지 확인을 해줄 생각이다.

<br />

# 내일 할 일

- React 공부 및 React 프로젝트 조금씩 진행하기

<br />

# 앞으로 해야 할 일

- React, NextJS 공부

- React 프로젝트 제작
