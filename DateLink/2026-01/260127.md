# 오늘 한 일

### React + TypeScript 프로젝트 제작 (React, TypeScript, ExpressJS, MongoDB로 만드는 실시간 통신 애플리케이션)

- 그룹 채팅방 위치 수정 테스트 (드래그 및 드롭)
  - 그룹 채팅방 목록에서 그룹 채팅방을 드래그해 다른 채팅방과 위치를 변경할 수 있도록 관련 라이브러리, Zustand 액션, 컴포넌트를 추가하고 해당 내용들을 조합해 테스트
  - 프론트엔드
    - groupChatStore
      - GroupChatStore 타입 정의 수정
        - reorderGroupChats 타입 정의 추가
          - 일반 함수 형태로 타입 정의
          - updater를 함수 형태의 매개변수로 받도록 구성
          - updater 내의 prev는 updater 함수의 매개변수로 받도록 구성하고 "GroupChatData[]"로 타입 정의
          - updater 매개변수는 "GroupChatData[]"로 타입 정의
      - reorderGroupChats 액션 추가
        - updater를 함수 형태의 매개변수로 받도록 구성
        - updater 내의 prev는 updater 함수의 매개변수로 받도록 구성하고 "GroupChatData[]"로 타입 정이
        - updater 매개변수는 "GroupChatData[]"로 타입 정의
        - set을 사용해 groupChats 상태가 `updater(prev.groupChats)`로 업데이트되도록 구성
          - updater 매개변수에 이전 그룹 채팅방 목록을 넣어서 업데이트
    - GroupChats
      - core 라이브러리에서 DndContext 내용을 불러와 구성
      - sortable 라이브러리에서 SortableContext, arrayMove 내용을 불러와 구성
      - useGroupChatStore Zustand에서 reorderGroupChats 액션을 추가로 불러오도록 구성
      - handleDragEnd 함수 추가
        - event에서 active, over를 객체 디스트럭처링
          - active는 드래그 시작한 아이템
          - over는 드래그 끝났을 때 올라가 있는 대상
        - over와 active가 유효한지 확인하는 조건부 추가
        - reorderGroupChats 액션에 새 배열을 만들어 반환하도록 구성
          - 현재 그룹 채팅방 목록을 받도록 구성
          - oldIndex 변수 추가
            - `prev.findIndex((c) => c._id === active.id)`
            - 드래그 중인 채팅방이 기존 채팅방 목록에서 몇 번째 인덱스에 있었는지 저장
            - 드래그 시작 전의 그룹 채팅방 목록에서 드래그하고 있는 채팅방 ID 확인해 몇 번째 인덱스에 있었는지 알아내는 내용
            - 간단하게 배열에서 현재 위치 인덱스
          - newIndex 변수 추가
            - `prev.findIndex((c) => c._id === over.id)`
            - 드래그를 놓은 대상이 기존 채팅방 목록에서 몇 번째에 있었는지 저장
            - 마우스를 놓은 채팅방 ID와 그룹 채팅방 목록에 저장된 ID를 비교해 몇 번째 인덱스에 있는지 알아내는 내용
            - 간단하게 배열에서 이동 후 위치하게 될 인덱스
          - 새 배열을 반환하는 내용 추가
            - `return arrayMove(prev, oldIndex, newIndex)`
            - 이전 그룹 채팅방 목록 배열에서 oldIndex에 있던 요소를 newIndex 위치로 옮긴 새 배열을 반환
            - 기존 배열을 직접 수정하지 않고, 새 배열을 만들어 반환
      - JSX 코드 내용 수정
        - DndContext 내용으로 전체를 감싸도록 구성
          - onDragEnd props를 추가해 handleDragEnd 함수로 구성
            - 드래그 종료 시 콜백하는 props로 드래그가 끝났을 때, handleDragEnd 함수를 한 번 실행하는 내용
            - 마우스를 놓는 순간, 터치를 떼는 순간, 키보드 드래그가 끝나는 순간 등 위치 확정 시점
          - DndContext는 해당 내용 안에서 일어나는 모든 드래그와 드룹 이벤트를 관리하는 전역 컨텍스트
          - 어떤 요소가 드래그 중인지, 마우스가 어디 위에 있는지, 드래그 시작과 이동 그리고 종료 시점을 추적하고 해당 정보들을 전부 컨텍스트로 하위 컴포넌트에 제공
        - 그룹 채팅방 목록에 map을 사용하는 내용을 감싸는 SortableContext 추가
          - SortableContext는 이 안에 있는 아이템들은 정렬 가능한 리스트라고 선언하는 영역
          - DndContext가 드래그 전체 관리자면, SortableContext는 정렬 규칙 담당자
          - sortable 라이브러리와 SortableContext를 통해 리스트 순서 바꿈
          - `items={groupChats.map((groupChat) => groupChat._id)}`
            - 해당 리스트의 순서는 그룹 채팅방 목록에서 ID 배열 순서
            - 이 내용이 없으면 정렬 기준이 없어서 드래그는 되는데 위치 계산이 틀려지거나 드롭 위치 인식이 불가능하게 됨
        - SortableGroupChat 컴포넌트를 추가해 그룹 채팅방 컴포넌트에 전달하는 내용 그대로 전달
    - SortableGroupChat
      - sortable 라이브러리에서 useSortable 내용을 불러와 구성
      - core, sortable 라이브러리 설치시 함께 설치된 utilities 라이브러리에서 CSS 내용을 불러오도록 구성
      - \_id, hostId, title, contextMenu, setContextMenu props를 전달받아 구성하고 GroupChatProps 타입 정의를 불러와 구성
      - useSortable 관련 내용 추가
        - `const { attributes, listeners, setNodeRef, transform, transition } = useSortable({ id: _id })`
        - `attributes, listeners, setNodeRef, transform, transition`를 객체 디스트럭처링하고 해당 컴포넌트를 드래그 중인 아이템으로 등록
        - `useSortable({ id: _id })`는 GroupChats 컴포넌트 내의 SortableContext 컴포넌트 내용에 구성한 items 내용과 매칭되어 드래그 중인 컴포넌트가 현재 리스트에서 몇 번째인지 확인하는 내용
        - attributes
          - 접근성 + 드래그 상태 관련 속성
          - 안에 들어있는 정보
            - `role="button"`
            - `aria-pressed`
            - `"aria-roledescription": "sortable"`
            - `"aria-describedby": "DndContext-1"`
            - 기타 dnd 상태 정보
          - 항상 listeners랑 같이 붙임
        - listeners
          - onPointerDown, onKeyDown 같은 드래그 시작 이벤트 묶음
          - 드래그 이벤트 리스너 모음으로 해당 영역을 누르면 드래그 시작 가능
        - setNodeRef
          - dnd-kit이 해당 DOM을 추적하기 위해 필요
          - 해당 DOM이 드래그하는 대상이라는걸 dnd-kit에게 알려주는 내용
          - 해당 내용이 없으면 드래그 인식, 위치 계산, 애니메이션 확인 불가
          - 반드시 실제 DOM 요소에 붙여야 함
        - transform / transition
          - 드래그 중 움직임 애니메이션
          - transform
            - 현재 드래그 중인 위치 이동 값
            - ex) `transform = { x: 0, y: 42, scaleX: 1, scaleY: 1 }`는 해당 아이템을 y축으로 42px 이동시키라는 뜻
            - 마우스 또는 터치가 움직일 때마다 실시간으로 계산되는 값
          - transition
            - 아이템들이 부드럽게 밀려나는 애니메이션 값
            - ex) `transition: "transform 200ms ease"`는 dnd-kit 내부의 기본 애니메이션 설정값 중 하나
            - 다른 아이템들이 순간이동이 아닌, 자연스럽게 밀리는 역할
            - 드래그 중인 아이템은 transition이 거의 없으며, 밀려나는 다른 아이템들은 적용
      - style 변수
        - `const style = { transform: CSS.Transform.toString(transform), transition, }`
        - x, y를 translate3d(...)로 변환해주는 유틸
        - 움직임을 실제 CSS로 적용
        - `{ x: 0, y: 42 }` 같은 값을 CSS는 못 알아먹기 때문에 dnd-kit 유틸을 사용해 `CSS.Transform.toString(transform)` 같이 구성하고, "translate3d(0px, 42px, 0)" 같은 내용으로 변환되어 사용됨
        - 최종적으로 `transform: translate3d(0px, 42px, 0)`, `transition: transform 200ms ease` 같은 형태로 구성되어 드래그 중일 때는 따라 움직이고 드롭되면 주변 아이템들이 자연스럽게 이동하는 형태로 구성됨
      - JSX 코드 내용 추가
        - div를 추가해 전체를 감싸도록 구성
          - ref를 추가해 setNodeRef로 구성
            - ref는 DOM에만 붙일 수 있기 때문에 GroupChat이 아닌 div에 구성
          - style을 추가해 style 변수로 구성
            - transform 같은 내용은 최상위 래퍼에 적용해야 안정적이기 때문에 div에 구성
          - `{...attributes} {...listeners}` 추가
            - 해당 내용들은 props 묶음 객체로 props 갯수가 많기에 스프레드 연산자를 사용해 객체 안에 들어있는 모든 props를 한 번에 적용
            - 기능은 동일하며 가독성과 유지보수에서 차이가 잇음
        - GroupChat 컴포넌트를 추가해 \_id, hostId, title, contextMenu, setContextMenu props로 관련 내용을 전달하도록 구성
  - 그룹 채팅방 목록 컴포넌트에 새롭게 추가한 라이브러리를 불러오고 드래그 관련 함수를 구성한 뒤 해당 내용들과 연결되는 새로운 컴포넌트와 액션을 추가해 테스트한 결과, 드래그와 드롭은 문제없이 작동하지만 새로고침했을 때나 드롭 후 클릭되어 방 이동이 되었을 때 다시 초기화되는 문제가 발생하기 때문에 해당 내용에 대한 추가 수정이 필요하다.
  - 그룹 채팅방 목록에서 드래그, 드롭 관련 동작이 잘 작동하긴 하지만 드롭 후 클릭되어 방 이동되는 문제와 변경된 그룹 채팅방 목록이 저장되지 않아 다시 초기화되는 문제가 발생하므로 추가 수정 필요
  - 다이렉트 채팅방 목록, 그룹 채팅방 내의 사용자 목록, 사용자 정보가 보여지는 아바타 내용에서 테두리 두께 설정 확인 필요
  - 로그인, 회원가입 페이지 배경에 사용되는 여러 이미지를 더 추가해 테스트해봐야 함
  - 해야 할 일에 정리된 내용 처리 필요
  - 다이렉트 채팅방 순서가 변경될 때 부드럽게 변경되는 기능
  - 그룹 채팅방 우클릭 시에 보여지는 컨텍스트 메뉴 CSS 수정 필요 (위치, UI 등)
  - 다크 모드 및 라이트 모드 관련 내용
  - 화면 투명도 관련 내용
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/bfb770ee1705edd95c4b6656f6967f5325a26da4)

# 오늘 느낀 점

- 그룹 채팅방 목록에서 그룹 채팅방이 자유롭게 위치가 변경되도록 관련 라이브러리와 드래그 관련 함수, 새로운 컴포넌트 그리고 Zustand 액션을 추가해 테스트한 결과, 드래그와 드롭은 문제없이 작동하며 위치도 변경되긴 하지만 드롭 후 채팅방이 클릭되어 바로 채팅방으로 이동되는 문제와 수정된 그룹 채팅방 위치가 저장되지 않는 문제가 발생하고 있기 때문에 해당 내용에 대한 추가 수정을 통해 드롭 시에 클릭되어 채팅방 이동이 되지 않도록 해야 하며 수정된 그룹 채팅방 목록이 DB에 저장되어 새로고침 또는 다시 접속했을 때 수정된 위치 그대로 보여지도록 구성해줄 생각이다. 그리고 새롭게 추가한 core 라이브러리는 자유 이동 즉, 드래그해서 아무 데나 놓기가 기본인데 내가 여기서 하고 싶은 동작은 드래그해서 아무 데나 놓으면 리스트 순서가 바뀌어 보여지는 것까지 구성하는 것이 목표이므로 sortable 라이브러리까지 추가해 그룹 채팅방을 드래그해 위치를 바꾸면 해당 리스트 순서가 바뀌어 보여지도록 구성을 해준 상태고, 현재 해당 내용들이 저장되지 않아 초기화되고 있으므로 해당 내용을 저장해 변경된 위치가 계속 유지될 수 있도록 구성할 생각이다.

<br />

# 내일 할 일

- 실시간 통신 애플리케이션 (Float Chat) 프로젝트 진행

- Zustand 내용 구성

- 닉네임 수정과 그룹 채팅방 제목 수정 내용에서 사용하지 않거나 필요없는 정보를 삭제해 코드 정리를 해야 함 (중복된 데이터 전송이나 사용하지 않는 데이터 전송 관련 내용 등)

- 그룹 채팅방에서 다른 사용자를 클릭할 수 있고, 클릭 시에 다이렉트 채팅방이 생성되어 채팅을 나눌 수 있도록 구성하는 것을 고려중 (이 방법 대신, 다른 사용자 클릭 시에 프로필이 보여지도록 구성하고 그 내용을 통해 다이렉트 메시지를 보내거나 프로필 내용을 보는 그런 방식으로 구성해야 함)

- 다이렉트 채팅방 목록이 정렬될 때 부드럽게 위로 올라가고 내려가는 CSS 적용 필요

- 친구 관련된 내용에서 코드 정리 필요 (코드를 깔끔하게 보이도록 수정 필요)

- 여러 Zustand에 구성된 실시간 반영 로직들이 재사용될 수 있도록 커스텀 훅에 옮겨서 구성하는 것을 고려해야 함

- 다크 모드 고려해야 함

<br />

# 앞으로 해야 할 일

- React, TypeScript 공부

- React 상태 관리 도구인 Zustand 공부

- 실시간 통신 애플리케이션 프로젝트 제작
