# 오늘 한 일

### JS 토이 프로젝트 제작 (JS, ExpressJS, MongoDB로 만드는 게시판 + EJS)

- 게시판 제작 진행 과정

  - 답글 기능 추가 (저장된 데이터를 확인해 해당 댓글에 존재하는 답글을 보여지도록 함)
    - fetch를 사용해서 스크립트에서 처리해서 해결하려고 했으나 문제가 잘 해결되지않아 chatgpt의 도움을 받아서 map을 사용해서 comment 배열의 각 요소에 대해 비동기 함수를 호출해 각 댓글에 대한 답글들을 얻을 수 있었다.
    - map이 comment 배열의 각 댓글에 대해 해당 댓글에 속한 답글들을 조회해 각 댓글에 대응하는 답글 배열을 생성하는 작업을 해준다. 이렇게 생성된 답글 배열을 ejs로 보내면서 ejs에서 처리해서 화면에 보여지게 된다.
    - ejs에서는 forEach를 사용해서 처리해주었다. 먼저 reply를 각 배열 요소인 replyArr에 대해 반복적으로 코드를 실행하고 replyArr에서 다시 forEach를 통해 각 요소인 답글 객체에 대해 반복적으로 코드를 실행한다. 그 다음 답글에 저장된 댓글의 _id를 toString으로 변환한것과 댓글에 저장된 _id를 toString으로 변환해 값을 비교해서 댓글과 답글이 연결되는 조건을 확인해 보여준다.
    - 여기서 toString으로 변환하는 이유는 js에서는 ObjectId를 직접 비교해봤자 의미가 없다고 한다. ObjectId는 이진 데이터이기 때문에 직접 비교해봤자 항상 false가 반환되어 toString으로 문자열로 변환한 후에 비교해서 일치하는지 확인을 해야 한다고 한다.
    - 문자열로 변환해서 비교하는 것은 ObjectId의 내용을 비교하는 것이 아니라 ObjectId의 문자열 표현을 비교한다고 한다.
    - 현재 css에서는 크게 수정하지않고, 답글 부분만 margin-left를 넣어서 답글처럼 보이게 했는데 여기서 border-bottom 부분이 마진을 넣은 부분과 함께 안쪽으로 들어가면서 이 부분을 수정을 해줘야하나 생각중이다. 이 부분은 내일 수정을 해보고 비교해보면서 확인을 해야할 것 같다.

  <br />

- 게시판 제작 진행 다음 목표

  - 댓글 기능
    - 답글쓰는 부분 기능 추가 현재는 답글 추가 됨
    - 수정 부분도 해결은 함 근데 여기서 추가해야할 부분이 있는데 빈 문자열일 때 저장이 된다는 점인데 이 부분을 스크립트 처리로 해줘야할 것 같음
  - 구성은 되어있는데 혹시나 수정할 수도 있는 부분
    - 문제가 하나 있는데 비밀번호를 확인하고 일치했을 때 게시글이 생성되는 것은 좋은데 그 비밀번호를 저장하는게 사용자의 비밀번호를 그대로 저장을 하고 있기 때문에 이 부분을 변경해야 함
      - 방법1 해싱된 상태의 비밀번호가 저장이 되도록 한다. (테스트는 해봄)
      - 방법2 비밀번호는 게시글에 저장하지 않도록 한다. (현재는 이 방법으로 구성)
      - 이 부분은 더 이상 생각하지 않아도 될 거 같음 굳이 해싱된 비밀번호를 저장하지 않아도 될 거 같다는 생각 그래서 아이에 비밀번호를 게시글에 저장하지 않도록 해놓음
    - 패스워드, 수정, 삭제 에러 관련 동작 처리
      - 최종적으로 다시 모달창으로 변경해주었다. 이벤트리스너 에러를 if문으로 조건을 추가해 해당 페이지에 들어왔을 때 바로 작동하지 않도록 해주며 해결하였다.
      - 수정, 삭제는 그냥 게시글 작성자가 아니라면 버튼이 보이지 않도록 해 막아주었다.
      - 추가로 해당 게시글 작성자가 아닌데 url로 접속시도를 하는경우 401페이지로 이동하도록 해주었다.
    - 페이지당 5개의 게시글까지만 보여지도록 해놓았으니, 이제 페이지네이션도 똑같이 한 화면에는 5개까지의 페이지버튼이 보이도록하고, 그 다음 6~10 이런 페이지 버튼은 다음 페이지 버튼을 클릭 시 보이도록 하려고 생각 중
      - 이 부분도 수정해서 예로 13번까지 페이지 버튼이 있다면 5개 단위로 끊어져있고, 5페이지에서 다음 버튼 클릭시 6번으로 넘어가면서 6~10이 보여지고 또 10 페이지에서 다음 버튼 클릭시 11~13이 보여지도록 되어있다. (이 방법으로 구성되어있음)
      - 다른 방법으로 페이지 버튼이 이전과 다음 버튼으로 아이에 정해진 단위대로 이동하는 것
      - 또 다른 방법으로 현재 보이는 페이지를 페이지 버튼에서 중앙으로 잡고 이전과 다음 버튼으로 -1, +1 씩 이동하는 방식
    - 한 가지 확인해야 할만한게 수정 페이지에 가게되면 조회수가 1씩 계속 증가되는데 수정하지 않고, 취소해도 증가하는 부분을 확인해봐야함
      - 조회 수를 시간 간격을 10초 정도로 주며, 중복된 사용자나 다른 사용자가 다시 클릭해도 10초가 지나지않으면 오르지 않도록 설정해놓았다.
        - 이 부분도 시간을 좀 수정하거나 이 정도만 확인하면 될 것 같다.
      - 세션 만료시 일정 시간 후에 세션 데이터가 자동으로 삭제되도록 하는 코드를 추가해놓았는데 정상적으로 작동해서 이 부분은 이제 해결이 된 것 같다. (세션 부분 파일을 따로 분리해놓은 곳에서 추가해놓음)
    - 삭제할 때 비밀번호 확인이 필요한가...? 좀 고민해봐야 함 애초에 권한 유무로 삭제하기 때문에 굳이 라는 생각도 들기 때문에 좀 의견을 물어볼 필요가 있음
    - 방법1. 그냥 삭제가 되도록한다.
    - 방법2. 예, 아니오 창이 떠서 거기서 한번 더 의사를 물어보고 삭제할지 안할지 결정(이 방법으로 구성)
    - 방법3. prompt창을 사용해서 비밀번호를 입력해서 삭제한다.
    - 방법4. 모달창에서 비밀번호를 입력해서 비밀번호가 맞을 시 삭제

<br />

# 오늘 느낀 점

- fetch를 스크립트에서 추가해서 해결할 수 있을 거 같았는데 이 부분은 뭔가 내가 개념이 좀 부족했던 거 같다. dataset을 통해서 ejs로부터 댓글의 _id를 가져와서 fetch로 해당 댓글의 _id를 답글쓰기를 클릭했을 때 보낼수 있을 거 같았는데 내가 fetch에 대해 지식이 좀 부족한지 fetch로 해결하지 못했다. 아마 내가 제대로 fetch에 대해 알고 쓰는 것이 아닌 예전에 해보고 봤던 내용을 참고로 구성해봐서 문제가 생긴거 같기도 하다. 다른 부분으로 조금 의심해볼만한게 내가 현재 게시글 내용을 보여주는 페이지에서 댓글, 답글 전부 처리를 하고 있어서 좀 꼬인거 같은 생각도 드는데 콘솔창에서 발생하는 에러를 보고 정확한 원인을 내가 파악할 수 없었는데 이건 아직 내 능력이 부족해서 그렇다고 생각이 된다.

- fetch를 통해서 답글 부분 기능을 구현하지 못했을 때 너무 답답해서 진짜 답글 부분만 포기를 할까 생각도 해봤는데 데이터도 정상적으로 저장이 되고 그 답글의 저장된 정보에서 어떤 댓글의 답글쓰기를 클릭해서 저장했는지 댓글의 _id 정보도 들어가 있는 것을 보고 정상적으로 댓글의 _id도 저장이 되어있으니 이걸 연결만 하면 될 거 같다는 생각이 여러가지 시도를 해보다가 단순하게 new ObjectId로 변환해서 하면 되지않을까 했지만 그건 부분적으로만 맞고 전체적인 흐름은 좀 부족했었다. 그래서 이 부분에 대해 어떻게 해야하나 고민을 해보다가 도움을 좀 받아야할 것 같아서 chatgpt의 도움을 받아서 map으로 배열 내의 모든 요소 각각에 함수를 호출해 결과를 얻어 가져온 내용을 Promises.all로 여러개의 프로미스를 동시에 실행해 모든 댓글에 대한 답변을 한 번에 가져와 해결해주었다. 만약 Promises.all을 사용하지 않고 단일 프로미스를 순차적으로 처리한다면, 답글을 가져오는 작업이 한 댓글씩 차례로 이루어져야 하므로 실행 시간이 크게 증가될 수 있다.

- 오늘 chatgpt의 도움을 받아서 해결한 부분은 내일 다시 한번 보면서 이해가 필요하다고 생각이 되고, 이제 답글을 추가했으니 답글을 수정, 삭제할 수 있게 해주면 될 것 같다. 그리고 게시글이 삭제될 때 댓글도 함께 삭제가 되도록 되어있는데 여기서 답글도 함께 삭제가 되도록 해줘야할 것 같다. 그러면 모든 기능에 대한 마무리가 될 것 같다.

<br />

# 내일 할 일

- JS, ExpressJS, MongoDB로 게시판 제작 + (EJS)

<br />

# 앞으로 해야 할 일

- Advanced-js(고급 JS)에 대해 공부하며 이해하기 (JS 공부)

- Python으로 웹 스크래퍼 만들어보기

- Python, PHP 공부할 거 찾아보기

- Python 셀레니움, 브라우저 드라이버에 대해 한번 찾아보기

- Python 데이터 분석도 한번 봐보기
