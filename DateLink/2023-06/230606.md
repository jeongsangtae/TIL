# 오늘 한 일

### JS 토이 프로젝트 제작 (JS, ExpressJS, MongoDB로 만드는 게시판 + EJS)

- 게시판 제작 진행 과정

  - 게시판 render의 Web Servier와 mongodb atlas로 배포

    - 예전에 배포할 때 작성한 내용을 참고해 배포를 시도
    - 먼저 database.js에서 내용 변경 및 추가

    ```
    let mongodbUrl = "mongodb://127.0.0.1:27017";

    if (process.env.MONGODB_URL) {
      mongodbUrl = process.env.MONGODB_URL;
    }

    ```

    - app.js에서 내용 변경 및 추가
      - app.listen(port); 이 부분이 원래 app.listen(3000);이렇게 되어있었는데 위에서 let port로 변수를 만들어줬기 때문에 port로 변경

    ```
    let port = 3000;

    if (process.env.PORT) {
      port = process.env.PORT;
    }

    db.connectToDatabase()
      .then(function () {
        app.listen(port);
      })
      .catch(function (error) {
        console.log("데이터베이스에 연결하지 못했습니다.");
        console.log(error);
      });
    ```

    - Render에서 `Web Service`로 새로 추가해 깃허브 레포지토리와 연결해 배포
      - `Root Directory`는 레포지토리 루트와 동일하기 때문에 추가하지않고 그대로 넘어간다.
      - `Runtime`은 Node.js를 사용하기 때문에 `Node`로 사용
      - `Start Command`는 `nodemon`을 사용해서 `npm start` 명령어로 사용하기 때문에 `npm start`로 작성
      - 마지막으로, 무료로 배포하기위해 Free를 사용해서 배포
      - 배포하던 중 오류가 2번 있었음
        - 첫 오류는 `Root Directory`에 폴더 이름인 `bulletin-board-nodejs-mongodb`를 추가해서 이상하게 경로가 잡혀서 그냥 Web Service를 삭제하고 다시 생성함
        - 두 번째 오류는 Node.js와 MongoDB 버전 간의 호환성 문제로 인해 오류가 생겼는데 예전에 다른 페이지를 배포할때 사용했던 MongoDB 버전으로 package.json에서 수정해주고 저장한 다음 npm install을 다시 해주어서 해결함
      - 여기까지 에러를 해결하고 웹 서비스 배포를 하면 데이터베이스가 아직 배포되지않아서 데이터베이스에 연결되지 않았다고 뜨는데 MongoDB atlas를 통해서 DB도 배포를 해주어야 함
    - MongoDB atlas를 통해 서버 배포
      - DB 클러스터 생성
        - DB를 생성하는데 여기서 Shared가 무료로 사용할 수 있기 때문에 Shared를 선택
        - aws 선택
        - 국가는 Render에서 Web Service를 만들때 싱가포르로 해주었기 때문에 혹시라도 문제가 생기지않게 하기 위해 싱가포르로 설정해주었다.
        - M0 Sandbox가 무료이기 때문에 M0 Sandbox를 선택해준다.
        - 그리고 Additional Settings은 기본으로 되어있는 MongoDB 6.0, No Backup으로 해주었다. 이 부분은 나중에 MongoDB atlas가 업데이트되면서 변경될 수 있으나 현재 배포할 때는 이 내용으로 했다.
        - 클러스터 이름은 임의적으로 변경해주었는데 기본으로 해도 상관은 없다.
        - 참고로 무료 클러스터는 하나만 가능하기 때문에 기존에 있다면 삭제해주어야한다. (기존에 있던 likepage를 삭제해주었음)
      - DB 구축을 해준 후에 DB Access 설정을 해준다.
        - 새로운 데이터베이스 사용자를 추가해주는데 여기서 추가해주는 이유는 우리가 이 DB에 연결할 사용자이며, 제어 권한은 사용자를 통해서 DB에 연결할 때 NodeJS 애플리케이션을 갖게 해주는 권한이다.
        - 나는 여기서 인증 방법으로 Password로 정해주었고, 사용자 이름은 그냥 자기 마음대로 설정한다.
        - 암호를 추가하는데 어렵게하는게 좋기 때문에 자동생성으로 복사-붙여넣기가 좋다고 생각된다.
        - 그 다음 중요한 부분인데 `Database User Privileges`(데이터베이스 사용자 권한) 설정을 데이터베이스를 읽고 쓸 수 있는 `Read and write to any database`로 설정해주고 생성한다.
      - DB Access 설정까지 완료한 후 Network Access 설정을 해준다.
        - 다른 서버와 머신이 다른 데이터베이스와 연결할 수 있도록 제어할 수 있다.
        - IP Access List에 IP 주소 추가를 누르고, `ADD CURRENT IP ADDRESS`를 눌러 현재 IP 주소를 추가할 수 있는데 MongoDB Altas를 원격 머신에서 사용하고 싶거나 로컬 머신에서 Node Express 웹 사이트를 실행하고 로컬에서 실행 중인 웹 사이트를 MongoDB Atlas에 연결하려면 현재 IP를 추가하면 된다.
        - 만약 헤로쿠 머신을 사용하면 이렇게 해서는 안되지만 여기서 Render를 사용한다면 Render 공식 문서에서 현재 IP 주소를 추가하라고 하였기 때문에 그대로 진행해도 된다.
        - 나는 여기서 어디에서나 액세스 할 수 있도록 `0.0.0.0/0`로 설정해 모든 사람이 내 DB에 연결할 수 있도록 해주었다. 안전하지 않다고 할 수도 있지만 바로 위에서 설정한 사용자 자격 증명도 필요로 하기 때문에 괜찮다고 한다. 모든 사람이 연결 요청을 보낼 수 있도록 설정 후 저장
      - 클러스터와 네트워크 액세스까지 모두 준비가 된 후에 클러스터에서 `Connect`를 눌러 연결해준다.
        - Connect를 누르면 연결 방법이 여러가지 있는데 여기서 `Connect your application`을 선택해 내가 사용하는 드라이버(ex: Node.js)와 버전(ex: 4.1 or later)를 선택해준다.
        - 그 다음 내 웹 사이트와 연결하는데 사용할 수 있는 URL을 얻게되는데 이 내용은 내가 만든 사용자가 자동으로 채워져 있다. 여기 암호 자리는 내가 아까 추가한 사용자 암호로 직접 채워줘야 한다.
          - ex) `mongodb+srv://jeongsangtae:<password>@likepage.2dkpcth.mongodb.net/?retryWrites=true&w=majority`
      - 얻게된 URL을 DB 코드에서 직접 변경할 수도 있지만, DB 코드에서는 환경 변수를 사용하고 있기 때문에 로컬 개발용 URL은 유지하고 Render 서비스에 대한 환경 변수를 만들어준다. (MongoDB Altas 클러스터에서 얻은 URL 사용)
      - Render Dashboard에서 `Environment Variables`에 들어가 설정해준다.
        - Key 값에는 DB 코드에서 환경 변수에 사용한 `MONGODB_URL`
        - Value 값에는 `MongoDB Altas 클러스터에서 연결하고 얻은 URL`을 넣어준다. 물론 password는 사용자 암호로 변경해주어야 한다.
      - 이제 연결이 되는지 오류가 발생하는지 Render Events에서 확인해보면 된다. 그리고 추가로 내용을 변경한다면 깃허브 커밋을 통해 Render에서 다시 배포하여 몇 분후 수정된 동적 웹 사이트를 다시 확인할 수 있다.
      - [MongoDB Altas에 연결하는데 참고한 render 공식 문서](https://render.com/docs/connect-to-mongodb-atlas)
      - [Render 환경 변수 참고](https://render.com/docs/configure-environment-variables#configuring-secrets-and-other-environment-information-on-render)

  <br />

- 게시판 제작 진행 다음 목표

  - 구성은 되어있는데 혹시나 수정할 수도 있는 부분
    - 문제가 하나 있는데 비밀번호를 확인하고 일치했을 때 게시글이 생성되는 것은 좋은데 그 비밀번호를 저장하는게 사용자의 비밀번호를 그대로 저장을 하고 있기 때문에 이 부분을 변경해야 함
      - 방법1 해싱된 상태의 비밀번호가 저장이 되도록 한다. (테스트는 해봄)
      - 방법2 비밀번호는 게시글에 저장하지 않도록 한다. (현재는 이 방법으로 구성)
      - 이 부분은 더 이상 생각하지 않아도 될 거 같음 굳이 해싱된 비밀번호를 저장하지 않아도 될 거 같다는 생각 그래서 아이에 비밀번호를 게시글에 저장하지 않도록 해놓음
    - 패스워드, 수정, 삭제 에러 관련 동작 처리
      - 최종적으로 다시 모달창으로 변경해주었다. 이벤트리스너 에러를 if문으로 조건을 추가해 해당 페이지에 들어왔을 때 바로 작동하지 않도록 해주며 해결하였다.
      - 수정, 삭제는 그냥 게시글 작성자가 아니라면 버튼이 보이지 않도록 해 막아주었다.
      - 추가로 해당 게시글 작성자가 아닌데 url로 접속시도를 하는경우 401페이지로 이동하도록 해주었다.
    - 페이지당 5개의 게시글까지만 보여지도록 해놓았으니, 이제 페이지네이션도 똑같이 한 화면에는 5개까지의 페이지버튼이 보이도록하고, 그 다음 6~10 이런 페이지 버튼은 다음 페이지 버튼을 클릭 시 보이도록 하려고 생각 중
      - 이 부분도 수정해서 예로 13번까지 페이지 버튼이 있다면 5개 단위로 끊어져있고, 5페이지에서 다음 버튼 클릭시 6번으로 넘어가면서 6~10이 보여지고 또 10 페이지에서 다음 버튼 클릭시 11~13이 보여지도록 되어있다. (이 방법으로 구성되어있음)
      - 다른 방법으로 페이지 버튼이 이전과 다음 버튼으로 아이에 정해진 단위대로 이동하는 것
      - 또 다른 방법으로 현재 보이는 페이지를 페이지 버튼에서 중앙으로 잡고 이전과 다음 버튼으로 -1, +1 씩 이동하는 방식
    - 한 가지 확인해야 할만한게 수정 페이지에 가게되면 조회수가 1씩 계속 증가되는데 수정하지 않고, 취소해도 증가하는 부분을 확인해봐야함
      - 조회 수를 시간 간격을 10초 정도로 주며, 중복된 사용자나 다른 사용자가 다시 클릭해도 10초가 지나지않으면 오르지 않도록 설정해놓았다.
        - 이 부분도 시간을 좀 수정하거나 이 정도만 확인하면 될 것 같다.
      - 세션 만료시 일정 시간 후에 세션 데이터가 자동으로 삭제되도록 하는 코드를 추가해놓았는데 정상적으로 작동해서 이 부분은 이제 해결이 된 것 같다. (세션 부분 파일을 따로 분리해놓은 곳에서 추가해놓음)
    - 삭제할 때 비밀번호 확인이 필요한가...? 좀 고민해봐야 함 애초에 권한 유무로 삭제하기 때문에 굳이 라는 생각도 들기 때문에 좀 의견을 물어볼 필요가 있음
    - 방법1. 그냥 삭제가 되도록한다.
    - 방법2. 예, 아니오 창이 떠서 거기서 한번 더 의사를 물어보고 삭제할지 안할지 결정(이 방법으로 구성)
    - 방법3. prompt창을 사용해서 비밀번호를 입력해서 삭제한다.
    - 방법4. 모달창에서 비밀번호를 입력해서 비밀번호가 맞을 시 삭제

<br />

# 오늘 느낀 점

- 배포를 시도했는데 처음에는 제대로 작동하는 거 같았는데 서버쪽에서 에러가 생겼는지 제대로 웹 사이트가 열리지않고 있는데 이 부분을 수정을 해줘야할 것 같다. 처음에 게시판 페이지가 나오고 가입하기 페이지도 정상적으로 나오는 것을 확인할 수 있었는데 어디쪽에서 문제가 생겼는지 차근차근 확인이 필요할 것 같다.

- 배포는 Render를 통해 웹 서비스를 배포하고, 서버는 MongoDB atlas를 통해서 배포했는데 예전에 배포할 때 내용을 정리해놓은 것을 참고해 배포했는데 일단은 화면이 제대로 보이는 것을 확인해서 에러만 수정해주면 될 것 같다. 또 새로운 사실을 알았는데 mongodb atlas를 통해서 무료로 배포하는건 하나의 클러스터만 가능하다는 건데 여러개 배포할 기회가 없어서 몰랐는데 이번에 mongodb atlas로 다시 배포하면서 알게 되었다. 그래서 기존에 무료로 서버 배포해놓은 클러스터를 삭제하고 이번에 게시판 만든 내용을 연결해주었다.

- 저번에 배포할 때 내용이 빠진게 있어서 이번에 좀 더 자세하게 내용을 추가해놓았는데 이 부분은 다음에 또 mongodb atlas를 사용해서 서버를 배포한다면 도움이 될 것 같다는 생각이 든다.

<br />

# 내일 할 일

- JS, ExpressJS, MongoDB로 게시판 제작 + (EJS)

<br />

# 앞으로 해야 할 일

- Advanced-js(고급 JS)에 대해 공부하며 이해하기 (JS 공부)

- Python으로 웹 스크래퍼 만들어보기

- Python, PHP 공부할 거 찾아보기

- Python 셀레니움, 브라우저 드라이버에 대해 한번 찾아보기

- Python 데이터 분석도 한번 봐보기
