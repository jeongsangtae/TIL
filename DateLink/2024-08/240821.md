# 오늘 한 일

### React 프로젝트 제작 (React, NodeJS, MongoDB로 만드는 미니 커뮤니티 플랫폼)

- 구성한 내용

  - 헬퍼 함수 위치를 변경하고 사용될 수 있도록 구성 (Context API에 헬퍼 함수를 구성)
    - 헬퍼 함수를 커스텀 훅을 통해서 사용하고 있었으나, 굳이 커스텀 훅을 사용하지 않고 이미 전역적으로 사용되고 있는 Context API에 헬퍼 함수를 옮겨서 사용될 수 있도록 해주고 이전에 구성한 내용도 커스텀 훅이 아닌, Context API에서 불러와서 사용될 수 있도록 구성을 변경해주었다.
    - 백엔드 구성
      - 조회와 삭제는 테스트에 문제가 없었지만, 추가 관련 예외 처리를 테스트할 때 에러가 뜨지만 데이터가 저장되는 문제를 발견해서 그와 관련된 테스트를 위해서 일부러 오류를 발생시키는 구문을 추가
      - 프론트엔드에서 추가한 예외 처리를 테스트하기 위해서, 오류를 발생시키는 throw new Error를 추가
    - 프론트엔드 구성
      - auth-context
        - 초기 값 설정에서 themeModeToggleHandler 대신에 themeModeToggle로 변경
        - 초기 값 설정에 errorHelper 추가
        - errorHelperHandler 함수를 추가하고 커스텀 훅에서 사용되던 내용을 가져와서 구성
          - fetch 함수 내에서 발생한 에러를 처리하고 재사용할 수 있는 헬퍼 함수
        - 내보내서 사용할 수 있게 errorHelper를 추가
      - AdminChats, Comment, Comments, CreateComment
        - 커스텀 훅을 삭제하고, Context API에서 구성한 헬퍼 함수가 사용될 수 있도록 구성
        - 내용은 그대로 유지하고, 사용되는 함수만 변경
    - 테스트 결과, 헬퍼 함수를 커스텀 훅 대신에 Context API로 사용하는 것에 문제는 없었고, 추가 관련 예외 처리 테스트에서 에러가 발생해도 데이터가 저장되는 문제를 추가 테스트 해주면서 어떤 이유로 데이터가 저장됐는 지 확인할 수 있었다.
      - 추가 관련 예외 처리 테스트를 진행하면서, 이미 데이터가 저장되고 그 이후에 오류를 발생시켜서 예외 처리 코드가 제대로 작동하지 않는 다고 착각했기 때문에, 정상적으로 다시 테스트해주기 위해서 데이터가 저장되기 전에 오류를 발생시켜서 제대로 에러가 뜨는 지 확인하고, 데이터가 확실하게 저장이 되지 않는 지 다시 확인해주었다.
      - 데이터가 저장되기 전에 오류를 발생시키면 데이터가 저장되지 않고, 에러가 발생하는 것을 확인할 수 있었다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/3508c4565b74d516961d778ea286cb68ddb93ab0)

  <br />

  - 관리자 채팅, 댓글 예외 처리 추가
    - 관리자 채팅과 관리자 채팅의 사용자 리스트, 댓글 부분의 fetch 함수에서 예외 처리 내용을 추가하고, 이미 추가되어 있는 컴포넌트에서는 예외 처리의 오류 처리 함수가 커스텀 훅이 아닌, Context API의 내용이 사용될 수 있도록 수정해주었다.
    - 백엔드 구성
      - 테스트를 위해서 추가했던 오류 발생 코드를 주석 처리해주었다.
    - 프론트엔드 구성
      - AdminChats, AdminComments
        - 이 컴포넌트들의 fetch 함수에서는 예외 처리가 없는 상태였기 때문에 새롭게 예외 처리를 추가해서 처리
      - AdminComment
        - 이미 예외 처리가 되어 있지만, 오류 처리 부분이 커스텀 훅으로 구성되어 있었기 때문에 Context API 내용이 사용될 수 있도록 변경
      - AdminUserList
        - 해당 컴포넌트의 fetchLastMessages에 예외 처리를 추가하는데, 이 내용에는 Promise.all 내용도 사용되고 있어서 try-catch 문을 2개로 나눠서 전체 함수 예외 처리와 map 함수 내부의 예외 처리로 구성되도록 해주었으나, 내용을 변경해서 전체 함수 예외 처리로만 구성되도록 해주었다.
        - 2개로 나눠서 예외 처리했을 때 좀 더 견고하고 발생할 수 있는 다양한 오류 상황에 대응할 수 있다고 생각했으나, 굳이 추가적인 try-catch 문을 사용하지 않고 fetch 요청 전체 예외 처리로 가능하다고 생각되어 하나의 try-catch 문으로 구성
        - try-catch 문을 사용하여, Promise.all을 포함한 모든 비동기 작업을 한 번에 처리할 수 있었음
        - Promise.all은 map 함수에서 반환된 모든 Promise를 처리하며, 그 중 하나라도 실패하면 전체가 실패로 처리되기 때문에 fetchLastMessages 함수 전체에 try-catch 문을 적용하면 모든 비동기 작업에서 발생할 수 있는 오류를 한 번에 처리할 수 있음, 그러므로 fetch 요청에서 추가적인 try-catch 문은 필요하지 않다고 판단하고 하나의 예외 처리로 구성
        - 이 컴포넌트도 커스텀 훅이 아닌, Context API의 오류 처리 함수가 사용되도록 구성
    - 테스트 결과, 추가한 예외 처리 내용이 문제가 없는 것을 확인할 수 있었고 AdminUserList에서 여러가지 테스트를 해보고 2개의 try-catch 문도 사용해봤으나, 하나의 try-catch 문으로 충분하다고 생각되어 2개는 사용하지 않도록 구성해주었다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/e4a58013601a5f77db09078527b96f1dbda0d4c0)

<br />

- 추가 및 해결 해야 할 내용
  - 컴포넌트를 분리해줄만한 곳이 있는지 확인해봐야 함
    - 컴포넌트 분리만이 아닌, 조건부나 이런 내용에서 중복된 부분을 줄이고 코드 가독성을 향상 시켜줘야 함
  - 코드 예외 처리 더 필요한 부분이 있는 지 체크해야 함
  - 전체적으로 코드에 주석을 추가해서 어떤 코드가 어떤 기능을 하는지 알 수 있도록 해줘야 함
  - 페이지로 구성되어있는데, action 함수가 사용되지 않는 부분을 확인해야 함
  - 마지막 기능 추가로, 관리자 권한을 부여하는 내용을 생각하고 있음
    - 가입할 때는 일반 사용자로 가입을 할 수 있고, admin 관리자 계정으로 관리자 페이지에서 관리자 권한을 부여하는 내용을 생각 중
  - 존재하지 않는 게시글 세부 페이지에 대해 처리해줘야 함
    - 원래 로딩 인디케이터가 보였으나, 예외 처리를 해주면서 현재 게시글 내용이 없는 빈 게시글 세부 페이지가 보여짐
  - 화면이 작아졌을 때 UI가 필요함
    - 반응형 CSS를 추가해야 함
  - 프론트엔드에서 예외 처리 내용을 추가하고, 예외 처리에서 발생한 에러를 처리하는 내용이 재사용될 수 있도록 해줘야 함
    - 현재 커스텀 훅으로 구성되어 사용하고 있으나, 이 내용을 Context API로 옮겨서 사용될 수 있도록 해줘야 함
    - Context API로 옮겨서 구성했고, 남은 프론트엔드의 fetch 함수에서 예외 처리를 해줘야 함
  - 새롭게 발견한 문제
    - 관리자 채팅의 사용자 리스트에서 사용자와 나눈 마지막 메시지 내용을 가져오는데, 이 때 새로고침을 하지 않으면 당장 채팅을 나눠도 실시간으로 마지막 메시지가 갱신되지 않아서 새로운 메시지가 있는 지 확인할 수 없기 때문에 추가하는 것도 고려해야 함
    - 한편으로는, 관리자 채팅이라서 사용자가 겪는 불편함이 아니기 때문에 그냥 놔두는 것도 고려 중

# 오늘 느낀 점

- 데이터 추가와 관련된 예외 처리를 테스트를 할 때, 실수로 이미 데이터가 저장된 후에 오류를 발생시켜서 데이터 추가 관련된 예외 처리가 제대로 작동하지 않는다고 생각했으나, 에러를 발생시키는 위치가 문제여서 해당 위치를 데이터가 저장되기 전으로 옮겨서 테스트하니 문제없이 예외 처리가 작동되는 것을 확인할 수 있었다. 그리고 프론트엔드의 fetch 함수에서 예외 처리를 추가하는 작업이 간단하게 금방 끝날 것으로 생각되었으나, 예외 처리를 추가하고 테스트하는 과정이 생각보다 좀 오래걸려서 더뎌지는 것 같은데 최대한 빠르게 처리해서 모든 fetch 함수에서 예외 처리를 추가해서 코드가 안전하게 작동될 수 있도록 해줘야 할 것 같다. 추가로 관리자 채팅의 사용자 리스트에서 보여지는 마지막 메시지 내용이 항상 실시간으로 반영되도록 해주는 것에 대한 고민은 일단 조금 뒤로 미뤄놓고 예외 처리 작업부터 다 마무리해주고 결정해야 할 것 같다.

<br />

# 내일 할 일

- React 공부 및 React 프로젝트 조금씩 진행하기

<br />

# 앞으로 해야 할 일

- React, NextJS 공부

- React 프로젝트 제작
