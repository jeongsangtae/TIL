# 오늘 한 일

### React + TypeScript 프로젝트 제작 (React, TypeScript, ExpressJS, MongoDB로 만드는 실시간 통신 애플리케이션)

- 그룹 채팅방 및 채팅 관련 내용에 구성된 웹 소켓 관련 로직 분리
  - 그룹 채팅방 참여 시에 소켓 연결을 재차 시도하고 방에 입장하는데, 이미 로그인할 때 소켓 연결이 되기 때문에 그룹 채팅방에 참여할 때는 별도의 소켓 연결을 시도하지 않고, 소켓이 연결되었는지 확인만 하고 바로 그룹 채팅방에 참여하도록 로직을 분리해 구성
  - 프론트엔드
    - chatStore
      - useSocketStore Zustand를 import
      - newMessage 액션 추가
        - connect 액션에서 매개변수로 받던 roomId를 여기서 받도록 구성
        - useSocketStore에서 socket 연결하는 내용을 가져와 구성
        - socket이 존재하는지 확인하는 조건부 추가
          - socket이 없을 경우 return을 통해 실행 종료
        - connect 액션에서 사용하고 있던 그룹 채팅방 참여 및 새로운 메시지를 저장하는 로직을 옮겨와 구성
      - connect 액션
        - 삭제하려고 했으나, 테스트를 위해 남겨놓은 상태
        - 소켓 연결이 중복되기 때문에 테스트를 다 진행한 후 삭제할 예정
    - Chats
      - useChatStore Zustand에서 newMessage 액션을 추가로 불러옴
      - useEffect에서 사용되는 connect 액션 대신에 newMessage 액션을 사용
        - newMessage 액션에 roomId 내용을 전달
  - 채팅 관련 Zustand에서 구성한 connect 액션 로직내의 그룹 채팅방 참여와 새로운 메시지 저장하는 내용이 별도의 액션에서 작동되도록 분리해 테스트한 결과, 방에 참여하고 추가된 메시지가 실시간으로 반영되어 보여지는 것은 문제가 없지만, 새로고침 시에 방 번호가 초기화되어 메시지를 추가해도 실시간으로 반영되지 않는 것을 확인할 수 있었다.
    - 처음에 방 참여하고 메시지를 추가하는 것은 문제가 없고, 다른 방으로 이동해 메시지를 추가하는 것도 문제없이 실시간 반영됨
    - 하지만, 참여한 방에서 새로고침을 하면 방 번호가 초기화되어 메시지를 추가해도 실시간 반영되지 않고 저장되는 것을 확인
    - 여러 방법으로 테스트해 봤으나 제대로 해결하지 못해서 추가 수정이 필요함
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/3f0a2199547a86e5de9d96aa480290b3f69a26eb)

# 오늘 느낀 점

- 소켓 관련된 Zustand에서 친구 요청 수신 이벤트를 따로 분리해 구성하고 테스트한 결과, 원할하게 작동이 되지 않았고 친구 요청 수신 이벤트는 전역적으로 작동되어 알림이 떠야 하기 때문에 따로 분리하는 것은 맞지 않다고 생각해 기존 코드 그대로 사용할 생각이다. 그리고 채팅 관련 Zustand에서 그룹 채팅방 참여와 새로운 메시지 저장하는 내용을 별도의 액션에 분리해 구성하고 테스트한 결과, 그룹 채팅방에 참여하고 다른 방으로 이동해서 메시지를 추가하고 실시간 출력도 문제가 없었지만, 새로고침 후에 메시지를 추가하면 실시간 출력 기능이 정상적으로 작동하지 않은 채로 메시지가 저장되기 때문에 이 부분에 대한 수정이 필요한 상황이다. 로컬 스토리지를 사용하는 방법도 테스트해 봤는데 제대로 작동하지 않아서, 로컬 스토리지를 활용하는 로직을 다시 구성해 테스트해 보거나 그룹 채팅방에 들어가고 나가는 것에 대한 내용을 소켓 Zustand에서 구성해 관리하고, 거기서 새로고침하면 소켓에 다시 연결되어 방 참여 유지까지 되는 내용을 생각해 봤는데, 아직 생각만 하고 테스트해 보진 못했기 때문에 해당 로직을 구현해 테스트를 진행해 봐야 한다.

<br />

# 내일 할 일

- 실시간 통신 애플리케이션 (Float Chat) 프로젝트 진행

- Zustand 내용 구성

- 친구 관련된 내용을 좀 다듬어야 함 (코드를 깔끔하게 보이도록 수정 필요)

- 친구 관련된 내용에서 타입 정의 및 코드 정리 필요

- 소켓 관련 내용에서도 타입 정의 필요

- 그룹 채팅방에서 채팅 메시지가 추가되면 전역적으로 알 수 있도록 알림이 떠야 하고, 그 알림 관리를 소켓 Zustand에서 할 수 있도록 구성 필요

- 추가된 친구와 대화를 나눌 수 있는 다이렉트 채팅방

- 그룹 채팅방 초대하는 기능

<br />

# 앞으로 해야 할 일

- React, TypeScript 공부

- React 상태 관리 도구인 Zustand 공부

- 실시간 통신 애플리케이션 프로젝트 제작
