# 오늘 한 일

### React + TypeScript 프로젝트 제작 (React, TypeScript, ExpressJS, MongoDB로 만드는 실시간 통신 애플리케이션)

- 그룹 채팅 연결 액션 추가 및 로컬 스토리지에 현재 있는 방 id 저장, 사용 및 그룹 채팅방 참여와 메시지 내용 분리
  - 그룹 채팅방에 참여해 연결하는 액션 내용을 별도로 추가해, 메시지 실시간 반영 내용과 분리해 주고 방에 참여하는 이벤트 내용이 따로 실행되도록 구성해 주었으며, 새로고침했을 때 방 정보가 사라지지 않도록 로컬 스토리지에 저장하고 활용
  - 프론트엔드
    - chatStore
      - newMessage 액션 수정
        - joinRoom 이벤트 내용을 주석 처리
        - socket.off를 추가하고, newMessage 이벤트를 구성
          - 중복 방지를 위해 추가
    - socketStore
      - currentRoom 상태 추가
        - 로컬 스토리지에 저장된 currentRoom 정보를 가져오도록 구성
          - currentRoom 정보가 없다면 null로 적용
      - connect 액션 수정
        - 새로고침하면 connect 이벤트가 재실행되는데, 이 때 자동으로 마지막 채팅방에 다시 입장하도록 구성
        - 로컬 스토리지에서 currentRoom 정보를 가져오도록 구성하고, 만약 currentRoom 정보가 있을 경우 joinGroupChat 액션을 실행해 방에 참여하도록 구성
      - joinGroupChat 액션 추가
        - socket 상태를 가져와 유효한지 확인
        - currentRoom 상태를 불러와 확인하고, 유효한 경우 leaveRoom 이벤트를 실행해 기존 방을 나가도록 구성
          - 아직 leaveRoom 이벤트는 구성되지 않음
        - joinRoom 이벤트를 실행해 새로운 방에 입장하도록 구성
          - 새로운 방에 입장할 때 roomId 정보를 전달
        - set을 통해 currentRoom 상태가 roomId 정보로 업데이트되도록 구성
        - 새로고침해도 유지가 되도록 로컬 스토리지에 currentRoom 항목을 추가
          - currentRoom 항목에 roomId 정보를 저장
        - 모두 올바르게 작동 시, roomId 정보 표시와 함께 그룹 채팅방 입장 메시지 콘솔에 출력
      - disconnect 액션 수정
        - 로그아웃 시에 채팅방 정보도 초기화되도록 로컬 스토리지에 저장된 currentRoom 항목을 삭제하도록 구성
    - Chats
      - useSocketStore Zustand를 추가하고, joinGroupChat을 불러오도록 구성
      - useEffect에 joinGroupChat 액션을 추가하고, roomId 내용이 전달되도록 구성
      - newMessage 액션은 별도의 useEffect로 분리
  - 채팅 관련 Zustand에서 이미 그룹 채팅방 연결과 메시지 실시간 반영 이벤트 내용을 분리했었지만, 그룹 채팅방 연결은 채팅 관련 Zustand가 아닌 소켓 관련 Zustand에서 관리하는 것이 맞다고 생각되어, 소켓 관련 Zustand에 그룹 채팅방 참여와 관련된 액션을 추가 및 이벤트 내용을 구성하고, 새로고침할 때 해당 채팅방 정보가 사라져도 다시 불러와 사용될 수 있도록 로컬 스토리지 관련 내용을 추가해 구성하고 테스트한 결과, 이전처럼 그룹 채팅방 참여에 문제가 없는 것을 확인했으며 연결 관련 메시지가 콘솔에 출력되는 것도 확인했고, 새로고침하면 그룹 채팅방 입장이라는 메시지가 콘솔에서 보여지며 그대로 연결 유지가 되는 것도 확인할 수 있었다.
    - 추가로 로그아웃하면 로컬 스토리지에 저장된 그룹 채팅방 정보가 사라지는 것도 확인됨
    - 방 참여는 문제없이 되고 새로고침해도 유지는 되지만, 메시지 실시간 반영 관련 이벤트가 제대로 연결되지 않아서 실시간 반영이 안되기 때문에 추가 수정 필요
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/5eb1410906be51ff5fd021c2a8b4335db45398b4)

<br />

- 새로고침 시에 newMessage 이벤트 연결 유지
  - 새로고침을 시도하면 방 참여 관련된 이벤트만 실행되어, 방 참여만 유지되고 메시지 수신 이벤트는 실행되지 않아서 실시간 반영이 안되기 때문에, 새로고침 후 방에 다시 참여될 때 메시지 수신 이벤트도 연결되도록 구성
  - 프론트엔드
    - chatStore
      - connect 액션 관련 코드를 주석 처리
      - newMessage 액션 수정
        - newMessage 이벤트가 실행되는지 확인하기 위한 콘솔 로그 추가
        - 중복된 메시지를 체크하는 조건문을 삼항 연산자로 수정해 간단하게 표현
    - socketStore
      - useChatStore Zustand를 추가
      - connect 액션 수정
        - 새로고침 후 자동으로 마지막 채팅방에 다시 입장하는 조건문에 `useChatStore.getState().newMessage()`를 추가
          - joinGroupChat 액션이 실행될 때, newMessage 액션도 함께 실행되어 메시지 수신 이벤트가 다시 등록되도록 구성
    - Chats
      - joinGroupChat 액션을 실행하는 useEffect와 newMessage 액션을 실행하는 useEffect를 하나로 합쳐서 실행되도록 구성
  - 새로고침을 시도하면 소켓 연결이 다시 진행되는데, 그 때 로컬 스토리지에 저장된 정보로 마지막 참여했던 채팅방에 다시 참여되고 메시지 수신 이벤트도 작동해 연결되도록 구성하고 테스트한 결과, 새로고침하면 방 연결도 다시 되며 메시지 수신 이벤트도 연결되어 콘솔에 관련 메시지가 출력되는 것을 확인할 수 있었다.
    - 메시지를 추가하면 실시간 반영되어 보여지는 것도 확인했고, 그룹 채팅방 참여 이벤트와 메시지 수신 이벤트를 분리하기 전과 동일하게 작동하는 것을 확인
    - 분리한 내용이 깔끔하지 못한 것 같고, 현재 구조가 부족한 느낌이 들어서 추가로 구조를 변경하거나 로직을 이동시켜서 코드 간 결합도를 좀 낮추는 것도 고려해야 함
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/a13877e33a747d347a65de53d26c69e906880da6)

# 오늘 느낀 점

- 분리해 놓은 그룹 채팅방 이벤트 관련 코드를 소켓 Zustand에 옮겨서 구성하고 방 참여와 동시에 참여한 방 ID를 로컬 스토리지에 저장하고 새로고침했을 때, 로컬 스토리지에 저장된 방 ID를 불러와 바로 연결이 되도록 구성을 해 주었다. 그리고 새로고침하면 메시지 수신 이벤트도 초기화되어 제대로 연결이 되지 않는데, 이 부분은 방 ID를 로컬 스토리지에서 불러올 때 메시지 수신 이벤트를 연결하는 액션을 실행시켜 추가된 메시지가 실시간 반영되어 화면에 출력하도록 구성해 주었다. 결과적으로 로직을 분리하고 구조를 변경한 내용이 변경 전 내용과 동일하게 작동이 되는 것을 확인할 수 있었다. 하지만 변경한 구조도 깔끔하지 않은 느낌이 들고, 더 깔끔하고 역할에 맞게 딱 분리가 가능할 것 같은데 다른 Zustand에서 관련 내용을 가져와 구성하기 때문에 Zustand 간의 의존성이 너무 높아져 좋지 않은 코드 같다는 생각도 든다. 그리고 Zustand 스토어 간의 결합도가 높아서 이 부분도 개선을 좀 해 줘야 할 것 같은데, 기능 동작이 현재 상태로 작동되고 메시지 수신 이벤트 연결 로직이 방 참여하는 액션 로직쪽에서 함께 작동하는 구조는 어떤지 좀 생각을 해 봤는데, 이렇게 구성하면 방 참여와 동시에 메시지 수신 이벤트도 작동해 함께 연결되고 새로고침하면 둘 다 바로 연결되는 구조를 가질 수 있을 것 같아서 한 번 구조를 수정하고 테스트해 봐야 할 것 같다.

<br />

# 내일 할 일

- 실시간 통신 애플리케이션 (Float Chat) 프로젝트 진행

- Zustand 내용 구성

- 친구 관련된 내용을 좀 다듬어야 함 (코드를 깔끔하게 보이도록 수정 필요)

- 친구 관련된 내용에서 타입 정의 및 코드 정리 필요

- 소켓 관련 내용에서도 타입 정의 필요

- 그룹 채팅방에서 채팅 메시지가 추가되면 전역적으로 알 수 있도록 알림이 떠야 하고, 그 알림 관리를 소켓 Zustand에서 할 수 있도록 구성 필요

- 추가된 친구와 대화를 나눌 수 있는 다이렉트 채팅방

- 그룹 채팅방 초대하는 기능

<br />

# 앞으로 해야 할 일

- React, TypeScript 공부

- React 상태 관리 도구인 Zustand 공부

- 실시간 통신 애플리케이션 프로젝트 제작
