# 오늘 한 일

### React + TypeScript 프로젝트 제작 (React, TypeScript, ExpressJS, MongoDB로 만드는 실시간 통신 애플리케이션)

- 친구 관련 토글 함수 재사용 및 친구 관련 액티브 버튼 수정
  - 친구 관련 내용에서 구성된 토글 함수 내용을 수정해 여러 활성화 버튼에서 재사용되도록 해 주고, 친구 관련 액티브 버튼 내용 또한 토글 함수와 연결되어 사용될 수 있도록 수정
  - 프론트엔드
    - Friends
      - toggle useState를 activeTab useState로 변경
      - 토글 함수 내용 수정
        - 매개변수로 tab, action 내용을 전달받도록 구성
        - if문 내용을 추가
          - activeTab useState를 확인하고 tab 내용과 일치하지 않을 때, activeTab useState 내용을 tab 내용으로 업데이트
          - 매개변수로 전달받은 action 내용이 실행되도록 구성하고, 옵셔널 체이닝을 추가해 함수가 존재할 때만 실행되도록 구성
          - action 내용이 undefined거나 null이면 아무것도 실행하지 않음
      - JSX 코드 내의 버튼과 활성화되는 내용들 수정
        - 모두 버튼
          - onClick 내용에 토글 함수를 구성하고, tab에는 all 내용, action에는 loadFriend 액션이 들어가도록 구성
        - 대기중 버튼
          - onClick 내용에 토글 함수를 구성하고, tab에는 pending, action에는 loadFriendRequests 액션으로 구성
        - 친구 추가하기 버튼
          - onClick 내용에 토글 함수를 구성하고, tab에는 addFriend, action은 따로 추가하지 않음
        - 모두 버튼 클릭 시 활성화되는 내용
          - activeTab을 확인해 all과 일치하면 내용이 활성화되어 보여지도록 구성
        - 대기중 버튼 클릭 시 활성화되는 내용
          - activeTab을 확인해 pending과 일치하면 내용이 활성화되어 보여지도록 구성
        - 친구 추가하기 버튼 클릭 시 활성화되는 내용
          - activeTab을 확인해 addFriend와 일치하면 내용이 활성화되어 보여지도록 구성
  - 토글 함수가 재사용되도록 수정하고, 활성화 버튼에서 토글 함수에 매개변수 내용을 전달해 실행되도록 구성한 후에 확인한 결과, 하나의 내용이 보여지는 동안 다른 활성화 버튼을 클릭하면 그 내용은 안보이고 버튼을 클릭한 내용이 보여지는 것을 확인할 수 있었다.
    - 구성한 내용에서 문제점을 발견, 처음에 "모두" 내용이 활성화되어 있는데 해당 내용을 불러오지 않고 대기중이나 추가 내용으로 이동하고 돌아와야 내용이 보여지므로, 처음부터 친구 목록이 "모두" 내용에서 보여지도록 수정이 필요함
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/a9208e3555ee1f609fa6aae2829555dbf0f2b95a)

<br />

- 함수에서 사용한 옵셔널 체이닝 내용 정리
  - `?.`의 원래 의미
    - 옵셔널 체이닝은 객체 프로퍼티를 안전하게 접근할 때 주로 사용
      - ex) `console.log(obj.user.name)`는 타입 에러
      - ex) `console.log(obj.user?.name)`는 안전하게 접근
    - `?.` 옵셔널 체이닝은 함수 호출에도 적용할 수가 있어서, 값이 존재하면 실행하고 아니면 무시함
  - `?.()`의 의미
    - 함수가 존재하면 실행하고, 없으면 무시하는 역할
    - ex) `action?.()`에서 action이 undefined나 null이면 아무것도 실행하지 않고, 반대로 action이 함수면 해당 함수를 실행
    - `?.()`는 결국, 해당 값이 함수라면 실행하라는 의미
  - 일반적으로 "." 뒤에는 객체 프로퍼티가 와야 하는데 어떻게 함수가 실행되는지에 대한 의문
    - 예시
      - ex) `obj.method();` 정상 실행
      - ex) `obj.method.();` 문법 오류
    - `.()`는 말이 안되는 구조지만, 옵셔널 체이닝은 특별하게 동작함
      - `?.()`는 함수 전용 문법으로, `?.`을 함수 호출에 사용하면 자동으로 `()`까지 포함해서 실행됨
      - `action.()`처럼 따로 찍는 건 불가능하지만, `?.()`는 특별한 동작을 하기 때문에 실행됨
  - 옵셔널 체이닝을 사용할 수 있는 세 가지 경우
    - 객체 프로퍼티 접근
      - ex) `user?.name`
    - 배열 요소 접근
      - ex) `arr?.[0]`
    - 함수 호출
      - ex) `obj.sayHello?.()`
  - 정리
    - 옵셔널 체이닝은 `?` 하나만으로 동작하는 게 아니라, `?.`이 하나의 세트로 동작하는 문법
    - 옵셔널 체이닝은 `?` 단독으로는 아무 의미가 없고, `?.`이 하나의 연산자로 사용되며 객체, 배열, 함수에 적용 가능

<br />

- 친구 삭제 액션, 라우터 로직 추가 및 연결 그리고 사용
  - 친구 삭제와 관련된 액션 내용을 친구 관련 Zustand에 추가하고, 백엔드에서는 친구 삭제 라우터를 추가해 액션 내용과 연결해 주었으며, 친구 컴포넌트에서는 친구 삭제 액션을 불러와 사용될 수 있도록 구성
  - 백엔드
    - friend-routes
      - 액세스 토큰에서 사용자 정보를 가져오도록 구성하고, 유효한 지 확인
      - 불러온 사용자 정보에서 \_id 내용을 ObjectId로 변환
      - params를 통해 가져온 친구 \_id 정보를 ObjectId로 변환
      - 친구 삭제하는 내용
        - friends 컬렉션에서 requester.id, receiver.id와 변환한 사용자 \_id, 친구 \_id를 비교하고 일치하는 항목을 찾도록 구성
      - 삭제하려는 항목이 정상적으로 삭제되었는지 확인하고, 정상 처리되었다면 프론트엔드로 삭제 메시지 전달
  - 프론트엔드
    - Friends
      - loadFriend로 사용되는 부분을 loadFriends로 변경
    - Friend
      - useFriendStore Zustand에서 deleteFriend를 불러오고 사용할 수 있도록 구성
      - 친구 삭제하는 함수 추가
        - deleteFriend 액션을 추가하고, id prop 내용이 전달되도록 구성
      - 버튼을 추가하고 onClick에 친구 삭제 함수를 구성
    - friendStore
      - loadFriend 액션을 loadFriends로 변경
      - sendFriendRequest, acceptFriendRequest, rejectFriendRequest 액션에서 응답 데이터를 확인하는 내용 추가
      - deleteFriend 액션 추가
        - fetch 함수 구성
          - 매개변수로 친구 \_id 정보를 전달받음
          - api 경로는 매개변수로 전달받은 친구 \_id 정보를 포함해 구성
          - 메소드는 DELETE로 구성
        - 응답 데이터가 정상적으로 넘어오는지 확인하고, 문제없다면 백엔드에서 전달한 메시지를 콘솔에 출력
        - 오류 발생 시에 오류 메시지를 화면에 출력
  - 친구 삭제 액션을 친구 관련 Zustand에 구성하고 백엔드에서는 친구 삭제 라우터를 추가한 후에 연결하고 테스트한 결과, 삭제 버튼 클릭 시에 친구가 삭제되어 친구 목록과 DB에서 보이지 않는 것을 확인
    - 실시간 반영과 관련된 내용은 따로 추가하지 않아서 새로고침해야 적용된 화면을 볼 수 있음
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/a4ba7035b829a37d54b6c52ebf153034774ef9fd)

# 오늘 느낀 점

- 친구 관련된 내용에서 모두, 대기중, 친구 추가 버튼이 토글 함수 하나로 재사용되도록 구성해 주었고, 친구 목록에서 친구를 삭제할 수 있도록 삭제 액션 로직와 백엔드 라우터 내용을 구성해 주었다. 구성한 내용들은 테스트한 결과, 크게 문제는 없었지만 초기에 친구 목록이 보여지는 모두 내용에서 바로 친구 목록이 보여지는 것이 아닌, 대기중이나 친구 추가 버튼을 클릭해 이동한 후에 모두 내용에서 친구 목록이 보여지기 때문에, 이 내용은 로그인 시에 바로 친구 목록이 보여지도록 수정이 필요하다. 그리고 친구 요청, 수락, 거절 또는 취소 내용이 실시간 반영되도록 하는 것에 대해 고민을 해 봤는데, 다른 것보다 친구 요청이 넘어오면 실시간 반영되어 알림이 뜨도록 하는 내용은 필요하다고 생각되기에, socket.io를 사용해 실시간 반영을 추가해야 할 것 같다.

<br />

# 내일 할 일

- 실시간 통신 애플리케이션 (Float Chat) 프로젝트 진행

- Zustand 내용 구성

- 친구 관련된 내용을 좀 다듬어야 함 (코드를 깔끔하게 보이도록 수정 필요)

- 친구 목록 출력 및 추가된 친구와 대화를 나눌 수 있는 다이렉트 채팅방

- 그룹 채팅방 초대하는 기능

<br />

# 앞으로 해야 할 일

- React, TypeScript 공부

- React 상태 관리 도구인 Zustand 공부

- 실시간 통신 애플리케이션 프로젝트 제작
