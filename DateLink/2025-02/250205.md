# 오늘 한 일

### React + TypeScript 프로젝트 제작 (React, TypeScript, ExpressJS, MongoDB로 만드는 실시간 통신 애플리케이션)

- 친구 요청 로직 추가 (프론트엔드, 백엔드 모두 추가 및 연결) 및 다이렉트 채팅, 친구 컴포넌트 구조 수정
  - 친구 추가를 하려는 상대방에게 친구 요청을 보내는 로직을 프론트엔드에 구성하고, 그에 맞게 백엔드에서도 구성해 연결해 주었고, 다이렉트 채팅과 친구 컴포넌트 구조를 수정
  - 백엔드
    - user-routes
      - ObjectId를 사용할 수 있도록 mongodb import
      - 친구 추가 요청 POST 라우터
        - 프론트엔드에서 전달한 데이터를 전달 받아 저장하도록 구성
        - 한국 시간으로 저장될 수 있도록 date, kstData 추가
        - 친구 추가할 사용자를 찾는 내용
          - 프론트엔드에서 전달한 입력한 사용자 이메일 내용과 기존의 users 컬렉션에 저장된 사용자 이메일 내용이 일치하는 항목을 찾도록 구성
          - 정규 표현식을 사용해 정확한 이메일 내용을 찾도록 구성
        - 친구 추가할 사용자가 존재하는지 확인하는 if문
        - 요청을 보낸 사용자와 친구 추가할 사용자를 구분하는 변수 추가
          - 요청을 보낸 사용자는 프론트엔드에서 전달한 정보의 \_id
          - 친구 추가할 사용자는 앞에서 찾은 내용의 \_id
          - new ObjectId를 사용해 MongoDB에서 사용할 수 있는 ObjectId로 변환
        - 이미 친구 요청을 보냈거나 친구인지 확인하는 내용
          - friendRequests 컬렉션에서 요청 보낸 사용자와 친구 추가할 사용자를 확인하도록 구성
          - 요청 보낸 사람과 친구 요청 받은 사람의 조합이 존재하는지 확인
        - 이미 친구 요청을 보냈다면 그에 맞는 메시지를 프론트엔드로 전달
        - 친구 요청을 처음 보낸다면, friendRequests 컬렉션에 요청을 보낸 사용자 ID와 친구 추가할 사용자 ID 그리고 status, date 항목으로 구성해 저장
          - status 항목은 "보류 중"으로 구성하고, 나중에 수락된다면 그 때 내용이 업데이트되어 "수락됨" 이런식으로 변경될 예쩡
          - date 항목은 앞에서 추가한 한국 시간 날짜가 저장되도록 구성
        - 모두 정상적으로 진행되면 친구 요청이 전송되었다는 메시지가 프론트엔드로 전달되도록 구성
          - 반대로 중간에 오류 발생 시에, 요청 오류에 대한 메시지 출력
  - 프론트엔드
    - DirectChats
      - 아이콘이 들어갈 위치를 구분하기 위해 텍스트로 구성
      - DirectChat 컴포넌트를 추가
    - DirectChat
      - 별다른 내용없이 우선 컴포넌트 기본 구성만 추가
    - Friends
      - 토글을 관리하는 useState 추가
        - 기본값은 false
      - 친구 추가 컴포넌트를 열고 닫는 토글 함수 추가
        - 클릭 시 토글 useState를 반대로 전환하도록 구성
      - 온라인, 모두, 대기 중, 친구 추가하기 항목으로 구성
      - 친구 추가하기 버튼에 onClick을 추가하고, 토글 함수가 사용되도록 구성
      - 토글을 관리하는 useState에 true가 넘어오면 친구 추가하는 컴포넌트가 보여지도록 구성
    - AddFriend
      - useAuthStore를 통해 userInfo 상태를 가져오도록 구성
      - 친구 추가하는 내용에 입력한 사용자 이메일 정보를 저장하는 useState 추가
      - 백엔드에서 전달한 메시지를 저장하는 useState 추가
      - 친구 추가 요청을 보내는 함수
        - 입력한 이메일 내용에 공백이 없는 지 확인하도록 구성
        - 가져온 userInfo 내용을 객체 디스트럭처링으로 구성
        - userInfo 내용과 입력한 이메일 내용을 백엔드에 함께 전달하도록 객체로 구성
        - 백엔드와 연결하는 fetch 함수를 추가하고, body에 userInfo 내용과 이메일 내용을 전달하도록 구성
        - 친구 추가 요청이 실패했을 때, 실패 메시지를 화면에 띄우도록 구성
        - 올바른 응답이 넘어왔을 때, 백엔드에서 전달한 메시지를 useState에 저장하고, 친구 추가 입력창 초기화
      - JSX 코드
        - 친구 추가 입력 input
          - type은 text
          - value에는 입력한 이메일 내용
          - onChange에는 입력한 내용을 업데이트하는 내용으로 구성
        - 친구 요청 보내는 button
          - onClick에 친구 추가 요청을 보내는 함수를 구성
        - 백엔드에서 전달한 메시지 출력
  - 친구 추가 요청에 대한 프론트엔드 로직과 백엔드 로직을 구성하고 연결해 테스트한 결과, 정상적으로 요청이 진행되어 friendRequests 컬렉션에 친구 요청 정보가 저장되는 것을 확인할 수 있었다.
    - 원래는 사용자를 검색하고 거기서 친구 추가를 하도록 구성하려고 했으나, 특정 이메일 같은 내용을 바로 입력해 친구 요청을 보내는 방식이 불필요한 데이터 로딩 없이 처리할 수 있다고 생각되어 변경
    - 아직은 친구 추가 요청만 구성한 상태이기 때문에, 친구 요청 수락 및 거절에 대한 내용도 추가해야 한다.
    - 추가로 친구 요청 수락 및 거절이 된 경우, friendRequests 컬렉션에서 그에 따른 업데이트가 되어야 하며, 완료된 내용은 바로 삭제되거나 일정 시간 후에 삭제될 필요가 있음
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/e083b0b7fde63b1c36439fb6af75d2a7e334654c)

# 오늘 느낀 점

- 친구 추가를 위해 검색 모달과 친구 추가 모달을 구성하려고 했지만, 굳이 검색 기능을 구현할 필요없이 필요한 사용자 정보(ex: 사용자 이메일)를 입력해 바로 친구 추가 요청을 하는 편이 불필요한 데이터 로딩 없이 처리될 수 있다고 생각되어 변경하게 되었다. 그리고 닉네임 뒤에 태그를 붙이는 내용 또한, 불필요하다고 생각이 되었는데 그 이유는 가입을 할 때 이메일이 중복되지 않도록 이미 구성을 해 놓은 상태이기 때문에 이 내용을 활용하면 충분히 중복 관련 문제도 방지되고, 닉네임 태그 같은 내용을 추가하기 위해 코드가 늘어나는 것도 방지할 수 있기 때문에 이메일을 활용할 생각이다. 그리고 친구 추가 요청이 정상적으로 진행되긴 하지만, 아직 기능 동작에 허점이 많다고 생각이 되기 때문에 좀 더 다듬어야 하고, 친구 추가 요청을 수락 또는 거절 아니면 보낸 사용자가 취소하는 그런 내용도 추가해 봐야 한다.

<br />

# 내일 할 일

- 실시간 통신 애플리케이션 (Float Chat) 프로젝트 진행

- Zustand 내용 구성

- ~~친구 추가를 위해 검색 모달 및 친구 추가 모달~~

- 친구 추가 요청 내용을 다듬어서, 요청 수락과 취소 그리고 같은 경우에 대한 내용을 추가해야 함

- 친구 목록 출력 및 추가된 친구와 대화를 나눌 수 있는 다이렉트 채팅방

- 그룹 채팅방 초대하는 기능

<br />

# 앞으로 해야 할 일

- React, TypeScript 공부

- React 상태 관리 도구인 Zustand 공부

- 실시간 통신 애플리케이션 프로젝트 제작
