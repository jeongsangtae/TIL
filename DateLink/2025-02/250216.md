# 오늘 한 일

### React + TypeScript 프로젝트 제작 (React, TypeScript, ExpressJS, MongoDB로 만드는 실시간 통신 애플리케이션)

- 로그인 시에 친구 목록이 바로 출력되도록 로직 추가
  - 로그인을 하면 친구 목록이 모두 내용에 바로 보여지도록 관련 로직을 추가
  - 프론트엔드
    - Friends
      - useEffect 추가
      - activeTab useState의 초기값 수정
        - "all"에서 null로 수정
      - useEffect를 추가하고, 토글 함수를 구성
        - 컴포넌트가 마운트되면 토글 함수에 "all"과 loadFriends 내용이 전달되어 실행되도록 구성
  - useState 초기값을 수정하고, useEffect를 추가해 초기 마운트 시에 친구 목록이 보이도록 구성하고 테스트한 결과, 로그인하면 저장된 친구 목록이 바로 표시되는 것을 확인할 수 있었다.
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/5e96185aa8565705d8186ed8c1429377d8f98624)

<br />

- socket 연결을 관리하는 Zustand 추가 및 로그인 시에 socket.io에 연결되는 로직 추가 및 알림 관련 내용 추가 등 여러 내용 추가 (미완성 내용으로 테스트 중)
  - socket 연결과 관련된 내용을 하나의 Zustand에서 관리하기 위해 별도의 socket 관련 Zustand를 추가하고, 로그인할 때 바로 socket에 연결되도록 로직을 추가, 해당 로직과 연결하기 위해 백엔드에서 구성된 socket 관련 내용을 수정해 주었으며, 친구 요청에 관한 알림이 전달되도록 구성
  - 백엔드
    - app
      - 로그인 시에 바로 연결되는 socket 내용 추가
        - userId를 전달 받고, 해당 내용으로 연결
    - friend-routes
      - 친구 요청 라우터에 알림과 관련된 내용 추가
        - 친구 요청 시에 알림이 전송되도록 로직을 추가했으나 미완성 상태
        - express 앱에서 인스턴스를 가져오고, 받는 사람 id 기반으로 id를 생성하고, 해당 사용자한테 친구 요청 알림을 전송하도록 구성
  - 프론트엔드
    - authStore
      - useSocketStore를 불러오고, getState를 사용해 connect 액션을 직접 가져와서 실행되도록 구성
      - renewToken, login, refreshToken에 추가해 사용되도록 구성
      - 로그인 시에 socket에 연결되는 것을 확인
    - friendStore
      - 친구 관련 내용에서 별도의 socket을 연결하는 로직을 추가하던 중에, socket 관련 내용을 전체적으로 관리하는 Zustand가 필요할 것 같아서, 이전에 구성하던 socket 연결하는 로직 주석 처리
    - socketStore
      - useAuthStore에서 userInfo 내용을 불러오도록 구성
      - socket, notification, connect, disconnect 액션을 추가
      - connect 액션 구성
        - userInfo 내용에 getState()를 사용해 상태를 직접 가져오도록 구성
        - 가져온 userInfo 내용의 \_id 내용이 유효한지 확인
        - 이미 연결되어 있는 socket이 있을 경우 중복 방지되도록 구성
        - socket과 연결하고, 이 때 registerUser 내용에 userInfo.\_id 정보를 전달
        - 친구 요청 수신 이벤트를 추가해 새로운 친구 요청이 들어오면 알림을 받을 수 있도록 구성
      - disconnect 액션 구성
        - socket이 유효한지 확인
        - 유효한 경우, disconnect를 실행시키고 socket은 null로 초기화시켜 소켓 연결 해제시킴
  - 추가한 내용들 중에서 친구 요청 시에 알림이 전송되는 부분은 미완성이라서 테스트를 해 볼 수 없었고, 로그인 시에 socket에 연결되는 부분은 문제없이 작동하는 것을 확인할 수 있었다.
    - 로그인 시에 socket 연결이 되긴 하지만, 새로고침하면 다시 연결되지 않고 토큰이 새롭게 갱신되어야 재연결되는 것을 확인
    - 새로고침하면 다시 재연결이 되어야 하지만, 어딘가에 빼먹은 내용이 있어서 정상적으로 처리가 되지않고 연결 메시지가 뜨지 않기 때문에, 다른 액션에 getState를 추가해 connect 내용을 직접 연결해 추가 확인을 해 봐야 한다.
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/62d4928639882d049f588e0f84571be5d7149606)

# 오늘 느낀 점

- 로그인 시에 바로 친구 목록이 보여지도록 하는 부분은 문제없기 때문에 더 이상 수정할 필요가 없고, 로그인하면 socket에 연결되는 것도 문제가 없긴 하지만, 한번 연결된 후에 새로고침하면 연결이 풀려버리고, 토큰이 재생성되어야 연결이 다시 되기 때문에 이 부분은 추가 확인이 필요하다. 친구 요청 알림 관련 내용은 아직 미완성 상태라서 제대로 테스트해 보지 못했는데, 구성한 코드를 다시 살펴본 결과 더 다듬고 수정해야 테스트가 가능할 것 같다. 앞에서 채팅 관련 내용을 위해 socket 구성한 내용이 있어서 조금만 내용을 추가하면 쉽게 연결하고 실시간 반영이 되는 내용을 구현할 수 있지 않을까 생각했으나, 구조도 그렇고 생각보다 신경 쓸 부분이 많아서 제대로 로직을 구성하고 테스트해 보지 못했는데, 좀 더 내용을 구성한 후에 확실하게 테스트해 확인해 봐야 할 것 같다. 그리고 socket을 하나의 Zustand에서 관리해 로그인 시에 연결되고 로그아웃 시에 해제되는 방식과 그냥 각 채팅, 친구 관련된 Zustand에서 필요할 때만 연결되고 끊어지는 방식 중에서 고민중인데, 아직 확실하게 정하지 못했기 때문에 이 내용에 대해 간략하게 정리하고 비교해 확실하게 정해야 할 것 같다.

<br />

# 내일 할 일

- 실시간 통신 애플리케이션 (Float Chat) 프로젝트 진행

- Zustand 내용 구성

- 친구 관련된 내용을 좀 다듬어야 함 (코드를 깔끔하게 보이도록 수정 필요)

- 친구 목록 출력 및 추가된 친구와 대화를 나눌 수 있는 다이렉트 채팅방

- 그룹 채팅방 초대하는 기능

<br />

# 앞으로 해야 할 일

- React, TypeScript 공부

- React 상태 관리 도구인 Zustand 공부

- 실시간 통신 애플리케이션 프로젝트 제작
