# 오늘 한 일

### JS 토이 프로젝트 제작 (JS, ExpressJS, MongoDB로 만드는 게시판 + EJS)

- 게시판 제작 진행 과정

  - mongodb 연결
    - 어이없게도 `MongoClient.connect("mongodb:127.0.0.1:27017");`에서 127.0.0.1 앞에 `//`를 빼먹어서 서버가 연결되지않음 항상 확인하는 습관 필요
    - ex) `MongoClient.connect("mongodb://127.0.0.1:27017");`
  - 게시글이 없는 경우 보여주는 텍스트 css 수정
    - 게시글이 없을 때 텍스트를 따로 추가를 해놓았는데 너무 볼품없어서 간단하게 css 추가
  - create-post의 form을 수정해 데이터가 전달되도록 변경
    - form에서 method, action을 추가해 데이터를 전송
      - method
        - 폼 데이터를 전송하는 방식을 지정하는데 사용한다.
        - GET, POST
      - method에서 POST
        - HTTP 요청 본문에 담아서 전송
        - HTTP 요청 페이로드(body)에 데이터를 전송
        - 더 많은 양의 데이터를 전송할 때 주로 사용
        - 이 방식은 URL에 데이터가 노출되지 않기 때문에 보안성이 높고, 전송할 수 있는 데이터의 크기에 제한이 없다.
        - 로그인, 회원가입 등 보안에 큰 이슈가 있는 요청에 주로 사용된다.
      - method에서 GET
        - 폼 데이터를 URL의 일부로 보내며, URL이 웹 서버로 전송된다.
        - 이 방식은 URL의 길이 제한 때문에 보통 폼 요소들 중에서 몇 개의 항목만 전송할 때 사용된다.
        - 주로 브라우저의 주소창이나 링크를 클릭해 페이지를 이동하는 경우 사용한다.
        - 이 때, 전달하는 데이터는 주소 뒤에 `?`를 붙이고 `key=value` 형태로 전달된다.
        - 이러한 데이터 전달 방식은 URL이나 브라우저 기록에 남아있어 보안성이 떨어진다.
        - GET 메서드는 데이터 크기가 작거나, 검색 등과 같이 보안에 큰 이슈가 없는 요청에 주로 사용된다.
        - 사용하면 `query`라는 이름으로 전달되어, 전달된 검색어는 서버에서 URL의 쿼리스트링 파라미터로 받아서 사용할 수 있다.
      - action
        - 폼이 전송될 URL을 지정하는 데 사용된다.
        - 예로, 폼의 전송 버튼이 클릭되면, 이 URL로 데이터가 전송된다.
        - action 속성의 값은 서버측 파일(ex: PHP, node.js)의 주소가 된다.
        - ex) `action="/posts"`
    - form의 label-for, input-id를 속성값이 일치하게 만들고, input의 name 추가
  - date가 ISO 표준으로 date로 저장되는 부분을 수정
    - form을 통해서 데이터가 mongodb에 저장되고, 그 데이터가 게시글 목록에서 보여지는데 date 부분이 `ISODate("2023-04-17T18:45:51.493Z")` 이런식으로 저장되어 그 상태로 게시글 목록에서 그대로 보여지게되면 가독성도 떨어지고, 게시글의 css가 망가지게되어 기존의 JS 게시판 제작할 때 사용한 방법으로 바꿔주었다.
    - 기존에 `date: new Date()` 이렇게 기본으로 newPost로 mongodb에 저장하면 ISO를 기준으로 저장이 된다.
    - 그래서 따로 `let date = new Date()` 변수를 선언해준다.
    - 그 다음 newPost의 date에 들어가는 부분을 `date:${date.getFullYear()}.${date.getMonth() + 1}.${date.getDate()}` 이렇게 수정해주면서 날짜가 XXXX.XX.XX 이렇게 나오게 구성해주었다.
    - 위의 예시 코드에서 `${date.getFullYear()}~` 이 부분에 백틱으로 감싸주는 코드를 보여줘야하나 markdown에서 백틱은 강조되는 표현으로 쓰여서 추가하지 못함 (참고)
  - num이 null로 저장되는 부분을 수정

    - form의 데이터가 입력되고 db에 저장될 때 num은 자동으로 1부터 시작해 게시글이 하나씩 추가 될 때마다 1씩 증가하는 형태가 되어야하는데 form에서는 따로 num을 입력하는 input이 없어 데이터를 전송해도 num 값이 없어 자동으로 null이라는 값이 들어가게 된다.
    - 그래서 먼저 마지막 게시글을 불러와서 그 num 값을 확인하고, 삼항연산자 ? 와 :를 사용해 마지막 게시글이 존재한다면 마지막 게시글의 num 값에 +1을 해주고, 만약 존재하지 않는다면 1이라는 값을 넣어주도록 하였다.
    - 여기서 sort: {num:-1}을 해주면서 내림차순 정렬해 마지막 게시글의 번호가 가장 큰 숫자가 최상위 문서가 되도록하여 findOne이 조건을 만족하는 문서중 최상위 문서를 반환해 확인해 처리

    ```
    const lastPost = await db
    .getDb()
    .collection("posts")
    .findOne({}, { sort: { num: -1 } });

    let num = lastPost ? lastPost.num + 1 : 1;
    ```

- 게시판 제작 진행 다음 목표

  - 게시판 구성에 필요한 ejs 파일의 몇개만 구성을 해놓았는데 모든 세부 구성은 하지 않더라도 기본 틀은 가져와서 구성을 해놓아야 한다고 생각 중
    - 현재 게시글 목록, 게시글 생성, 게시글 내용까지는 기존의 게시판에서 가져와서 ejs형식으로 바꿔서 구성하였고, 잘 작동중
    - 가져와야하는 남은 페이지는 게시글 수정하는 html만 가져오면 될 것 같다.
    - 추가해놓은 ejs파일 중 구성 해야하는 파일은 404, 500 ejs파일을 구성해야한다.
  - 근데 여기서 생각해봐야할 부분 페이지네이션, 그리고 기존에 게시판에서 DOM으로 생성했던 그 게시글을 보여주는 div들을 ejs에서 구성을 해놓고 보여줄 것 인지 아니면 그 부분을 생각해보아야 함
    - 이 부분은 DOM으로 생성했던 게시글을 보여주는 div들은 단순하게 키를 만들어 가져와 ejs파일에서 사용해서 보여주도록 함.
    - 페이지네이션 기능은 조금 더 생각해보아야함 차근차근 순서대로 진행해야하기 때문
    - 페이지네이션은 먼저 게시글부터 구성을 하고 그 다음 생각
  - DOM을 사용하지 않고, ejs에서 구성을 해놓는 쪽으로 일단 생각 중
  - 필요하다면 따로 js 파일을 만들어서 DOM을 추가할 생각도 구상 중
  - 조회 수 추가하는 부분도 해결해야 함

<br />

# 오늘 느낀 점

- 기존에 router를 구성하고 db 연결이 되지 않았을 때 연관되는 middleware 함수가 추가되지않아서 문제가 발생한줄 알았으나, 2가지 실수를 해서 문제가 발생한건데 첫 번째는 db연결에서 `//`를 빼먹어서 db에 연결이 되지않은 것이고, 두 번째는 `module.exports = router`를 해주지않아서 작성한 router들이 middleware를 통해 추가해도 작동하지 않았던 것이다. 간단한 오류지만, 신경쓰지않으면 쉽게 생길 수 있는 오류이기 때문에 항상 신경을 써야한다고 다시 한번 느꼈다.

- 기존의 JS에서는 form을 전송하는 이벤트리스너를 추가해서 작업을 하였는데 expressjs에서는 method와 action을 추가해 따로 이벤트리스너를 추가하지않고, button 태그를 통해 자동으로 form 데이터가 전송되도록 하였다. 문득 궁금해진게 expressjs에서는 이벤트 리스너처럼 동작을 추가하지 않는지 궁금해서 chatgpt에게 물어보았는데, expressjs에서는 form 요소를 사용해 데이터를 전송하는 경우, JS를 사용해 버튼에 대한 이벤트 리스너를 추가할 필요 없이 HTML의 기본 동작에 따라 자동으로 동작한다고 하였다.

- 추가로 JS에서 expressjs처럼 form에서 method, action 속성을 추가해서 작업할 수 있는지도 물어보았는데 가능하다는 답변을 받았다. XMLHttpRequest 객체나 fetch API를 사용해 form 데이터를 서버로 전송할 수 있다고 하였다. 예시들도 보았는데 XMLHttpRequest 객체를 통한 방식은 좀 복잡해보였고, fetch API를 사용한 방식은 그래도 좀 간단해 보이기도 하였다. 하지만 두 방식보다 이벤트 리스너를 통한 방식이 훨씬 코드의 가독성도 좋아보이고, 추가적인 동작도 할 수 있다고 생각이 되어 JS에서는 이벤트 리스너를 사용한 방식이 좋아보인다.

- date를 저장하는 방식은 앞으로 기존에 만들어 놓은 방식을 조금씩 변형해서 사용할 거 같은데 저 방식이 간단하고 보여지는 부분에서도 깔끔해보이고, 또 코드도 추가로 가독성 떨어지게 할 필요없이 간단하다고 생각이 되어서 필요할 때 가져와서 사용할 생각이다.

- num은 숫자로 자동 저장이 되도록 처음부터 생각을 해야했는데 input으로 따로 추가하는게 아닌 게시글이 추가될 떄 자동으로 생성되도록 해야했으나, 그 부분을 생각하지 않고 그냥 db에 일단 저장이 되는 것만 생각해놓친 실수라고 생각이 된다. 뭔가 나 혼자서 추가를 하려고 했는데 JS가 아닌 expressjs 즉, 백엔드에서 생성을 해서 함께 추가되고, 그 다음 게시글에서 1씩 늘어나도록 하는 부분이 혼자서 머릿속으로 구상이 잘 되지않아서, chatgpt의 도움을 받았는데 sort와 num:-1을 사용해 데이터를 역순으로 정렬해 검색하는 부분도 감탄했고, 삼항 연산자를 사용해 처리하는 방법도 놀라웠다. 단순하게 나는 JS로 게시판을 제작할 때 시작은 1 그 다음 게시글부터 +1이 되도록 하였는데 여기서는 최신 게시글을 기준으로 존재한다면 +1 존재하지 않는다면 1로 설정해 처리한다는게 조금 놀라웠다. 아직도 배울 부분이 많고, chatgpt가 막힌 부분에서 도움을 줄 수 있다는게 정말 좋다고 생각되었다.

<br />

# 내일 할 일

- JS, ExpressJS, MongoDB로 게시판 제작 + (EJS)

<br />

# 앞으로 해야 할 일

- Advanced-js(고급 JS)에 대해 공부하며 이해하기 (JS 공부)

- Python으로 웹 스크래퍼 만들어보기

- Python, PHP 공부할 거 찾아보기

- Python 셀레니움, 브라우저 드라이버에 대해 한번 찾아보기

- Python 데이터 분석도 한번 봐보기
