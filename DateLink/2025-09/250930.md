# 오늘 한 일

### React + TypeScript 프로젝트 제작 (React, TypeScript, ExpressJS, MongoDB로 만드는 실시간 통신 애플리케이션)

- react strict mode 주석 처리 및 채팅 목록 내의 스크롤 관련 플래그 조건부 추가 테스트
  - 개발 모드에서 의도적으로 useEffect를 두 번 실행시키고 있기 때문에 해당 내용을 주석 처리해 테스트하고, 채팅 목록 내의 메시지 추가 관련 useEffect에 플래그 조건부를 추가해 채팅방 들어갔을 때와 메시지 추가했을 때 실행 관련 내용 테스트
  - 프론트엔드
    - main
      - strict mode 관련 내용 주석 처리
    - Chats
      - Zustand에서 shallow를 불러오도록 구성
      - Zustand에서 불러오는 chatData, messages, lastReadMessage, saveLastReadMessageId 상태 모두 주석 처리하고 각각 변수로 따로 구성
        - 각각 변수로 구성하고 ex) `useChatStore((state) => state.chatData)` 이런 방식으로 구성
          - 추가한 내용들 모두 제대로 작동하는지 의문
        - messages 내용만 `useChatStore((state) => state.messages, shallow)` 이런식으로 구성해 shallow 내용을 추가
          - shallow 내용을 테스트하려고 추가했으나, 타입 에러가 계속 발생하고 제대로 작동하지 않는 것 같음
      - initialMessageCount useRef 주석 처리
      - prevMessagesLength useRef 추가 및 주석 처리
        - number로 타입 정의
        - messages.length, 0으로 초기값 구성한 내용 2개 추가
      - firstRender useRef 추가
        - boolean으로 타입 정의
        - 초기값을 false로 구성
      - 채팅방 이동 시에 작동하는 useEffect 수정
        - `firstRender.current = true`를 추가해 firstRender useRef를 true로 업데이트하도록 구성
      - 채팅방 입장 시에 마지막으로 읽은 메시지 ID를 불러와 스크롤 위치 조정하는 useEffect 주석 해제
      - 이전에 테스트한 useEffect 주석 처리
        - 메시지 추가 시에 작동하는 useEffect 내용들 주석 처리하고 다시 추가해 테스트
      - 메시지 추가 시에 작동하는 useEffect 수정
        - firstRender.current, currentUser를 확인하는 콘솔 로그 추가
        - `firstRender.current`가 true일 때 작동하는 조건부 추가
          - firstRender.current를 false로 업데이트하고 return을 통해 멈추도록 구성
        - `isAtBottom || currentUser || nearBottom`를 확인하는 조건부 추가
          - 스크롤을 최하단으로 이동하는 함수 추가
          - 새로운 메시지, 최신 메시지 버튼 보이지 않도록 구성
          - else를 추가해 새로운 메시지 버튼이 보이도록 구성
  - 채팅 목록 내의 메시지 추가 관련 useEffect에 플래그 조건부를 추가하고 개발 모드에서 useEffect가 두 번씩 실행되는 내용을 막기 위해 관련 내용을 주석 처리해 확인한 결과, Strict Mode를 주석 처리했음에도 여전히 useEffect가 2번씩 실행되는 문제가 발생해 플래그 조건부가 통과되어 생각한 의도와 다르게 작동하는 것을 확인할 수 있었다.
    - Strict Mode를 주석 처리하면 useEffect가 한 번만 실행되어 플래그 조건부가 문제없이 실행될 것으로 예상했으나, Strict Mode가 아닌 다른 컴포넌트나 Zustand에서 구성된 내용들이 useEffect를 여러번 실행시키고 있기 때문에 이 부분만 확인을 해보고, 이걸 해결하지 못하면 적당히 타협해 간단한 스크롤 로직으로 다시 되돌릴 생각임
    - useEffect가 두 번씩 실행되는 것을 막기 위해 Zustand에서 shallow도 추가했으나, 이 내용은 타입 에러가 계속 발생하며 정상적으로 작동하는지도 의문이기 때문에 삭제 예정
    - 임시 방편으로 메시지 갯수를 저장해 확인하는 내용을 사용하고, 클린업 함수로 이전 채팅방 갯수를 초기화하는 로직을 구성하는 쪽으로 생각중
    - 로컬 스토리지에 저장하고 불러와 사용하는 내용 모두 삭제해야 함
    - 새로운 메시지 버튼, 최신 메시지 버튼 등 위치 및 CSS 수정 필요
    - 그룹 채팅방 삭제 시에 마지막 메시지 관련 내용도 함께 삭제되도록 구성해야 함 (다이렉트 채팅방은 사실상 삭제가 아닌 나가기만 적용되기 때문에 굳이 필요없을 것으로 생각됨)
    - 그룹 채팅방 초대 알림 배경색 변경 필요, 아마도 새로운 메시지 추가 같은 알림도 색 변경 필요할 것으로 예상됨
    - 로그인, 회원가입 페이지 배경색을 변경하거나 인터렉티브한 내용은 테스트해봐도 만족스러운 결과를 얻지 못해서 추가 수정 필요
    - 로그인, 회원가입 페이지 배경에 이미지를 넣어서 좀 더 자연스럽게 보여지도록 수정해봐야 함
    - 정리해야 할 내용은 정리하고 채팅 목록과 관련된 스크롤 관련 기능을 수정해봐야 함
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/250823572a305cdb9badaaded49d843b1ee69086)

# 오늘 느낀 점

- 마지막으로 생각한 방법을 테스트했으나, useEffect가 여러번 실행되는 것을 막지 못해 결국 생각한대로 구성을 하지 못했다. useEffect가 Strict Mode로 인해 여러번 실행되는 것이 문제가 된다고 생각해 해당 내용을 주석 처리해봤으나, 이 내용을 주석 처리해도 다른 부분에서 useEffect를 두 번 실행시키기고 있었으며 그 부분을 찾아서 해결해보려 했으나 어느 위치에서 useEffect를 두 번 실행시키는지 찾지 못해 결과적으로 해결을 하지 못한 상황이다. 그래서 채팅 목록 컴포넌트와 관련 Zustand 내용을 한 번 다시 살펴보고 useEffect가 어느 내용으로 인해 두 번 실행되는지 테스트가 필요하며, 이 내용을 해결한다면 플래그 조건부 내용도 문제없이 작동될 것으로 생각되기에 해당 문제만 확인해보고 해결되지 않는다면 적당한 타협으로 스크롤 로직 관련 구성을 마무리할 생각이다.

<br />

# 내일 할 일

- 실시간 통신 애플리케이션 (Float Chat) 프로젝트 진행

- Zustand 내용 구성

- 닉네임 수정과 그룹 채팅방 제목 수정 내용에서 사용하지 않거나 필요없는 정보를 삭제해 코드 정리를 해야 함 (중복된 데이터 전송이나 사용하지 않는 데이터 전송 관련 내용 등)

- 그룹 채팅방에서 다른 사용자를 클릭할 수 있고, 클릭 시에 다이렉트 채팅방이 생성되어 채팅을 나눌 수 있도록 구성하는 것을 고려중 (이 방법 대신, 다른 사용자 클릭 시에 프로필이 보여지도록 구성하고 그 내용을 통해 다이렉트 메시지를 보내거나 프로필 내용을 보는 그런 방식으로 구성해야 함)

- 출력되는 채팅 메시지 목록에 스크롤 관련 내용을 추가 수정해야 함

- 채팅 입력창에 적용된 스크롤 기능 추가 수정 필요

- 다이렉트 채팅방 목록이 정렬될 때 부드럽게 위로 올라가고 내려가는 CSS 적용 필요

- 친구 관련된 내용에서 코드 정리 필요 (코드를 깔끔하게 보이도록 수정 필요)

- 여러 Zustand에 구성된 실시간 반영 로직들이 재사용될 수 있도록 커스텀 훅에 옮겨서 구성하는 것을 고려해야 함

<br />

# 앞으로 해야 할 일

- React, TypeScript 공부

- React 상태 관리 도구인 Zustand 공부

- 실시간 통신 애플리케이션 프로젝트 제작
