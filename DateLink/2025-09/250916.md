# 오늘 한 일

### React + TypeScript 프로젝트 제작 (React, TypeScript, ExpressJS, MongoDB로 만드는 실시간 통신 애플리케이션)

- 채팅 목록 내의 마지막 메시지 ID 관련 내용 테스트 로직 추가
  - 보고 있는 화면 내의 채팅 목록에서 마지막에 보여지는 메시지 ID를 콘솔에 띄워서 출력될 수 있도록 테스트 로직 추가
  - 프론트엔드
    - Chats
      - messageRefs useRef 추가
        - 초기값은 객체로 구성
        - 타입은 "Record<string, HTMLDivElement | null>"로 구성
      - lastReadMessageId useState 삭제
      - 스크롤 마지막에 보여지는 메시지 \_id를 확인하는 테스트용 useEffect 추가
        - container 변수 추가
          - "chatContainerRef.current"로 구성
          - container가 유효한지 확인하는 조건부 추가
        - handleScroll 변수 추가
          - messagesInView 변수 추가
            - "messages.filter((msg) => {...}
            - 메시지 배열을 돌면서 현재 DOM에 존재하는 메시지 엘리먼트가 화면에 보이는지 확인
            - el 변수 추가
              - "messageRefs.current[msg._id]"
              - 각 메시지 DOM 요소를 참조하는 ref
            - rect 변수 추가
              - "el.getBoundingClientRect()"
              - 메시지 요소의 브라우저 뷰포트 내 위치 정보를 가져옴
              - rect.top은 요소의 상단이 뷰포트 위에서 얼마나 떨어져 있는지 확인
              - rect.bottom은 요소의 하단이 뷰포트 위에서 얼마나 떨어져 있는지 확인
            - "rect.bottom <= window.innerHeight"
              - 메시지 하단이 현재 화면 높이보다 위에 있으면 true
                - 이미 화면 안에 있는 것을 확인
              - 완전히 화면 안에 들어온 메시지만 필터링
          - "if (messagesInView.length === 0) return"
            - 화면에 보이는 메시지가 없으면 더 이상 처리하지 않고 종료하도록 구성
          - lastVisibleMessageId 변수 추가
            - "messagesInView[messagesInView.length - 1].\_id"
            - 보이는 메시지들만 모아놓은 배열
            - 해당 배열 마지막 요소 \_id를 가져오도록 구성
            - 화면에 보이는 마지막 메시지의 ID를 찾는 내용
          - 테스트 로직이라서 결과 확인용 콘솔 로그 추가
            - 화면에 마지막으로 보여지는 메시지 ID라는 문구와 함께 마지막 메시지의 \_id를 출력
        - 이벤트 등록 및 해제 관련 내용 추가
          - "container.addEventListener("scroll", handleScroll)"
            - 스크롤 이벤트가 발생하면 handleScroll 함수 실행
          - "return () => container.removeEventListener("scroll", handleScroll)"
            - useEffect cleanup에서 이벤트를 제거해 메모리 누수 방지
        - 의존성 배열로 messages를 추가
      - 이전에 사용하던 useEffect 주석 해제
      - JSX 코드 내용 수정
        - 메시지 목록 배열에 div에 ref 추가
          - "(el) => (messageRefs.current[message._id] = el)"
          - 렌더링된 각 메시지의 DOM을 messageRefs에 ID 기준으로 저장
  - 사용자가 보고 있는 채팅 목록에서 마지막으로 보여지는 메시지 ID가 콘솔에 띄워져 출력되도록 내용을 구성하고 확인한 결과, 사용자가 채팅방에 참여해 현재 화면에서 마지막으로 보여지는 메시지 ID가 콘솔에 보여지는 것을 확인했고, 스크롤을 이동해 마지막으로 보여지는 메시지가 달라진 상황에서도 마지막 메시지 ID가 콘솔에 보여지는 것을 확인할 수 있었다.
    - 마지막 메시지를 감지하는 내용이 정확하게 감지하는 것이 아닌, 약간의 오차가 있긴 하지만 그래도 생각한대로 동작하고 있기 때문에 여기에 Zustand와 백엔드 라우터를 구성해 DB에 마지막 메시지 ID를 저장할 수 있도록 구성해봐야 함
    - 새로고침했을 때 마지막 메시지를 보낸 사용자만 스크롤이 최하단에 위치하고 다른 사용자는 스크롤이 최상단에 위치하기 때문에 이에 대한 추가 수정이 필요함
    - 로그인, 회원가입 페이지 배경색을 변경하거나 인터렉티브한 내용은 테스트해봐도 만족스러운 결과를 얻지 못해서 추가 수정 필요
    - 로그인, 회원가입 페이지 배경에 이미지를 넣어서 좀 더 자연스럽게 보여지도록 수정해봐야 함
    - 정리해야 할 내용은 정리하고 채팅 목록과 관련된 스크롤 관련 기능을 수정해봐야 함
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/c9aa3da1c5cafea5366db0f21a2416b66c9901de)

# 오늘 느낀 점

- 사용자가 채팅방에 참여하고 화면에서 보여지는 마지막 메시지 \_id 정보가 콘솔에 보여질 수 있도록 구성하고, 스크롤로 이동해 마지막 메시지가 변경되는 것도 모두 감지되어 콘솔에 출력되는 것까지 모두 확인을 했기 때문에, 해당 정보가 Zustand 그리고 백엔드를 통해 DB에 저장되도록 내용을 구성해봐야 한다. 마지막 메시지를 감지하는 내용이 약간의 오차가 있긴 하지만 크게 문제될 정도는 아니라고 생각되어 이대로 진행을 할 생각이고, 백엔드에서 마지막 메시지 \_id를 저장할 때 사용자 \_id와 참여한 채팅방 \_id 정보도 함께 저장해 데이터가 확실하게 구분되도록 구성을 해봐야 할 것 같고, 스크롤을 지속적으로 이동하면 마지막 메시지가 매번 달라지는데 이 때 스크롤이 이동할 때마다 마지막 메시지 \_id가 전송되어 업데이트되는 구조가 아닌, 스크롤이 멈춘 후 그 때 마지막 메시지 \_id가 전송되는 구조로 내용을 구성해볼 생각이다.

<br />

# 내일 할 일

- 실시간 통신 애플리케이션 (Float Chat) 프로젝트 진행

- Zustand 내용 구성

- 닉네임 수정과 그룹 채팅방 제목 수정 내용에서 사용하지 않거나 필요없는 정보를 삭제해 코드 정리를 해야 함 (중복된 데이터 전송이나 사용하지 않는 데이터 전송 관련 내용 등)

- 그룹 채팅방에서 다른 사용자를 클릭할 수 있고, 클릭 시에 다이렉트 채팅방이 생성되어 채팅을 나눌 수 있도록 구성하는 것을 고려중 (이 방법 대신, 다른 사용자 클릭 시에 프로필이 보여지도록 구성하고 그 내용을 통해 다이렉트 메시지를 보내거나 프로필 내용을 보는 그런 방식으로 구성해야 함)

- 출력되는 채팅 메시지 목록에 스크롤 관련 내용을 추가 수정해야 함

- 채팅 입력창에 적용된 스크롤 기능 추가 수정 필요

- 다이렉트 채팅방 목록이 정렬될 때 부드럽게 위로 올라가고 내려가는 CSS 적용 필요

- 친구 관련된 내용에서 코드 정리 필요 (코드를 깔끔하게 보이도록 수정 필요)

- 여러 Zustand에 구성된 실시간 반영 로직들이 재사용될 수 있도록 커스텀 훅에 옮겨서 구성하는 것을 고려해야 함

<br />

# 앞으로 해야 할 일

- React, TypeScript 공부

- React 상태 관리 도구인 Zustand 공부

- 실시간 통신 애플리케이션 프로젝트 제작
