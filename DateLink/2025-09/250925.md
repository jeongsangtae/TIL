# 오늘 한 일

### React + TypeScript 프로젝트 제작 (React, TypeScript, ExpressJS, MongoDB로 만드는 실시간 통신 애플리케이션)

- 채팅 목록 내의 스크롤 로직 관련 내용 정리
  - 현재 구성한 내용
    - 채팅방 입장 시에 작동하는 스크롤 내용
      - 채팅방에 입장해 마지막으로 읽은 메시지 ID 내용을 확인하고 있을 경우, 해당 위치로 스크롤 이동
      - 마지막으로 읽은 메시지 ID 내용이 없을 경우, 스크롤을 최하단으로 이동시키도록 구성
      - 추가로 마지막 메시지를 보낸 사용자도 마지막으로 읽은 메시지 ID 내용을 기반으로 스크롤 위치가 조정되도록 채팅 메시지 갯수를 확인하는 조건부를 함께 구성
    - 스크롤 위치를 최하단에 가깝게 놔둘 경우
      - 최신 메시지 버튼이 보여지며, 사용자 본인이 새로운 메시지를 추가하거나 다른 사용자가 메시지를 추가하면 스크롤이 최하단으로 이동되도록 구성
    - 스크롤 위치를 최하단 근처가 아닌 일정 높이이상 위로 올렸을 경우
      - 스크롤이 일정 거리를 벗어나면, 최근 메시지 버튼이 보여지며 다른 사용자가 새로운 메시지 추가해도 스크롤이 최하단으로 이동하지 않도록 구성
      - 사용자 본인이 새로운 메시지를 추가하면 스크롤이 최하단으로 이동하도록 구성
      - 다른 사용자가 새로운 메시지를 추가하면 최근 메시지 버튼 대신 새로운 메시지 버튼이 보여지도록 구성
    - 스크롤 위치가 최하단에 있을 경우
      - 최신 메시지 버튼은 보이지 않고, 사용자 본인 또는 다른 사용자가 새로운 메시지를 추가하면 스크롤이 그대로 최하단에 유지되며 새로운 메시지가 보여지도록 구성
    - 스크롤 이동 시에 작동하는 내용
      - debounce 패턴을 함께 구성해 스크롤이 움직일 때마다 마지막으로 읽은 메시지 ID가 전달되지 않고, 스크롤이 멈추고 일정 시간 이후에 마지막 메시지 ID가 전달되도록 구성
  - 미흡한 내용
    - 채팅방 입장 시에 작동하는 스크롤 내용
      - 마지막 메시지를 보낸 사용자의 경우 스크롤을 위로 올려서 마지막으로 읽은 메시지 ID를 저장해도 채팅방에 입장하면 최하단으로 이동되는 문제가 발생
        - 해당 문제를 해결하기 위해 채팅 메시지 목록 갯수를 저장해 초기 채팅방에 들어오면 갯수 내용이 적거나 일치할 때 return으로 하위 조건부가 실행되지 않도록 구성해 조치
        - 해당 조치로 마지막 메시지를 보낸 사용자도 초기 채팅방 접근 시에는 마지막으로 읽은 메시지 ID 위치로 스크롤이 이동하지만, 이후에 다른 채팅방을 다녀오면 채팅 메시지 목록 갯수가 덮어씌워지는 문제로 다시 스크롤이 최하단에 위치하는 문제 발생
  - 테스트해볼 방법
    - 방법
      - 마지막으로 읽은 메시지 ID를 DB에 저장하는 동시에 로컬 스토리지나 세션 스토리지에 저장하는 방법
        - DB와 로컬 스토리지 또는 세션 스토리지 내용을 병행해 저장
        - 로컬 스토리지 또는 세션 스토리지는 빠르게 접근 가능하고 즉시 복원도 가능
    - 구조
      - 방을 떠날 때 또는 스크롤을 멈추고 마지막으로 읽은 메시지 ID를 전달할 때, 해당 내용을 DB에 저장하며 동시에 로컬 스토리지 또는 세션 스토리지에 저장
      - 방 입장 시 로컬 스토리지 또는 세션 스토리지에서 먼저 불러옴
        - 만약 로컬 스토리지 또는 세션 스토리지에 데이터가 없으면 DB에서 불러오는 구조
      - 사용자 로컬 스토리지 또는 세션 스토리지에서 불러온 마지막으로 읽은 메시지 ID를 조건부로 사용해 스크롤 위치가 조정되는 구조로 생각중
  - 결론
    - 마지막 방법을 시도해보고 해결되지 않는다면 우선, 임시방편으로 사용중인 메시지 목록 갯수 확인하는 조건부 로직을 그대로 유지하고, 추후에 다른 방법을 생각해 다시 수정해봐야 함
    - 현재 카카오톡 같은 방식이 아닌, 디스코드 같은 방식의 스크롤 유지를 구성하려고 하기 때문에 좀 더 어려움을 겪고 있으며, 부족한 부분은 주석을 남겨서 다음에 처리할 수 있도록 하고 다른 내용을 우선으로 구성하는 것에 초점을 둬야 함

# 오늘 느낀 점

- 스크롤 관련 로직에 대해 정리를 하면서 구성한 내용은 무엇이 있는지, 아직 제대로 구현하지 못한 내용은 무엇이 있는지 그리고 제대로 구현하지 못한 내용을 마무리할 것인지 등 여러 내용을 정리한 결과, 여러 방법을 시도해보고 완벽하게 구성하지 못한 내용인 마지막 메시지를 추가한 사용자도 채팅방에 접속하면 마지막으로 읽은 메시지 ID 위치로 스크롤이 이동되는 로직을 생각한 방법으로 테스트해보고 이 방법으로도 해결되지 않는다면 다른 내용으로 넘어갈 생각이다. 너무 오랜시간 안되는 것을 붙잡고 있는 것도 문제가 될 수 있기 때문에 적당히 타협하고 다른 내용을 수정할 생각이며, 만약 가능성이 보인다면 최대한 마무리를 짓고 다른 내용으로 넘어갈 생각이다. 로컬 스토리지 또는 세션 스토리지에 저장하는 방법이 성공할 지 확신은 없지만, 어느정도 가능성도 있다고 생각되어 이 방법을 생각하게 되었고 안되더라도 다른 기능에 큰 문제가 있는 것은 아니기 때문에 추후에 추가로 수정해볼 생각이다.

<br />

# 내일 할 일

- 실시간 통신 애플리케이션 (Float Chat) 프로젝트 진행

- Zustand 내용 구성

- 닉네임 수정과 그룹 채팅방 제목 수정 내용에서 사용하지 않거나 필요없는 정보를 삭제해 코드 정리를 해야 함 (중복된 데이터 전송이나 사용하지 않는 데이터 전송 관련 내용 등)

- 그룹 채팅방에서 다른 사용자를 클릭할 수 있고, 클릭 시에 다이렉트 채팅방이 생성되어 채팅을 나눌 수 있도록 구성하는 것을 고려중 (이 방법 대신, 다른 사용자 클릭 시에 프로필이 보여지도록 구성하고 그 내용을 통해 다이렉트 메시지를 보내거나 프로필 내용을 보는 그런 방식으로 구성해야 함)

- 출력되는 채팅 메시지 목록에 스크롤 관련 내용을 추가 수정해야 함

- 채팅 입력창에 적용된 스크롤 기능 추가 수정 필요

- 다이렉트 채팅방 목록이 정렬될 때 부드럽게 위로 올라가고 내려가는 CSS 적용 필요

- 친구 관련된 내용에서 코드 정리 필요 (코드를 깔끔하게 보이도록 수정 필요)

- 여러 Zustand에 구성된 실시간 반영 로직들이 재사용될 수 있도록 커스텀 훅에 옮겨서 구성하는 것을 고려해야 함

<br />

# 앞으로 해야 할 일

- React, TypeScript 공부

- React 상태 관리 도구인 Zustand 공부

- 실시간 통신 애플리케이션 프로젝트 제작
