# 오늘 한 일

### React + TypeScript 프로젝트 제작 (React, TypeScript, ExpressJS, MongoDB로 만드는 실시간 통신 애플리케이션)

- 채팅방 참여, 나가기 시에 작동하는 액션 이름 변경 및 채팅 목록 내의 초기 메시지 갯수 관련 내용 주석 처리 및 debounce 패턴 시간 수정
  - 채팅방에 참여 또는 나가기 시에 작동하는 액션 이름이 그룹 채팅방 관련된 이름으로 구성되어 있기 때문에 해당 이름을 공통적으로 사용될 수 있도록 수정하고, 채팅 목록 내의 초기 메시지 갯수를 확인하고 조건부로 사용하는 내용 주석 처리, debounce 패턴 작동하는 시간을 조금 더 짧게 수정
  - 프론트엔드
    - socketStore
      - SocketStore 타입 정의 수정
        - joinGroupChat 이름을 joinChatRoom으로 수정
        - leaveGroupChat 이름을 leaveChatRoom으로 수정
      - connect 액션 수정
        - joinGroupChat 액션이 사용되는 부분을 joinChatRoom으로 수정
      - joinGroupChat 액션 이름 joinChatRoom으로 수정
      - leaveGroupChat 액션 이름 leaveChatRoom으로 수정
    - RootLayout
      - useSocketStore Zustand에서 불러오는 leaveGroupChat 액션을 leaveChatRoom로 수정
      - leaveGroupChatHandler 함수 수정
        - leaveChatRoomHandler 함수로 이름을 수정
        - leaveGroupChat 액션 대신 leaveChatRoom 액션이 사용되도록 수정
      - JSX 코드 내용 수정
        - Layout 컴포넌트에 전달하는 props 이름을 onLeaveChatRoom로 수정
          - leaveChatRoomHandler 함수를 전달하도록 수정
    - Layout
      - LayoutProps 타입 정의 수정
        - onLeaveGroupChat이 아닌 onLeaveChatRoom로 수정
      - props로 넘어오는 onLeaveGroupChat 대신 onLeaveChatRoom로 수정
      - JSX 코드 내용 수정
        - onLeaveGroupChat props에 전달하는 onLeaveGroupChat 대신 onLeaveChatRoom로 수정
        - onLeaveGroupChat props 이름도 수정해야 함
    - Chats
      - useSocketStore Zustand에서 불러오는 joinGroupChat, leaveGroupChat 액션을 joinChatRoom, leaveChatRoom로 수정
      - 채팅방을 들어가고 나갈 때 사용하는 useEffect 수정
        - joinGroupChat, leaveGroupChat 액션이 사용되도록 수정
      - 마지막으로 읽은 메시지 ID 내용을 전달하는 useEffect 수정
        - debounce 패턴이 적용되는 시간을 1000에서 500으로 수정
      - 메시지 추가 시에 작동하는 useEffect 수정
        - 메시지 목록 갯수와 초기 메시지 목록 갯수를 확인하는 조건부 관련 내용 주석 처리
          - 콘솔에서 확인하는 내용 포함해 주석 처리
        - 메시지 목록 갯수가 초기 메시지 목록 갯수보다 적거나 같을 때 작동하는 조건부 내용 주석 처리
  - 그룹 채팅방 또는 다이렉트 채팅방에 참여하거나 나갈 때 작동되는 액션 이름이 그룹 채팅방 관련된 이름처럼 보이기 때문에 해당 이름을 좀 더 포괄적으로 사용될 수 있도록 수정하고, 채팅 목록 내의 초기 메시지 갯수 관련된 내용을 모두 주석 처리 및 debounce 패턴 작동 시간을 약간 줄여 스크롤을 멈췄을 때 좀 더 빠르게 반응하도록 구성하고 확인한 결과, 그룹 채팅방만이 아닌 채팅방에 참여하고 나가는 액션인 것을 명확히 알 수 있게 되었고, 채팅 목록 내에서 메시지 목록 갯수 대신 로컬 스토리지에 저장된 마지막으로 읽은 메시지 ID를 기준으로 스크롤 위치 조정하는 것을 테스트해볼 수 있었고, debounce 패턴이 작동하는 시간도 줄어서 스크롤을 멈추면 더 빠르게 DB에 마지막으로 읽은 메시지 ID를 전달하는 것을 확인할 수 있었다.
    - 사이드바에 전달하는 채팅방 나가기 액션 관련 내용 이름도 수정해야 함
    - 로컬 스토리지에 저장된 내용을 불러와 사용하는 내용이 적용되긴 했지만 조건부 로직이 생각한대로 동작하지 않는 것 같아서 추가 수정을 해봐야 함
    - 마지막 메시지를 추가한 사용자가 스크롤을 위로 올린 상태에서 새로고침하거나 다시 로그인해 채팅방에 참여하면 해당 메시지 ID를 기억해 스크롤이 유지되지만, 다른 채팅방을 다녀오면 메시지 갯수 내용이 이전 채팅방 갯수로 저장되면서 조건부가 false가 되고 스크롤이 유지되지 않는 문제가 발생하기 때문에 추가 수정 필요
    - 새롭게 방에 참여했을 때 스크롤이 최하단에 이동하는 것은 문제가 없지만, 마지막 메시지 ID를 활용한 내용이 뭔가 조금 부족한 느낌이 들어서 추가로 확인을 해봐야 함
    - 새로운 메시지 버튼, 최신 메시지 버튼 등 위치 및 CSS 수정 필요
    - 그룹 채팅방 삭제 시에 마지막 메시지 관련 내용도 함께 삭제되도록 구성해야 함 (다이렉트 채팅방은 사실상 삭제가 아닌 나가기만 적용되기 때문에 굳이 필요없을 것으로 생각됨)
    - 그룹 채팅방 초대 알림 배경색 변경 필요, 아마도 새로운 메시지 추가 같은 알림도 색 변경 필요할 것으로 예상됨
    - 로그인, 회원가입 페이지 배경색을 변경하거나 인터렉티브한 내용은 테스트해봐도 만족스러운 결과를 얻지 못해서 추가 수정 필요
    - 로그인, 회원가입 페이지 배경에 이미지를 넣어서 좀 더 자연스럽게 보여지도록 수정해봐야 함
    - 정리해야 할 내용은 정리하고 채팅 목록과 관련된 스크롤 관련 기능을 수정해봐야 함
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/8ffffee2669906312b1137c399060e3c385d0dcf)

<br />

- 채팅 목록 내의 마지막으로 읽은 메시지 ID 내용 로컬 스토리지에 저장하는 로직 테스트 (실패)
  - 채팅 목록 내에서 마지막으로 읽은 메시지 ID 내용을 로컬 스토리지에 저장하는데 이 때 채팅방별로 따로 저장하도록 구성하고, 별도의 useEffect을 추가해 방에 참여하면 로컬 스토리지에 저장된 마지막으로 읽은 메시지 ID 내용을 불러와 스크롤 위치가 조정되도록 구성해 테스트
  - 프론트엔드
    - Chats
      - 마지막으로 읽은 메시지 ID 내용을 전달하는 useEffect 수정
        - 마지막으로 읽은 메시지 ID를 로컬 스토리지에 저장하는 내용 수정
          - 저장하는 이름을 "lastVisibleMessageId-${roomId}"로 수정
          - 채팅방마다 각각 저장되도록 구성
      - 채팅방에 들어갔을 때 새롭게 실행되는 useEffect 추가
        - 채팅방 번호를 확인하는 조건부 추가
        - savedId 변수 추가
          - localStorage.getItem을 사용해 "lastVisibleMessageId-${roomId}" 이름으로 저장된 값을 불러오도록 구성
        - savedId 변수를 확인하는 조건문 추가
          - setTimeout 추가
            - targetEl 변수 추가
              - "messageRefs.current[savedId]"로 구성
            - targetEl를 확인하는 조건문 추가
              - targetEl가 유효한다면 스크롤을 해당 위치에 이동하도록 구성
            - 시간은 0으로 설정
        - 의존성 배열로 roomId를 추가해 구성
      - 메시지 추가 시에 작동하는 useEffect 수정
        - loadLastVisibleMessageId 변수 내용 주석 처리
        - loadLastVisibleMessageId를 조건부로 확인하는 내용 주석 처리
        - loadLastVisibleMessageId 관련 내용을 제거한 조건부로 수정
  - 채팅 목록에서 마지막으로 읽은 메시지 ID 내용을 DB에 전달하면서 로컬 스토리지에 저장하는데 이 내용이 채팅방을 옮겨 다닐 때마다 업데이트되는 문제가 발생하기 때문에 해당 내용을 수정해 채팅방마다 별도로 저장되어 그 내용만 업데이트되도록 구성하고, 별도의 useEffect를 추가해 채팅방 참여 시에 로컬 스토리지에 저장된 내용을 불러와 스크롤이 조정되도록 구성해 확인한 결과, 기대한 것과 달리 생각한대로 작동하지 않은 것을 확인할 수 있었다.
    - 이 방법도 안되면 다음 내용으로 넘어가려고 했으나, 생각난 방법이 있어서 그 방법을 마지막으로 테스트해보고 넘어갈 예정
    - 사이드바에 전달하는 채팅방 나가기 액션 관련 내용 이름도 수정해야 함
    - 로컬 스토리지에 저장된 내용을 불러와 사용하는 내용이 적용되긴 했지만 조건부 로직이 생각한대로 동작하지 않는 것 같아서 추가 수정을 해봐야 함
    - 마지막 메시지를 추가한 사용자가 스크롤을 위로 올린 상태에서 새로고침하거나 다시 로그인해 채팅방에 참여하면 해당 메시지 ID를 기억해 스크롤이 유지되지만, 다른 채팅방을 다녀오면 메시지 갯수 내용이 이전 채팅방 갯수로 저장되면서 조건부가 false가 되고 스크롤이 유지되지 않는 문제가 발생하기 때문에 추가 수정 필요
    - 새롭게 방에 참여했을 때 스크롤이 최하단에 이동하는 것은 문제가 없지만, 마지막 메시지 ID를 활용한 내용이 뭔가 조금 부족한 느낌이 들어서 추가로 확인을 해봐야 함
    - 새로운 메시지 버튼, 최신 메시지 버튼 등 위치 및 CSS 수정 필요
    - 그룹 채팅방 삭제 시에 마지막 메시지 관련 내용도 함께 삭제되도록 구성해야 함 (다이렉트 채팅방은 사실상 삭제가 아닌 나가기만 적용되기 때문에 굳이 필요없을 것으로 생각됨)
    - 그룹 채팅방 초대 알림 배경색 변경 필요, 아마도 새로운 메시지 추가 같은 알림도 색 변경 필요할 것으로 예상됨
    - 로그인, 회원가입 페이지 배경색을 변경하거나 인터렉티브한 내용은 테스트해봐도 만족스러운 결과를 얻지 못해서 추가 수정 필요
    - 로그인, 회원가입 페이지 배경에 이미지를 넣어서 좀 더 자연스럽게 보여지도록 수정해봐야 함
    - 정리해야 할 내용은 정리하고 채팅 목록과 관련된 스크롤 관련 기능을 수정해봐야 함
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/d44e6f09036c1b28169825be9eedea744a59fbc4)

# 오늘 느낀 점

- 이번에 수정한 내용을 마지막으로 더이상 테스트하지 않으려고 생각했는데, 마지막으로 생각난 조건부 내용이 있어서 그 내용을 테스트해보고 이번에도 생각한대로 동작하지 않으면, 그냥 간단하게 구성해 넘어가고 다음에 다시 구현해볼 생각이다. 현재 생각한 조건부 내용은 마지막으로 읽은 메시지 ID 내용을 확인해 존재할 경우, 마지막으로 읽은 메시지 ID 내용과 마지막 메시지 ID가 동일하면 그대로 스크롤을 바닥으로 이동시키고, 아닐 경우 마지막으로 읽은 메시지 ID 기준으로 스크롤이 유지되도록 조건부를 추가해볼 생각인데, 이 내용이 제대로 적용될 지 조금 걱정이 되며 새로운 메시지를 추가했을 때 어떤식으로 작동하는지 확인이 필요할 것 같다. 해당 방법을 마지막으로 가능성이 보이면 조금 더 테스트해볼 수도 있긴 하지만, 이 조건부 내용도 생각한대로 동작하지 않으면 더이상 테스트하지 않고 다른 내용으로 넘어갈 생각이다.

<br />

# 내일 할 일

- 실시간 통신 애플리케이션 (Float Chat) 프로젝트 진행

- Zustand 내용 구성

- 닉네임 수정과 그룹 채팅방 제목 수정 내용에서 사용하지 않거나 필요없는 정보를 삭제해 코드 정리를 해야 함 (중복된 데이터 전송이나 사용하지 않는 데이터 전송 관련 내용 등)

- 그룹 채팅방에서 다른 사용자를 클릭할 수 있고, 클릭 시에 다이렉트 채팅방이 생성되어 채팅을 나눌 수 있도록 구성하는 것을 고려중 (이 방법 대신, 다른 사용자 클릭 시에 프로필이 보여지도록 구성하고 그 내용을 통해 다이렉트 메시지를 보내거나 프로필 내용을 보는 그런 방식으로 구성해야 함)

- 출력되는 채팅 메시지 목록에 스크롤 관련 내용을 추가 수정해야 함

- 채팅 입력창에 적용된 스크롤 기능 추가 수정 필요

- 다이렉트 채팅방 목록이 정렬될 때 부드럽게 위로 올라가고 내려가는 CSS 적용 필요

- 친구 관련된 내용에서 코드 정리 필요 (코드를 깔끔하게 보이도록 수정 필요)

- 여러 Zustand에 구성된 실시간 반영 로직들이 재사용될 수 있도록 커스텀 훅에 옮겨서 구성하는 것을 고려해야 함

<br />

# 앞으로 해야 할 일

- React, TypeScript 공부

- React 상태 관리 도구인 Zustand 공부

- 실시간 통신 애플리케이션 프로젝트 제작
