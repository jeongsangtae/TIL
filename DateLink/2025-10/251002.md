# 오늘 한 일

### React + TypeScript 프로젝트 제작 (React, TypeScript, ExpressJS, MongoDB로 만드는 실시간 통신 애플리케이션)

- 채팅 목록 내의 useEffect 재실행 확인, 테스트 관련 내용 추가
  - 채팅 목록 내에 구성된 채팅 관련 상태들 내용을 이전에 구성했던 상태로 되돌리고, 여러 useEffect에 확인용 콘솔 로그를 추가 그리고 메시지를 추가하는 useEffect에 메시지 갯수가 0개일 때 종료하도록 구성해 테스트 및 확인
  - 프론트엔드
    - socketStore
      - joinChatRoom 액션 수정
        - current 변수 추가
          - currentRoom 상태를 불러오도록 구성
        - current 변수와 roomId가 일치하는지 확인하는 조건문 추가
          - 같은 방인지 확인하고, 일치하면 이미 입장한 방이라는 메시지를 보여주도록 구성
          - return으로 종료되도록 구성
        - current 변수를 확인하는 조건문 추가
          - socket.emit을 통해 leaveRoom 이벤트에 방 번호를 전달하도록 구성
          - 콘솔 로그로 이전 방 나간 방 번호를 보여주도록 구성
          - set을 통해 currentRoom을 null로 업데이트하도록 구성
    - Chats
      - Zustand에서 shallow를 불러오는 내용 삭제
      - Zustand에서 불러오는 chatData, messages, lastReadMessage, saveLastReadMessageId 상태 모두 주석 해제하고 사용하도록 구성
        - chatData, lastReadMessage, saveLastReadMessageId, messages 내용 모두 삭제
      - 구성된 여러 useEffect에 두 번 실행 확인을 위한 콘솔 로그 추가
        - 채팅방 이동 시에 작동하는 useEffect
        - 채팅 목록을 불러오는 useEffect
        - 마지막으로 읽은 메시지 ID를 저장하는 useEffect
        - 채팅방 입장 후에 마지막으로 읽은 메시지 ID를 확인해 스크롤 위치를 조정하는 useEffect
        - 메시지 추가시에 작동 하는 useEffect
      - 메시지 추가 시에 작동하는 useEffect 수정
        - `if (messages.length === 0) return` 내용을 추가해 메시지 갯수가 0개일 경우 종료되어 이후 조건문이 실행되지 않도록 구성
  - 채팅 목록 컴포넌트에서 불러오는 여러 Zustand 내용을 이전 상태로 되돌리고, 확인을 위한 콘솔 로그를 추가 및 메시지 갯수가 0개일 때 종료되어 이후 조건부가 실행되지 않도록 구성하고, 방 참여와 관련된 액션에 이미 같은 채팅방일 경우 콘솔에 메시지 출력 및 종류되도록 구성해 확인한 결과, 두 번 실행되는 useEffect를 발견하고 메시지 갯수가 0개일 때 뒤 조건부가 실행되지 않는 것을 확인할 수 있었다.
    - 두 번 실행되는 내용을 찾긴 했지만 해당 문제를 해결할 방법을 정확히 찾지 못했기 때문에 마지막으로 생각난 방법을 테스트해볼 예정
    - Strict Mode를 주석 처리하면 useEffect가 한 번만 실행되어 플래그 조건부가 문제없이 실행될 것으로 예상했으나, Strict Mode가 아닌 다른 컴포넌트나 Zustand에서 구성된 내용들이 useEffect를 여러번 실행시키고 있기 때문에 이 부분만 확인을 해보고, 이걸 해결하지 못하면 적당히 타협해 간단한 스크롤 로직으로 다시 되돌릴 생각임
    - 임시 방편으로 메시지 갯수를 저장해 확인하는 내용을 사용하고, 클린업 함수로 이전 채팅방 갯수를 초기화하는 로직을 구성하는 쪽으로 생각중
    - 로컬 스토리지에 저장하고 불러와 사용하는 내용 모두 삭제해야 함
    - 새로운 메시지 버튼, 최신 메시지 버튼 등 위치 및 CSS 수정 필요
    - 그룹 채팅방 삭제 시에 마지막 메시지 관련 내용도 함께 삭제되도록 구성해야 함 (다이렉트 채팅방은 사실상 삭제가 아닌 나가기만 적용되기 때문에 굳이 필요없을 것으로 생각됨)
    - 그룹 채팅방 초대 알림 배경색 변경 필요, 아마도 새로운 메시지 추가 같은 알림도 색 변경 필요할 것으로 예상됨
    - 로그인, 회원가입 페이지 배경색을 변경하거나 인터렉티브한 내용은 테스트해봐도 만족스러운 결과를 얻지 못해서 추가 수정 필요
    - 로그인, 회원가입 페이지 배경에 이미지를 넣어서 좀 더 자연스럽게 보여지도록 수정해봐야 함
    - 정리해야 할 내용은 정리하고 채팅 목록과 관련된 스크롤 관련 기능을 수정해봐야 함
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/ca7562a628dc65c74c5d52b8cc34e2b16d010d2e)

# 오늘 느낀 점

- 두 번 실행되는 useEffect를 찾긴 했지만 한 번만 실행되도록 해결을 하지 못했고, 수정한 내용들로 해결이 되지 않기 때문에 차라리 초기 렌더링 시에 메시지 갯수를 확인해 스크롤 위치를 조정하는 로직을 테스트해볼 생각이다. 채팅방을 옮겨갈 때 이전 메시지 갯수가 적용되어 조건부 로직이 망가지는 문제가 발생하므로 채팅방마다 로컬 스토리지에 메시지 갯수를 저장해 해당 내용을 불러와 사용하는 구조로 구성을 해볼 생각이다. 플래그 관련 내용은 어떤 방법을 사용하던지 두 번 실행되는 useEffect로 인해 해결이 되지 않기 때문에 채팅방마다 메시지 갯수를 로컬 스토리지에 저장하고 불러와 활용하는 방법으로 테스트해볼 생각이다.

<br />

# 내일 할 일

- 실시간 통신 애플리케이션 (Float Chat) 프로젝트 진행

- Zustand 내용 구성

- 닉네임 수정과 그룹 채팅방 제목 수정 내용에서 사용하지 않거나 필요없는 정보를 삭제해 코드 정리를 해야 함 (중복된 데이터 전송이나 사용하지 않는 데이터 전송 관련 내용 등)

- 그룹 채팅방에서 다른 사용자를 클릭할 수 있고, 클릭 시에 다이렉트 채팅방이 생성되어 채팅을 나눌 수 있도록 구성하는 것을 고려중 (이 방법 대신, 다른 사용자 클릭 시에 프로필이 보여지도록 구성하고 그 내용을 통해 다이렉트 메시지를 보내거나 프로필 내용을 보는 그런 방식으로 구성해야 함)

- 출력되는 채팅 메시지 목록에 스크롤 관련 내용을 추가 수정해야 함

- 채팅 입력창에 적용된 스크롤 기능 추가 수정 필요

- 다이렉트 채팅방 목록이 정렬될 때 부드럽게 위로 올라가고 내려가는 CSS 적용 필요

- 친구 관련된 내용에서 코드 정리 필요 (코드를 깔끔하게 보이도록 수정 필요)

- 여러 Zustand에 구성된 실시간 반영 로직들이 재사용될 수 있도록 커스텀 훅에 옮겨서 구성하는 것을 고려해야 함

<br />

# 앞으로 해야 할 일

- React, TypeScript 공부

- React 상태 관리 도구인 Zustand 공부

- 실시간 통신 애플리케이션 프로젝트 제작
