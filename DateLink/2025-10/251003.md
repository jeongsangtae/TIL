# 오늘 한 일

### React + TypeScript 프로젝트 제작 (React, TypeScript, ExpressJS, MongoDB로 만드는 실시간 통신 애플리케이션)

- 채팅 목록 내의 이전 메시지 목록 갯수 정보 로컬 스토리지에 저장 및 이전 메시지 목록 갯수 사용한 조건부 추가
  - 채팅 목록 내에서 마지막으로 읽은 메시지 ID를 저장하면서 이전 메시지 목록 갯수를 로컬 스토리지에 저장하도록 구성하고 저장한 이전 메시지 목록 갯수 관련 로컬 스토리지 내용을 불러와 조건부로 사용하도록 구성 추가
  - 프론트엔드
    - main
      - strict mode 관련 내용 주석 해제
    - socketStore
      - joinChatRoom 액션 수정
        - current 변수 주석 처리
        - current 변수와 roomId가 일치하는지 확인하는 조건부 주석 처리
        - current 변수를 확인하는 조건부 주석 처리
    - Chats
      - 새로운 prevMessagesLength useRef 추가
        - 초기값은 null로 구성
        - 타입은 number 또는 null이 적용되도록 구성
        - 이전에 구성하고 주석 처리한 prevMessagesLength useRef 내용 모두 삭제
      - 주석 처리한 initialMessageCount useRef 삭제
      - 마지막으로 읽은 메시지 ID 전달하는 useEffect 수정
        - 로컬 스토리지에 마지막으로 읽은 메시지 ID 대신 메시지 목록 갯수를 저장하도록 구성
          - 이름을 lastVisibleMessageId에서 prevMessagesLength로 수정
          - "String()"을 추가해 타입 오류가 생기지 않도록 구성
      - 마지막으로 읽은 메시지 ID를 불러와 스크롤 위치 조정하는 useEffect 주석 처리
      - 메시지 추가 시에 작동하는 useEffect 수정
        - loadLastVisibleMessageId 변수 loadPrevMessagesLength로 수정
          - 로컬 스토리지에서 prevMessagesLength 내용을 숫자 형태로 불러오도록 구성
          - "Number"를 추가해 숫자 형태로 불러옴
        - 메시지 목록 갯수가 0보다 크고, prevMessagesLength useRef가 존재하는지 확인하는 조건부 추가
          - prevMessagesLength useRef에 loadPrevMessagesLength 변수 내용이 들어가도록 구성
          - 로컬 스토리지에 저장된 메시지 목록 갯수 불러와 prevMessagesLength useRef에 담는 내용
        - 메시지 목록 갯수, prevMessagesLength useRef에 저장된 메시지 목록 갯수, loadPrevMessagesLength 변수 내용을 확인하도록 콘솔 로그 추가
          - 메시지 추가 시에 작동하는 조건부 내용 뒤에도 추가
        - 메시지 목록 갯수가 loadPrevMessagesLength 변수와 같거나 작을 때를 확인하고, 마지막으로 읽은 메시지 ID가 있는지 확인하는 조건부 추가
          - targetEl 변수를 추가해 마지막으로 읽은 메시지 ID를 통해 해당 메시지 찾도록 구성
          - targetEl 변수가 유효한지 확인하고, 유효할 경우 해당 메시지 위치로 이동시키도록 구성
        - 메시지 목록 갯수가 0개인지 확인하는 조건부 주석 처리
        - firstRender useRef 확인하는 조건부 주석 처리
        - prevMessagesLength useRef 내용에 메시지 목록 갯수를 저장하고, 로컬 스토리지에 저장하는 내용 주석 처리
  - 이전 메시지 목록 갯수를 로컬 스토리지에 저장하고, 메시지 목록을 불러올 때 함께 불러와 조건부를 통해 비교하고 조건이 일치하면 return을 통해 종료시켜 메시지 추가하는 조건부가 실행되지 않도록 구성해 확인한 결과, 완벽하지는 않지만 얼핏 구상한대로 초기에 채팅방 입장하면 로컬 스토리지에 저장된 이전 메시지 목록 갯수를 불러와 조건부를 실행시키고 마지막으로 읽은 메시지 ID 위치에 스크롤이 위치되도록 구성되었으며, 새로운 메시지를 추가하면 스크롤이 최하단으로 이동하는 것을 확인할 수 있었다.
    - 완벽하진 않지만 그래도 생각한 구성대로 얼추 작동하기 떄문에 적당히 타협해 이 상태를 유지할 생각이며, 주석 처리한 많은 내용들 및 테스트를 위해 추가했던 내용들을 삭제해야 함
    - 새로운 메시지 버튼, 최신 메시지 버튼 등 위치 및 CSS 수정 필요
    - 그룹 채팅방 삭제 시에 마지막 메시지 관련 내용도 함께 삭제되도록 구성해야 함 (다이렉트 채팅방은 사실상 삭제가 아닌 나가기만 적용되기 때문에 굳이 필요없을 것으로 생각됨)
    - 그룹 채팅방 초대 알림 배경색 변경 필요, 아마도 새로운 메시지 추가 같은 알림도 색 변경 필요할 것으로 예상됨
    - 로그인, 회원가입 페이지 배경색을 변경하거나 인터렉티브한 내용은 테스트해봐도 만족스러운 결과를 얻지 못해서 추가 수정 필요
    - 로그인, 회원가입 페이지 배경에 이미지를 넣어서 좀 더 자연스럽게 보여지도록 수정해봐야 함
    - 정리해야 할 내용은 정리하고 채팅 목록과 관련된 스크롤 관련 기능을 수정해봐야 함
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/56df0464aff2b434a5194fca1fc8b8326cb36522)

# 오늘 느낀 점

- 로컬 스토리지에 마지막으로 읽은 메시지 ID를 저장하는 것 대신 이전 메시지 목록 갯수를 저장하도록 구성하고, 해당 내용을 불러와 조건부가 실행되어 스크롤 위치가 조정된 다음 종료되어 메시지 추가하는 조건부가 실행되지 않도록 구성한 내용이 완벽하진 않지만 어느정도 생각한대로 동작을 하고 있기 때문에 적당히 타협해 이정도 기능으로 유지할 생각이며, 추후에 또 다른 좋은 방법이 생각나거나 새로운 해결책을 찾는다면 그 때 다시 추가 수정할 생각이다. 이제 스크롤 관련 내용을 마무리해 테스트를 위해 추가했던 코드들을 모두 삭제해야 하고, 새로운 메시지 버튼이나 최신 메시지 버튼 위치나 CSS도 수정해 좀 더 자연스럽게 보이도록 구성할 생각이다.

<br />

# 내일 할 일

- 실시간 통신 애플리케이션 (Float Chat) 프로젝트 진행

- Zustand 내용 구성

- 닉네임 수정과 그룹 채팅방 제목 수정 내용에서 사용하지 않거나 필요없는 정보를 삭제해 코드 정리를 해야 함 (중복된 데이터 전송이나 사용하지 않는 데이터 전송 관련 내용 등)

- 그룹 채팅방에서 다른 사용자를 클릭할 수 있고, 클릭 시에 다이렉트 채팅방이 생성되어 채팅을 나눌 수 있도록 구성하는 것을 고려중 (이 방법 대신, 다른 사용자 클릭 시에 프로필이 보여지도록 구성하고 그 내용을 통해 다이렉트 메시지를 보내거나 프로필 내용을 보는 그런 방식으로 구성해야 함)

- 출력되는 채팅 메시지 목록에 스크롤 관련 내용을 추가 수정해야 함

- 채팅 입력창에 적용된 스크롤 기능 추가 수정 필요

- 다이렉트 채팅방 목록이 정렬될 때 부드럽게 위로 올라가고 내려가는 CSS 적용 필요

- 친구 관련된 내용에서 코드 정리 필요 (코드를 깔끔하게 보이도록 수정 필요)

- 여러 Zustand에 구성된 실시간 반영 로직들이 재사용될 수 있도록 커스텀 훅에 옮겨서 구성하는 것을 고려해야 함

<br />

# 앞으로 해야 할 일

- React, TypeScript 공부

- React 상태 관리 도구인 Zustand 공부

- 실시간 통신 애플리케이션 프로젝트 제작
