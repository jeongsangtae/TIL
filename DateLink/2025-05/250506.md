# 오늘 한 일

### React + TypeScript 프로젝트 제작 (React, TypeScript, ExpressJS, MongoDB로 만드는 실시간 통신 애플리케이션)

- 키 중복 오류 관련 테스트 마무리 및 해결 방법 추가하고 주석 처리
  - 키 중복 오류 관련 테스트를 마무리하고, 프론트엔드와 백엔드에서 키 중복 오류를 해결하는 로직은 따로 주석 처리해 남겨놓고 불필요한 로직들을 삭제
  - 백엔드
    - friend-routes
      - 친구 목록 조회하는 라우터 수정
        - aggregate pipeline을 사용해 테스트한 내용은 주석 처리하고, 기존 데이터인 friends 데이터가 전송되도록 수정
  - 프론트엔드
    - friendStore
      - loadFriends 액션 수정
        - 이전 내용으로 되돌려서 friends 내용을 저장하고 사용하도록 구성
    - DirectChatMainContent
      - toggleFriend useState, 이전에 사용하던 friendToggleHandler 함수 삭제
      - friendToggleHandler 함수 내에서 navigate만 사용되도록 수정
      - JSX 코드 내용 수정
        - 이전에 테스트하던 내용들을 삭제하고, selectedMainContent useState를 통해 내용이 변경되도록 구성
    - Friends
      - useEffect 수정
        - 전체 친구 목록이 보여지는 것이 아닌, 온라인 상태의 친구 목록이 보여지도록 수정
        - 로그인을 하면 전체 친구 목록 대신에, 온라인 상태의 친구 목록이 보여져 키 중복 관련 오류가 보이지 않음
      - filteredFriends 변수에 filter를 추가한 내용 테스트하고 주석 처리
        - `friend.id !== userId`
          - 자기 자신은 친구 목록에 포함시키지 않기 위해 제거
        - `index === self.findIndex((f) => f.id === friend.id)`
          - 중복 제거를 위한 조건으로, 동일한 id를 가진 친구가 앞에 이미 존재한다면 index가 달라지므로 제거됨
          - 결과적으로 중복되지 않은 친구 객체들만 남김
        - 해당 로직으로 로그인한 사용자 id 내용이 친구 목록에 보여지지 않게 됨
      - JSX 코드 내용 수정
        - 테스트를 위해 추가했던 내용을 삭제하고 기존의 내용은 주석 해제
  - 키 중복 관련 에러를 해결하는 로직들은 주석 처리해 남겨놓고, 로그인 시에 전체 친구 목록이 아닌 로그인 상태의 친구 목록이 보여지도록 구성한 결과, 키 중복 오류가 발생하지 않는 것을 확인할 수 있었다.
    - 키 중복 관련 에러에 대해 처리를 했기 때문에, 이제 내부 CSS에 대해 수정을 하거나 로그인하지 않은 상태에서 사이드바에 로그인, 회원가입 버튼이 보여지는 것이 아닌, 다른 페이지를 추가해 로그인할 수 있는 공간이 보여지고 그 페이지에서 로그인하면 메인 내용이 보여지도록 구성하는 방향으로 고려중
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/e109cfd507026d4d327d60d50f92d189e8bfece7)

# 오늘 느낀 점

- 키 중복 오류를 해결하기 위해 여러 방법을 테스트해 본 결과, 프론트엔드에서 filter를 사용해 중복 제거하는 방법 그리고 백엔드에서 aggregate pipeline을 구성해 로그인한 사용자 정보는 제거하고 친구 관련 정보만 남긴 친구 목록 데이터를 프론트엔드로 전달해 해결하는 방법, 마지막으로 임시방편이긴 하지만 로그인 시에 전체 친구 목록이 아닌 로그인 상태의 친구 목록을 보여주는 방법 중에서 로그인 시에 로그인 상태의 친구 목록을 보여주는 방법을 선택했는데, 이유는 사용자가 로그인했을 때 전체 친구 목록이 아닌 온라인 상태의 친구 목록이 보여지도록 하는 것이 더 적절하다고 생각했고, 이 내용으로 구성하면 어차피 키 중복 관련 에러가 발생하지 않기 때문에 다른 처리 방법은 주석 처리를 해 놓은 상황이다. 만약 이후에 비슷한 오류가 발생하거나 리팩토링이 필요하다고 생각되면 filter를 사용한 방법이나, aggregate pipeline을 사용한 방법을 적용해 다시 처리할 예정이며, 현재는 굳이 추가하지 않아도 된다고 생각한다. 그리고 UI 관련 CSS 내용을 추가해야 하는데, 이와 관련해 내용을 추가하기 전에 로그인을 따로 할 수 있는 페이지를 추가해 해당 페이지에서 로그인 또는 회원가입 처리를 하고, 로그인하면 메인 페이지 내용이 보여지도록 구성을 해 볼 생각이다.

<br />

# 내일 할 일

- 실시간 통신 애플리케이션 (Float Chat) 프로젝트 진행

- Zustand 내용 구성

- 로그아웃 버튼 등 여러 버튼들이 텍스트가 아닌 아이콘으로 보여지도록 수정 필요

- 홈으로 이동 시에 친구 버튼과 다이렉트 채팅방 목록이 사이드바 옆으로 보여지고, 친구 버튼 클릭 또는 다이렉트 채팅방 클릭 시에 그 옆으로 해당 내용이 보여지도록 수정 필요

- 그룹 채팅방은 그룹 채팅방에 참여한 사용자 목록이 사이드바 옆으로 보여지고, 그 옆에 채팅 관련 내용이 보여지도록 수정 필요

- 출력되는 채팅 메시지 목록에 스크롤을 추가해 보기 편하도록 변경해야 하고, 메시지가 언제 추가되었는지 구분할 수 있도록 저장된 날짜 데이터를 불러와 표기해야 함

- 채팅 입력창에 적용된 스크롤 기능 추가 수정 필요

- 다이렉트 채팅방 목록이 정렬될 때 부드럽게 위로 올라가고 내려가는 CSS 적용 필요

- 친구 삭제 시에 다이렉트 채팅방 삭제 확인 로직 필요 (친구 삭제 시에 다이렉트 채팅방을 그대로 남겨놓고 삭제 확인창은 따로 추가하지 않을 예정)

- 친구 관련된 내용에서 코드 정리 필요 (코드를 깔끔하게 보이도록 수정 필요)

- 그룹 채팅방 초대하고 알림을 전송하는 기능에서, 로그인한 사용자가 아닌 친구에게 보내는 그런 구조로 작동되도록 수정이 필요 (비로그인 상태여도 상관이 없음 단순하게 친구한테 친구 요청하면 알림 메시지가 전달되어야 함)

- 추가된 친구와 대화를 나눌 수 있는 다이렉트 채팅방 (진행중)

- 여러 Zustand에 구성된 실시간 반영 로직들이 재사용될 수 있도록 커스텀 훅에 옮겨서 구성하는 것을 고려해야 함

<br />

# 앞으로 해야 할 일

- React, TypeScript 공부

- React 상태 관리 도구인 Zustand 공부

- 실시간 통신 애플리케이션 프로젝트 제작
