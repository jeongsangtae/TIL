# 오늘 한 일

### React + TypeScript 프로젝트 제작 (React, TypeScript, ExpressJS, MongoDB로 만드는 실시간 통신 애플리케이션)

- 키 중복 관련 에러 해결을 위해 테스트
  - 로그인 시에 발생하는 키 중복 관련 에러를 해결하기 위해 백엔드에서 미리 aggregate pipeline을 사용해 필터링하고 프론트엔드로 전달해 출력하도록 수정하고 테스트
  - 백엔드
    - friend-routes
      - 친구 목록 조회하는 라우터 수정
        - aggregate pipeline 테스트 내용
          - `$match`
            - 로그인한 사용자와 관계된 친구 관계 문서를 필터링
          - `$project`
            - 로그인한 사용자를 제외한 상대방 정보만 추출
            - `$cond`
              - `{ $eq: ["$requester.id", userId] }` 이 조건에 일치할 경우 `$receiver`가 반환되고, 일치하지 않을 경우 `$requester`를 반환
              - `$cond: [ <ifCondition>, <trueCase>, <falseCase> ]`
              - `$cond`를 사용해 상대방만 추출
          - `$group`
            - friend.id를 기준으로 중복을 제거
              - 각 친구 정보를 하나씩만 추출
            - `$friend.id` 그룹 기준 필드
              - friend.id 값이 같은 문서들끼리 하나의 그룹으로 묶음
            - `friend: { $first: "$friend" }`
              - 그룹화된 문서 중 첫 번째 문서의 friend 필드 값만 저장
              - 중복 제거용으로 사용
        - aggregate pipeline을 사용해 정리한 데이터를 프론트엔드로 전달하도록 구성
  - 프론트엔드
    - friendStore
      - loadFriends 액션 수정
        - 백엔드에서 전송한 friends 대신에 friendss를 저장하도록 구성하고, 콘솔에 관련 정보를 출력
    - DirectChatMainContent
      - friendToggleHandler 함수 수정
        - navigate를 통해 "/"가 아닌, "/me" 경로로 이동하도록 수정
    - Friends
      - filteredFriends 변수 주석 처리
      - friends 데이터가 어떻게 넘어오는지 확인을 위한 콘솔 로그 추가
      - JSX 코드 내용 수정
        - 기존의 친구 목록을 출력하는 내용은 주석 처리하고, 비슷한 내용을 추가
        - filteredFriends 변수 대신에 friends 내용에 map 함수를 사용하고 Friend 컴포넌트로 \_id, nickname을 전달하도록 구성
  - 백엔드에서 aggregate를 사용해 미리 필터링하고 프론트엔드로 전달해 출력하고 확인한 결과, 키 중복 에러가 발생하지 않는 것을 확인할 수 있었다.
    - 키 중복 관련 에러가 발생하지 않긴 하지만, 친구 목록에 보여지는 친구들 순서가 제멋대로 정렬되는 문제가 있어서 이 내용으로 처리하기 위해서는 순서 정렬에 대한 로직을 추가해야 함
    - 백엔드에서 처리하는 것도 좋지만, 프론트엔드에서 뭔가 다른 방법으로 처리할 수 있을 것 같다는 생각이 들어서 토글 관련 내용을 추가해 테스트해보고 결정할 생각이다.
    - 로그인 시에 전체 친구 목록이 아닌, 로그인 상태인 친구 목록이 보여지도록 구성하는 것도 고려중
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/14f47c0456c5867bfbfd5b4359a9e448197aceec)

# 오늘 느낀 점

- 키 중복 관련 에러를 해결하기 위해 백엔드에서 미리 데이터를 필터링해서 프론트엔드로 전달하고 출력한 결과, 이 구조로 진행하면 키 중복 관련 문제가 없어지지만, 정렬이 멋대로 되는 문제가 있어서 이 부분에 대한 추가 수정을 해줘야 한다. 백엔드에서 미리 필터링해 전달하는 방법으로도 해결이 가능하긴 하지만 프론트엔드에서 처리를 해보고 싶다는 생각이 들어서, 다른 방법으로 프론트엔드에서 처리할 수 있도록 테스트해 볼 생각이고, 로그인 시에 전체 친구 목록이 아닌 로그인 상태인 친구 목록이 보여지도록 구성해 키 중복 관련 에러를 없애는 것도 고려중에 있다. 그리고 좀 더 생각해보니 근본적인 문제는 마운트 관련된 문제인 것 같은데, 메인 컨텐츠 영역이 변경될 때 언마운트되고 다시 마운트되는 그런 구조로 구성을 한다면 문제가 없어지지 않을까하는 생각도 들어서, 여러 방법을 좀 더 추가로 테스트해보고 확실하게 결정을 할 생각이다.

<br />

# 내일 할 일

- 실시간 통신 애플리케이션 (Float Chat) 프로젝트 진행

- Zustand 내용 구성

- 로그아웃 버튼 등 여러 버튼들이 텍스트가 아닌 아이콘으로 보여지도록 수정 필요

- 홈으로 이동 시에 친구 버튼과 다이렉트 채팅방 목록이 사이드바 옆으로 보여지고, 친구 버튼 클릭 또는 다이렉트 채팅방 클릭 시에 그 옆으로 해당 내용이 보여지도록 수정 필요

- 그룹 채팅방은 그룹 채팅방에 참여한 사용자 목록이 사이드바 옆으로 보여지고, 그 옆에 채팅 관련 내용이 보여지도록 수정 필요

- 출력되는 채팅 메시지 목록에 스크롤을 추가해 보기 편하도록 변경해야 하고, 메시지가 언제 추가되었는지 구분할 수 있도록 저장된 날짜 데이터를 불러와 표기해야 함

- 채팅 입력창에 적용된 스크롤 기능 추가 수정 필요

- 다이렉트 채팅방 목록이 정렬될 때 부드럽게 위로 올라가고 내려가는 CSS 적용 필요

- 친구 삭제 시에 다이렉트 채팅방 삭제 확인 로직 필요 (친구 삭제 시에 다이렉트 채팅방을 그대로 남겨놓고 삭제 확인창은 따로 추가하지 않을 예정)

- 친구 관련된 내용에서 코드 정리 필요 (코드를 깔끔하게 보이도록 수정 필요)

- 그룹 채팅방 초대하고 알림을 전송하는 기능에서, 로그인한 사용자가 아닌 친구에게 보내는 그런 구조로 작동되도록 수정이 필요 (비로그인 상태여도 상관이 없음 단순하게 친구한테 친구 요청하면 알림 메시지가 전달되어야 함)

- 추가된 친구와 대화를 나눌 수 있는 다이렉트 채팅방 (진행중)

- 여러 Zustand에 구성된 실시간 반영 로직들이 재사용될 수 있도록 커스텀 훅에 옮겨서 구성하는 것을 고려해야 함

<br />

# 앞으로 해야 할 일

- React, TypeScript 공부

- React 상태 관리 도구인 Zustand 공부

- 실시간 통신 애플리케이션 프로젝트 제작
