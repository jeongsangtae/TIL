# 오늘 한 일

### React 프로젝트 제작 (React, NodeJS, MongoDB로 만드는 미니 커뮤니티 플랫폼)

- 구성한 내용

  - 사용자 정보를 가져오는 loader 함수 위치 변경 및 AdminUsers 컴포넌트에서 삭제한 사용자 정보가 즉시 반영되어 보여지도록 내용 추가
    - 관리자 페이지의 사용자 정보를 가져오는 loader 함수를 AdminUsersPage가 아닌, AdminRootLayout에 구성해서 중복사용이 되지않도록 변경해주고, AdminUsers에서는 useLoaderData가 아닌 useRouteLoaderData를 통해서 데이터를 가져올 수 있도록 변경해주었으며, 사용자를 삭제한 후에 해당 페이지에서는 filter를 사용해서 즉시 반영되어 삭제된 사용자가 보여지지않지만, 다른 페이지로 이동하고 다시 돌아오면 삭제한 사용자가 그대로 보여지며 클릭할 수 있는 문제가 있기 때문에 이 부분을 수정해주었다.
    - 프론트엔드 구성
      - AdminUsersPage -> AdminRootLayout
        - AdminUsersPage에 구성된 사용자 정보를 가져오는 loader 함수를 AdminRootLayout에 이동
      - main
        - loader 함수를 AdminRootLayout에서 import 시키고, "/admin" 경로의 내용에서 loader를 사용해서 추가
          - id는 "users-data"로 설정하고, 다른 페이지에서 useRouteLoaderData를 통해서 사용자 정보를 가져올 수 있도록 구성
        - "users" 경로의 loader 함수는 삭제
      - AdminUsers
        - useLoaderData 대신에 useRouteLoaderData를 사용하도록 변경
        - 사용자를 삭제하면 해당 페이지에서는 filter를 통해서 즉시 적용되지만, 다른 페이지를 이동한 후에 돌아오면 삭제한 사용자 정보가 그대로 노출되기 때문에 이 내용이 그대로 남아있지 않고, 삭제된 것처럼 보이도록 useEffect를 사용해서 내용 구성
          - 삭제된 것처럼 보이도록 해주는 이유는 실제로 삭제 버튼 클릭 시, DB에서는 해당 데이터가 삭제되며 존재하지 않지만, useRouteLoaderData를 통해서 넘어온 정보가 아직 화면에 출력되기 때문에, 삭제한 사용자를 다시 클릭할 수 없도록 보이지 않도록 해주는 작업 내용
          - 관리자 계정을 제외한 모든 사용자 계정 정보을 가져오는 fetch 함수를 구성
          - 가져온 사용자 계정 정보를 setUsers에 넣어서 users를 업데이트
          - 업데이트된 users는 삭제된 사용자 정보를 포함하고 있지 않기 때문에 삭제된 사용자 계정을 제외한 내용이 화면에 출력되게 됨
    - 테스트 결과, loader 함수 위치 변경으로 인해 AdminUsers 컴포넌트에서 useRouteLoaderData를 사용하는 것도 문제없이 작동되고, AdminUsers 컴포넌트에서 삭제한 사용자 정보가 다른 페이지로 이동하고 돌아오면 다시 보여지는 문제도 이제 해결되어서 보이지 않는 것을 확인할 수 있었다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/b78a972ac6e63b54a3c9bb9e00191f6738ce8da7)

  <br />

  - 관리자 컴포넌트에서 사용자 방 연결과 관련된 로직을 추가 및 AdminUserList 컴포넌트 내용 추가
    - 관리자 페이지에서 사용자 \_id 정보를 가져와서, 사용자 방 설정에 사용하고 해당 방과 연결하는 로직을 추가해주고, 나중에 사용할 AdminUserList 컴포넌트를 추가해주었다.
    - 백엔드 구성
      - 프론트엔드에서 body를 통해 전달한 사용자 \_id를 방 번호에 사용
      - io.to().emit()를 사용해서 관리자 채팅창에서 입력한 내용이 연결한 사용자 채팅창에 보여지도록 구성
    - 프론트엔드 구성
      - AdminHeader
        - AdminChats 컴포넌트에 사용자 정보를 usersData라는 prop으로 전달
        - 나중에 사용할 AdminUserList 컴포넌트도 일단 추가
      - AdminUserList
        - AdminChats 컴포넌트에서 사용하던 내용을 거의 가져와서 구성
          - 채팅창을 여는 버튼, socket.io를 연결하는 내용, 방 연결을 하는 함수 등등
        - 채팅창을 열면 이 AdminUserList 내용이 먼저 보이고, 여기서 사용자를 클릭하면 해당 사용자와 연결된 채팅방으로 들어가지도록 구성해줄 생각이다.
        - 테스트를 하기 위해서 구성하다가 일단은 AdminChats 컴포넌트에서 하나의 사용자 내용만 사용해서 방 연결을 해보기 위해서 AdminUserList 컴포넌트는 보류해놓은 상태
      - AdminChats
        - 새로운 useEffect를 추가
          - if문을 통해서 socket.io와 usersData가 정상적인 내용이 들어오는지 확인
          - usersData의 정보가 1개 이상일 경우, 사용자의 \_id를 joinUserRoom 함수에 매개변수로 전달
            - 여기서는 테스트를 위해서 일단 첫번째로 생성한 사용자 \_id 정보를 넘기는 것으로 구성
            - 이후에는 map 함수를 사용해서, 여러 사용자 \_id 정보를 넘기게 될 예정
          - 의존성 배열로 socket과 usersData 내용을 추가
        - joinUserRoom 함수
          - socket.io 내용이 정상적인지 확인
          - 방 번호 내용에 매개변수로 전달받은 사용자 \_id 정보를 사용
          - socket.emit을 사용해서 joinRoom이라는 이벤트에 매개변수로 전달받은 사용자 \_id와 사용자 type인 admin을 전달
            - 여기서 사용자 \_id는 매개변수로 받은 내용을 사용하고, 사용자 type은 관리자이기 때문에 admin을 전달
          - 정상적으로 방에 입장되었는지 확인하기 위해서 console.log를 통해서 입장된 내용이 보여지도록 구성
        - sendMessage 함수
          - testNewMessage라는 변수에 userId, adminEmail, content, userType 내용을 객체 형태로 구성해서 fetch 함수의 body에 전달
            - userId는 테스트를 위해서 "usersData[0].\_id"로 구성
            - content에는 message 내용이 전달되도록 구성
            - userType은 관리자이기 떄문에 admin으로 구성
    - CSS 구성
      - AdminUserList
        - 전체적인 채팅창 틀과 채팅 버튼 아이콘 관련 내용 및 animation 효과 내용이 들어가있다.
        - AdminChats에서 사용하던 내용을 가져와서 구성
    - 테스트 결과, 관리자 채팅창에서 입력한 내용이 사용자 채팅창에서 보여지고, 반대로 사용자 채팅창에서 입력한 내용이 관리자 채팅창에서 보여지는 것을 확인할 수 있었다. 바로 입력한 채팅이 서로 보여지는 것은 문제가 없지만, 해당 데이터를 아직 저장하지 못해서 새로고침해버리면 바로 날아가기 때문에 이 부분에 대한 수정이 필요한 상황이다.
      - 현재 테스트를 위해서 한 명의 사용자만 따로 방 연결을 한 상황이기 때문에, AdminUserList 컴포넌트 내용을 구성해서 사용자를 선택하고 해당 사용자와 연결된 채팅방에 접속해서 채팅하는 내용을 구성해줘야 한다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/64d52bb4af9fe813a9aa5a68720e511156897893)

<br />

- 추가 및 해결 해야 할 내용
  - 채팅과 관련된 내용 구성
    - 출력되는 메시지 UI 수정 필요
      - 본인이 작성한 메시지는 오른쪽, 상대방 메시지는 왼쪽에 보이도록 구성해야 함
    - 사용자-관리자 사이의 방 번호를 설정해서 서로 채팅이 보이도록 구현해야 함
      - 관리자 부분에서 사용자 \_id를 가져오고 해당 방으로 들어가는 내용을 구성해야 함
        - 이 부분은 구현했지만 아직 부족한 구성이 있어서 추가 작업 필요
      - 관리자 채팅창에서는 채팅 버튼 클릭 시, 바로 채팅창이 들어가지는 것이 아닌 채팅창을 선택해서 들어갈 수 있도록 사용자 항목을 만들어줘야 함
        - 이 내용을 구성하기 위해서 새로운 컴포넌트도 추가 했는데, 아직 로직을 완성하지 못해서 테스트해보지 못함
    - 스크롤 작동에서 추가 작업을 해봐야 함
      - 새로운 메시지가 뜨면, 아래로 가는 버튼이 사라지고, 새로운 메시지 버튼만 보이도록 해야 함
    - 채팅창에서 사용되는 함수 이름 변경도 생각을 해봐야 하는데, 좀 더 명확하게 표현할 필요성을 느낌
  - 코드 예외 처리 더 필요한 부분이 있는 지 체크해야 함
  - ul 요소 안의 자식이 li가 아닌, div나 프래그먼트로 사용되는 부분을 수정해야 함

# 오늘 느낀 점

- loader 함수를 옮겨서 구성한 내용도 테스트 결과 문제없이 작동하는 것을 확인했고, 사용자 계정 삭제 후에 화면에 즉시 적용되었다가 다른 페이지 이동 후에 돌아오면 다시 보여지는 부분도 useEffect를 통해서 추가 작업을 해주면서 해결되었고, 관리자 채팅방과 사용자 채팅방이 연결되어서 서로 입력한 내용이 보여지는 것은 구현이 되었지만, 아직 저장을 하지 못해서 새로고침하면 그 내용들이 사라지기 때문에 이 부분에 대한 추가 작업이 필요하다. 현재 생각한 방법으로는 채팅을 입력하고 백엔드를 통해서 DB에 저장될 때 사용자 type도 함께 저장되도록 해주고, 입력한 채팅 정보가 내 DB 컬렉션에 저장되면서 상대방 DB 컬렉션에 똑같이 저장되며, 이 내용을 가져와서 사용할 때는 사용자 type을 확인해서 채팅을 좌우로 분리하고 보여지는 방법을 생각해보았다. 아직 구현해보지 못해서 이게 가능할지는 확신할 수 없지만, 가능할 것 같다는 생각이 들고 우선 이 내용을 구현해주기 전에 관리자 측에서 채팅창을 열면 바로 채팅창이 뜨는 것이 아닌, 어떤 사용자와 채팅을 할 것인지 선택할 수 있는 사용자 리스트가 뜨고 거기서 선택을 하면 채팅창으로 이동해서 채팅을 할 수 있도록 구성을 해줘야 한다.

<br />

# 내일 할 일

- React 공부 및 React 프로젝트 조금씩 진행하기

<br />

# 앞으로 해야 할 일

- React, NextJS 공부

- React 프로젝트 제작
