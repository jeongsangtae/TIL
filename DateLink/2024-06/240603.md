# 오늘 한 일

### React 프로젝트 제작 (React, NodeJS, MongoDB로 만드는 미니 커뮤니티 플랫폼)

- 구성한 내용

  - AdminUser, AdminUsers 컴포넌트 수정 및 CSS 수정
    - AdminUsers 내용이 짤리면서 출력되기 때문에 이 부분을 수정해주기 위해서 백그라운드와 컨테이너를 추가, 몇명의 사용자가 있는지, 사용자 간의 구분이 되도록 해주고, 사용자가 없는 경우 없다는 텍스트를 출력하도록 구성해주었다. 그리고 AdminUsers와 AdminUser 내용에 Context API 내용을 사용해서 테마 변경 관련 내용도 추가해서 구성
    - 프론트엔드 구성
      - AdminUsers
        - useContext 추가해서, Context API 내용 사용
          - 테마 변경을 사용하기 위해서 구성 추가
        - 백그라운드 추가
        - 사용자 데이터 로딩중일 때의 조건부 추가
        - 사용자 정보가 몇명있는 지 알 수 있도록 내용 추가
        - 사용자가 없는 경우, 다른 텍스트가 나오도록 구성
      - AdminUser
        - useContext 추가해서, Context API 내용 사용
    - CSS 구성
      - AdminUsers
        - AdminPosts의 내용을 가져와서 구성
        - 전체적인 배경이나 컨테이너 구성, 밑줄 내용을 사용하고 이외의 구성은 따로 추가해야 함
      - AdminUser
        - AdminPost 내용을 가져와서 구성
        - 기본적인 전체 틀 구성을 사용하고, 밑줄 관련 내용을 사용
    - 테스트 결과, 사용자 계정 내용이 짤리는 문제가 사라졌고 이전보다는 사용자 간의 정보가 좀 더 구분이 되었지만 아직 UI 부분에서 부족하기 때문에 더 깔끔하게 구성을 해줘야 한다.
      - 테마 모드 변경도 정상적으로 이루어지고, 사용자가 없는 경우의 텍스트도 정상적으로 출력, 사용자 계정 갯수도 정상적으로 출력되기 때문에 사용자 정보 출력되는 부분의 UI만 좀 더 보완해주면 될 것 같다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/3253f6fb646fe0e29a22bd50b48b862b342195d9)

  <br />

  - AdminUsers, AdminUser 컴포넌트 수정 및 백엔드에서 구성한 admin user delete router 수정
    - AdminUsers에 사용자를 삭제하게되면 삭제된 사용자를 걸러내도록 해주는 상수를 추가하고 그 내용을 AdminUser에 prop으로 전달, AdminUser에서 fetch 함수 사용해서 사용자를 삭제하도록 구성해주고, 백엔드에서 프론트엔드의 정보를 받아와서 삭제 버튼을 클릭한 사용자 이메일을 확인해서 관련된 게시글, 댓글, 답글을 모두 삭제하고 사용자까지 삭제하도록 구성해주었다.
    - 백엔드 구성
      - 사용자가 정상적인 accessToken을 가지고 있는 지 확인
      - 프론트엔드에서 body를 통해 전달한 email 내용을 사용해서, users 컬렉션에서 일치하는 사용자를 찾음
      - 찾은 사용자의 이메일과 댓글, 답글에 저장된 이메일을 확인해서 일치하는 모든 항목을 삭제
        - 이 부분에서 이메일로 확인하는게 잘못된 것 같아서 수정 필요
      - 찾은 사용자 이메일과 게시글에 저장된 이메일을 확인해서 일치하는 모든 항목을 찾음
      - 찾은 게시글이 0보다 크다면 map 함수를 사용해서 다시 반환하고 찾은 게시글의 postId를 가져옴
      - posts 컬렉션 내용에서 찾은 사용자 이메일과 일치하는 이메일 내용이 있는 모든 항목을 삭제
      - for 문을 사용하고, map 함수로 반환 받은 게시글을 하나씩 순회하면서 postId를 확인해서 해당 postId보다 더 큰 항목의 postId는 1씩 줄어들도록 구성
        - 이 부분은 조금 잘못 구성된 것 같아서 수정 필요
      - 위의 내용들이 이루어지면 users 컬렉션에서 찾은 사용자 이메일과 일치하는 이메일을 확인하고 삭제
      - req.body로 전달받은 이메일 내용을 다시 프론트엔드로 전달
    - 프론트엔드 구성
      - AdminUsers
        - deleteUser 함수를 추가
          - useLoaderData로 전달받은 내용에서 filter를 사용해서, 삭제한 사용자 계정 이메일을 확인하고 일치하는 항목을 제외하고 화면에 보여주도록 구성
        - deleteUser 함수를 AdminUser에 prop으로 전달
      - AdminUser
        - deleteUser 함수를 onDeleteUserData라는 prop으로 전달받도록 추가
        - fetch 함수 추가
          - delete method로 구성
          - body에 email 정보를 전달
          - 정상적으로 삭제가 이루어지지 않으면 텍스트 메시지가 출력되도록 구성
          - 정상적으로 삭제되면 백엔드에서 응답 데이터를 전달받는데, 이 데이터에서 email 내용을 onDeleteUserData에 상태 끌어올리기로 전달하도록 구성
        - 사용자 계정 삭제 버튼을 추가하고, 클릭 시 fetch 함수가 작동되도록 구성
    - 테스트 결과, 사용자 계정이 삭제되는 것은 문제가 없지만 삭제하고 즉시 화면에 적용되지 않고, AdminUser 컴포넌트에서 전달받은 prop 문제가 있는 것처럼 콘솔에 오류 메시지가 뜨기 떄문에 확인이 필요하며, 삭제 로직에서 잘못 생각하고 구성한 부분이 있어서 이 부분에 대해 수정이 필요하다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/e79fe79a29d6ca8840b2008fd46e83326d5c6435)

<br />

- 추가 및 해결 해야 할 내용
  - 커스텀 Hook에 대한 고려
    - Context API를 사용하는 것은 좋지만, 이 내용을 사용하려는 파일에서 하나하나 추가해서 사용하기 때문에 커스텀 Hook을 구성해서 재사용할 수 있도록 해줄 필요가 있음
  - 백엔드의 user-router.js에서 accessToken, login/success, profile router에서 모두 accessToken 함수 내용을 재사용하고 있는데, 굳이 3개의 router로 나눌 필요가 있는 지 확인해보고 필요가 없다면 하나로 줄여줘야 함
    - 명확하게 하기 위해서 일단은 하나로 합치지 않고, 그대로 나눠서 사용하도록 유지
    - 내용이 엄청 많은 코드로 구성된 것이 아니기 때문에 현재로서는 크게 문제 없다고 생각되어 그대로 유지
  - 코드 예외 처리 더 필요한 부분이 있는 지 체크해야 함

# 오늘 느낀 점

- 관리자 페이지에서 사용자 계정을 삭제하도록 하는 코드를 짜서 테스트해본 결과, 사용자 계정이 삭제가 되긴 하지만 사용자 계정이 삭제된 것을 즉시 반영하는 부분이 제대로 적용되지 않고, 콘솔에서 AdminUser에서 에러가 발생하는 메시지가 뜨기 때문에 이 부분을 확인해줘야 한다. 그리고 백엔드에서 구성한 로직도 수정을 해줘야 하는데, 내가 생각한 것과 다르게 게시글에 작성된 모든 댓글과 답글이 삭제되지 않고 삭제한 사용자 계정의 댓글과 답글만 삭제되기 때문에, 이 부분의 내용은 추가적으로 수정이 필요하다. 삭제 로직을 추가로 수정해주고 아직 드롭다운 메뉴를 별도의 컴포넌트로 분리해주지 않았기 때문에 이 부분도 분리를 해줘야 한다.

<br />

# 내일 할 일

- React 공부 및 React 프로젝트 조금씩 진행하기

<br />

# 앞으로 해야 할 일

- React, NextJS 공부

- React 프로젝트 제작
