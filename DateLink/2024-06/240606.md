# 오늘 한 일

### React 프로젝트 제작 (React, NodeJS, MongoDB로 만드는 미니 커뮤니티 플랫폼)

- 구성한 내용

  - admin user delete router 수정 (for 문에서 다른 방식으로 변경, 댓글과 답글 삭제 내용 추가)
    - 사용자 삭제 시에 사용자가 작성한 게시글의 댓글과 답글이 삭제되도록 for문을 사용하고 있었는데, 이 내용을 변경해서 mongodb의 $in 내용을 사용해서 게시글 \_id와 일치하는 댓글과 답글을 삭제하도록 해주고, 삭제되는 사용자가 작성했던 모든 댓글과 답글을 삭제하도록 사용자 이메일과 일치하는 항목의 댓글, 답글이 모두 삭제되도록 구성
    - 백엔드 구성
      - for문에서 mongodb의 $in 연산자를 사용해서 각 게시글의 댓글과 답글을 삭제하도록 변경
        - for 문을 사용하면 deleteMany가 순차적으로 실행되기 때문에 비효율적이다. 특히 배열이 커질수록 전체 삭제 작업이 오래 걸릴 수 있다.
        - $in 연산자를 상요하면 지정된 배열에 포함된 값을 한 번에 처리한다. 한 번의 deleteMany 호출로 여러 postId를 동시에 처리
        - 단일 DB 호출로 여러 문서를 삭제하므로 더 효율적이며, 배열이 큰 경우 성능이 크게 향상된다.
        - $in 연산자를 사용하면 단일 DB 호출로 여러 문서를 삭제할 수 있으므로, 네트워크 지연 및 DB 처리 시간을 줄일 수 있다.
        - $in 연산자를 사용하면 코드가 더 간결하고 이해하기 쉬워짐
        - for문을 사용한 코드와 $in 연산자 사용한 코드는 동일한 작업을 수행하지만, $in 연산자 코드는 병렬로 처리해서 한 번의 DB 호출로 여러 문서를 삭제하므로 네트워크 및 DB 부하가 줄어들고 전체 작업 시간이 단축됨
      - 사용자가 작성한 모든 댓글과 답글을 삭제하는 코드를 삭제했었지만, 이 코드를 다시 사용해서, 삭제하려는 사용자가 작성했던 모든 댓글과 답글도 함께 삭제되도록 구성
        - 사용자가 작성했던 게시글의 댓글과 답글을 먼저 삭제하고, 다른 게시글에서 사용자가 작성했던 댓글과 답글을 모두 찾아내서 삭제하므로, 해당 사용자가 작성했던 내용이 모두 사라지게 됨
    - 테스트 결과, 삭제하려는 사용자가 작성했던 게시글에 작성된 모든 댓글과 답글을 삭제되는 것을 확인할 수 있었고, 다른 게시글에 사용자가 작성한 댓글과 답글이 삭제되는 것은 확인을 했지만, 사용자가 댓글을 작성하고 답글로 다른 사용자가 작성한 내용은 UI에서는 보여지지 않지만 DB에서는 답글 정보가 남아있기 때문에 이 부분에 대한 수정이 필요하다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/843a5ed44a2d497cc689c6093abb96a21a88be6c)

  <br />

  - admin user delete router 수정 (사용자가 작성한 댓글 찾는 내용 추가, map 함수 추가, 댓글의 \_id와 일치하는 모든 답글 삭제)
    - 사용자가 작성한 댓글들을 모두 찾아서 배열로 저장하고, 저장한 댓글 배열에 map 함수를 사용해서 댓글의 \_id를 추출하고, $in 연산자를 사용해서 댓글의 \_id와 일치하는 모든 답글 삭제하도록 구성
    - 백엔드 구성
      - 삭제하려는 사용자가 작성한 모든 댓글을 찾기 위해서 사용자 이메일과 일치하는 댓글을 찾도록 구성
        - 사용자 이메일과 comments 컬렉션에 저장된 이메일을 비교해서 일치하는 모든 항목을 찾음
      - 삭제하려는 댓글의 \_id를 추출
        - 이메일이 일치하는 댓글에 map 함수를 사용해서 댓글의 \_id 내용을 추출
      - 답글 컬렉션에서 댓글의 \_id 내용과 일치하는 모든 답글을 삭제
        - replies 컬렉션에 저장된 comment_id 내용과 댓글에서 map 함수를 사용해서 추출한 댓글의 \_id를 비교해서 일치하는 모든 항목을 $in 연산자를 사용해서 삭제
    - 테스트 결과, 사용자가 다른 게시글에서 작성한 댓글에 달린 답글이 먼저 삭제된 후에 사용자가 작성한 댓글이 삭제되기 때문에 DB에서도 데이터가 남아있지 않게 되었고, UI에서 보이지 않는 댓글이나 답글이 남아있지 않게 되었다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/f0714a39a11116b4e017e2250c00511626463ad4)

  <br />

  - admin user delete router 수정 (postId 초기화 후 재설정 내용 추가)
    - 사용자를 삭제하게되면 그 사용자가 작성한 게시글도 모두 함께 삭제되는데, 이 때 삭제되는 게시글의 뒷 게시글들 번호가 -1씩 줄어들도록 구성을 했지만, 이 방식으로는 중간에 있는 게시글이 함께 삭제되면 번호가 비어있는 문제가 생기기 떄문에, 번호가 비어있지 않도록 모든 게시글 번호를 초기화하고 다시 1부터 재설정해주는 내용을 추가해주었다.
    - 백엔드 구성
      - 게시글의 번호를 재배열하는 내용 추가
        - posts 컬렉션에서 모든 게시글을 가져오는데 여기서 postId 내용만 가져와서 배열로 구성
      - for 문을 추가해서 게시글 번호를 재설정하는 내용 추가
        - 게시글 배열이 순서대로 들어오면서, 하나씩 업데이트가 되는데 여기서 게시글 번호가 1부터 시작하고 1씩 증가한 번호가 순서대로 게시글 번호로 들어가게 구성
    - 테스트 결과, 삭제한 사용자가 작성한 게시글이 다른 게시글 중간 중간에 섞여있어도, 전체 게시글 번호를 초기화해서 순서대로 1부터 새로 재설정 하기 때문에 중간에 번호가 비어있지 않게 되었다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/f13a15c8610470f8ab9866c1e03fdd6c001f015a)

<br />

- 추가 및 해결 해야 할 내용
  - 커스텀 Hook에 대한 고려
    - Context API를 사용하는 것은 좋지만, 이 내용을 사용하려는 파일에서 하나하나 추가해서 사용하기 때문에 커스텀 Hook을 구성해서 재사용할 수 있도록 해줄 필요가 있음
  - 백엔드의 user-router.js에서 accessToken, login/success, profile router에서 모두 accessToken 함수 내용을 재사용하고 있는데, 굳이 3개의 router로 나눌 필요가 있는 지 확인해보고 필요가 없다면 하나로 줄여줘야 함
    - 명확하게 하기 위해서 일단은 하나로 합치지 않고, 그대로 나눠서 사용하도록 유지
    - 내용이 엄청 많은 코드로 구성된 것이 아니기 때문에 현재로서는 크게 문제 없다고 생각되어 그대로 유지
  - 코드 예외 처리 더 필요한 부분이 있는 지 체크해야 함

# 오늘 느낀 점

- 사용자 계정을 삭제하면서 사용자가 작성한 게시글, 댓글, 답글 삭제에 관한 처리를 하나씩 테스트해보면서 잘못된 작동에 대해 수정해주고, 모두 정상적으로 작동하도록 구성해주었기 때문에 이제 사용자 페이지의 UI를 수정해서 좀 더 직관적으로 보이도록 해줘야 한다. 그리고 드롭다운 메뉴를 별도의 컴포넌트로 구성해주는 부분을 아직 구현하지 않았기 때문에 이 부분에 대해 분리 작업을 해줘야 하고, 관리자 페이지 구성이 얼추 되었기 때문에 이제 채팅을 통해서 사용자와 관리자간의 메시지 전달이 이루어지는지, 정상적으로 방을 분리해서 구분이 되는지 등 채팅과 관련된 내용을 하나씩 구성을 해줘야 할 것 같다.

<br />

# 내일 할 일

- React 공부 및 React 프로젝트 조금씩 진행하기

<br />

# 앞으로 해야 할 일

- React, NextJS 공부

- React 프로젝트 제작
