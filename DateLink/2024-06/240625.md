# 오늘 한 일

### React 프로젝트 제작 (React, NodeJS, MongoDB로 만드는 미니 커뮤니티 플랫폼)

- 구성한 내용

  - 사용자가 방을 생성하고, 그 방을 백엔드와 socket.io에 연결 및 관리자 내용에서 사용자 정보를 가져오는 loader 함수를 재사용하도록 구성
    - 프론트엔드에서 방과 관련된 내용을 설정해서 메시지와 함께 백엔드로 전달하고, 백엔드에서 join을 사용해서 사용자 \_id로 방에 참여하도록 구성해주고, 이 내용을 사용자 채팅 라우터에서 to를 사용해서 메시지를 방에 전달하면서 프론트엔드로 해당 메시지를 브로드캐스트하도록 구성해주었고, 이와 관련된 내용을 관리자 채팅에 연결하기 위해서 사용자 정보를 가져오는 내용을 추가로 관리자 메인헤더에 구성해주었다.
    - 백엔드 구성
      - app
        - 프론트엔드에서 전달한 userId, userType 같은 내용을 사용할 수 있도록 구성
        - 프론트엔드에서 전달받은 사용자 \_id를 활용해서 join으로 방에 참여하도록 구성
          - 방에 join되면, 사용자 \_id와 사용자 type 그리고 방 번호가 콘솔에 보이도록 구성
      - user-chat-routes
        - 프론트엔드에서 전달받은 userId 내용을 먼저 변환하지 않고, 메시지가 추가될 때 해당 내용만 변환되도록 해주고 메시지를 브로드캐스트 하는 부분에서는 변환하기 전의 userId 내용이 사용되도록 구성
          - 변환한 내용은 ObjectId()를 통해서 mongodb의 특수한 \_id 내용이 되기 때문에, 새로운 메시지가 저장될 때만 ObjectId 형식으로 변환되도록 구성 변경
          - 변환되지 않은 userId를 사용해서 방 번호를 설정하고 io.to().emit()을 통해서 메시지가 방에 전달되도록 구성
    - 프론트엔드 구성
      - Chats
        - 웹 소켓 연결과 실시간 메시지를 수신하는 useEffect에서 백엔드에 emit을 사용해서, "joinRoom"이라는 이벤트로 userId, userType을 전달
          - userId를 의존성 배열로 추가
        - 메시지를 전달하는 함수에서 userId가 넘어오지 않았을 때 오류가 발생하는 것을 방지하기 위해서 조건문을 추가
          - newMessage 변수를 추가하고, 이 내용에 userId, userEmail, content, userType를 구성해서 한번에 객체 형태로 전달될 수 있도록 구성
          - body를 통해서 newMessage 내용이 전달될 수 있도록 구성
      - main
        - 사용자 정보를 모두 가져오는 loader 함수를 재사용해서 AdminMainHeader 컴포넌트에서도 useLoaderData를 사용할 수 있도록 구성
          - adminUsersLoader를 재사용
          - 이렇게 사용하면 "/admin" 경로와 "users" 경로에서 중복으로 사용하기 떄문에, 차라리 최상위 경로에서 사용하고 그 아래 자식은 useLoaderData를 통해서 가져올 수 있도록 구성을 변경하는 방향도 생각해봐야 함
      - AdminMainHeader
        - useLoaderData Hook을 추가하고, usersData 변수를 통해서 사용
        - 콘솔에 usersData 내용을 사용해서 데이터가 출력되는 것을 확인
    - 테스트 결과, 사용자 부분에서만 방 설정을 해주고 아직 관리자쪽의 방 설정 관련 내용을 구성해주지 못해서, 보이는 부분에서 달라진 것은 없고 콘솔과 터미널에서 구성한 내용이 출력된 것을 확인했기 때문에 관리자 부분에 방 설정 내용을 추가해서 정상적으로 연결이 되는지 확인이 필요하다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/cf805a68b8ca6814fd88f58b9721b731ec590ebe)

<br />

- 추가 및 해결 해야 할 내용
  - 채팅과 관련된 내용 구성
    - 출력되는 메시지 UI 수정 필요
      - 본인이 작성한 메시지는 오른쪽, 상대방 메시지는 왼쪽에 보이도록 구성해야 함
    - 사용자-관리자 사이의 방 번호를 설정해서 서로 채팅이 보이도록 구현해야 함
      - 사용자 측에서 방 번호를 설정하는 부분은 추가
      - 관리자 부분에서 사용자 \_id를 가져오고 해당 방으로 들어가는 내용을 구성해야 함
      - 관리자 채팅창에서는 채팅 버튼 클릭 시, 바로 채팅창이 들어가지는 것이 아닌 채팅창을 선택해서 들어갈 수 있도록 사용자 항목을 만들어줘야 함
    - 스크롤 작동에서 추가 작업을 해봐야 함
      - 새로운 메시지가 뜨면, 아래로 가는 버튼이 사라지고, 새로운 메시지 버튼만 보이도록 해야 함
    - 채팅창에서 사용되는 함수 이름 변경도 생각을 해봐야 하는데, 좀 더 명확하게 표현할 필요성을 느낌
  - 코드 예외 처리 더 필요한 부분이 있는 지 체크해야 함
  - ul 요소 안의 자식이 li가 아닌, div나 프래그먼트로 사용되는 부분을 수정해야 함

# 오늘 느낀 점

- 사용자 채팅창에서 방 설정하고 이 내용을 백엔드로 전송한 뒤에, socket.io 연결 작업을 통해서 방 설정하는 것은 구성을 했는데 아직 관리자 쪽에서 사용자의 방 번호와 방 설정 관련 내용을 구성하지 못해서 정확한 테스트는 해보지 못했다. 관리자 쪽에서 사용자 방 설정을 연결 해주기 위해서 관리자 메인헤더 부분에 사용자 정보를 가져올 수 있도록 구성을 해주었고, 이 내용이 다른 컴포넌트에서 중복으로 사용되기 때문에 한 곳에서만 사용해서 해당 내용을 뿌려줄 수 있는지 확인해야 하고, 관리자 채팅창에서는 사용자를 선택해서 해당 채팅방으로 들어갈 수 있도록 구성도 해줘야 한다. 그리고 우선 사용자 측에서 설정한 방 번호가 정상적으로 연결이 되는지 확인하기 위해서 관리자 쪽에서 해당 내용을 추가해서 연결하고 사용될 수 있도록 구성을 해줘야 한다.

<br />

# 내일 할 일

- React 공부 및 React 프로젝트 조금씩 진행하기

<br />

# 앞으로 해야 할 일

- React, NextJS 공부

- React 프로젝트 제작
