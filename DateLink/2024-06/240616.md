# 오늘 한 일

### React 프로젝트 제작 (React, NodeJS, MongoDB로 만드는 미니 커뮤니티 플랫폼)

- 구성한 내용

  - 저장된 채팅 메시지 내용을 출력 (구성 실패)
    - 채팅 메시지를 DB에 저장하는 것은 문제가 없었는데, 입력했던 채팅 내역이 새로고침했을 때 채팅창에서 초기화되기 때문에 이 문제를 해결하기 위해서, DB에 저장된 채팅 메시지를 가져와서 보여주도록 구성해주었다.
    - 백엔드 구성
      - GET 메소드로 구성된 엔드포인트를 추가
        - "/chat/:userId" 경로로 구성
      - accessToken이 유효한지 확인
      - params로 넘어온 userId를 ObjectId를 통해서 변환
      - userChat 컬렉션에서 user_id와 userId가 일치하는 모든 항목을 가져와서 프론트엔드로 전달
    - 프론트엔드 구성
      - GET 메소드로 구성된 fetch 함수를 구성
        - 백엔드와 연결될 수 있도록 경로를 구성
        - CORS 에러가 생기지 않도록, credentials 내용 추가
      - 정상적으로 데이터가 넘어온다면 해당 데이터를 useState에 전달
      - useEffect에서 fetch 함수 내용이 실행되도록 구성
      - prop으로 넘어온 userId를 의존성 배열에 추가해서, 채팅창을 열었을 때 userId가 넘어오면서 useEffect가 실행되도록 구성
    - 테스트 결과, DB에 저장된 채팅 메시지를 가져오지 못하고 에러가 발생했는데, 이 에러들이 한 두개가 아닌 여러 에러가 발생해서 하나씩 확인을 해봐야 한다.
      - useEffect에서 추가한 fetch 함수 내용을 주석 처리하고 테스트하면 콘솔에서 에러가 발생하지 않기 때문에, 새롭게 추가한 코드에서 무엇이 문제인지 확인이 필요하다.
      - WebSocket 연결 실패, userId가 undefined, fetch 함수 에러 등 에러가 확인됨
      - 현재 WebSocket 연결은 문제가 없었고, fetch 함수 구성에서도 딱히 문제는 보이지 않기 때문에 가장 유력한 에러는 userId가 undefined 되면서 제대로 백엔드에 userId 정보를 넘기지 못해서 에러가 발생한 것으로 예상이 되는데, 이 userId에 대한 처리를 추가해서 에러를 고쳐봐야 할 것 같다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/cbd3b4aeaeefcda68bdb0672dc787b3343b0196a)

  <br />

  - 저장된 채팅 메시지 내용을 출력 (에러 수정)
    - 앞에서 구성한 내용이 에러를 발생해서 제대로 저장된 채팅 메시지가 채팅창에 출력되지 않아서 정상적으로 출력될 수 있도록 에러를 수정해준 후에, useEffect에 구성된 코드를 분리해서 기능을 명확하게 알 수 있게 해주고 코드 가독성이 향상되도록 해주었다.
    - 프론트엔드 구성
      - userId를 확인해서, 아직 넘어오지 않은 경우 에러 내용을 콘솔에 띄워주고 return을 통해서 종료하도록 구성
        - 정상적으로 userId가 넘어오면 fetch 함수 내용이 실행되며 저장된 메시지를 불러오게 된다.
        - 의존성 배열에 userId를 사용해서 채팅창을 열고 닫을 때와 새로고침했을 때 저장된 메시지가 보여지게 된다.
      - 저장된 메시지를 불러오는 내용과 WebSocket 연결, 그리고 실시간 메시지 수신하는 내용을 따로 분리해서 별도의 useEffect로 구성
        - 다른 역할을 하는 내용이기 때문에 하나의 useEffect에서 구성하는 것은 가독성이 많이 떨어진다고 생각해서 분리
    - 테스트 결과, userId가 처음에 넘어오지 않을 때는 콘솔창에서 에러 메시지가 출력되고, 정상적으로 userId가 넘어올 때는 채팅창에서 저장된 메시지가 보여지는 것을 확인할 수 있었다.
      - useEffect 내용을 분리해 구성해주면서 이전보다 훨씬 코드가 명확해지고 가독성이 좋아진 것도 확인할 수 있었다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/531dd960f4442e0722b98fd3a68e8b894afc2ec1)

<br />

- 추가 및 해결 해야 할 내용
  - 채팅과 관련된 내용 구성
  - 코드 예외 처리 더 필요한 부분이 있는 지 체크해야 함

# 오늘 느낀 점

- MainHeader 컴포넌트에서 userId 정보를 넘길 때, "?" 내용을 넣어서 에러가 없을 것으로 예상했는데, userId 정보가 아직 넘어오지 않은 경우에 undefined로 인해 정상적으로 메시지를 불러오지 못하면서 에러를 발생시켰다. 그래서 userId가 undefined인 경우에 그 뒤의 코드가 실행되지 않고 종료되도록 해주고, 의존성 배열에 userId를 추가해서 정상적으로 userId가 넘어왔을 경우에 fetch 함수가 실행되어서 정상적으로 저장된 메시지를 불러오도록 구성해서 해결해주었다. useEffect 안에서 실시간 메시지 업데이트와 저장된 메시지를 보여주는 내용을 같이 구성했었는데, 목적이 다른 두 내용을 하나의 useEffect에서 구성하는 것은 명확성과 가독성 부분이 떨어지는 것 같아서 분리해 구성해주었다. 저장된 메시지가 정상적으로 출력되기 때문에, 이 출력되는 메시지 UI를 수정해서 좀 더 잘 보이도록 해주고, 관리자 메시지도 입력해서 전달하면 저장과 동시에 출력이 되도록 구성을 해줘야 한다. 관리자 채팅 내역까지 처리가 된다면, 사용자-관리자 사이의 방 번호를 설정해서 서로 채팅이 보이도록 구성을 해줘야 한다.

<br />

# 내일 할 일

- React 공부 및 React 프로젝트 조금씩 진행하기

<br />

# 앞으로 해야 할 일

- React, NextJS 공부

- React 프로젝트 제작
