# 오늘 한 일

### React 프로젝트 제작 (React, NodeJS, MongoDB로 만드는 미니 커뮤니티 플랫폼)

- 구성한 내용

  - 새로운 메시지 버튼이 출력될 수 있도록 스크롤 조건부 변경
    - 이전에 테스트를 위해서 구성했던 새로운 메시지 버튼을 다시 사용하기 위해서 새로운 메시지가 추가되었을 때, 맨 밑으로 이동하는 버튼이 사라지고 새로운 메시지 버튼이 출력되도록 해주고, 스크롤을 맨 밑으로 이동하면 새로운 메시지 버튼이 사라지도록 구성해주었다. 그리고 넘어오는 채팅이 사용자 채팅인지, 관리자 채팅인지에 따라서 내가 입력한 채팅이라면 스크롤이 위에 있어도 바로 맨 밑으로 이동하도록 해주었고, 관리자 채팅이라면 새로운 메시지 버튼이 보여지도록 구성을 해주었다.
    - 백엔드 구성
      - admin-chat-routes
        - 채팅 내용을 가져오는 부분에서, sort를 추가해서 date를 기준으로 오름차순 정렬이 되어 내용을 가져오도록 구성
    - 프론트엔드 구성
      - Chats
        - isAtBottom 변수를 추가해서, 스크롤이 제일 밑일 때를 확인하는 내용으로 구성
        - latestMessage 변수를 추가해서, messages 배열의 마지막 요소를 가져오도록 구성
        - 새로운 메시지가 추가되는 useEffect의 if문을 변경해서, 스크롤이 맨 밑 또는 메시지 배열의 마지막 요소 userType이 user인지 확인해서, true의 경우 새로운 메시지 버튼과 맨 밑으로 이동하는 버튼이 모두 보이지않고 스크롤이 맨 밑으로 이동하도록 구성
          - 스크롤이 어떤 위치에 있던지, 내가 채팅을 입력하면 스크롤이 맨 밑으로 이동해서 바로 보여지도록 구성
          - 스크롤이 맨 밑에 있는 경우, 새로운 메시지 버튼이 보이지않고 바로 추가된 메시지가 보여져야 함
        - 새로운 메시지가 추가되는 useEffect에 else if문을 추가해서, 메시지 배열의 마지막 요소 userType이 admin인 경우, 맨 밑으로 이동하는 버튼은 보여지지 않고 새로운 메시지 버튼은 보여지도록 구성
          - 스크롤이 맨 밑이 아닌 스크롤이 조금이라도 위에 있는 경우, 맨 밑으로 이동하는 버튼 대신에 새로운 메시지 버튼이 보여지면서 클릭할 수 있게 구성
          - 추가로 스크롤이 맨 밑에 있는 경우, 어떤 메시지가 추가되던지 스크롤이 맨 밑으로 이동되도록 구성하려고 했으나, 현재 관리자 채팅이 넘어왔을 경우에는 스크롤이 맨 밑에 있어도 이동되지 않고 새로운 메시지 버튼이 뜨기 때문에 추가 수정이 필요
        - 스크롤을 이동하는 함수인 handleScroll에서 사용되는 if문은 스크롤이 맨 밑에 있는 경우, 새로운 메시지 버튼과 맨 밑으로 이동하는 버튼이 모두 보여지지 않도록 구성
          - 스크롤이 위에 있는 경우, 새로운 메시지가 생긴다면 해당 버튼으로 이동할 수도 있지만, 스크롤을 직접 움직여서 이동할 수도 있기 때문에 스크롤을 직접 움직여서 맨 밑으로 이동하면 모든 버튼이 사라지도록 구성
        - 스크롤 이동하는 함수인 handleScroll에 else if문을 추가해서, 스크롤이 맨 밑이 아니며 새로운 메시지 버튼이 보이지 않을때는 맨 밑으로 이동하는 버튼이 보이도록 구성
      - AdminChats
        - 새로운 메시지 버튼과 이와 관련된 useState 내용을 추가
        - 새로운 메시지가 추가되었을 때, 사용자와는 반대로 관리자 본인의 채팅에는 바로 스크롤이 내려가고 사용자 채팅이 추가되었을 때는 새로운 메시지 버튼이 보이도록 해주었다.
        - 스크롤 이동과 관련된 함수는 Chats 컴포넌트와 동일하게 구성
    - CSS 구성
      - AdminChats
        - 새로운 메시지 버튼 CSS를 추가해서, 새로운 메시지 버튼이 input 위쪽에 위치해서 보여지도록 구성
        - Chats에서 사용하던 내용을 가져와서 그대로 구성
    - 테스트 결과, 사용자 채팅과 관리자 채팅 모두에서 본인이 작성한 채팅에 대해서는 바로 스크롤이 이동해서 맨 밑으로 이동하는 것에 문제는 없지만, 상대방이 채팅을 입력해서 추가되면 스크롤이 어디에 있던지 새로운 메시지 버튼이 뜨는데, 이렇게 작동하는 것이 아닌 스크롤이 맨 밑이라면 어떤 채팅이라도 스크롤이 맨 밑으로 이동하도록 작동되는 것이 목표이기 때문에 추가로 수정이 필요하다.
      - 스크롤이 맨 밑이 아닌 위쪽에 있는 경우, 상대방 채팅이 새로운 메시지로 추가된다면 버튼이 보여지는 것이 맞고, 스크롤이 맨 밑에 있는 경우에는 상대방 채팅에도 스크롤이 맨 밑으로 이동해야 하지만, 현재는 이 방식이 제대로 적용되지 않아서 추가 작업이 필요하다.
      - 이 외에 새로운 메시지가 추가되었을 때, 맨 밑으로 이동하는 버튼 대신에 새로운 메시지 버튼이 뜨는 것도 문제없고, 새로운 메시지 버튼이 뜬 후에 스크롤을 맨 밑으로 이동시키면 새로운 메시지 버튼이 사라지는 것도 문제없으며, 본인이 채팅을 입력하면 스크롤이 어디에 있던지 바로 맨 밑으로 이동하는 것도 문제가 없기 때문에 대부분의 기능은 정상적으로 작동하는 것을 확인할 수 있었다.
      - 추가로, 새로운 메시지 버튼이 생기고나서 스크롤을 이동하면 맨 밑으로 이동하는 버튼이 다시 보여지게 되었는데 이 부분도 수정해서 이제 새로운 메시지 버튼이 띄워져있는 동안 맨 밑으로 이동하는 버튼이 보이지 않게 되었다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/b622ffbbd9ceb0a1fc534588b9cd94379d71979f)

<br />

- 추가 및 해결 해야 할 내용
  - 채팅과 관련된 내용 구성
    - 사용자-관리자 사이의 방 번호를 설정해서 서로 채팅이 보이도록 구현해야 함
      - 관리자 부분에서 사용자 \_id를 가져오고 해당 방으로 들어가는 내용을 구성해야 함
        - 관리자 채팅을 열면, 사용자 리스트가 보여지고 거기서 클릭해서 들어간 사용자 \_id의 정보가 넘어와서 사용될 수 있도록 추가 구성을 해야 함
      - 관리자 채팅창에서는 채팅 버튼 클릭 시, 바로 채팅창이 들어가지는 것이 아닌 채팅창을 선택해서 들어갈 수 있도록 사용자 항목을 만들어줘야 함
        - 이 내용을 구성하기 위해서 새로운 컴포넌트도 추가 했는데, 아직 로직을 완성하지 못해서 테스트해보지 못함
    - 스크롤 작동에서 추가 작업을 해봐야 함
      - 대부분의 스크롤 문제는 해결되었지만, 상대방이 새로운 메시지를 추가했을 때 스크롤이 맨 밑에 있다면 그대로 스크롤도 함께 이동되어야 하지만 스크롤이 이동되지 않고 새로운 메시지 버튼이 뜨기 때문에 이 부분을 수정해줘야 함
    - 사용자 계정이 삭제될 때, 해당 채팅도 함께 사라지도록 구성을 변경해줘야 함
    - 채팅창에서 사용되는 함수 이름 변경도 생각을 해봐야 하는데, 좀 더 명확하게 표현할 필요성을 느낌
  - 코드 예외 처리 더 필요한 부분이 있는 지 체크해야 함
  - ul 요소 안의 자식이 li가 아닌, div나 프래그먼트로 사용되는 부분을 수정해야 함

# 오늘 느낀 점

- 새로운 메시지 버튼과 관련된 작업이나 스크롤 관련 작업 대부분은 문제없이 구성을 했는데, 여기서 딱 한가지 서로 채팅창에서 상대방 채팅이 새롭게 추가되었을 때 스크롤이 맨 밑에 있다면 스크롤이 이동해야 하지만 스크롤이 위에 있던지 맨 밑에 있던지 항상 새로운 메시지 버튼이 보여지기 때문에 이 부분을 수정해줘야 한다. 그래서 생각한 방법으로, 스크롤 이동하는 함수인 handleScroll를 수정해서 useEffect의 조건부에서 사용하거나 새로운 채팅이 추가되었을 때 스크롤 값을 구해서 해당 값을 더하거나 빼도록 내용을 추가해서 확인해봐야 할 것 같다. 스크롤이 맨 밑에 있는 경우, 어떤 채팅이 들어오던지 실시간으로 볼 수 있도록 해주면 이제 스크롤 관련 문제는 끝날 것 같고, 이 작업을 해준 후에 관리자 채팅창에서 사용자 리스트를 구성해서 여러 사용자와 따로따로 채팅을 할 수 있도록 구현을 해줘야 한다.

<br />

# 내일 할 일

- React 공부 및 React 프로젝트 조금씩 진행하기

<br />

# 앞으로 해야 할 일

- React, NextJS 공부

- React 프로젝트 제작
