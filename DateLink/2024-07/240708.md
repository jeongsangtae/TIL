# 오늘 한 일

### React 프로젝트 제작 (React, NodeJS, MongoDB로 만드는 미니 커뮤니티 플랫폼)

- 구성한 내용

  - 사용자 데이터와 마지막 메시지 데이터를 결합 및 마지막 메시지 내용, 날짜 출력
    - 마지막 메시지 데이터를 fetch 함수로 가져오고, 이 내용을 사용자 데이터와 결합하는데 여기서 Promise.all을 통해서 모든 비동기 작업이 완료되어 결과가 한번에 반환되도록 구성해주고, 이 결합된 데이터를 prop으로 전달해서 출력하도록 구성해주었다.
    - 백엔드 구성
      - chatMessages 컬렉션에서 마지막 메시지를 찾는 로직을 변경
      - 이전 방법
        - userId가 일치하는 모든 내용을 찾고 거기서 내림차순으로 정렬해서 하나의 내용만 가져와서 배열로 저장
      - 변경한 방법
        - userId가 일치하는 내용중에서 내림차순으로 정렬해서 하나의 내용만 가져오도록 구성
      - 이전 방법보다 훨씬 간결하게 구성되었고, 배열이 아닌 객체 상태로 프론트엔드에 전달
        - 이로 인해 프론트엔드에서 좀 더 가독성 좋은 코드를 구성할 수 있음
    - 프론트엔드 구성
      - AdminUserList
        - 마지막 메시지 가져와서 저장하는 useState 삭제
        - 마지막 메시지와 사용자 정보가 결합된 내용을 저장하는 useState 추가
        - fetch 함수로 마지막 메시지를 가져오기 전에, usersData에 map 함수를 사용해서 새로운 배열로 구성해주고, 그 다음 fetch 함수를 통해서 마지막 메시지를 가져오도록 구성
        - 새로운 배열로 구성한 내용에, 가져온 마지막 메시지 내용을 결합하도록 구성
        - 결합하는 과정이 Promise.all을 통해서 데이터를 병렬로 가져와서 처리하도록 구성
          - 모든 작업이 완료될 때까지 기다린 다음 결과를 반환하도록 구성
        - Promise.all을 통해서 병렬로 처리되고 결합된 내용을 새로 추가한 useState에 업데이트되도록 구성
        - 최종적으로 결합되어 업데이트된 내용을 map 함수를 사용해서, AdminUserItem 컴포넌트에 전달하도록 구성
          - lastMessage, lastDate 내용이 prop으로 전달되도록 구성 추가
          - 옵셔널 체이닝을 사용해서 undefined 되지 않고 안전하게 접근하도록 구성
      - AdminUserItem
        - lastMessage, lastDate를 출력해보기 위해서 div에 추가해서 확인하도록 구성
    - 테스트 결과, 문제없이 마지막 메시지 내용과 날짜가 사용자 리스트에서 함께 출력되는 것을 확인할 수 있었다.
      - 사용자 또는 관리자 둘 중 아무나 마지막에 메시지를 입력하면 그 메시지의 내용과 날짜가 사용자 리스트에서 함께 출력되는 것을 확인할 수 있었다.
      - 현재 확인한 내용으로는 새로운 메시지가 추가되면 즉시 적용되지 않고, 새로고침을 했을 때 적용이 되기 때문에 이 부분에 대한 수정이 필요하다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/c551dac8cc6bd61f9e353cd25f35ed9b100827ad)

  <br />

  - 사용하지 않는 코드 삭제 및 prop 이름 수정 그리고 AdminUserItem CSS 수정
    - AdminUserList에서 사용하지 않는 useEffect와 방으로 들어가는 코드를 삭제하고, AdminUserList에서 AdminUserItem에 prop으로 전달하는 내용중에 마지막 메시지 내용과 날짜의 이름을 좀 더 명확하게 알 수 있도록 수정해주고, AdminUserItem에서 새롭게 추가된 내용의 CSS를 구성해주고 기존의 내용 CSS는 조금 수정해주었다.
    - 프론트엔드 구성
      - AdminUserList
        - socket.io 관련 내용 삭제
        - 사용하지 않는 useEffect 삭제
          - 삭제한 useEffect 내용은 AdminChats 컴포넌트에서 사용중
        - 방으로 입장하는 내용 삭제
          - 이 내용은 AdminChats 컴포넌트에서 사용중
        - 사용자 정보에 map 함수를 사용하는 내용을 삭제
          - 이제는 업데이트된 사용자 정보에 map 함수를 사용하기 때문에 이전 코드는 필요없음
        - lastMessage, lastDate 이름을 lastMessageContent, lastMessageDate로 변경
          - prop 이름을 좀 더 명확하게 알 수 있도록 변경
      - AdminUserItem
        - 사용자 이름과 이메일을 하나의 div로 묶고, 마지막 메시지 내용과 날짜를 하나의 div로 묶음
          - 이렇게 해준 이유는 왼쪽에 사용자 이름과 이메일이 출력되고, 오른쪽에는 마지막 메시지 내용과 날짜가 출력되도록 CSS를 구성했기 때문이다.
        - 왼쪽에 사용되는 내용은 item-left, 오른쪽에 사용되는 내용은 item-right로 className을 구성
        - 마지막 메시지 내용과 날짜에 className을 추가하고, 내용에는 테마 모드 변경과 관련된 내용도 추가
    - CSS 구성
      - AdminUserItem
        - item-select-button
          - 버튼안에 구성된 내용이 왼쪽 오른쪽 양 끝에 위치하도록 space-between 추가
          - 버튼안에 구성된 내용의 수평을 맞추기 위해서 align-items는 center로 구성
        - item-left
          - 왼쪽에 위치하도록 align-items는 flex-start, text-align은 left로 구성
        - item-right
          - 오른쪽에 위치하도록 align-items는 flex-end, text-align은 right로 구성
        - last-message-content
          - bold는 추가하지 않고, 폰트 사이즈는 이름보다 조금 작게 구성
          - 다크 모드에서는 흰색으로 구성했는데 회색 계열로 수정하는 것도 고려를 해봐야 함
        - last-message-date
          - 폰트는 이메일보다 조금 작게 구성, 색은 동일
    - 테스트 결과, 필요없는 코드를 삭제했을 때 작동에 문제가 없었고, 사용자 리스트에서 이름과 이메일은 왼쪽에 보여지고 마지막 메시지 내용과 날짜는 오른쪽에 보여지는 것을 확인할 수 있었다.
      - 커밋한 코드를 확인하다가 알게된 사실인데, 폰트 사이즈를 rem이 아닌 em으로 구성하고 맞춰놓았기 때문에 rem으로 다시 변경해서 이전과 크기가 같도록 변경해줘야 한다.
      - 이름과 이메일 폰트 크기나 색은 변경을 더이상 하지 않아도 되지만, 마지막 메시지 내용과 날짜의 폰트 크기나 색은 좀 더 자연스럽게 보이도록 폰트 크기와 색을 조정해줘야 할 것 같다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/eeda3e2737649fdba6d17a2d75422c24713996fe)

<br />

- 추가 및 해결 해야 할 내용
  - 채팅과 관련된 내용 구성
    - 사용자-관리자 사이의 방 번호를 설정해서 서로 채팅이 보이도록 구현해야 함
      - 관리자 부분에서 사용자 \_id를 가져오고 해당 방으로 들어가는 내용을 구성해야 함
        - 관리자 채팅을 열면, 사용자 리스트가 보여지고 거기서 클릭해서 들어간 사용자 \_id의 정보가 넘어와서 사용될 수 있도록 추가 구성을 해야 함
      - 관리자 채팅창에서는 채팅 버튼 클릭 시, 바로 채팅창이 들어가지는 것이 아닌 채팅창을 선택해서 들어갈 수 있도록 사용자 항목을 만들어줘야 함
        - 관리자 채팅에서 채팅 버튼을 클릭하면 채팅방이 열리는 것이 아닌, 사용자 리스트가 열리도록 수정한 상태로, 사용자를 클릭하면 사용자 \_id가 넘어오는 것까지는 확인해서 추가로 내용을 수정해서 사용자 채팅방으로 넘어가도록 구성해줘야 함
    - 스크롤 작동에서 추가 작업을 해봐야 함
      - 대부분의 스크롤 문제는 해결되었지만, 상대방이 새로운 메시지를 추가했을 때 스크롤이 맨 밑에 있다면 그대로 스크롤도 함께 이동되어야 하지만 스크롤이 이동되지 않고 새로운 메시지 버튼이 뜨기 때문에 이 부분을 수정해줘야 함
      - 이 부분은 수정해서 정상적으로 작동하지만, 수치를 조금 변경해서 세부 조정이 필요함
    - 사용자 계정이 삭제될 때, 해당 채팅도 함께 사라지도록 구성을 변경해줘야 함
    - 채팅창에서 사용되는 함수 이름 변경도 생각을 해봐야 하는데, 좀 더 명확하게 표현할 필요성을 느낌
  - 코드 예외 처리 더 필요한 부분이 있는 지 체크해야 함
  - ul 요소 안의 자식이 li가 아닌, div나 프래그먼트로 사용되는 부분을 수정해야 함

# 오늘 느낀 점

- 사용자 리스트에서 마지막 메시지와 관련된 내용이 즉시 적용되도록 하려고 했으나, 이 내용을 구성하기 위해서는 AdminChats에서 사용하고 있던 내용을 가져와서 사용해야 하기 때문에 구성이 너무 복잡해지고 굳이 해줄 필요성을 못 느껴서 내용을 구성해주다가 삭제했다. 사용자 리스트에서 채팅창을 열고 닫는 버튼을 추가해서 자유롭게 다른 채팅창으로 이동할 수 있게 해줘야 하고, 사용자 리스트에서 많은 사용자가 추가되면 스크롤이 추가되어 이동할 수 있게 해줘야 한다. 우선 이 두 가지를 먼저 작업해주고 이후에 사용자 계정이 삭제될 때 그 사용자와 관련된 채팅도 사라지도록 해줄 생각이다.

<br />

# 내일 할 일

- React 공부 및 React 프로젝트 조금씩 진행하기

<br />

# 앞으로 해야 할 일

- React, NextJS 공부

- React 프로젝트 제작
