# 오늘 한 일

### React 프로젝트 제작 (React, NodeJS, MongoDB로 만드는 미니 커뮤니티 플랫폼)

- 구성한 내용

  - 사용자, 관리자 채팅 컬렉션을 하나로 공유해서 사용하도록 변경 및 사용자 채팅창에서 관리자 채팅을 출력하고 유지하도록 구성 변경
    - 사용자, 관리자 채팅 컬렉션을 따로 분리해서 구성했었는데, 이 내용을 변경해서 하나의 컬렉션을 공유해 사용하도록 구성해주고, 해당 컬렉션에 userType 항목을 추가시켜서 이 항목을 통해서, 사용자 채팅창에서 사용자 채팅과 관리자 채팅을 구분해서 출력하고 새로고침해도 관리자 채팅이 없어지지않고 그대로 유지되어 보여지도록 구성을 변경해주었다.
    - 백엔드 구성
      - user-chat-routes
        - req.body를 통해 넘어오는 데이터를 객체 디스트럭처링을 사용하도록 변경
          - userType 내용이 넘어오고 사용되지 않았는데, 사용되도록 함께 포함
        - 새로운 메시지가 저장될 때 userType도 함께 저장되도록 구성
        - 메시지가 저장되는 컬렉션을 chatMessages로 변경
        - 저장된 메시지를 가져오는 get 메소드 내용에서 userChat이 아닌 chatMessages 컬렉션에서 내용을 가져오도록 구성
          - sort를 사용해서 date를 기준으로 오름차순 정렬되도록 구성
      - admin-chat-routes
        - req.body를 통해 넘어오는 데이터를 객체 디스트럭처링으로 변경
          - userType 내용 포함
        - 새로운 메시지가 저장될 때, userId 내용과 userType 내용도 포함되도록 구성
        - 새로운 메시지가 저장되는 컬렉션을 chatMessages로 변경
        - get 메소드에서 메시지를 불러오는 내용의 컬렉션도 chatMessages에서 메시지를 가져오도록 변경
    - 프론트엔드 구성
      - Chats
        - userType 내용을 Chat 컴포넌트에 prop을 통해서 전달
      - Chat
        - 채팅창 내에서 userType 내용을 확인하고 분리해서 다른 className이 적용되도록 구성
      - AdminChats
        - userType 내용을 AdminChat 컴포넌트에 prop으로 전달
    - CSS 구성
      - Chat
        - 기본적으로 모든 채팅이 오른쪽에 붙도록 구성을 했지만, 내용을 변경해서 user-message class가 적용된 내용은 오른쪽, admin-message class가 적용된 내용은 왼쪽에 위치하도록 변경
    - 테스트 결과, 하나의 컬렉션에 사용자와 관리자가 입력한 채팅이 모두 저장되는 것을 확인할 수 있었고, 채팅의 userType을 통해서 사용자가 작성한 채팅인지, 관리자가 작성한 채팅인지 구분이 가능했으며, 사용자 채팅창에서 사용자가 작성했던 채팅은 오른쪽에 보이고, 관리자가 작성한 채팅은 왼쪽에 보이는 것을 확인했고 새로고침했을 때 관리자 채팅이 사라지지않고 그대로 유지되며 구분되어 보이는 것을 확인할 수 있었다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/df58480878c2bb03b2279ede0ea460dd89749f1f)

  <br />

  - 메시지를 출력할 때, 더 확실하게 구분하기 위해서 내용을 수정 및 AdminChats에서 userId를 백엔드로 전달, 관리자 채팅 부분에서 adminId 대신에 userId를 사용해서 내용을 가져오도록 변경
    - 사용자 채팅창에서 사용자 채팅과 관리자 채팅의 구분이 더 확실하게 되도록 구성 내용을 변경해주고, 관리자 채팅창에서도 사용자 채팅을 가져와서 보여줄 수 있도록 userId 내용을 fetch 함수의 params에 포함시켜서 백엔드에 전달하고, 관리자 get 메소드에서 채팅 내용을 adminId를 확인해서 가져왔으나, 사용자의 채팅도 함께 가져오기 위해서 adminId 대신에 userId를 사용해서 채팅 내용을 가져오도록 구성 변경
    - 백엔드 구성
      - params를 통해서 userId 내용을 받도록 하기 위해서, 엔드포인트에 userId 내용 추가
      - params를 통해서 전달받은 userId 내용을 new ObjectId로 변환해서, 저장된 메시지 내용을 가져올 때 사용
        - adminId 대신에 userId를 사용
        - 여기서 userId는 사실상 사용자의 방번호로 사용되고 있는데 이 때, 방에 저장된 모든 메시지를 가져오는 역할을 한다고 생각하면 됨
    - 프론트엔드 구성
      - AdminChats
        - usersData가 제대로 존재하는지 확인하는 if문 추가
        - userId 내용을 fetch 함수의 params를 통해서 백엔드로 전달해서 사용할 수 있도록 구성
      - AdminChat
        - Context API와 관련된 내용 추가
        - userType을 확인해서 admin-message 또는 user-message className이 적용되도록 구성
        - chat-bubble, message 부분에 테마 모드와 관련된 className 추가
    - CSS 구성
      - Chat
        - user-message
          - 채팅이 오른쪽에 보이도록 구성
        - admin-message
          - 채팅이 왼쪽에 보이도록 구성
        - admin-message .chat-bubble
          - 사용자 채팅과 다른 버블색으로 구성해주고, 왼쪽 위 대신에 오른쪽 위 radius가 적용되도록 구성
          - 다크 모드의 색도 추가
        - user-message .date
          - 기존의 left: -70px를 이쪽으로 옮기도록 수정
          - 날짜가 먼저 보여지고 그 다음 bubble과 텍스트 메시지가 보여지도록 구성
        - admin-message .date
          - right: -70px로 구성해서 bubble과 텍스트 메시지가 보여지고 그 오른쪽에 날짜가 보여지도록 구성
      - AdminChat
        - Chat 컴포넌트와 반대로, 여기서는 관리자 채팅이 본인이 작성한 채팅이 되기 때문에 admin-message 내용이 오른쪽에 보여지도록 위치해주고, 날짜가 먼저 보여지고 그 다음 채팅 내용이 보여지도록 구성
        - 반대로, user-message 부분은 오른쪽에 보여지도록 위치하고, 채팅 관련 내용이 먼저 보이고 그 다음 날짜가 오른쪽에 위치하도록 구성
        - 모드 변경에 따른 색 추가도 함께 구성
    - 테스트 결과, 관리자 채팅창에서도 사용자가 작성했던 채팅이 보여지는 것을 확인할 수 있었고, 실시간으로 사용자 채팅이 보여지며 새로고침해도 사라지지않고 그대로 유지되는 것을 확인할 수 있었다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/8ab9979ccf265ed628ca88f3b7b20e06ad5eaaa5)

<br />

- 추가 및 해결 해야 할 내용
  - 채팅과 관련된 내용 구성
    - 사용자-관리자 사이의 방 번호를 설정해서 서로 채팅이 보이도록 구현해야 함
      - 관리자 부분에서 사용자 \_id를 가져오고 해당 방으로 들어가는 내용을 구성해야 함
        - 관리자 채팅을 열면, 사용자 리스트가 보여지고 거기서 클릭해서 들어간 사용자 \_id의 정보가 넘어와서 사용될 수 있도록 추가 구성을 해야 함
      - 관리자 채팅창에서는 채팅 버튼 클릭 시, 바로 채팅창이 들어가지는 것이 아닌 채팅창을 선택해서 들어갈 수 있도록 사용자 항목을 만들어줘야 함
        - 이 내용을 구성하기 위해서 새로운 컴포넌트도 추가 했는데, 아직 로직을 완성하지 못해서 테스트해보지 못함
    - 스크롤 작동에서 추가 작업을 해봐야 함
      - 새로운 메시지가 뜨면, 아래로 가는 버튼이 사라지고, 새로운 메시지 버튼만 보이도록 해야 함
    - 사용자 계정이 삭제될 때, 해당 채팅도 함께 사라지도록 구성을 변경해줘야 함
    - 채팅창에서 사용되는 함수 이름 변경도 생각을 해봐야 하는데, 좀 더 명확하게 표현할 필요성을 느낌
  - 코드 예외 처리 더 필요한 부분이 있는 지 체크해야 함
  - ul 요소 안의 자식이 li가 아닌, div나 프래그먼트로 사용되는 부분을 수정해야 함

# 오늘 느낀 점

- 사용자 계정 하나만 관리자와 연결해서 테스트해본 것까지는 문제없이 작동이 되었는데, 최종적으로는 사용자 한명과의 채팅 연결이 아닌, 모든 사용자와 채팅이 연결되어야 하기 때문에 사용자 리스트가 관리자 채팅에서 뜨고 선택할 수 있도록 구성을 해줘야 한다. 그리고 이제 스크롤을 위로 올린 상태에서 새로운 메시지가 뜨면 새로운 메시지 버튼이 밑으로 이동하는 버튼 대신에 뜨고 클릭할 수 있도록 되어야 하며, 추가로 사용자 계정을 삭제했을 때 사용자 채팅과 관련된 내용도 모두 삭제될 수 있도록 구성을 해줘야 한다. 최우선으로 해줘야 할 내용은 어느정도 구성이 되어있는 내용으로, 스크롤을 위로 올린 상태에서 새로운 메시지가 추가되었을 때 밑으로 이동하는 버튼이 아닌, 새로운 메시지 버튼이 보여지도록 구성을 해줘야 하고, 그 다음 사용자 리스트가 관리자 채팅에서 보여지며 선택할 수 있도록 구성을 해줘야 한다. 마지막으로 사용자 계정 삭제 시에 관련된 모든 채팅 내용이 사라지도록 하는 내용을 구성해줘야 한다.

<br />

# 내일 할 일

- React 공부 및 React 프로젝트 조금씩 진행하기

<br />

# 앞으로 해야 할 일

- React, NextJS 공부

- React 프로젝트 제작
