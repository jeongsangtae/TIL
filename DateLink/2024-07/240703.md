# 오늘 한 일

### React 프로젝트 제작 (React, NodeJS, MongoDB로 만드는 미니 커뮤니티 플랫폼)

- 구성한 내용

  - 새로운 메시지가 추가되었을 때, 스크롤 위치를 좀 더 세부적으로 확인하는 조건부가 적용되도록 구성
    - 본인이 작성한 메시지는 문제가 없지만, 상대방이 메시지를 입력하고 넘어오는 부분에서 스크롤이 어디에 있던지 새로운 메시지 버튼이 뜨고 스크롤이 바로 밑으로 내려가지 않기 때문에, 스크롤 위치를 좀 더 세부적으로 나눠서 조건이 다르게 적용되도록 구성해주었다.
    - 프론트엔드 구성
      - 스크롤이 거의 아래에 있는 경우의 값을 구하는 변수 추가
        - 스크롤이 맨 아래에서 조금 위로 올라와 있는 상태를 구하기 위해서 맨 밑 구하는 값에 -100을 추가
      - 새로운 메시지가 추가되었을 때 사용되는 useEffect 내용에서 중간에 else if를 하나 추가해서, 스크롤이 아래쪽에 있는지 확인하고 마지막으로 들어온 메시지가 admin userType인지 확인해서 일치하는 경우, 스크롤이 맨 밑으로 이동하도록 구성
      - 관리자 채팅 부분에서는 admin을 user로 변경해서 구성
        - 코드 저장을 하지 않고, 커밋해서 추가로 다시 저장하고 커밋함
    - 테스트 결과, 스크롤이 조금 올라가 있을 때 상대방의 채팅이 추가되면 새로운 메시지 버튼이 뜨지 않고, 바로 스크롤이 맨 밑으로 이동해서 즉시 보여지는 것을 확인할 수 있었다.
      - 조금 더 테스트해보고 수치 조절을 추가로 해줘야 할 것 같음
    - [코드 내용 1](https://github.com/jeongsangtae/mini-community-platform/commit/5627c69837574e4465fe4d040b0b0d8e2b0f678c)
    - [코드 내용 2](https://github.com/jeongsangtae/mini-community-platform/commit/4598065b7e8a05bcda85b04d3b7d5fafc9a91656)

  <br />

  - 관리자 채팅 부분에서 사용자 리스트 내용을 수정 및 사용자 개별 컴포넌트를 추가 그리고 모든 사용자가 사용자 리스트에 제대로 출력되도록 구성
    - 관리자가 사용자를 선택하고 해당 사용자와 채팅을 할 수 있도록 사용자 리스트 내용을 수정해주고, 사용자 리스트 내용에서 사용되는 사용자들을 따로 분리해서 내용 구성하기 위해서 컴포넌트를 추가해주고, 관리자 채팅에서 버튼을 통해서 채팅을 열면 모든 사용자가 리스트에 나오도록 구성을 해주었다.
    - 프론트엔드 구성
      - AdminMainHeader
        - AdminChats 대신에, AdminUserList 컴포넌트가 보여지도록 변경
      - AdminUserList
        - useLoaderData를 통해서 가져온 사용자 정보를 map 함수를 사용해서, AdminUserItem 컴포넌트에 prop으로 전달
        - prop으로 전달되는 내용은 사용자 \_id, 이름, 이메일 그리고 AdminChats 컴포넌트에 다시 전달할 관리자 \_id, 이메일 내용을 전달
      - AdminUserItem
        - boolean 값을 저장하는 useState를 추가
        - AdminUserList를 통해서 전달 받은 사용자 정보로 내용을 구성
          - 사용자 정보를 버튼으로 감싸서 클릭될 수 있도록 구성
          - 버튼을 클릭하면 구성한 useState의 값이 변경되도록 구성
        - useState의 true, false 값에 따라서 AdminChats 컴포넌트가 보여지거나 보여지지않도록 구성
          - 사용자 정보가 보여지는 버튼을 클릭하면 false에서 true로 바뀌면서 채팅방이 열리는 구조로 구성
          - 현재는 제대로 열고 닫는게 안되지만, 콘솔에서 어떤 사용자를 클릭했는지 사용자 \_id는 넘어오는 것을 확인
        - 버튼을 통해서 채팅창이 열릴 때, 관리자 \_id와 이메일이 prop으로 전달되도록 구성
          - 현재 관리자 \_id와 이메일이 굳이 필요한가 싶은 생각이 들어서 이 내용은 삭제할 예정으로, 굳이 관리자 내용이 필요없을 것 같아서 백엔드에서도 삭제하는 방향으로 생각해봐야 함
      - AdminChats
        - usersData 대신에, prop을 통해서 전달받은 userId를 사용
          - userId 이름이 겹치기 때문에 여기서 리네이밍해서, chatRoomId로 사용
          - 사실상 userId는 방 번호로 사용되기 때문에 chatRoomId라는 이름을 사용
        - 테스트를 위해서 사용되었던 "usersData[0].\_id" 대신에, chatRoomId 내용이 들어가도록 변경
          - 사용되었던 모든 "usersData[0].\_id" 대신에 chatRoomId 내용을 넣어서 구성
    - 테스트 결과, 관리자 페이지에서 채팅창을 열면 바로 채팅방이 뜨는 것이 아닌, 사용자 리스트가 뜨고 여기서 사용자를 클릭하면 해당 사용자의 채팅방이 잠깐 떴다가 사라지는 것을 확인할 수 있었다.
      - 테스트를 위해서 구성한 내용으로, 제대로 채팅창이 뜨지는 않지만 콘솔에서 클릭한 사용자의 \_id 정보가 출력되는 것을 확인했기 때문에 여기에 구성을 조금 추가해주면 제대로 채팅창이 뜨는 것을 확인할 수 있을 것 같다.
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/bb7aa0f5a5dccf942d5c03ccaff8db82d53a37f6)

<br />

- 추가 및 해결 해야 할 내용
  - 채팅과 관련된 내용 구성
    - 사용자-관리자 사이의 방 번호를 설정해서 서로 채팅이 보이도록 구현해야 함
      - 관리자 부분에서 사용자 \_id를 가져오고 해당 방으로 들어가는 내용을 구성해야 함
        - 관리자 채팅을 열면, 사용자 리스트가 보여지고 거기서 클릭해서 들어간 사용자 \_id의 정보가 넘어와서 사용될 수 있도록 추가 구성을 해야 함
      - 관리자 채팅창에서는 채팅 버튼 클릭 시, 바로 채팅창이 들어가지는 것이 아닌 채팅창을 선택해서 들어갈 수 있도록 사용자 항목을 만들어줘야 함
        - 관리자 채팅에서 채팅 버튼을 클릭하면 채팅방이 열리는 것이 아닌, 사용자 리스트가 열리도록 수정한 상태로, 사용자를 클릭하면 사용자 \_id가 넘어오는 것까지는 확인해서 추가로 내용을 수정해서 사용자 채팅방으로 넘어가도록 구성해줘야 함
    - 스크롤 작동에서 추가 작업을 해봐야 함
      - 대부분의 스크롤 문제는 해결되었지만, 상대방이 새로운 메시지를 추가했을 때 스크롤이 맨 밑에 있다면 그대로 스크롤도 함께 이동되어야 하지만 스크롤이 이동되지 않고 새로운 메시지 버튼이 뜨기 때문에 이 부분을 수정해줘야 함
      - 이 부분은 수정해서 정상적으로 작동하지만, 수치를 조금 변경해서 세부 조정이 필요함
    - 사용자 계정이 삭제될 때, 해당 채팅도 함께 사라지도록 구성을 변경해줘야 함
    - 채팅창에서 사용되는 함수 이름 변경도 생각을 해봐야 하는데, 좀 더 명확하게 표현할 필요성을 느낌
  - 코드 예외 처리 더 필요한 부분이 있는 지 체크해야 함
  - ul 요소 안의 자식이 li가 아닌, div나 프래그먼트로 사용되는 부분을 수정해야 함

# 오늘 느낀 점

- 스크롤 관련 문제는 사실상 거의 다 끝냈는데, 여기서 조건부에 사용될 변수의 수치 조정만 조금해서 적절한 위치를 잡아주면 될 것 같다. 관리자 채팅 부분에서 이제 채팅 컨테이너를 열면 바로 채팅방이 보여지는 것이 아닌, 사용자 리스트가 보여지는데 여기서 사용자를 클릭하면 해당 사용자와 채팅할 수 있는 채팅방으로 이동이 되는 것이 목표인데, 현재는 테스트를 위해서 구성했기 때문에 잠깐 채팅방이 떴다가 사라지는 것을 확인할 수 있었다. 하지만 사용자를 클릭하면 콘솔에서 사용자 \_id가 출력되는 것을 확인했기 때문에 내용을 조금 추가해주고 수정해주면 정상적으로 클릭한 사용자 채팅방에 접속해서 채팅할 수 있을 것 같다는 생각이 든다. 여기서 조금 생각해봐야 할 부분은 사용자 리스트에서 사용자를 클릭하고 채팅방이 열리는데 이 내용을 메인헤더나 사용자 리스트 쪽으로 옮겨서, 해당 컴포넌트에서 버튼 클릭 시 열리는 구조로 변경하는 방향도 고려를 해봐야 할 것 같다. 사용자 리스트에서는 단순하게 열리는 작동을 감지만 해서 상태 끌어올리기로 부모 컴포넌트에 내용을 전달해서 부모 컴포넌트에서 채팅방이 열리고 닫히는 작동을 하는게 좋을 것 같다는 생각도 든다.

<br />

# 내일 할 일

- React 공부 및 React 프로젝트 조금씩 진행하기

<br />

# 앞으로 해야 할 일

- React, NextJS 공부

- React 프로젝트 제작
