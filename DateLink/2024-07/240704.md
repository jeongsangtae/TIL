# 오늘 한 일

### React 프로젝트 제작 (React, NodeJS, MongoDB로 만드는 미니 커뮤니티 플랫폼)

- 구성한 내용

  - AdminUserItem 컴포넌트를 간소화 및 AdminUserList에서 AdminChats 컴포넌트를 사용하도록 구성
    - AdminUserItem에서 구성된 AdminChats 관련 내용을 AdminUserList 컴포넌트로 옮기고, AdminUserList에서 방 이동과 관련된 함수를 구성해서 AdminUserItem에 사용자 정보를 넘겨서 AdminUserItem이 클릭되면 해당 정보를 상태 끌어올리기로 다시 가져와서 이 내용을 useState에 저장해서 해당 정보를 AdminChats에 전달하도록 구성
    - 프론트엔드 구성
      - AdminUserItem
        - 해당 컴포넌트에서 사용자 클릭 시 AdminChats이 열리도록 구성 했으나, AdminChats 내용을 AdminUserList로 옮기고 간단하게 구성
        - AdminUserList에서 사용자를 클릭하면 사용자 정보가 넘어와서 이 정보를 다시 AdminUserList에 전달하도록 구성
          - AdminUserList에서 구성된 함수를 통해서 어떤 사용자가 클릭되었는지 정보를 받고, 그 사용자 정보를 다시 전달받은 함수에 전달
          - 상태 끌어올리기를 통해서 어떤 사용자가 클릭되었는지 확인시키는 구성
          - 좀 생각해보고 굳이 필요없는 구성이면 삭제할 예정
      - AdminUserList
        - AdminChats 컴포넌트 import, 선택한 사용자 채팅방 \_id를 저장하는 useState 추가
        - 사용자 채팅방으로 이동하는 함수를 추가
          - 이 내용에 어떤 사용자 채팅방이 선택되었는지 알 수 있게 업데이트되는 useState 추가
        - AdminUserItem 컴포넌트에 adminId, adminEmail 내용은 전달하지 않고, 사용자 채팅방으로 이동하는 함수를 prop으로 전달
          - 이 내용은 상태 끌어올리기로 정보를 전달받는데 사용
        - AdminChats 내용은 선택된 사용자 채팅방이 있다면 AdminChats 컴포넌트를 열고 여기에 선택한 사용자 채팅방 \_id 내용과 관리자 \_id, 이메일을 전달하도록 구성
    - 테스트 결과, 작동은 크게 달라진 것은 없으며 단지, AdminUserItem 컴포넌트를 간소화하고 AdminUserItem에서는 클릭 동작만 실행해서 관련 내용을 다시 AdminUserList로 전달해서 AdminUserList에서 클릭한 사용자와 관련된 AdminChats 컴포넌트가 열리도록 구성
      - 이렇게 구성한 결과, AdminUserItem 컴포넌트의 유무가 굳이 필요한가라는 의문이 들어서 없애는 방향도 생각을 해봐야 함
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/cfe85833b6271191648304f2fe0f30a482843e87)

  <br />

  - 사용자 채팅방을 열고 닫을 수 있는 toggle을 추가 및 사용자 각자의 채팅에 저장된 메시지가 출력되도록 구성
    - 사용자 리스트에서 사용자를 클릭했을 때, 해당 사용자 채팅방이 열릴 수 있도록 toggle 관련 구성을 해주고, 채팅방이 열리고 해당 채팅방에 저장된 채팅이 모두 보이도록 구성을 해주었다.
    - 프론트엔드 구성
      - AdminUserList
        - 사용자를 클릭했을 때, 채팅방을 열어주는 toggle 함수와 useState 추가
          - 사용자 클릭 시, AdminUserItem에서 userId를 전달 받고 채팅방을 열어주는 함수가 실행되도록 구성
          - 채팅방을 열어주는 함수는 실행되면 useState 값의 반대로 전환이 되며 채팅창이 열리는 구조
        - 채팅창 toggle과 관련된 내용을 조건부로 구성하고, true가 되었을 때 AdminChats에 해당 토글 내용을 전달하도록 구성
          - 채팅방과 관련된 useState가 false로 지정되어 있다가, 사용자를 클릭하면 true로 바뀌면서 AdminChats에 토글 내용이 prop으로 전달
      - AdminChats
        - 전달 받은 toggle 내용을 chatToggle 대신에 사용해서, 사용자가 클릭되면 toggle 내용이 true가 되면서, className에 open 이라는 내용이 적용되어 AdminChats 컴포넌트가 보여지도록 구성
        - 저장된 메시지를 보여주는 useEffect의 의존성 배열에 prop으로 전달 받은 chatRoomId 내용을 추가해서 AdminChats 컴포넌트가 열릴 때, 이 채팅방에 저장된 메시지가 보여지도록 구성
        - AdminChats 컴포넌트에서, 채팅창을 여는 버튼이 보이지 않도록 주석 처리
    - 테스트 결과, 사용자 리스트에서 사용자를 클릭하면 AdminChats에 사용자 \_id가 전달되어 방 번호로 사용되고 이 방 번호를 확인해서 일치하는 모든 메시지가 보여지는 것을 확인할 수 있었다.
      - 처음 테스트할 때는 저장된 메시지가 보여지지 않고 실시간 채팅으로 전달된 내역은 문제없이 보여졌었는데, 추가로 수정을 해서 채팅방에 들어왔을 때 DB에 저장되어 있던 메시지도 보여지는 것을 확인할 수 있었다.
      - 사용자 \_id, 즉 방 번호가 일치하지 않는다면 다른 사용자의 채팅은 보여지지 않는 것도 확인
    - [코드 내용](https://github.com/jeongsangtae/mini-community-platform/commit/a862b930172d773d5b6aa82536cd2c0d642163d0)

<br />

- 추가 및 해결 해야 할 내용
  - 채팅과 관련된 내용 구성
    - 사용자-관리자 사이의 방 번호를 설정해서 서로 채팅이 보이도록 구현해야 함
      - 관리자 부분에서 사용자 \_id를 가져오고 해당 방으로 들어가는 내용을 구성해야 함
        - 관리자 채팅을 열면, 사용자 리스트가 보여지고 거기서 클릭해서 들어간 사용자 \_id의 정보가 넘어와서 사용될 수 있도록 추가 구성을 해야 함
      - 관리자 채팅창에서는 채팅 버튼 클릭 시, 바로 채팅창이 들어가지는 것이 아닌 채팅창을 선택해서 들어갈 수 있도록 사용자 항목을 만들어줘야 함
        - 관리자 채팅에서 채팅 버튼을 클릭하면 채팅방이 열리는 것이 아닌, 사용자 리스트가 열리도록 수정한 상태로, 사용자를 클릭하면 사용자 \_id가 넘어오는 것까지는 확인해서 추가로 내용을 수정해서 사용자 채팅방으로 넘어가도록 구성해줘야 함
    - 스크롤 작동에서 추가 작업을 해봐야 함
      - 대부분의 스크롤 문제는 해결되었지만, 상대방이 새로운 메시지를 추가했을 때 스크롤이 맨 밑에 있다면 그대로 스크롤도 함께 이동되어야 하지만 스크롤이 이동되지 않고 새로운 메시지 버튼이 뜨기 때문에 이 부분을 수정해줘야 함
      - 이 부분은 수정해서 정상적으로 작동하지만, 수치를 조금 변경해서 세부 조정이 필요함
    - 사용자 계정이 삭제될 때, 해당 채팅도 함께 사라지도록 구성을 변경해줘야 함
    - 채팅창에서 사용되는 함수 이름 변경도 생각을 해봐야 하는데, 좀 더 명확하게 표현할 필요성을 느낌
  - 코드 예외 처리 더 필요한 부분이 있는 지 체크해야 함
  - ul 요소 안의 자식이 li가 아닌, div나 프래그먼트로 사용되는 부분을 수정해야 함

# 오늘 느낀 점

- 사용자 한명이 아닌, 모든 사용자 개인이 관리자와 따로 채팅을 할 수 있게 구성이 되었고, 사용자가 관리자와 나눴던 채팅 메시지가 다른 사용자 채팅방에서 보여지지 않는 것도 확인할 수 있었으며, 관리자 채팅쪽에서만 사용자를 선택해서 채팅하기 때문에 사용자 측에서 다른 사용자가 자신의 메시지를 보거나 하는 보안 부분은 문제가 없을 것 같다는 생각이 든다. 현재 구성된 내용에서 사용자를 클릭하면 그 사용자와 채팅하는 채팅방이 새롭게 나타나는 구조로 구성이 되어있기 때문에, 이 구조에서 애니메이션을 없애고 단순하게 채팅 쪽에서 페이지가 이동되는 것처럼 보이도록 구성을 변경해줘야 하고, 현재 사용자와 채팅을 종료하고 다른 사용자와 채팅하기 위해서 뒤로 가기 버튼으로 사용자 리스트로 다시 이동하는 버튼이 필요하다고 생각된다. 그리고 사용자 리스트도 CSS를 좀 추가해서 깔끔한 UI로 구성을 해줘야 할 것 같다.

<br />

# 내일 할 일

- React 공부 및 React 프로젝트 조금씩 진행하기

<br />

# 앞으로 해야 할 일

- React, NextJS 공부

- React 프로젝트 제작
