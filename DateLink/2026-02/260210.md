# 오늘 한 일

### React + TypeScript 프로젝트 제작 (React, TypeScript, ExpressJS, MongoDB로 만드는 실시간 통신 애플리케이션)

- 재정렬된 그룹 채팅방 목록 출력 관련 로직 추가 (실시간 반영 포함) 및 그룹 채팅방 드래그, 드롭 관련 내용 수정
  - 재정렬된 그룹 채팅방 목록을 불러와 해당 순서대로 보여질 수 있도록 로직을 추가 및 수정하고 드래그와 드롭 시 변경된 그룹 채팅방 목록 순서가 실시간으로 반영되도록 내용 수정
  - 백엔드
    - user-routes
      - 재정렬된 그룹 채팅방 목록을 업데이트하는 PATCH 라우터에 주석 추가
  - 프론트엔드
    - authStore
      - updateUserGroupChatOrder 액션 추가
        - 매개변수로 그룹 채팅방 ID 목록을 전달받도록 구성
        - set을 통해 업데이트하는 내용 추가
          - 이전에 저장된 사용자 정보가 유효한지 확인하는 내용 추가
          - userInfo 상태에서 groupChatOrder 항목은 매개변수로 넘어오는 내용으로 업데이트하고, 나머지 항목은 그대로 유지한 채로 반환하도록 구성
    - GroupChats
      - useAuthStore Zustand에서 updateUserGroupChatOrder 액션을 불러오도록 구성
      - sortedGroupChats useMemo
        - 사용자 정보의 groupChatOrder 내용 존재하는지 확인하는 조건부 추가
          - 만약 존재하지 않을 경우 그룹 채팅방 목록을 반환
          - 정렬 기준이 없으면 현재 순서를 유지하는 내용
        - orderMap 변수 추가
          - `const orderMap = new Map(userInfo.groupChatOrder.map((id, index) => [id, index]))`
          - Map으로 만들어 채팅방 ID를 정렬 순서로 설정
          - `orderMap.get`을 통해 빠르게 찾기 위해 구성
        - 정렬한 내용을 반환하는 내용 추가
          - `return [...groupChats].sort((a, b) => {...}`
          - groupChats를 복사해 정렬하는 내용
          - groupChats를 복사해 각 채팅방의 order index를 찾아서 a 채팅방과 b 채팅방이 몇 번째여야 하는지 확인
            - `const aIndex = orderMap.get(a._id)`
            - `const bIndex = orderMap.get(b._id)`
          - order 즉, groupChatOrder에 포함되지 않은 새롭게 생성된 채팅방은 맨 뒤에 정렬되어 보여지도록 구성
            - `if (aIndex === undefined) return 1`
            - `if (bIndex === undefined) return -1`
            - a가 order에 없으면 뒤로 보내고, b가 order에 없으면 앞에 둠
          - index 차이로 정렬해 반환하는 내용
            - `return aIndex - bIndex`
            - 해당 내용이 음수면 a가 앞으로 가고, 양수면 b가 앞으로 이동, 0이면 순서를 유지
            - ex) aIndex = 1, bIndex = 3일 경우 -2로 음수이기 때문에 a가 앞에 정렬
        - 의존성 배열로 userInfo?.groupChatOrder, groupChats를 사용
      - dragStartHandler 함수 수정
        - setActiveIndex를 통해 업데이트하는 내용에서 groupChats 대신 sortedGroupChats가 사용되도록 수정
      - dragOverHandler 함수 수정
        - setOverIndex를 통해 업데이트하는 내용에서 groupChats 대신 sortedGroupChats가 사용되도록 수정
      - dragEndHandler 함수 수정
        - reorderGroupChats 액션 내용 사용하지 않도록 수정
        - oldIndex, newIndex 변수 수정
          - prev가 아닌, sortedGroupChats에서 findIndex를 찾도록 구성
        - sortableGroupChats 변수 수정
          - newOrderChats으로 이름을 변경하고, arrayMove에 prev 대신 sortedGroupChats를 전달
        - newOrderIds 변수 추가
          - newOrderChats 변수에 map을 사용해 새로운 배열을 만들어 채팅방 ID만 뽑아내 저장하도록 구성
        - updateUserGroupChatOrder 액션 추가
          - newOrderIds를 전달하도록 구성
        - saveGroupChatOrder 액션 수정
          - newOrderIds를 전달하도록 수정
      - JSX 코드 내용 수정
        - groupChats.map을 사용하는 내용을 주석 처리
          - 해당 내용은 주석 처리하고, 복사해 groupChats 대신 sortedGroupChats에 map을 사용하는 내용으로 구성해 테스트
  - 변경된 그룹 채팅방 목록 순서 정보를 불러와 해당 정보대로 정렬되어 보여지도록 구성한 내용을 확인한 결과, 사용자 정보에 저장된 정보를 토대로 그룹 채팅방 목록이 정렬되어 보여지는 것을 확인했고, 정렬된 목록에서 드래그와 드롭으로 순서를 수정하면 해당 내용이 실시간 반영되어 수정되는 것 또한 확인했으며, 새롭게 채팅방을 추가하면 정렬된 목록 중간이나 최상단으로 가는 것이 아닌 최하단에 포함되어 보여지는 것을 확인할 수 있었다.
    - 사용자 정보에 저장된 그룹 채팅방 목록 정보를 불러와 출력하고, 드래그와 드롭으로 변경된 그룹 채팅방 순서가 실시간 반영되는 내용은 문제가 없지만, 새롭게 추가한 액션이나 여러 내용에서 타입 에러가 발생하고 있기 때문에 이에 대한 수정 필요
    - 실시간 반영 관련 액션을 사용자 관련 Zustand가 아닌, 그룹 채팅방 관련 Zustand에 옮기는 것을 고려해야 함
    - 그룹 채팅방 새롭게 추가 또는 삭제 시, 사용자 정보에 저장된 그룹 채팅방 목록 내용이 실시간으로 반영되지 않고 있으므로 이에 대한 추가 수정 필요
    - 다이렉트 채팅방 목록, 그룹 채팅방 내의 사용자 목록, 사용자 정보가 보여지는 아바타 내용에서 테두리 두께 설정 확인 필요
    - 로그인, 회원가입 페이지 배경에 사용되는 여러 이미지를 더 추가해 테스트해봐야 함
    - 해야 할 일에 정리된 내용 처리 필요
    - 다이렉트 채팅방 순서가 변경될 때 부드럽게 변경되는 기능
    - 그룹 채팅방 우클릭 시에 보여지는 컨텍스트 메뉴 CSS 수정 필요 (위치, UI 등)
    - 다크 모드 및 라이트 모드 관련 내용
    - 화면 투명도 관련 내용
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/258b07b4bc125d67e843c250d24b28549ac1f69f)

# 오늘 느낀 점

- 사용자 정보에 저장된 그룹 채팅방 목록 정보를 불러오고 해당 내용을 토대로 그룹 채팅방 목록이 보여지도록 구성한 내용은 문제없이 보여지고 있으며, 드래그와 드롭을 통해 변경된 채팅방 목록이 실시간으로 반영되어 보여지는 것 또한 문제가 없었고, 실시간으로 반영된 내용과 동일하게 데이터가 저장되어 새로고침했을 때 이전과 동일한 순서로 보여지는 것 또한 문제가 없는 것을 확인해주었다. 새로운 채팅방을 추가하면 기존 목록의 마지막에 추가되어 보여지도록 구성된 상태인데, 새로운 채팅방 ID가 사용자 정보에 저장된 그룹 채팅방 목록 데이터에 실시간으로 포함되지 않고 있기 때문에 이에 대한 수정이 필요하고, 반대로 기존 채팅방을 삭제했을 때 사용자 정보에 저장된 그룹 채팅방 목록 데이터에서 삭제한 채팅방 ID가 실시간 반영되어 삭제되지 않고 그대로 남아있는 문제 또한 발견했기 때문에 이에 대한 내용도 수정할 생각이다. 실시간 반영 관련 액션 내용을 사용자 Zustand에 구성한 상태인데, 이 내용을 해당 위치에 그대로 남겨두는 것이 맞는지 아니면 그룹 채팅방 Zustand에 옮겨서 구성하는 것이 맞는지 확인이 필요하며, 새롭게 추가한 액션이나 여러 내용에서 타입 에러가 발생하고 있기 때문에 타입 정의를 추가해 타입 에러가 발생하지 않도록 수정해줄 생각이다.

<br />

# 내일 할 일

- 실시간 통신 애플리케이션 (Float Chat) 프로젝트 진행

- Zustand 내용 구성

- 닉네임 수정과 그룹 채팅방 제목 수정 내용에서 사용하지 않거나 필요없는 정보를 삭제해 코드 정리를 해야 함 (중복된 데이터 전송이나 사용하지 않는 데이터 전송 관련 내용 등)

- 그룹 채팅방에서 다른 사용자를 클릭할 수 있고, 클릭 시에 다이렉트 채팅방이 생성되어 채팅을 나눌 수 있도록 구성하는 것을 고려중 (이 방법 대신, 다른 사용자 클릭 시에 프로필이 보여지도록 구성하고 그 내용을 통해 다이렉트 메시지를 보내거나 프로필 내용을 보는 그런 방식으로 구성해야 함)

- 다이렉트 채팅방 목록이 정렬될 때 부드럽게 위로 올라가고 내려가는 CSS 적용 필요

- 친구 관련된 내용에서 코드 정리 필요 (코드를 깔끔하게 보이도록 수정 필요)

- 여러 Zustand에 구성된 실시간 반영 로직들이 재사용될 수 있도록 커스텀 훅에 옮겨서 구성하는 것을 고려해야 함

- 다크 모드 고려해야 함

<br />

# 앞으로 해야 할 일

- React, TypeScript 공부

- React 상태 관리 도구인 Zustand 공부

- 실시간 통신 애플리케이션 프로젝트 제작
