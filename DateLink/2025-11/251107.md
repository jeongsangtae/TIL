# 오늘 한 일

### React + TypeScript 프로젝트 제작 (React, TypeScript, ExpressJS, MongoDB로 만드는 실시간 통신 애플리케이션)

- 그룹 채팅방 내의 온라인 사용자 목록 확인 관련 내용 테스트
  - 그룹 채팅방 내의 사용자 목록에서 온라인 상태의 사용자를 걸러내고 해당 사용자 정보를 추출한 뒤 온라인 유무 내용을 포함시켜 소켓 이벤트로 전달하도록 구성하고 해당 내용을 받아서 실시간 반영시키는 내용 구성해 테스트
  - 백엔드
    - app
      - registerUser 소켓 이벤트 수정
        - for of문 추가
          - 그룹 채팅방 목록을 돌아다니며 사용자 목록에서 온라인 상태의 사용자를 찾고 온라인 유무 내용을 포함해 소켓 이벤트로 전달하도록 구성
          - onlineParticipantIds 변수 추가
            - 그룹 채팅방 내의 사용자 목록에 filter를 사용해 온라인 상태의 사용자를 찾도록 구성
          - onlineParticipantInfos 변수 추가
            - 온라인 상태의 사용자 목록에 map을 사용해 사용자 id와 users 컬렉션 내에 저장된 \_id가 일치하는 사용자 정보를 찾도록 구성
            - 비밀번호는 제외한 정보를 찾도록 구성
          - onlineParticipantOnlineChecked 변수 추가
            - 찾은 온라인 상태의 사용자 정보에 onlineChecked 항목을 추가하고 true로 설정해 기존 사용자 정보에 온라인 유무 내용을 추가
          - groupChatUpdateOnlineUser 소켓 이벤트 관련 내용 추가
            - to는 "room-${groupChat.\_id}"로 설정해 관련된 채팅방에 참여한 모든 사용자에게 전달하도록 구성
            - onlineParticipantOnlineChecked 내용을 통해 온라인 상태의 사용자 정보와 온라인 유무 내용을 전달
  - 프론트엔드
    - groupChatStore
      - getGroupChatUsers 액션 수정
        - socket.off 추가
          - groupChatUpdateOnlineUser 소켓 이벤트 관련 중복이 발생하지 않도록 추가
        - socket.on 추가
          - groupChatUpdateOnlineUser 소켓 이벤트를 통해 onlineParticipantOnlineChecked 내용을 전달받도록 구성
          - 콘솔 로그를 추가해 onlineParticipantOnlineChecked 내용이 전달되는지 확인
          - 그룹 채팅방 내의 사용자 목록에 map을 사용
          - found 변수 추가
            - onlineParticipantOnlineChecked 내용에 find를 사용해 온라인 상태의 사용자 \_id와 그룹 채팅방 내의 사용자 \_id를 비교
            - 비교해 일치하면 그대로 사용자 정보를 반환
            - 일치하지 않으면 onlineParticipantOnlineChecked 내용을 반환
            - 실수로 수정한 내용을 저장하지 않고 커밋해서 추가 설명
              - 비교해 일치하면 사용자 정보와 onlineChecked 내용을 true로 반환
              - 일치하지 않으면 사용자 정보와 onlineChecked 내용을 false로 반환
  - 그룹 채팅방 내의 사용자 목록에서 걸러낸 온라인 상태의 사용자 목록에서 사용자 정보를 찾고 그 내용에 온라인 유무 관련된 내용을 포함시켜 소켓 이벤트를 통해 프론트엔드로 전달해 프론트엔드에서 실시간 반영하도록 구성한 뒤 확인한 결과, 생각한 것과 다르게 사용자가 로그인해도 그룹 채팅방 내의 사용자 목록에서 실시간 반영되어 온라인 상태로 변경되지 않는 것을 확인했기 때문에 추가로 수정해야 한다.
    - 백엔드에서 소켓 이벤트로 전달하는데, 이 때 방 번호를 통해 전달하는 구조가 잘못된 건지 아니면 프론트엔드의 그룹 채팅방 내 사용자 목록을 불러오는 액션에서 연결되는 소켓을 구성한게 잘못된 건지 확인이 필요함
    - 수정한 채팅 목록 구조와 버튼들이 문제없는지 다시 한 번 확인을 해봐야 함
    - 로그인, 회원가입 페이지 배경에 사용되는 여러 이미지를 더 추가해 테스트해봐야 함
    - 해야 할 일에 정리된 내용 처리 필요
  - [코드 내용](https://github.com/jeongsangtae/float-chat/commit/64a6ec5d387582eb0f0ade661754511c85370b08)

# 오늘 느낀 점

- 온라인 상태의 사용자 목록에서 사용자 정보를 찾고 해당 내용에 온라인 유무 관련 내용을 포함시켜 전달해 실시간 반영이 되도록 구성해봤으나, 다른 사용자가 로그인해도 그룹 채팅방 내의 사용자 목록에서 실시간 반영이 되지 않기 때문에 추가 수정을 해줄 생각이다. 구성한 내용이 제대로 적용되지 않는 이유를 몇가지 생각해보았는데, 첫 번째로 소켓 이벤트를 전달하는 to 관련 내용에서 방 번호를 통해 전달하는데 애초에 로그인한 사용자는 방 번호를 따로 가지고 있지 않으므로 사용자가 로그인하면 참여한 모든 방에 참여하는 그런 내용이 있으면 해결이 될 수 있다고 생각이 되며, 두 번째로 그룹 채팅방 내의 사용자 목록을 불러오는 액션에 실시간 반영을 위한 소켓 이벤트를 추가했는데 해당 액션은 방에 참여할 때 실행되는 액션으로 이 내용에 구성하는 것이 잘못된 것은 아닌지 생각이 되어, 로그인 시에 작동되는 액션에 옮겨서 구성하는 것을 고려해봐야 한다. 여러 문제 원인에 대해 생각해보았고 수정하는 것도 어느정도 생각을 해본 상태이기 때문에, 차근차근 하나씩 수정하고 테스트해 다시 구성해볼 생각이다.

<br />

# 내일 할 일

- 실시간 통신 애플리케이션 (Float Chat) 프로젝트 진행

- Zustand 내용 구성

- 닉네임 수정과 그룹 채팅방 제목 수정 내용에서 사용하지 않거나 필요없는 정보를 삭제해 코드 정리를 해야 함 (중복된 데이터 전송이나 사용하지 않는 데이터 전송 관련 내용 등)

- 그룹 채팅방에서 다른 사용자를 클릭할 수 있고, 클릭 시에 다이렉트 채팅방이 생성되어 채팅을 나눌 수 있도록 구성하는 것을 고려중 (이 방법 대신, 다른 사용자 클릭 시에 프로필이 보여지도록 구성하고 그 내용을 통해 다이렉트 메시지를 보내거나 프로필 내용을 보는 그런 방식으로 구성해야 함)

- 다이렉트 채팅방 목록이 정렬될 때 부드럽게 위로 올라가고 내려가는 CSS 적용 필요

- 친구 관련된 내용에서 코드 정리 필요 (코드를 깔끔하게 보이도록 수정 필요)

- 여러 Zustand에 구성된 실시간 반영 로직들이 재사용될 수 있도록 커스텀 훅에 옮겨서 구성하는 것을 고려해야 함

<br />

# 앞으로 해야 할 일

- React, TypeScript 공부

- React 상태 관리 도구인 Zustand 공부

- 실시간 통신 애플리케이션 프로젝트 제작
